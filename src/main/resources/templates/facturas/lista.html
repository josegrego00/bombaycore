<!DOCTYPE html>
<!-- Módulo Facturas - Ajustes visuales MiBombay -->
<!-- VARIABLES PRESERVADAS: facturas, totalElementos, tamanio, paginaActual, totalPaginas, fechaInicio, fechaFin -->
<!-- RUTAS PRESERVADAS: /facturas, /facturas/detalle/{id}, /facturas/anular/{id}, /principal -->

<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Facturas</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet" />

    <style>
        body {
            background-color: #f8fafc;
            font-family: "Segoe UI", system-ui, sans-serif;
        }

        h1 {
            font-weight: 700;
            color: #0a0a0f;
        }

        /* Cards */
        .card {
            border-radius: 14px;
            border: 2px solid #e2e8f0;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: "";
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background-color: #667eea;
        }

        /* Botones */
        .btn-primary {
            background-color: #667eea;
            border: 2px solid #764ba2;
            font-weight: 600;
        }

        .btn-primary:hover {
            background-color: #764ba2;
        }

        .btn-secondary {
            background-color: #0a0a0f;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background-color: #764ba2;
        }

        .btn-info {
            background-color: #667eea;
            border: none;
            color: white;
        }

        .btn-warning {
            background-color: #ffd166;
            border: none;
            font-weight: 600;
        }

        /* Badges */
        .badge {
            padding: 6px 10px;
            font-size: 0.75rem;
            border-radius: 8px;
            font-weight: 600;
        }

        .badge.bg-warning {
            background-color: #ffd166 !important;
            color: #0a0a0f;
        }

        .badge.bg-success {
            background-color: #06d6a0 !important;
        }

        .badge.bg-danger {
            background-color: #ef476f !important;
        }

        .badge.bg-info {
            background-color: #667eea !important;
            color: #ffffff;
        }

        /* Tabla */
        .table thead {
            background-color: #0a0a0f;
            color: white;
        }

        .table th {
            font-weight: 600;
            border-bottom: 3px solid #667eea;
        }

        .table td {
            vertical-align: middle;
        }

        .table-hover tbody tr:hover {
            background-color: #edf2ff;
        }

        /* Paginación */
        .pagination .page-link {
            color: #667eea;
            border: 2px solid #e2e8f0;
        }

        .pagination .active .page-link {
            background-color: #667eea;
            border-color: #764ba2;
            color: white;
            font-weight: 700;
        }

        /* Select */
        .form-select {
            border: 2px solid #e2e8f0;
        }

        .form-control {
            border: 2px solid #e2e8f0;
        }

        .form-control:focus,
        .form-select:focus {
            border-color: #667eea;
            box-shadow: none;
        }
    </style>
</head>

<body>
<div class="container mt-4">

    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1><i class="bi bi-receipt me-2"></i>Facturas</h1>
        <a th:href="@{/principal}" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Volver
        </a>
    </div>

    <!-- FILTROS -->
    <div class="card mb-4">
        <div class="card-body">
            <form method="get" class="row g-3">
                <input type="hidden" name="pagina" value="0">
                <input type="hidden" name="tamanio" th:value="${tamanio}">

                <div class="col-md-4">
                    <label class="form-label fw-bold">Fecha desde</label>
                    <input type="date" class="form-control" name="fechaInicio"
                           th:value="${fechaInicio != null ? #temporals.format(fechaInicio, 'yyyy-MM-dd') : ''}">
                </div>

                <div class="col-md-4">
                    <label class="form-label fw-bold">Fecha hasta</label>
                    <input type="date" class="form-control" name="fechaFin"
                           th:value="${fechaFin != null ? #temporals.format(fechaFin, 'yyyy-MM-dd') : ''}">
                </div>

                <div class="col-md-4 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary me-2">
                        <i class="bi bi-search"></i> Buscar
                    </button>
                    <a th:href="@{/facturas}" class="btn btn-outline-secondary">
                        <i class="bi bi-x-circle"></i> Limpiar
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!-- TABLA -->
    <div class="card">
        <div class="card-body table-responsive">
            <table class="table table-hover">
                <thead>
                <tr>
                    <th>No. Factura</th>
                    <th>Fecha</th>
                    <th>Cliente</th>
                    <th>Estado</th>
                    <th>Total</th>
                    <th>Acciones</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="factura : ${facturas}">
                    <td th:text="${factura.numeroFactura}"></td>
                    <td th:text="${#temporals.format(factura.fecha, 'dd/MM/yyyy HH:mm')}"></td>
                    <td>
                        <span th:if="${factura.cliente != null}"
                              th:text="${factura.cliente.nombre}"
                              class="badge bg-info"></span>
                        <span th:unless="${factura.cliente != null}" class="text-muted">
                            Consumidor Final
                        </span>
                    </td>
                    <td>
                        <span th:if="${factura.estado == 'PENDIENTE'}" class="badge bg-warning">Pendiente</span>
                        <span th:if="${factura.estado == 'PAGADA'}" class="badge bg-success">Pagada</span>
                        <span th:if="${factura.estado == 'ANULADA'}" class="badge bg-danger">Anulada</span>
                    </td>
                    <td th:text="${'$' + #numbers.formatDecimal(factura.total, 1, 2)}"></td>
                    <td>
                        <a th:href="@{/facturas/detalle/{id}(id=${factura.id})}" class="btn btn-sm btn-info">
                            Ver
                        </a>
                        <a th:if="${factura.estado == 'PAGADA'}"
                           th:href="@{/facturas/anular/{id}(id=${factura.id})}"
                           class="btn btn-sm btn-warning"
                           onclick="return confirm('¿Anular esta factura?')">
                            Anular
                        </a>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
