2026-01-25 13:02:07 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing POST /logout
2026-01-25 13:02:07 [http-nio-8080-exec-2] DEBUG o.s.security.web.csrf.CsrfFilter - Invalid CSRF token found for http://defecto.localhost:8080/logout
2026-01-25 13:02:07 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AccessDeniedHandlerImpl - Forwarding to /acceso-denegado with status code 403
2026-01-25 13:02:07 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing POST /acceso-denegado
2026-01-25 13:02:07 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured POST /acceso-denegado
2026-01-25 13:02:07 [http-nio-8080-exec-2] WARN  o.s.w.s.m.s.DefaultHandlerExceptionResolver - Resolved [org.springframework.web.HttpRequestMethodNotSupportedException: Request method 'POST' is not supported]
2026-01-25 13:02:07 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-25 13:02:07 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing POST /error
2026-01-25 13:02:07 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured POST /error
2026-01-25 13:02:07 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-25 13:02:17 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /
2026-01-25 13:02:17 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /
2026-01-25 13:02:17 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /, M√©todo: GET
2026-01-25 13:02:17 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-25 13:02:17 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-25 13:02:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-25 13:02:17 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-25 13:02:17 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 43
2026-01-25 13:02:17 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-25 13:02:17 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-25 13:02:17 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /, Empresa ID: 1
2026-01-25 13:02:17 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-25, Hora: 13:00
2026-01-25 13:02:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-25 13:02:17 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-25 13:02:17 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-25 13:02:17 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-25 13:02:17 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-24
2026-01-25 13:02:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-25 13:02:17 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-24]
2026-01-25 13:02:17 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-25 13:02:17 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-25 13:02:17 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-24 cerrado?: false (Empresa ID: 1)
2026-01-25 13:02:17 [http-nio-8080-exec-3] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-24 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-25 13:02:17 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 43, Tenant anterior: 1
2026-01-25 13:02:17 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /, Empresa ID anterior: 1
2026-01-25 13:02:17 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-24
2026-01-25 13:02:17 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-25 13:02:17 [http-nio-8080-exec-4] DEBUG o.s.s.w.s.HttpSessionRequestCache - Saved request http://defecto.localhost:8080/cierres/obligatorio?fecha=2026-01-24&continue to session
2026-01-25 13:02:17 [http-nio-8080-exec-4] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to http://defecto.localhost:8080/login
2026-01-25 13:02:17 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login
2026-01-25 13:02:17 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login
2026-01-25 13:02:17 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-25 13:02:17 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-25 13:02:17 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-25 13:02:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-25 13:02:17 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-25 13:02:17 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 45
2026-01-25 13:02:17 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-25 13:02:17 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-25 13:02:17 [http-nio-8080-exec-5] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-25 13:02:17 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 45, Tenant anterior: 1
2026-01-25 13:02:17 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 45, Request: /login, Empresa ID anterior: 1
2026-01-25 13:02:22 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-25 13:02:22 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: admin para la empresa ID: null
2026-01-25 13:02:22 [http-nio-8080-exec-6] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: defecto
2026-01-25 13:02:22 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-25 13:02:22 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-25 13:02:22 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: defecto | Empresa ID: 1 | Empresa Nombre: Sistema por Defecto
2026-01-25 13:02:22 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-25 13:02:22 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-25 13:02:22 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:02:22 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:02:22 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:22 [http-nio-8080-exec-6] INFO  j.s.s.servicios.UsuarioServicio - üîê Encontrado usuario: admin
2026-01-25 13:02:22 [http-nio-8080-exec-6] INFO  j.s.s.servicios.UsuarioServicio - üîê Rol: ADMIN
2026-01-25 13:02:22 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - üîê Activo: true
2026-01-25 13:02:22 [http-nio-8080-exec-6] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Authenticated user
2026-01-25 13:02:22 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.s.ChangeSessionIdAuthenticationStrategy - Changed session id from CAB428E1CB594BEFAC92C68009F5E762
2026-01-25 13:02:22 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.CsrfAuthenticationStrategy - Replaced CSRF Token
2026-01-25 13:02:22 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Stored SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=CAB428E1CB594BEFAC92C68009F5E762], Granted Authorities=[ROLE_ADMIN]]] to HttpSession [org.apache.catalina.session.StandardSessionFacade@1edf9de2]
2026-01-25 13:02:22 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.UsernamePasswordAuthenticationFilter - Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=CAB428E1CB594BEFAC92C68009F5E762], Granted Authorities=[ROLE_ADMIN]]
2026-01-25 13:02:22 [http-nio-8080-exec-6] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /principal
2026-01-25 13:02:22 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-25 13:02:22 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=CAB428E1CB594BEFAC92C68009F5E762], Granted Authorities=[ROLE_ADMIN]]]
2026-01-25 13:02:22 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-25 13:02:22 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-25 13:02:22 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-25 13:02:22 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-25 13:02:22 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-25 13:02:22 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-25 13:02:22 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 47
2026-01-25 13:02:22 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-25 13:02:22 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-25 13:02:22 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-25 13:02:22 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-25 13:02:22 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-25 13:02:22 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:02:22 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:02:22 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:22 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-25 13:02:22 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 1
2026-01-25 13:02:22 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-25, Hora: 13:00
2026-01-25 13:02:22 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-25 13:02:22 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-25 13:02:22 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-25 13:02:22 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-25 13:02:22 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-24
2026-01-25 13:02:22 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-25 13:02:22 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-24]
2026-01-25 13:02:22 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-25 13:02:22 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-25 13:02:22 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-24 cerrado?: false (Empresa ID: 1)
2026-01-25 13:02:22 [http-nio-8080-exec-7] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-24 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-25 13:02:22 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 47, Tenant anterior: 1
2026-01-25 13:02:22 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 47, Request: /principal, Empresa ID anterior: 1
2026-01-25 13:02:22 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-24
2026-01-25 13:02:22 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=CAB428E1CB594BEFAC92C68009F5E762], Granted Authorities=[ROLE_ADMIN]]]
2026-01-25 13:02:22 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/obligatorio?fecha=2026-01-24
2026-01-25 13:02:22 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/obligatorio, M√©todo: GET
2026-01-25 13:02:22 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-25 13:02:22 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-25 13:02:22 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-25 13:02:22 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-25 13:02:22 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 48
2026-01-25 13:02:22 [http-nio-8080-exec-8] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-25 13:02:22 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-25 13:02:22 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-25 13:02:22 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-25 13:02:22 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-25 13:02:22 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:02:22 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:02:22 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:22 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-25 13:02:22 [http-nio-8080-exec-8] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚è∞ GET /cierres/obligatorio - Verificando cierre obligatorio
2026-01-25 13:02:22 [http-nio-8080-exec-8] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Hora actual: 13:00, Fecha: 2026-01-25
2026-01-25 13:02:22 [http-nio-8080-exec-8] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Fecha proporcionada: 2026-01-24
2026-01-25 13:02:22 [http-nio-8080-exec-8] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚ö†Ô∏è Cierre obligatorio requerido para fecha: 2026-01-24
2026-01-25 13:02:22 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 48, Tenant anterior: 1
2026-01-25 13:02:22 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 48, Request: /cierres/obligatorio, Empresa ID anterior: 1
2026-01-25 13:02:39 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres
2026-01-25 13:02:39 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=CAB428E1CB594BEFAC92C68009F5E762], Granted Authorities=[ROLE_ADMIN]]]
2026-01-25 13:02:39 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres
2026-01-25 13:02:39 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres, M√©todo: GET
2026-01-25 13:02:39 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-25 13:02:39 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-25 13:02:39 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-25 13:02:39 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-25 13:02:39 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 49
2026-01-25 13:02:39 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-25 13:02:39 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-25 13:02:39 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-25 13:02:39 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-25 13:02:39 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-25 13:02:39 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:02:39 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:02:39 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:39 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-25 13:02:39 [http-nio-8080-exec-9] INFO  j.s.s.c.CierreInventarioDiarioControlador - üìã GET /cierres - Listando cierres diarios
2026-01-25 13:02:39 [http-nio-8080-exec-9] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo todos los cierres para empresa ID: 1
2026-01-25 13:02:39 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        e1_0.id=?
2026-01-25 13:02:39 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:39 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:02:39 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:39 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-25 13:02:39 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:39 [http-nio-8080-exec-9] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 3 cierres para empresa ID: 1
2026-01-25 13:02:39 [http-nio-8080-exec-9] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Encontrados 3 cierres
2026-01-25 13:02:39 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 49, Tenant anterior: 1
2026-01-25 13:02:39 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 49, Request: /cierres, Empresa ID anterior: 1
2026-01-25 13:02:48 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/iniciar?fecha=2026-01-24
2026-01-25 13:02:48 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=CAB428E1CB594BEFAC92C68009F5E762], Granted Authorities=[ROLE_ADMIN]]]
2026-01-25 13:02:48 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/iniciar?fecha=2026-01-24
2026-01-25 13:02:48 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/iniciar, M√©todo: GET
2026-01-25 13:02:48 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-25 13:02:48 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-25 13:02:48 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-25 13:02:48 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 50
2026-01-25 13:02:48 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-25 13:02:48 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-25 13:02:48 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-25 13:02:48 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:02:48 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:48 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-25 13:02:48 [http-nio-8080-exec-10] INFO  j.s.s.c.CierreInventarioDiarioControlador - üöÄ GET /cierres/iniciar - Iniciando nuevo cierre. Usuario: admin, Fecha: 2026-01-24
2026-01-25 13:02:48 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-25 13:02:48 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:02:48 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:48 [http-nio-8080-exec-10] INFO  j.s.s.s.CierreInventarioDiarioService - Iniciando cierre para fecha espec√≠fica: 2026-01-24 para empresa ID: 1, Usuario: admin
2026-01-25 13:02:48 [http-nio-8080-exec-10] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@1904844259 wrapping com.mysql.cj.jdbc.ConnectionImpl@7827e241] read-only
2026-01-25 13:02:48 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:48 [http-nio-8080-exec-10] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@1904844259 wrapping com.mysql.cj.jdbc.ConnectionImpl@7827e241]
2026-01-25 13:02:48 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.fecha=? 
        and e1_0.id=?
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-24]
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:02:48 [http-nio-8080-exec-10] DEBUG j.s.s.s.CierreInventarioDiarioService - No hay cierre existente para fecha: 2026-01-24
2026-01-25 13:02:48 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        cierre_inventario_diario
        (cantidad_facturas, empresa_id, estado, fecha, observaciones, total_ventas, usuario_id) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:INTEGER) <- [0]
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [EN_PROCESO]
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DATE) <- [2026-01-24]
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [Cierre para fecha espec√≠fica 2026-01-24]
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DOUBLE) <- [0.0]
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:BIGINT) <- [1]
2026-01-25 13:02:48 [http-nio-8080-exec-10] INFO  j.s.s.s.CierreInventarioDiarioService - ‚úÖ Cierre creado para fecha espec√≠fica ID: 4 - Fecha: 2026-01-24, Usuario: admin
2026-01-25 13:02:48 [http-nio-8080-exec-10] DEBUG j.s.s.s.CierreInventarioDiarioService - Precargando detalles para cierre ID: 4
2026-01-25 13:02:48 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    left join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        e1_0.id=?
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:48 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:48 [http-nio-8080-exec-10] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 2 ingredientes para empresa ID: 1
2026-01-25 13:02:48 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        p1_0.receta_id,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta 
    from
        producto p1_0 
    left join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        e1_0.id=? 
        and not(p1_0.tiene_receta)
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:48 [http-nio-8080-exec-10] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 0 productos sin receta para empresa ID: 1
2026-01-25 13:02:48 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        detalle_cierre_inventario_diario
        (cierre_id, costo_unitario, diferencia, ingrediente_id, producto_id, stock_desperdicio, stock_merma, stock_real, stock_teorico, valor_diferencia) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [4]
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:DOUBLE) <- [2500.0]
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:DOUBLE) <- [0.0]
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [2]
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:BIGINT) <- [null]
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DOUBLE) <- [0.0]
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:DOUBLE) <- [0.0]
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:DOUBLE) <- [0.0]
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:DOUBLE) <- [345.0]
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:DOUBLE) <- [0.0]
2026-01-25 13:02:48 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        detalle_cierre_inventario_diario
        (cierre_id, costo_unitario, diferencia, ingrediente_id, producto_id, stock_desperdicio, stock_merma, stock_real, stock_teorico, valor_diferencia) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [4]
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:DOUBLE) <- [4500.0]
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:DOUBLE) <- [0.0]
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [1]
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:BIGINT) <- [null]
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DOUBLE) <- [0.0]
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:DOUBLE) <- [0.0]
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:DOUBLE) <- [0.0]
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:DOUBLE) <- [0.0]
2026-01-25 13:02:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:DOUBLE) <- [0.0]
2026-01-25 13:02:48 [http-nio-8080-exec-10] INFO  j.s.s.s.CierreInventarioDiarioService - Detalles precargados: 2 totales para cierre ID: 4
2026-01-25 13:02:48 [http-nio-8080-exec-10] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚úÖ Cierre iniciado para fecha espec√≠fica: 2026-01-24 por usuario: admin
2026-01-25 13:02:48 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 50, Tenant anterior: 1
2026-01-25 13:02:48 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 50, Request: /cierres/iniciar, Empresa ID anterior: 1
2026-01-25 13:02:48 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/en-proceso
2026-01-25 13:02:48 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=CAB428E1CB594BEFAC92C68009F5E762], Granted Authorities=[ROLE_ADMIN]]]
2026-01-25 13:02:48 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/en-proceso
2026-01-25 13:02:48 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/en-proceso, M√©todo: GET
2026-01-25 13:02:48 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-25 13:02:48 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-25 13:02:48 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-25 13:02:48 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-25 13:02:48 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 41
2026-01-25 13:02:48 [http-nio-8080-exec-1] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-25 13:02:48 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-25 13:02:48 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-25 13:02:48 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-25 13:02:48 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-25 13:02:48 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:02:48 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:02:48 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:48 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-25 13:02:48 [http-nio-8080-exec-1] INFO  j.s.s.c.CierreInventarioDiarioControlador - üîç GET /cierres/en-proceso - Viendo cierre en proceso
2026-01-25 13:02:48 [http-nio-8080-exec-1] DEBUG j.s.s.s.CierreInventarioDiarioService - Buscando cierre en proceso para empresa ID: 1
2026-01-25 13:02:48 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.estado=? 
        and e1_0.id=?
2026-01-25 13:02:48 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [EN_PROCESO]
2026-01-25 13:02:48 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:02:48 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:02:48 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:48 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-25 13:02:48 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:48 [http-nio-8080-exec-1] DEBUG j.s.s.s.CierreInventarioDiarioService - Cierre en proceso encontrado ID: 4 para empresa ID: 1
2026-01-25 13:02:48 [http-nio-8080-exec-1] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo detalles para cierre ID: 4
2026-01-25 13:02:48 [http-nio-8080-exec-1] DEBUG j.s.s.s.CierreInventarioDiarioService - Buscando cierre ID: 4 para empresa ID: 1
2026-01-25 13:02:48 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.id=? 
        and e1_0.id=?
2026-01-25 13:02:48 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [4]
2026-01-25 13:02:48 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:02:48 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:02:48 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:48 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-25 13:02:48 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:48 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        dcid1_0.ingrediente_id,
        dcid1_0.producto_id,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    where
        dcid1_0.cierre_id=?
2026-01-25 13:02:48 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [4]
2026-01-25 13:02:48 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        s1_0.nombre,
        s1_0.telefono 
    from
        cierre_inventario_diario cid1_0 
    join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=cid1_0.usuario_id 
    left join
        empresa e2_0 
            on e2_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    where
        cid1_0.id=?
2026-01-25 13:02:48 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [4]
2026-01-25 13:02:48 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-25 13:02:48 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-25 13:02:48 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-25 13:02:48 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:48 [http-nio-8080-exec-1] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 2 detalles para cierre ID: 4
2026-01-25 13:02:48 [http-nio-8080-exec-1] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Cierre en proceso ID: 4, Estado: EN_PROCESO, Detalles: 2, Total diferencia: 0.0
2026-01-25 13:02:48 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 41, Tenant anterior: 1
2026-01-25 13:02:48 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 41, Request: /cierres/en-proceso, Empresa ID anterior: 1
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing POST /cierres/completar/4
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=CAB428E1CB594BEFAC92C68009F5E762], Granted Authorities=[ROLE_ADMIN]]]
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured POST /cierres/completar/4
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/completar/4, M√©todo: POST
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 42
2026-01-25 13:02:53 [http-nio-8080-exec-2] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-25 13:02:53 [http-nio-8080-exec-2] INFO  j.s.s.c.CierreInventarioDiarioControlador - üìù POST /cierres/completar/4 - Completando cierre (PRE-COMPLETADO)
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Recibidos 2 detalles para guardar
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG j.s.s.s.CierreInventarioDiarioService - Actualizando detalle ID: 5 para empresa ID: 1
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        dcid1_0.ingrediente_id,
        dcid1_0.producto_id,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    left join
        cierre_inventario_diario c1_0 
            on c1_0.id=dcid1_0.cierre_id 
    left join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    where
        dcid1_0.id=? 
        and e1_0.id=?
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        s1_0.nombre,
        s1_0.telefono 
    from
        cierre_inventario_diario cid1_0 
    join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=cid1_0.usuario_id 
    left join
        empresa e2_0 
            on e2_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    where
        cid1_0.id=?
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [4]
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        c1_0.id,
        c1_0.cantidad_facturas,
        c1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        c1_0.estado,
        c1_0.fecha,
        c1_0.observaciones,
        c1_0.total_ventas,
        c1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e3_0.id,
        e3_0.email_contacto,
        e3_0.estado,
        e3_0.fecha_creacion,
        e3_0.nombre,
        e3_0.plan,
        e3_0.subdominio,
        e3_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida,
        rd1_0.ingrediente_id,
        rd1_0.id,
        rd1_0.cantidad_ingrediente,
        rd1_0.receta_id,
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        e4_0.id,
        e4_0.email_contacto,
        e4_0.estado,
        e4_0.fecha_creacion,
        e4_0.nombre,
        e4_0.plan,
        e4_0.subdominio,
        e4_0.telefono,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        r2_0.id,
        r2_0.costo_receta,
        r2_0.descripcion,
        r2_0.empresa_id,
        r2_0.nombre,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    join
        cierre_inventario_diario c1_0 
            on c1_0.id=dcid1_0.cierre_id 
    join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=c1_0.usuario_id 
    left join
        ingrediente i1_0 
            on i1_0.id=dcid1_0.ingrediente_id 
    left join
        empresa e3_0 
            on e3_0.id=i1_0.empresa_id 
    left join
        receta_detalle rd1_0 
            on i1_0.id=rd1_0.ingrediente_id 
    left join
        producto p1_0 
            on p1_0.id=dcid1_0.producto_id 
    left join
        empresa e4_0 
            on e4_0.id=p1_0.empresa_id 
    left join
        receta r2_0 
            on r2_0.id=p1_0.receta_id 
    where
        dcid1_0.id=?
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        r1_0.nombre,
        i1_0.receta_id,
        i1_0.id,
        i1_0.cantidad_ingrediente,
        i1_0.ingrediente_id,
        i2_0.id,
        i2_0.activo,
        i2_0.empresa_id,
        i2_0.nombre,
        i2_0.precio,
        i2_0.stock_actual,
        i2_0.stock_minimo,
        i2_0.unidad_medida 
    from
        receta r1_0 
    join
        empresa e1_0 
            on e1_0.id=r1_0.empresa_id 
    left join
        receta_detalle i1_0 
            on r1_0.id=i1_0.receta_id 
    left join
        ingrediente i2_0 
            on i2_0.id=i1_0.ingrediente_id 
    where
        r1_0.id=?
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        d1_0.cierre_id,
        d1_0.id,
        d1_0.costo_unitario,
        d1_0.diferencia,
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida,
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        r1_0.nombre,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta,
        d1_0.stock_desperdicio,
        d1_0.stock_merma,
        d1_0.stock_real,
        d1_0.stock_teorico,
        d1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario d1_0 
    left join
        ingrediente i1_0 
            on i1_0.id=d1_0.ingrediente_id 
    left join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    left join
        producto p1_0 
            on p1_0.id=d1_0.producto_id 
    left join
        empresa e2_0 
            on e2_0.id=p1_0.empresa_id 
    left join
        receta r1_0 
            on r1_0.id=p1_0.receta_id 
    where
        d1_0.cierre_id=?
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [4]
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    update
        detalle_cierre_inventario_diario 
    set
        cierre_id=?,
        costo_unitario=?,
        diferencia=?,
        ingrediente_id=?,
        producto_id=?,
        stock_desperdicio=?,
        stock_merma=?,
        stock_real=?,
        stock_teorico=?,
        valor_diferencia=? 
    where
        id=?
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [4]
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:DOUBLE) <- [2500.0]
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:DOUBLE) <- [0.0]
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [2]
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:BIGINT) <- [null]
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DOUBLE) <- [0.0]
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:DOUBLE) <- [0.0]
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:DOUBLE) <- [345.0]
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:DOUBLE) <- [345.0]
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:DOUBLE) <- [0.0]
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:BIGINT) <- [5]
2026-01-25 13:02:53 [http-nio-8080-exec-2] INFO  j.s.s.s.CierreInventarioDiarioService - Detalle actualizado ID: 5, Stock real: 345.0, Diferencia: 0.0, Valor diferencia: 0.0
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG j.s.s.s.CierreInventarioDiarioService - Actualizando detalle ID: 6 para empresa ID: 1
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        dcid1_0.ingrediente_id,
        dcid1_0.producto_id,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    left join
        cierre_inventario_diario c1_0 
            on c1_0.id=dcid1_0.cierre_id 
    left join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    where
        dcid1_0.id=? 
        and e1_0.id=?
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [6]
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        s1_0.nombre,
        s1_0.telefono 
    from
        cierre_inventario_diario cid1_0 
    join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=cid1_0.usuario_id 
    left join
        empresa e2_0 
            on e2_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    where
        cid1_0.id=?
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [4]
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        c1_0.id,
        c1_0.cantidad_facturas,
        c1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        c1_0.estado,
        c1_0.fecha,
        c1_0.observaciones,
        c1_0.total_ventas,
        c1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e3_0.id,
        e3_0.email_contacto,
        e3_0.estado,
        e3_0.fecha_creacion,
        e3_0.nombre,
        e3_0.plan,
        e3_0.subdominio,
        e3_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida,
        rd1_0.ingrediente_id,
        rd1_0.id,
        rd1_0.cantidad_ingrediente,
        rd1_0.receta_id,
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        e4_0.id,
        e4_0.email_contacto,
        e4_0.estado,
        e4_0.fecha_creacion,
        e4_0.nombre,
        e4_0.plan,
        e4_0.subdominio,
        e4_0.telefono,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        r2_0.id,
        r2_0.costo_receta,
        r2_0.descripcion,
        r2_0.empresa_id,
        r2_0.nombre,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    join
        cierre_inventario_diario c1_0 
            on c1_0.id=dcid1_0.cierre_id 
    join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=c1_0.usuario_id 
    left join
        ingrediente i1_0 
            on i1_0.id=dcid1_0.ingrediente_id 
    left join
        empresa e3_0 
            on e3_0.id=i1_0.empresa_id 
    left join
        receta_detalle rd1_0 
            on i1_0.id=rd1_0.ingrediente_id 
    left join
        producto p1_0 
            on p1_0.id=dcid1_0.producto_id 
    left join
        empresa e4_0 
            on e4_0.id=p1_0.empresa_id 
    left join
        receta r2_0 
            on r2_0.id=p1_0.receta_id 
    where
        dcid1_0.id=?
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [6]
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        r1_0.nombre,
        i1_0.receta_id,
        i1_0.id,
        i1_0.cantidad_ingrediente,
        i1_0.ingrediente_id,
        i2_0.id,
        i2_0.activo,
        i2_0.empresa_id,
        i2_0.nombre,
        i2_0.precio,
        i2_0.stock_actual,
        i2_0.stock_minimo,
        i2_0.unidad_medida 
    from
        receta r1_0 
    join
        empresa e1_0 
            on e1_0.id=r1_0.empresa_id 
    left join
        receta_detalle i1_0 
            on r1_0.id=i1_0.receta_id 
    left join
        ingrediente i2_0 
            on i2_0.id=i1_0.ingrediente_id 
    where
        r1_0.id=?
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        d1_0.cierre_id,
        d1_0.id,
        d1_0.costo_unitario,
        d1_0.diferencia,
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida,
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        r1_0.nombre,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta,
        d1_0.stock_desperdicio,
        d1_0.stock_merma,
        d1_0.stock_real,
        d1_0.stock_teorico,
        d1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario d1_0 
    left join
        ingrediente i1_0 
            on i1_0.id=d1_0.ingrediente_id 
    left join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    left join
        producto p1_0 
            on p1_0.id=d1_0.producto_id 
    left join
        empresa e2_0 
            on e2_0.id=p1_0.empresa_id 
    left join
        receta r1_0 
            on r1_0.id=p1_0.receta_id 
    where
        d1_0.cierre_id=?
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [4]
2026-01-25 13:02:53 [http-nio-8080-exec-2] INFO  j.s.s.s.CierreInventarioDiarioService - Detalle actualizado ID: 6, Stock real: 0.0, Diferencia: 0.0, Valor diferencia: 0.0
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG j.s.s.c.CierreInventarioDiarioControlador - 2 detalles actualizados
2026-01-25 13:02:53 [http-nio-8080-exec-2] INFO  j.s.s.s.CierreInventarioDiarioService - Completando cierre ID: 4 para empresa ID: 1
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.id=? 
        and e1_0.id=?
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [4]
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        dcid1_0.ingrediente_id,
        dcid1_0.producto_id,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    where
        dcid1_0.cierre_id=?
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [4]
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        s1_0.nombre,
        s1_0.telefono 
    from
        cierre_inventario_diario cid1_0 
    join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=cid1_0.usuario_id 
    left join
        empresa e2_0 
            on e2_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    where
        cid1_0.id=?
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [4]
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        s1_0.nombre,
        s1_0.telefono,
        d1_0.cierre_id,
        d1_0.id,
        d1_0.costo_unitario,
        d1_0.diferencia,
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida,
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        p1_0.receta_id,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta,
        d1_0.stock_desperdicio,
        d1_0.stock_merma,
        d1_0.stock_real,
        d1_0.stock_teorico,
        d1_0.valor_diferencia 
    from
        cierre_inventario_diario cid1_0 
    join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=cid1_0.usuario_id 
    left join
        empresa e2_0 
            on e2_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        detalle_cierre_inventario_diario d1_0 
            on cid1_0.id=d1_0.cierre_id 
    left join
        ingrediente i1_0 
            on i1_0.id=d1_0.ingrediente_id 
    left join
        producto p1_0 
            on p1_0.id=d1_0.producto_id 
    where
        cid1_0.id=?
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [4]
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        rd1_0.ingrediente_id,
        rd1_0.id,
        rd1_0.cantidad_ingrediente,
        rd1_0.receta_id,
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        r1_0.nombre 
    from
        receta_detalle rd1_0 
    left join
        receta r1_0 
            on r1_0.id=rd1_0.receta_id 
    left join
        empresa e1_0 
            on e1_0.id=r1_0.empresa_id 
    where
        rd1_0.ingrediente_id=?
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        rd1_0.ingrediente_id,
        rd1_0.id,
        rd1_0.cantidad_ingrediente,
        rd1_0.receta_id,
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        r1_0.nombre 
    from
        receta_detalle rd1_0 
    left join
        receta r1_0 
            on r1_0.id=rd1_0.receta_id 
    left join
        empresa e1_0 
            on e1_0.id=r1_0.empresa_id 
    where
        rd1_0.ingrediente_id=?
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    update
        cierre_inventario_diario 
    set
        cantidad_facturas=?,
        empresa_id=?,
        estado=?,
        fecha=?,
        observaciones=?,
        total_ventas=?,
        usuario_id=? 
    where
        id=?
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:INTEGER) <- [0]
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [PRE-COMPLETADO]
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DATE) <- [2026-01-24]
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [Cierre para fecha espec√≠fica 2026-01-24]
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DOUBLE) <- [0.0]
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:BIGINT) <- [1]
2026-01-25 13:02:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:BIGINT) <- [4]
2026-01-25 13:02:53 [http-nio-8080-exec-2] INFO  j.s.s.s.CierreInventarioDiarioService - Cierre marcado como PRE-COMPLETADO ID: 4 para empresa ID: 1
2026-01-25 13:02:53 [http-nio-8080-exec-2] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚úÖ Cierre marcado como PRE-COMPLETADO ID: 4
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 42, Tenant anterior: 1
2026-01-25 13:02:53 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 42, Request: /cierres/completar/4, Empresa ID anterior: 1
2026-01-25 13:02:53 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres
2026-01-25 13:02:53 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=CAB428E1CB594BEFAC92C68009F5E762], Granted Authorities=[ROLE_ADMIN]]]
2026-01-25 13:02:53 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres
2026-01-25 13:02:53 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres, M√©todo: GET
2026-01-25 13:02:53 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-25 13:02:53 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-25 13:02:53 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-25 13:02:53 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-25 13:02:53 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 43
2026-01-25 13:02:53 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-25 13:02:53 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-25 13:02:53 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-25 13:02:53 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-25 13:02:53 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-25 13:02:53 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:02:53 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:02:53 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:53 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-25 13:02:53 [http-nio-8080-exec-3] INFO  j.s.s.c.CierreInventarioDiarioControlador - üìã GET /cierres - Listando cierres diarios
2026-01-25 13:02:53 [http-nio-8080-exec-3] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo todos los cierres para empresa ID: 1
2026-01-25 13:02:53 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        e1_0.id=?
2026-01-25 13:02:53 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:53 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:02:53 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:53 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-25 13:02:53 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:53 [http-nio-8080-exec-3] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 4 cierres para empresa ID: 1
2026-01-25 13:02:53 [http-nio-8080-exec-3] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Encontrados 4 cierres
2026-01-25 13:02:53 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 43, Tenant anterior: 1
2026-01-25 13:02:53 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /cierres, Empresa ID anterior: 1
2026-01-25 13:02:54 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/detalle/4
2026-01-25 13:02:54 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=CAB428E1CB594BEFAC92C68009F5E762], Granted Authorities=[ROLE_ADMIN]]]
2026-01-25 13:02:54 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/detalle/4
2026-01-25 13:02:54 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/detalle/4, M√©todo: GET
2026-01-25 13:02:54 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-25 13:02:54 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-25 13:02:54 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-25 13:02:54 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-25 13:02:54 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 44
2026-01-25 13:02:54 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-25 13:02:54 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-25 13:02:54 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-25 13:02:54 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-25 13:02:54 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-25 13:02:54 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:02:54 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:02:54 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:54 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-25 13:02:54 [http-nio-8080-exec-4] INFO  j.s.s.c.CierreInventarioDiarioControlador - üëÅÔ∏è GET /cierres/detalle/4 - Viendo detalles de cierre
2026-01-25 13:02:54 [http-nio-8080-exec-4] DEBUG j.s.s.s.CierreInventarioDiarioService - Buscando cierre ID: 4 para empresa ID: 1
2026-01-25 13:02:54 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.id=? 
        and e1_0.id=?
2026-01-25 13:02:54 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [4]
2026-01-25 13:02:54 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:02:54 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:02:54 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:54 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-25 13:02:54 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:54 [http-nio-8080-exec-4] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo detalles para cierre ID: 4
2026-01-25 13:02:54 [http-nio-8080-exec-4] DEBUG j.s.s.s.CierreInventarioDiarioService - Buscando cierre ID: 4 para empresa ID: 1
2026-01-25 13:02:54 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.id=? 
        and e1_0.id=?
2026-01-25 13:02:54 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [4]
2026-01-25 13:02:54 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:02:54 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:02:54 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:54 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-25 13:02:54 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:54 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        dcid1_0.ingrediente_id,
        dcid1_0.producto_id,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    where
        dcid1_0.cierre_id=?
2026-01-25 13:02:54 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [4]
2026-01-25 13:02:54 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        s1_0.nombre,
        s1_0.telefono 
    from
        cierre_inventario_diario cid1_0 
    join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=cid1_0.usuario_id 
    left join
        empresa e2_0 
            on e2_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    where
        cid1_0.id=?
2026-01-25 13:02:54 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [4]
2026-01-25 13:02:54 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-25 13:02:54 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-25 13:02:54 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-25 13:02:54 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:54 [http-nio-8080-exec-4] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 2 detalles para cierre ID: 4
2026-01-25 13:02:54 [http-nio-8080-exec-4] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Cierre ID: 4, Estado: PRE-COMPLETADO, Detalles: 2, Diferencia total: 0.0
2026-01-25 13:02:54 [http-nio-8080-exec-4] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Cierre PRE-COMPLETADO, mostrando vista para editar
2026-01-25 13:02:54 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 44, Tenant anterior: 1
2026-01-25 13:02:54 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 44, Request: /cierres/detalle/4, Empresa ID anterior: 1
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing POST /cierres/completar-definitivo/4
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=CAB428E1CB594BEFAC92C68009F5E762], Granted Authorities=[ROLE_ADMIN]]]
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured POST /cierres/completar-definitivo/4
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/completar-definitivo/4, M√©todo: POST
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 45
2026-01-25 13:02:55 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-25 13:02:55 [http-nio-8080-exec-5] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚úÖ POST /cierres/completar-definitivo/4 - Completando cierre definitivamente
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Actualizando 2 detalles antes de completar
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG j.s.s.s.CierreInventarioDiarioService - Actualizando detalle ID: 5 para empresa ID: 1
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        dcid1_0.ingrediente_id,
        dcid1_0.producto_id,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    left join
        cierre_inventario_diario c1_0 
            on c1_0.id=dcid1_0.cierre_id 
    left join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    where
        dcid1_0.id=? 
        and e1_0.id=?
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        s1_0.nombre,
        s1_0.telefono 
    from
        cierre_inventario_diario cid1_0 
    join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=cid1_0.usuario_id 
    left join
        empresa e2_0 
            on e2_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    where
        cid1_0.id=?
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [4]
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        c1_0.id,
        c1_0.cantidad_facturas,
        c1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        c1_0.estado,
        c1_0.fecha,
        c1_0.observaciones,
        c1_0.total_ventas,
        c1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e3_0.id,
        e3_0.email_contacto,
        e3_0.estado,
        e3_0.fecha_creacion,
        e3_0.nombre,
        e3_0.plan,
        e3_0.subdominio,
        e3_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida,
        rd1_0.ingrediente_id,
        rd1_0.id,
        rd1_0.cantidad_ingrediente,
        rd1_0.receta_id,
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        e4_0.id,
        e4_0.email_contacto,
        e4_0.estado,
        e4_0.fecha_creacion,
        e4_0.nombre,
        e4_0.plan,
        e4_0.subdominio,
        e4_0.telefono,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        r2_0.id,
        r2_0.costo_receta,
        r2_0.descripcion,
        r2_0.empresa_id,
        r2_0.nombre,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    join
        cierre_inventario_diario c1_0 
            on c1_0.id=dcid1_0.cierre_id 
    join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=c1_0.usuario_id 
    left join
        ingrediente i1_0 
            on i1_0.id=dcid1_0.ingrediente_id 
    left join
        empresa e3_0 
            on e3_0.id=i1_0.empresa_id 
    left join
        receta_detalle rd1_0 
            on i1_0.id=rd1_0.ingrediente_id 
    left join
        producto p1_0 
            on p1_0.id=dcid1_0.producto_id 
    left join
        empresa e4_0 
            on e4_0.id=p1_0.empresa_id 
    left join
        receta r2_0 
            on r2_0.id=p1_0.receta_id 
    where
        dcid1_0.id=?
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        r1_0.nombre,
        i1_0.receta_id,
        i1_0.id,
        i1_0.cantidad_ingrediente,
        i1_0.ingrediente_id,
        i2_0.id,
        i2_0.activo,
        i2_0.empresa_id,
        i2_0.nombre,
        i2_0.precio,
        i2_0.stock_actual,
        i2_0.stock_minimo,
        i2_0.unidad_medida 
    from
        receta r1_0 
    join
        empresa e1_0 
            on e1_0.id=r1_0.empresa_id 
    left join
        receta_detalle i1_0 
            on r1_0.id=i1_0.receta_id 
    left join
        ingrediente i2_0 
            on i2_0.id=i1_0.ingrediente_id 
    where
        r1_0.id=?
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        d1_0.cierre_id,
        d1_0.id,
        d1_0.costo_unitario,
        d1_0.diferencia,
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida,
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        r1_0.nombre,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta,
        d1_0.stock_desperdicio,
        d1_0.stock_merma,
        d1_0.stock_real,
        d1_0.stock_teorico,
        d1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario d1_0 
    left join
        ingrediente i1_0 
            on i1_0.id=d1_0.ingrediente_id 
    left join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    left join
        producto p1_0 
            on p1_0.id=d1_0.producto_id 
    left join
        empresa e2_0 
            on e2_0.id=p1_0.empresa_id 
    left join
        receta r1_0 
            on r1_0.id=p1_0.receta_id 
    where
        d1_0.cierre_id=?
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [4]
2026-01-25 13:02:55 [http-nio-8080-exec-5] INFO  j.s.s.s.CierreInventarioDiarioService - Detalle actualizado ID: 5, Stock real: 345.0, Diferencia: 0.0, Valor diferencia: 0.0
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG j.s.s.s.CierreInventarioDiarioService - Actualizando detalle ID: 6 para empresa ID: 1
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        dcid1_0.ingrediente_id,
        dcid1_0.producto_id,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    left join
        cierre_inventario_diario c1_0 
            on c1_0.id=dcid1_0.cierre_id 
    left join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    where
        dcid1_0.id=? 
        and e1_0.id=?
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [6]
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        s1_0.nombre,
        s1_0.telefono 
    from
        cierre_inventario_diario cid1_0 
    join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=cid1_0.usuario_id 
    left join
        empresa e2_0 
            on e2_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    where
        cid1_0.id=?
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [4]
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        c1_0.id,
        c1_0.cantidad_facturas,
        c1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        c1_0.estado,
        c1_0.fecha,
        c1_0.observaciones,
        c1_0.total_ventas,
        c1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e3_0.id,
        e3_0.email_contacto,
        e3_0.estado,
        e3_0.fecha_creacion,
        e3_0.nombre,
        e3_0.plan,
        e3_0.subdominio,
        e3_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida,
        rd1_0.ingrediente_id,
        rd1_0.id,
        rd1_0.cantidad_ingrediente,
        rd1_0.receta_id,
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        e4_0.id,
        e4_0.email_contacto,
        e4_0.estado,
        e4_0.fecha_creacion,
        e4_0.nombre,
        e4_0.plan,
        e4_0.subdominio,
        e4_0.telefono,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        r2_0.id,
        r2_0.costo_receta,
        r2_0.descripcion,
        r2_0.empresa_id,
        r2_0.nombre,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    join
        cierre_inventario_diario c1_0 
            on c1_0.id=dcid1_0.cierre_id 
    join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=c1_0.usuario_id 
    left join
        ingrediente i1_0 
            on i1_0.id=dcid1_0.ingrediente_id 
    left join
        empresa e3_0 
            on e3_0.id=i1_0.empresa_id 
    left join
        receta_detalle rd1_0 
            on i1_0.id=rd1_0.ingrediente_id 
    left join
        producto p1_0 
            on p1_0.id=dcid1_0.producto_id 
    left join
        empresa e4_0 
            on e4_0.id=p1_0.empresa_id 
    left join
        receta r2_0 
            on r2_0.id=p1_0.receta_id 
    where
        dcid1_0.id=?
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [6]
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        r1_0.nombre,
        i1_0.receta_id,
        i1_0.id,
        i1_0.cantidad_ingrediente,
        i1_0.ingrediente_id,
        i2_0.id,
        i2_0.activo,
        i2_0.empresa_id,
        i2_0.nombre,
        i2_0.precio,
        i2_0.stock_actual,
        i2_0.stock_minimo,
        i2_0.unidad_medida 
    from
        receta r1_0 
    join
        empresa e1_0 
            on e1_0.id=r1_0.empresa_id 
    left join
        receta_detalle i1_0 
            on r1_0.id=i1_0.receta_id 
    left join
        ingrediente i2_0 
            on i2_0.id=i1_0.ingrediente_id 
    where
        r1_0.id=?
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        d1_0.cierre_id,
        d1_0.id,
        d1_0.costo_unitario,
        d1_0.diferencia,
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida,
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        r1_0.nombre,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta,
        d1_0.stock_desperdicio,
        d1_0.stock_merma,
        d1_0.stock_real,
        d1_0.stock_teorico,
        d1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario d1_0 
    left join
        ingrediente i1_0 
            on i1_0.id=d1_0.ingrediente_id 
    left join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    left join
        producto p1_0 
            on p1_0.id=d1_0.producto_id 
    left join
        empresa e2_0 
            on e2_0.id=p1_0.empresa_id 
    left join
        receta r1_0 
            on r1_0.id=p1_0.receta_id 
    where
        d1_0.cierre_id=?
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [4]
2026-01-25 13:02:55 [http-nio-8080-exec-5] INFO  j.s.s.s.CierreInventarioDiarioService - Detalle actualizado ID: 6, Stock real: 0.0, Diferencia: 0.0, Valor diferencia: 0.0
2026-01-25 13:02:55 [http-nio-8080-exec-5] INFO  j.s.s.s.CierreInventarioDiarioService - Completando cierre definitivo ID: 4
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG j.s.s.s.CierreInventarioDiarioService - Buscando cierre ID: 4 para empresa ID: 1
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.id=? 
        and e1_0.id=?
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [4]
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG j.s.s.s.CierreInventarioDiarioService - Calculando ventas del d√≠a para cierre ID: 4
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG j.s.s.s.CierreInventarioDiarioService - Calculando ventas del d√≠a 2026-01-24 para empresa ID: 1
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        f1_0.id,
        f1_0.cliente_id,
        f1_0.empresa_id,
        f1_0.estado,
        f1_0.fecha,
        f1_0.forma_pago,
        f1_0.iva,
        f1_0.numero_factura,
        f1_0.subtotal,
        f1_0.total 
    from
        factura f1_0 
    left join
        empresa e1_0 
            on e1_0.id=f1_0.empresa_id 
    where
        f1_0.fecha=? 
        and f1_0.estado=? 
        and e1_0.id=?
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-24]
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [PAGADA]
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG j.s.s.s.CierreInventarioDiarioService - Ventas calculadas: 0 facturas, Total: 0.0 para fecha: 2026-01-24
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        dcid1_0.ingrediente_id,
        dcid1_0.producto_id,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    where
        dcid1_0.cierre_id=?
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [4]
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        s1_0.nombre,
        s1_0.telefono 
    from
        cierre_inventario_diario cid1_0 
    join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=cid1_0.usuario_id 
    left join
        empresa e2_0 
            on e2_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    where
        cid1_0.id=?
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [4]
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG j.s.s.s.CierreInventarioDiarioService - Ajustando inventario para 2 detalles
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG j.s.s.s.CierreInventarioDiarioService - Ajustando inventario para 2 detalles
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida,
        rd1_0.ingrediente_id,
        rd1_0.id,
        rd1_0.cantidad_ingrediente,
        rd1_0.receta_id,
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        r1_0.nombre 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    left join
        receta_detalle rd1_0 
            on i1_0.id=rd1_0.ingrediente_id 
    left join
        receta r1_0 
            on r1_0.id=rd1_0.receta_id 
    where
        i1_0.id=?
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        i1_0.receta_id,
        i1_0.id,
        i1_0.cantidad_ingrediente,
        i1_0.ingrediente_id,
        i2_0.id,
        i2_0.activo,
        i2_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i2_0.nombre,
        i2_0.precio,
        i2_0.stock_actual,
        i2_0.stock_minimo,
        i2_0.unidad_medida 
    from
        receta_detalle i1_0 
    left join
        ingrediente i2_0 
            on i2_0.id=i1_0.ingrediente_id 
    left join
        empresa e1_0 
            on e1_0.id=i2_0.empresa_id 
    where
        i1_0.receta_id=?
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida,
        rd1_0.ingrediente_id,
        rd1_0.id,
        rd1_0.cantidad_ingrediente,
        rd1_0.receta_id,
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        r1_0.nombre 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    left join
        receta_detalle rd1_0 
            on i1_0.id=rd1_0.ingrediente_id 
    left join
        receta r1_0 
            on r1_0.id=rd1_0.receta_id 
    where
        i1_0.id=?
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        i1_0.receta_id,
        i1_0.id,
        i1_0.cantidad_ingrediente,
        i1_0.ingrediente_id,
        i2_0.id,
        i2_0.activo,
        i2_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i2_0.nombre,
        i2_0.precio,
        i2_0.stock_actual,
        i2_0.stock_minimo,
        i2_0.unidad_medida 
    from
        receta_detalle i1_0 
    left join
        ingrediente i2_0 
            on i2_0.id=i1_0.ingrediente_id 
    left join
        empresa e1_0 
            on e1_0.id=i2_0.empresa_id 
    where
        i1_0.receta_id=?
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:55 [http-nio-8080-exec-5] INFO  j.s.s.s.CierreInventarioDiarioService - Inventario ajustado: 2 ingredientes, 0 productos
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        s1_0.nombre,
        s1_0.telefono,
        d1_0.cierre_id,
        d1_0.id,
        d1_0.costo_unitario,
        d1_0.diferencia,
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida,
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        p1_0.receta_id,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta,
        d1_0.stock_desperdicio,
        d1_0.stock_merma,
        d1_0.stock_real,
        d1_0.stock_teorico,
        d1_0.valor_diferencia 
    from
        cierre_inventario_diario cid1_0 
    join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=cid1_0.usuario_id 
    left join
        empresa e2_0 
            on e2_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        detalle_cierre_inventario_diario d1_0 
            on cid1_0.id=d1_0.cierre_id 
    left join
        ingrediente i1_0 
            on i1_0.id=d1_0.ingrediente_id 
    left join
        producto p1_0 
            on p1_0.id=d1_0.producto_id 
    where
        cid1_0.id=?
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [4]
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        rd1_0.ingrediente_id,
        rd1_0.id,
        rd1_0.cantidad_ingrediente,
        rd1_0.receta_id,
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        r1_0.nombre 
    from
        receta_detalle rd1_0 
    left join
        receta r1_0 
            on r1_0.id=rd1_0.receta_id 
    left join
        empresa e1_0 
            on e1_0.id=r1_0.empresa_id 
    where
        rd1_0.ingrediente_id=?
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        rd1_0.ingrediente_id,
        rd1_0.id,
        rd1_0.cantidad_ingrediente,
        rd1_0.receta_id,
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        r1_0.nombre 
    from
        receta_detalle rd1_0 
    left join
        receta r1_0 
            on r1_0.id=rd1_0.receta_id 
    left join
        empresa e1_0 
            on e1_0.id=r1_0.empresa_id 
    where
        rd1_0.ingrediente_id=?
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    update
        cierre_inventario_diario 
    set
        cantidad_facturas=?,
        empresa_id=?,
        estado=?,
        fecha=?,
        observaciones=?,
        total_ventas=?,
        usuario_id=? 
    where
        id=?
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:INTEGER) <- [0]
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [COMPLETADO]
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DATE) <- [2026-01-24]
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [Cierre para fecha espec√≠fica 2026-01-24]
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DOUBLE) <- [0.0]
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:BIGINT) <- [1]
2026-01-25 13:02:55 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:BIGINT) <- [4]
2026-01-25 13:02:55 [http-nio-8080-exec-5] INFO  j.s.s.s.CierreInventarioDiarioService - Cierre completado definitivamente ID: 4 para empresa ID: 1. Total ventas: 0.0, Cantidad facturas: 0
2026-01-25 13:02:55 [http-nio-8080-exec-5] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚úÖ Cierre completado definitivamente ID: 4
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 45, Tenant anterior: 1
2026-01-25 13:02:55 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 45, Request: /cierres/completar-definitivo/4, Empresa ID anterior: 1
2026-01-25 13:02:55 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres
2026-01-25 13:02:55 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=CAB428E1CB594BEFAC92C68009F5E762], Granted Authorities=[ROLE_ADMIN]]]
2026-01-25 13:02:55 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres
2026-01-25 13:02:55 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres, M√©todo: GET
2026-01-25 13:02:55 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-25 13:02:55 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-25 13:02:55 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-25 13:02:55 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-25 13:02:55 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 46
2026-01-25 13:02:55 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-25 13:02:55 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-25 13:02:55 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-25 13:02:55 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-25 13:02:55 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-25 13:02:55 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:02:55 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:02:55 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:55 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-25 13:02:55 [http-nio-8080-exec-6] INFO  j.s.s.c.CierreInventarioDiarioControlador - üìã GET /cierres - Listando cierres diarios
2026-01-25 13:02:55 [http-nio-8080-exec-6] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo todos los cierres para empresa ID: 1
2026-01-25 13:02:55 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        e1_0.id=?
2026-01-25 13:02:55 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:55 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:02:55 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:55 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-25 13:02:55 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:55 [http-nio-8080-exec-6] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 4 cierres para empresa ID: 1
2026-01-25 13:02:55 [http-nio-8080-exec-6] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Encontrados 4 cierres
2026-01-25 13:02:55 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 46, Tenant anterior: 1
2026-01-25 13:02:55 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 46, Request: /cierres, Empresa ID anterior: 1
2026-01-25 13:02:57 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-25 13:02:57 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=CAB428E1CB594BEFAC92C68009F5E762], Granted Authorities=[ROLE_ADMIN]]]
2026-01-25 13:02:57 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-25 13:02:57 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-25 13:02:57 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-25 13:02:57 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-25 13:02:58 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-25 13:02:58 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-25 13:02:58 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 47
2026-01-25 13:02:58 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-25 13:02:58 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-25 13:02:58 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-25 13:02:58 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-25 13:02:58 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-25 13:02:58 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:02:58 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:02:58 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:02:58 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-25 13:02:58 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 1
2026-01-25 13:02:58 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-25, Hora: 13:00
2026-01-25 13:02:58 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-25 13:02:58 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-25 13:02:58 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-25 13:02:58 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-25 13:02:58 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-24
2026-01-25 13:02:58 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-25 13:02:58 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-24]
2026-01-25 13:02:58 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-25 13:02:58 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-25 13:02:58 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-24 cerrado?: true (Empresa ID: 1)
2026-01-25 13:02:58 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-24 cerrado correctamente
2026-01-25 13:02:58 [http-nio-8080-exec-7] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-25
2026-01-25 13:02:58 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-25 13:02:58 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-25 13:02:58 [http-nio-8080-exec-7] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-25
2026-01-25 13:02:58 [http-nio-8080-exec-7] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-25 13:02:58 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 47, Tenant anterior: 1
2026-01-25 13:02:58 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 47, Request: /principal, Empresa ID anterior: 1
2026-01-25 13:03:08 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres
2026-01-25 13:03:08 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=CAB428E1CB594BEFAC92C68009F5E762], Granted Authorities=[ROLE_ADMIN]]]
2026-01-25 13:03:08 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres
2026-01-25 13:03:08 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres, M√©todo: GET
2026-01-25 13:03:08 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-25 13:03:08 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-25 13:03:08 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-25 13:03:08 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-25 13:03:08 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 48
2026-01-25 13:03:08 [http-nio-8080-exec-8] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-25 13:03:08 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-25 13:03:08 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-25 13:03:08 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-25 13:03:08 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-25 13:03:08 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:03:08 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:03:08 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:08 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-25 13:03:08 [http-nio-8080-exec-8] INFO  j.s.s.c.CierreInventarioDiarioControlador - üìã GET /cierres - Listando cierres diarios
2026-01-25 13:03:08 [http-nio-8080-exec-8] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo todos los cierres para empresa ID: 1
2026-01-25 13:03:08 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        e1_0.id=?
2026-01-25 13:03:08 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:08 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:03:08 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:08 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-25 13:03:08 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:08 [http-nio-8080-exec-8] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 4 cierres para empresa ID: 1
2026-01-25 13:03:08 [http-nio-8080-exec-8] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Encontrados 4 cierres
2026-01-25 13:03:08 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 48, Tenant anterior: 1
2026-01-25 13:03:08 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 48, Request: /cierres, Empresa ID anterior: 1
2026-01-25 13:03:14 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/iniciar?fecha=2026-01-25
2026-01-25 13:03:14 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=CAB428E1CB594BEFAC92C68009F5E762], Granted Authorities=[ROLE_ADMIN]]]
2026-01-25 13:03:14 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/iniciar?fecha=2026-01-25
2026-01-25 13:03:14 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/iniciar, M√©todo: GET
2026-01-25 13:03:14 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-25 13:03:14 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-25 13:03:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-25 13:03:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-25 13:03:14 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 49
2026-01-25 13:03:14 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-25 13:03:14 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-25 13:03:14 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-25 13:03:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-25 13:03:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-25 13:03:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:03:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:03:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:14 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-25 13:03:14 [http-nio-8080-exec-9] INFO  j.s.s.c.CierreInventarioDiarioControlador - üöÄ GET /cierres/iniciar - Iniciando nuevo cierre. Usuario: admin, Fecha: 2026-01-25
2026-01-25 13:03:14 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-25 13:03:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-25 13:03:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-25 13:03:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:03:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:03:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:14 [http-nio-8080-exec-9] INFO  j.s.s.s.CierreInventarioDiarioService - Iniciando cierre para fecha espec√≠fica: 2026-01-25 para empresa ID: 1, Usuario: admin
2026-01-25 13:03:14 [http-nio-8080-exec-9] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@644423396 wrapping com.mysql.cj.jdbc.ConnectionImpl@7827e241] read-only
2026-01-25 13:03:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:03:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:14 [http-nio-8080-exec-9] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@644423396 wrapping com.mysql.cj.jdbc.ConnectionImpl@7827e241]
2026-01-25 13:03:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.fecha=? 
        and e1_0.id=?
2026-01-25 13:03:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-25 13:03:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:03:14 [http-nio-8080-exec-9] DEBUG j.s.s.s.CierreInventarioDiarioService - No hay cierre existente para fecha: 2026-01-25
2026-01-25 13:03:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        cierre_inventario_diario
        (cantidad_facturas, empresa_id, estado, fecha, observaciones, total_ventas, usuario_id) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-25 13:03:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:INTEGER) <- [0]
2026-01-25 13:03:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:03:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [EN_PROCESO]
2026-01-25 13:03:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DATE) <- [2026-01-25]
2026-01-25 13:03:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [Cierre para fecha espec√≠fica 2026-01-25]
2026-01-25 13:03:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DOUBLE) <- [0.0]
2026-01-25 13:03:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:BIGINT) <- [1]
2026-01-25 13:03:15 [http-nio-8080-exec-9] INFO  j.s.s.s.CierreInventarioDiarioService - ‚úÖ Cierre creado para fecha espec√≠fica ID: 5 - Fecha: 2026-01-25, Usuario: admin
2026-01-25 13:03:15 [http-nio-8080-exec-9] DEBUG j.s.s.s.CierreInventarioDiarioService - Precargando detalles para cierre ID: 5
2026-01-25 13:03:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    left join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        e1_0.id=?
2026-01-25 13:03:15 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:03:15 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:15 [http-nio-8080-exec-9] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 2 ingredientes para empresa ID: 1
2026-01-25 13:03:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        p1_0.receta_id,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta 
    from
        producto p1_0 
    left join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        e1_0.id=? 
        and not(p1_0.tiene_receta)
2026-01-25 13:03:15 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:15 [http-nio-8080-exec-9] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 0 productos sin receta para empresa ID: 1
2026-01-25 13:03:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        detalle_cierre_inventario_diario
        (cierre_id, costo_unitario, diferencia, ingrediente_id, producto_id, stock_desperdicio, stock_merma, stock_real, stock_teorico, valor_diferencia) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2026-01-25 13:03:15 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-25 13:03:15 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:DOUBLE) <- [2500.0]
2026-01-25 13:03:15 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:DOUBLE) <- [0.0]
2026-01-25 13:03:15 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [2]
2026-01-25 13:03:15 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:BIGINT) <- [null]
2026-01-25 13:03:15 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DOUBLE) <- [0.0]
2026-01-25 13:03:15 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:DOUBLE) <- [0.0]
2026-01-25 13:03:15 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:DOUBLE) <- [0.0]
2026-01-25 13:03:15 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:DOUBLE) <- [345.0]
2026-01-25 13:03:15 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:DOUBLE) <- [0.0]
2026-01-25 13:03:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        detalle_cierre_inventario_diario
        (cierre_id, costo_unitario, diferencia, ingrediente_id, producto_id, stock_desperdicio, stock_merma, stock_real, stock_teorico, valor_diferencia) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2026-01-25 13:03:15 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-25 13:03:15 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:DOUBLE) <- [4500.0]
2026-01-25 13:03:15 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:DOUBLE) <- [0.0]
2026-01-25 13:03:15 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [1]
2026-01-25 13:03:15 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:BIGINT) <- [null]
2026-01-25 13:03:15 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DOUBLE) <- [0.0]
2026-01-25 13:03:15 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:DOUBLE) <- [0.0]
2026-01-25 13:03:15 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:DOUBLE) <- [0.0]
2026-01-25 13:03:15 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:DOUBLE) <- [0.0]
2026-01-25 13:03:15 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:DOUBLE) <- [0.0]
2026-01-25 13:03:15 [http-nio-8080-exec-9] INFO  j.s.s.s.CierreInventarioDiarioService - Detalles precargados: 2 totales para cierre ID: 5
2026-01-25 13:03:15 [http-nio-8080-exec-9] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚úÖ Cierre iniciado para fecha espec√≠fica: 2026-01-25 por usuario: admin
2026-01-25 13:03:15 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 49, Tenant anterior: 1
2026-01-25 13:03:15 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 49, Request: /cierres/iniciar, Empresa ID anterior: 1
2026-01-25 13:03:15 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/en-proceso
2026-01-25 13:03:15 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=CAB428E1CB594BEFAC92C68009F5E762], Granted Authorities=[ROLE_ADMIN]]]
2026-01-25 13:03:15 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/en-proceso
2026-01-25 13:03:15 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/en-proceso, M√©todo: GET
2026-01-25 13:03:15 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-25 13:03:15 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-25 13:03:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-25 13:03:15 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-25 13:03:15 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 50
2026-01-25 13:03:15 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-25 13:03:15 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-25 13:03:15 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-25 13:03:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-25 13:03:15 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-25 13:03:15 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:03:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:03:15 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:15 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-25 13:03:15 [http-nio-8080-exec-10] INFO  j.s.s.c.CierreInventarioDiarioControlador - üîç GET /cierres/en-proceso - Viendo cierre en proceso
2026-01-25 13:03:15 [http-nio-8080-exec-10] DEBUG j.s.s.s.CierreInventarioDiarioService - Buscando cierre en proceso para empresa ID: 1
2026-01-25 13:03:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.estado=? 
        and e1_0.id=?
2026-01-25 13:03:15 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [EN_PROCESO]
2026-01-25 13:03:15 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:03:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:03:15 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-25 13:03:15 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:15 [http-nio-8080-exec-10] DEBUG j.s.s.s.CierreInventarioDiarioService - Cierre en proceso encontrado ID: 5 para empresa ID: 1
2026-01-25 13:03:15 [http-nio-8080-exec-10] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo detalles para cierre ID: 5
2026-01-25 13:03:15 [http-nio-8080-exec-10] DEBUG j.s.s.s.CierreInventarioDiarioService - Buscando cierre ID: 5 para empresa ID: 1
2026-01-25 13:03:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.id=? 
        and e1_0.id=?
2026-01-25 13:03:15 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-25 13:03:15 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:03:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:03:15 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-25 13:03:15 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        dcid1_0.ingrediente_id,
        dcid1_0.producto_id,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    where
        dcid1_0.cierre_id=?
2026-01-25 13:03:15 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-25 13:03:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        s1_0.nombre,
        s1_0.telefono 
    from
        cierre_inventario_diario cid1_0 
    join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=cid1_0.usuario_id 
    left join
        empresa e2_0 
            on e2_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    where
        cid1_0.id=?
2026-01-25 13:03:15 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-25 13:03:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-25 13:03:15 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-25 13:03:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-25 13:03:15 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:15 [http-nio-8080-exec-10] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 2 detalles para cierre ID: 5
2026-01-25 13:03:15 [http-nio-8080-exec-10] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Cierre en proceso ID: 5, Estado: EN_PROCESO, Detalles: 2, Total diferencia: 0.0
2026-01-25 13:03:15 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 50, Tenant anterior: 1
2026-01-25 13:03:15 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 50, Request: /cierres/en-proceso, Empresa ID anterior: 1
2026-01-25 13:03:26 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing POST /cierres/completar/5
2026-01-25 13:03:26 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=CAB428E1CB594BEFAC92C68009F5E762], Granted Authorities=[ROLE_ADMIN]]]
2026-01-25 13:03:26 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured POST /cierres/completar/5
2026-01-25 13:03:26 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/completar/5, M√©todo: POST
2026-01-25 13:03:26 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-25 13:03:26 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-25 13:03:26 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-25 13:03:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-25 13:03:26 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 41
2026-01-25 13:03:26 [http-nio-8080-exec-1] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-25 13:03:26 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-25 13:03:26 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-25 13:03:26 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-25 13:03:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-25 13:03:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:03:26 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:03:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:26 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-25 13:03:26 [http-nio-8080-exec-1] INFO  j.s.s.c.CierreInventarioDiarioControlador - üìù POST /cierres/completar/5 - Completando cierre (PRE-COMPLETADO)
2026-01-25 13:03:26 [http-nio-8080-exec-1] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Recibidos 2 detalles para guardar
2026-01-25 13:03:26 [http-nio-8080-exec-1] DEBUG j.s.s.s.CierreInventarioDiarioService - Actualizando detalle ID: 7 para empresa ID: 1
2026-01-25 13:03:26 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        dcid1_0.ingrediente_id,
        dcid1_0.producto_id,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    left join
        cierre_inventario_diario c1_0 
            on c1_0.id=dcid1_0.cierre_id 
    left join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    where
        dcid1_0.id=? 
        and e1_0.id=?
2026-01-25 13:03:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [7]
2026-01-25 13:03:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:03:26 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        s1_0.nombre,
        s1_0.telefono 
    from
        cierre_inventario_diario cid1_0 
    join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=cid1_0.usuario_id 
    left join
        empresa e2_0 
            on e2_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    where
        cid1_0.id=?
2026-01-25 13:03:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-25 13:03:26 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-25 13:03:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-25 13:03:26 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        c1_0.id,
        c1_0.cantidad_facturas,
        c1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        c1_0.estado,
        c1_0.fecha,
        c1_0.observaciones,
        c1_0.total_ventas,
        c1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e3_0.id,
        e3_0.email_contacto,
        e3_0.estado,
        e3_0.fecha_creacion,
        e3_0.nombre,
        e3_0.plan,
        e3_0.subdominio,
        e3_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida,
        rd1_0.ingrediente_id,
        rd1_0.id,
        rd1_0.cantidad_ingrediente,
        rd1_0.receta_id,
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        e4_0.id,
        e4_0.email_contacto,
        e4_0.estado,
        e4_0.fecha_creacion,
        e4_0.nombre,
        e4_0.plan,
        e4_0.subdominio,
        e4_0.telefono,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        r2_0.id,
        r2_0.costo_receta,
        r2_0.descripcion,
        r2_0.empresa_id,
        r2_0.nombre,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    join
        cierre_inventario_diario c1_0 
            on c1_0.id=dcid1_0.cierre_id 
    join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=c1_0.usuario_id 
    left join
        ingrediente i1_0 
            on i1_0.id=dcid1_0.ingrediente_id 
    left join
        empresa e3_0 
            on e3_0.id=i1_0.empresa_id 
    left join
        receta_detalle rd1_0 
            on i1_0.id=rd1_0.ingrediente_id 
    left join
        producto p1_0 
            on p1_0.id=dcid1_0.producto_id 
    left join
        empresa e4_0 
            on e4_0.id=p1_0.empresa_id 
    left join
        receta r2_0 
            on r2_0.id=p1_0.receta_id 
    where
        dcid1_0.id=?
2026-01-25 13:03:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [7]
2026-01-25 13:03:26 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        r1_0.nombre,
        i1_0.receta_id,
        i1_0.id,
        i1_0.cantidad_ingrediente,
        i1_0.ingrediente_id,
        i2_0.id,
        i2_0.activo,
        i2_0.empresa_id,
        i2_0.nombre,
        i2_0.precio,
        i2_0.stock_actual,
        i2_0.stock_minimo,
        i2_0.unidad_medida 
    from
        receta r1_0 
    join
        empresa e1_0 
            on e1_0.id=r1_0.empresa_id 
    left join
        receta_detalle i1_0 
            on r1_0.id=i1_0.receta_id 
    left join
        ingrediente i2_0 
            on i2_0.id=i1_0.ingrediente_id 
    where
        r1_0.id=?
2026-01-25 13:03:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-25 13:03:26 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        d1_0.cierre_id,
        d1_0.id,
        d1_0.costo_unitario,
        d1_0.diferencia,
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida,
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        r1_0.nombre,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta,
        d1_0.stock_desperdicio,
        d1_0.stock_merma,
        d1_0.stock_real,
        d1_0.stock_teorico,
        d1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario d1_0 
    left join
        ingrediente i1_0 
            on i1_0.id=d1_0.ingrediente_id 
    left join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    left join
        producto p1_0 
            on p1_0.id=d1_0.producto_id 
    left join
        empresa e2_0 
            on e2_0.id=p1_0.empresa_id 
    left join
        receta r1_0 
            on r1_0.id=p1_0.receta_id 
    where
        d1_0.cierre_id=?
2026-01-25 13:03:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-25 13:03:26 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    update
        detalle_cierre_inventario_diario 
    set
        cierre_id=?,
        costo_unitario=?,
        diferencia=?,
        ingrediente_id=?,
        producto_id=?,
        stock_desperdicio=?,
        stock_merma=?,
        stock_real=?,
        stock_teorico=?,
        valor_diferencia=? 
    where
        id=?
2026-01-25 13:03:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-25 13:03:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:DOUBLE) <- [2500.0]
2026-01-25 13:03:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:DOUBLE) <- [0.0]
2026-01-25 13:03:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [2]
2026-01-25 13:03:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:BIGINT) <- [null]
2026-01-25 13:03:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DOUBLE) <- [0.0]
2026-01-25 13:03:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:DOUBLE) <- [0.0]
2026-01-25 13:03:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:DOUBLE) <- [345.0]
2026-01-25 13:03:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:DOUBLE) <- [345.0]
2026-01-25 13:03:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:DOUBLE) <- [0.0]
2026-01-25 13:03:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:BIGINT) <- [7]
2026-01-25 13:03:26 [http-nio-8080-exec-1] INFO  j.s.s.s.CierreInventarioDiarioService - Detalle actualizado ID: 7, Stock real: 345.0, Diferencia: 0.0, Valor diferencia: 0.0
2026-01-25 13:03:26 [http-nio-8080-exec-1] DEBUG j.s.s.s.CierreInventarioDiarioService - Actualizando detalle ID: 8 para empresa ID: 1
2026-01-25 13:03:26 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        dcid1_0.ingrediente_id,
        dcid1_0.producto_id,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    left join
        cierre_inventario_diario c1_0 
            on c1_0.id=dcid1_0.cierre_id 
    left join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    where
        dcid1_0.id=? 
        and e1_0.id=?
2026-01-25 13:03:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [8]
2026-01-25 13:03:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:03:26 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        s1_0.nombre,
        s1_0.telefono 
    from
        cierre_inventario_diario cid1_0 
    join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=cid1_0.usuario_id 
    left join
        empresa e2_0 
            on e2_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    where
        cid1_0.id=?
2026-01-25 13:03:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-25 13:03:26 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-25 13:03:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:26 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        c1_0.id,
        c1_0.cantidad_facturas,
        c1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        c1_0.estado,
        c1_0.fecha,
        c1_0.observaciones,
        c1_0.total_ventas,
        c1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e3_0.id,
        e3_0.email_contacto,
        e3_0.estado,
        e3_0.fecha_creacion,
        e3_0.nombre,
        e3_0.plan,
        e3_0.subdominio,
        e3_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida,
        rd1_0.ingrediente_id,
        rd1_0.id,
        rd1_0.cantidad_ingrediente,
        rd1_0.receta_id,
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        e4_0.id,
        e4_0.email_contacto,
        e4_0.estado,
        e4_0.fecha_creacion,
        e4_0.nombre,
        e4_0.plan,
        e4_0.subdominio,
        e4_0.telefono,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        r2_0.id,
        r2_0.costo_receta,
        r2_0.descripcion,
        r2_0.empresa_id,
        r2_0.nombre,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    join
        cierre_inventario_diario c1_0 
            on c1_0.id=dcid1_0.cierre_id 
    join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=c1_0.usuario_id 
    left join
        ingrediente i1_0 
            on i1_0.id=dcid1_0.ingrediente_id 
    left join
        empresa e3_0 
            on e3_0.id=i1_0.empresa_id 
    left join
        receta_detalle rd1_0 
            on i1_0.id=rd1_0.ingrediente_id 
    left join
        producto p1_0 
            on p1_0.id=dcid1_0.producto_id 
    left join
        empresa e4_0 
            on e4_0.id=p1_0.empresa_id 
    left join
        receta r2_0 
            on r2_0.id=p1_0.receta_id 
    where
        dcid1_0.id=?
2026-01-25 13:03:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [8]
2026-01-25 13:03:26 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        r1_0.nombre,
        i1_0.receta_id,
        i1_0.id,
        i1_0.cantidad_ingrediente,
        i1_0.ingrediente_id,
        i2_0.id,
        i2_0.activo,
        i2_0.empresa_id,
        i2_0.nombre,
        i2_0.precio,
        i2_0.stock_actual,
        i2_0.stock_minimo,
        i2_0.unidad_medida 
    from
        receta r1_0 
    join
        empresa e1_0 
            on e1_0.id=r1_0.empresa_id 
    left join
        receta_detalle i1_0 
            on r1_0.id=i1_0.receta_id 
    left join
        ingrediente i2_0 
            on i2_0.id=i1_0.ingrediente_id 
    where
        r1_0.id=?
2026-01-25 13:03:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:26 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        d1_0.cierre_id,
        d1_0.id,
        d1_0.costo_unitario,
        d1_0.diferencia,
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida,
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        r1_0.nombre,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta,
        d1_0.stock_desperdicio,
        d1_0.stock_merma,
        d1_0.stock_real,
        d1_0.stock_teorico,
        d1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario d1_0 
    left join
        ingrediente i1_0 
            on i1_0.id=d1_0.ingrediente_id 
    left join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    left join
        producto p1_0 
            on p1_0.id=d1_0.producto_id 
    left join
        empresa e2_0 
            on e2_0.id=p1_0.empresa_id 
    left join
        receta r1_0 
            on r1_0.id=p1_0.receta_id 
    where
        d1_0.cierre_id=?
2026-01-25 13:03:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-25 13:03:26 [http-nio-8080-exec-1] INFO  j.s.s.s.CierreInventarioDiarioService - Detalle actualizado ID: 8, Stock real: 0.0, Diferencia: 0.0, Valor diferencia: 0.0
2026-01-25 13:03:26 [http-nio-8080-exec-1] DEBUG j.s.s.c.CierreInventarioDiarioControlador - 2 detalles actualizados
2026-01-25 13:03:26 [http-nio-8080-exec-1] INFO  j.s.s.s.CierreInventarioDiarioService - Completando cierre ID: 5 para empresa ID: 1
2026-01-25 13:03:26 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.id=? 
        and e1_0.id=?
2026-01-25 13:03:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-25 13:03:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:03:26 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:03:27 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:27 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-25 13:03:27 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:27 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        dcid1_0.ingrediente_id,
        dcid1_0.producto_id,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    where
        dcid1_0.cierre_id=?
2026-01-25 13:03:27 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-25 13:03:27 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        s1_0.nombre,
        s1_0.telefono 
    from
        cierre_inventario_diario cid1_0 
    join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=cid1_0.usuario_id 
    left join
        empresa e2_0 
            on e2_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    where
        cid1_0.id=?
2026-01-25 13:03:27 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-25 13:03:27 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-25 13:03:27 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-25 13:03:27 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-25 13:03:27 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:27 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        s1_0.nombre,
        s1_0.telefono,
        d1_0.cierre_id,
        d1_0.id,
        d1_0.costo_unitario,
        d1_0.diferencia,
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida,
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        p1_0.receta_id,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta,
        d1_0.stock_desperdicio,
        d1_0.stock_merma,
        d1_0.stock_real,
        d1_0.stock_teorico,
        d1_0.valor_diferencia 
    from
        cierre_inventario_diario cid1_0 
    join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=cid1_0.usuario_id 
    left join
        empresa e2_0 
            on e2_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        detalle_cierre_inventario_diario d1_0 
            on cid1_0.id=d1_0.cierre_id 
    left join
        ingrediente i1_0 
            on i1_0.id=d1_0.ingrediente_id 
    left join
        producto p1_0 
            on p1_0.id=d1_0.producto_id 
    where
        cid1_0.id=?
2026-01-25 13:03:27 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-25 13:03:27 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        rd1_0.ingrediente_id,
        rd1_0.id,
        rd1_0.cantidad_ingrediente,
        rd1_0.receta_id,
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        r1_0.nombre 
    from
        receta_detalle rd1_0 
    left join
        receta r1_0 
            on r1_0.id=rd1_0.receta_id 
    left join
        empresa e1_0 
            on e1_0.id=r1_0.empresa_id 
    where
        rd1_0.ingrediente_id=?
2026-01-25 13:03:27 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:27 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        rd1_0.ingrediente_id,
        rd1_0.id,
        rd1_0.cantidad_ingrediente,
        rd1_0.receta_id,
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        r1_0.nombre 
    from
        receta_detalle rd1_0 
    left join
        receta r1_0 
            on r1_0.id=rd1_0.receta_id 
    left join
        empresa e1_0 
            on e1_0.id=r1_0.empresa_id 
    where
        rd1_0.ingrediente_id=?
2026-01-25 13:03:27 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-25 13:03:27 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    update
        cierre_inventario_diario 
    set
        cantidad_facturas=?,
        empresa_id=?,
        estado=?,
        fecha=?,
        observaciones=?,
        total_ventas=?,
        usuario_id=? 
    where
        id=?
2026-01-25 13:03:27 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:INTEGER) <- [0]
2026-01-25 13:03:27 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:03:27 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [PRE-COMPLETADO]
2026-01-25 13:03:27 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DATE) <- [2026-01-25]
2026-01-25 13:03:27 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [Cierre para fecha espec√≠fica 2026-01-25]
2026-01-25 13:03:27 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DOUBLE) <- [0.0]
2026-01-25 13:03:27 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:BIGINT) <- [1]
2026-01-25 13:03:27 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:BIGINT) <- [5]
2026-01-25 13:03:27 [http-nio-8080-exec-1] INFO  j.s.s.s.CierreInventarioDiarioService - Cierre marcado como PRE-COMPLETADO ID: 5 para empresa ID: 1
2026-01-25 13:03:27 [http-nio-8080-exec-1] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚úÖ Cierre marcado como PRE-COMPLETADO ID: 5
2026-01-25 13:03:27 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 41, Tenant anterior: 1
2026-01-25 13:03:27 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 41, Request: /cierres/completar/5, Empresa ID anterior: 1
2026-01-25 13:03:27 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres
2026-01-25 13:03:27 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=CAB428E1CB594BEFAC92C68009F5E762], Granted Authorities=[ROLE_ADMIN]]]
2026-01-25 13:03:27 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres
2026-01-25 13:03:27 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres, M√©todo: GET
2026-01-25 13:03:27 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-25 13:03:27 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-25 13:03:27 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-25 13:03:27 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-25 13:03:27 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 42
2026-01-25 13:03:27 [http-nio-8080-exec-2] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-25 13:03:27 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-25 13:03:27 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-25 13:03:27 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-25 13:03:27 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-25 13:03:27 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:03:27 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:03:27 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:27 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-25 13:03:27 [http-nio-8080-exec-2] INFO  j.s.s.c.CierreInventarioDiarioControlador - üìã GET /cierres - Listando cierres diarios
2026-01-25 13:03:27 [http-nio-8080-exec-2] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo todos los cierres para empresa ID: 1
2026-01-25 13:03:27 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        e1_0.id=?
2026-01-25 13:03:27 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:27 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:03:27 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:27 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-25 13:03:27 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:27 [http-nio-8080-exec-2] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 5 cierres para empresa ID: 1
2026-01-25 13:03:27 [http-nio-8080-exec-2] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Encontrados 5 cierres
2026-01-25 13:03:27 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 42, Tenant anterior: 1
2026-01-25 13:03:27 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 42, Request: /cierres, Empresa ID anterior: 1
2026-01-25 13:03:28 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/detalle/5
2026-01-25 13:03:28 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=CAB428E1CB594BEFAC92C68009F5E762], Granted Authorities=[ROLE_ADMIN]]]
2026-01-25 13:03:28 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/detalle/5
2026-01-25 13:03:28 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/detalle/5, M√©todo: GET
2026-01-25 13:03:28 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-25 13:03:28 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-25 13:03:28 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-25 13:03:28 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-25 13:03:28 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 43
2026-01-25 13:03:28 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-25 13:03:28 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-25 13:03:28 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-25 13:03:28 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-25 13:03:28 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-25 13:03:28 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:03:28 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:03:28 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:28 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-25 13:03:28 [http-nio-8080-exec-3] INFO  j.s.s.c.CierreInventarioDiarioControlador - üëÅÔ∏è GET /cierres/detalle/5 - Viendo detalles de cierre
2026-01-25 13:03:28 [http-nio-8080-exec-3] DEBUG j.s.s.s.CierreInventarioDiarioService - Buscando cierre ID: 5 para empresa ID: 1
2026-01-25 13:03:28 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.id=? 
        and e1_0.id=?
2026-01-25 13:03:28 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-25 13:03:28 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:03:28 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:03:28 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:28 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-25 13:03:28 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:28 [http-nio-8080-exec-3] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo detalles para cierre ID: 5
2026-01-25 13:03:28 [http-nio-8080-exec-3] DEBUG j.s.s.s.CierreInventarioDiarioService - Buscando cierre ID: 5 para empresa ID: 1
2026-01-25 13:03:28 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.id=? 
        and e1_0.id=?
2026-01-25 13:03:28 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-25 13:03:28 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:03:28 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:03:28 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:28 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-25 13:03:28 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:28 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        dcid1_0.ingrediente_id,
        dcid1_0.producto_id,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    where
        dcid1_0.cierre_id=?
2026-01-25 13:03:28 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-25 13:03:28 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        s1_0.nombre,
        s1_0.telefono 
    from
        cierre_inventario_diario cid1_0 
    join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=cid1_0.usuario_id 
    left join
        empresa e2_0 
            on e2_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    where
        cid1_0.id=?
2026-01-25 13:03:28 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-25 13:03:28 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-25 13:03:28 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-25 13:03:28 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-25 13:03:28 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:28 [http-nio-8080-exec-3] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 2 detalles para cierre ID: 5
2026-01-25 13:03:28 [http-nio-8080-exec-3] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Cierre ID: 5, Estado: PRE-COMPLETADO, Detalles: 2, Diferencia total: 0.0
2026-01-25 13:03:28 [http-nio-8080-exec-3] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Cierre PRE-COMPLETADO, mostrando vista para editar
2026-01-25 13:03:28 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 43, Tenant anterior: 1
2026-01-25 13:03:28 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /cierres/detalle/5, Empresa ID anterior: 1
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing POST /cierres/completar-definitivo/5
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=CAB428E1CB594BEFAC92C68009F5E762], Granted Authorities=[ROLE_ADMIN]]]
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured POST /cierres/completar-definitivo/5
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/completar-definitivo/5, M√©todo: POST
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 44
2026-01-25 13:03:29 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-25 13:03:29 [http-nio-8080-exec-4] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚úÖ POST /cierres/completar-definitivo/5 - Completando cierre definitivamente
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Actualizando 2 detalles antes de completar
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG j.s.s.s.CierreInventarioDiarioService - Actualizando detalle ID: 7 para empresa ID: 1
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        dcid1_0.ingrediente_id,
        dcid1_0.producto_id,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    left join
        cierre_inventario_diario c1_0 
            on c1_0.id=dcid1_0.cierre_id 
    left join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    where
        dcid1_0.id=? 
        and e1_0.id=?
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [7]
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        s1_0.nombre,
        s1_0.telefono 
    from
        cierre_inventario_diario cid1_0 
    join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=cid1_0.usuario_id 
    left join
        empresa e2_0 
            on e2_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    where
        cid1_0.id=?
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        c1_0.id,
        c1_0.cantidad_facturas,
        c1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        c1_0.estado,
        c1_0.fecha,
        c1_0.observaciones,
        c1_0.total_ventas,
        c1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e3_0.id,
        e3_0.email_contacto,
        e3_0.estado,
        e3_0.fecha_creacion,
        e3_0.nombre,
        e3_0.plan,
        e3_0.subdominio,
        e3_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida,
        rd1_0.ingrediente_id,
        rd1_0.id,
        rd1_0.cantidad_ingrediente,
        rd1_0.receta_id,
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        e4_0.id,
        e4_0.email_contacto,
        e4_0.estado,
        e4_0.fecha_creacion,
        e4_0.nombre,
        e4_0.plan,
        e4_0.subdominio,
        e4_0.telefono,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        r2_0.id,
        r2_0.costo_receta,
        r2_0.descripcion,
        r2_0.empresa_id,
        r2_0.nombre,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    join
        cierre_inventario_diario c1_0 
            on c1_0.id=dcid1_0.cierre_id 
    join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=c1_0.usuario_id 
    left join
        ingrediente i1_0 
            on i1_0.id=dcid1_0.ingrediente_id 
    left join
        empresa e3_0 
            on e3_0.id=i1_0.empresa_id 
    left join
        receta_detalle rd1_0 
            on i1_0.id=rd1_0.ingrediente_id 
    left join
        producto p1_0 
            on p1_0.id=dcid1_0.producto_id 
    left join
        empresa e4_0 
            on e4_0.id=p1_0.empresa_id 
    left join
        receta r2_0 
            on r2_0.id=p1_0.receta_id 
    where
        dcid1_0.id=?
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [7]
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        r1_0.nombre,
        i1_0.receta_id,
        i1_0.id,
        i1_0.cantidad_ingrediente,
        i1_0.ingrediente_id,
        i2_0.id,
        i2_0.activo,
        i2_0.empresa_id,
        i2_0.nombre,
        i2_0.precio,
        i2_0.stock_actual,
        i2_0.stock_minimo,
        i2_0.unidad_medida 
    from
        receta r1_0 
    join
        empresa e1_0 
            on e1_0.id=r1_0.empresa_id 
    left join
        receta_detalle i1_0 
            on r1_0.id=i1_0.receta_id 
    left join
        ingrediente i2_0 
            on i2_0.id=i1_0.ingrediente_id 
    where
        r1_0.id=?
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        d1_0.cierre_id,
        d1_0.id,
        d1_0.costo_unitario,
        d1_0.diferencia,
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida,
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        r1_0.nombre,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta,
        d1_0.stock_desperdicio,
        d1_0.stock_merma,
        d1_0.stock_real,
        d1_0.stock_teorico,
        d1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario d1_0 
    left join
        ingrediente i1_0 
            on i1_0.id=d1_0.ingrediente_id 
    left join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    left join
        producto p1_0 
            on p1_0.id=d1_0.producto_id 
    left join
        empresa e2_0 
            on e2_0.id=p1_0.empresa_id 
    left join
        receta r1_0 
            on r1_0.id=p1_0.receta_id 
    where
        d1_0.cierre_id=?
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-25 13:03:29 [http-nio-8080-exec-4] INFO  j.s.s.s.CierreInventarioDiarioService - Detalle actualizado ID: 7, Stock real: 345.0, Diferencia: 0.0, Valor diferencia: 0.0
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG j.s.s.s.CierreInventarioDiarioService - Actualizando detalle ID: 8 para empresa ID: 1
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        dcid1_0.ingrediente_id,
        dcid1_0.producto_id,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    left join
        cierre_inventario_diario c1_0 
            on c1_0.id=dcid1_0.cierre_id 
    left join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    where
        dcid1_0.id=? 
        and e1_0.id=?
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [8]
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        s1_0.nombre,
        s1_0.telefono 
    from
        cierre_inventario_diario cid1_0 
    join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=cid1_0.usuario_id 
    left join
        empresa e2_0 
            on e2_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    where
        cid1_0.id=?
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        c1_0.id,
        c1_0.cantidad_facturas,
        c1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        c1_0.estado,
        c1_0.fecha,
        c1_0.observaciones,
        c1_0.total_ventas,
        c1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e3_0.id,
        e3_0.email_contacto,
        e3_0.estado,
        e3_0.fecha_creacion,
        e3_0.nombre,
        e3_0.plan,
        e3_0.subdominio,
        e3_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida,
        rd1_0.ingrediente_id,
        rd1_0.id,
        rd1_0.cantidad_ingrediente,
        rd1_0.receta_id,
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        e4_0.id,
        e4_0.email_contacto,
        e4_0.estado,
        e4_0.fecha_creacion,
        e4_0.nombre,
        e4_0.plan,
        e4_0.subdominio,
        e4_0.telefono,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        r2_0.id,
        r2_0.costo_receta,
        r2_0.descripcion,
        r2_0.empresa_id,
        r2_0.nombre,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    join
        cierre_inventario_diario c1_0 
            on c1_0.id=dcid1_0.cierre_id 
    join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=c1_0.usuario_id 
    left join
        ingrediente i1_0 
            on i1_0.id=dcid1_0.ingrediente_id 
    left join
        empresa e3_0 
            on e3_0.id=i1_0.empresa_id 
    left join
        receta_detalle rd1_0 
            on i1_0.id=rd1_0.ingrediente_id 
    left join
        producto p1_0 
            on p1_0.id=dcid1_0.producto_id 
    left join
        empresa e4_0 
            on e4_0.id=p1_0.empresa_id 
    left join
        receta r2_0 
            on r2_0.id=p1_0.receta_id 
    where
        dcid1_0.id=?
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [8]
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        r1_0.nombre,
        i1_0.receta_id,
        i1_0.id,
        i1_0.cantidad_ingrediente,
        i1_0.ingrediente_id,
        i2_0.id,
        i2_0.activo,
        i2_0.empresa_id,
        i2_0.nombre,
        i2_0.precio,
        i2_0.stock_actual,
        i2_0.stock_minimo,
        i2_0.unidad_medida 
    from
        receta r1_0 
    join
        empresa e1_0 
            on e1_0.id=r1_0.empresa_id 
    left join
        receta_detalle i1_0 
            on r1_0.id=i1_0.receta_id 
    left join
        ingrediente i2_0 
            on i2_0.id=i1_0.ingrediente_id 
    where
        r1_0.id=?
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        d1_0.cierre_id,
        d1_0.id,
        d1_0.costo_unitario,
        d1_0.diferencia,
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida,
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        r1_0.nombre,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta,
        d1_0.stock_desperdicio,
        d1_0.stock_merma,
        d1_0.stock_real,
        d1_0.stock_teorico,
        d1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario d1_0 
    left join
        ingrediente i1_0 
            on i1_0.id=d1_0.ingrediente_id 
    left join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    left join
        producto p1_0 
            on p1_0.id=d1_0.producto_id 
    left join
        empresa e2_0 
            on e2_0.id=p1_0.empresa_id 
    left join
        receta r1_0 
            on r1_0.id=p1_0.receta_id 
    where
        d1_0.cierre_id=?
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-25 13:03:29 [http-nio-8080-exec-4] INFO  j.s.s.s.CierreInventarioDiarioService - Detalle actualizado ID: 8, Stock real: 0.0, Diferencia: 0.0, Valor diferencia: 0.0
2026-01-25 13:03:29 [http-nio-8080-exec-4] INFO  j.s.s.s.CierreInventarioDiarioService - Completando cierre definitivo ID: 5
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG j.s.s.s.CierreInventarioDiarioService - Buscando cierre ID: 5 para empresa ID: 1
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.id=? 
        and e1_0.id=?
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG j.s.s.s.CierreInventarioDiarioService - Calculando ventas del d√≠a para cierre ID: 5
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG j.s.s.s.CierreInventarioDiarioService - Calculando ventas del d√≠a 2026-01-25 para empresa ID: 1
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        f1_0.id,
        f1_0.cliente_id,
        f1_0.empresa_id,
        f1_0.estado,
        f1_0.fecha,
        f1_0.forma_pago,
        f1_0.iva,
        f1_0.numero_factura,
        f1_0.subtotal,
        f1_0.total 
    from
        factura f1_0 
    left join
        empresa e1_0 
            on e1_0.id=f1_0.empresa_id 
    where
        f1_0.fecha=? 
        and f1_0.estado=? 
        and e1_0.id=?
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [PAGADA]
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG j.s.s.s.CierreInventarioDiarioService - Ventas calculadas: 0 facturas, Total: 0.0 para fecha: 2026-01-25
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        dcid1_0.ingrediente_id,
        dcid1_0.producto_id,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    where
        dcid1_0.cierre_id=?
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        s1_0.nombre,
        s1_0.telefono 
    from
        cierre_inventario_diario cid1_0 
    join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=cid1_0.usuario_id 
    left join
        empresa e2_0 
            on e2_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    where
        cid1_0.id=?
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG j.s.s.s.CierreInventarioDiarioService - Ajustando inventario para 2 detalles
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG j.s.s.s.CierreInventarioDiarioService - Ajustando inventario para 2 detalles
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida,
        rd1_0.ingrediente_id,
        rd1_0.id,
        rd1_0.cantidad_ingrediente,
        rd1_0.receta_id,
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        r1_0.nombre 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    left join
        receta_detalle rd1_0 
            on i1_0.id=rd1_0.ingrediente_id 
    left join
        receta r1_0 
            on r1_0.id=rd1_0.receta_id 
    where
        i1_0.id=?
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        i1_0.receta_id,
        i1_0.id,
        i1_0.cantidad_ingrediente,
        i1_0.ingrediente_id,
        i2_0.id,
        i2_0.activo,
        i2_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i2_0.nombre,
        i2_0.precio,
        i2_0.stock_actual,
        i2_0.stock_minimo,
        i2_0.unidad_medida 
    from
        receta_detalle i1_0 
    left join
        ingrediente i2_0 
            on i2_0.id=i1_0.ingrediente_id 
    left join
        empresa e1_0 
            on e1_0.id=i2_0.empresa_id 
    where
        i1_0.receta_id=?
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida,
        rd1_0.ingrediente_id,
        rd1_0.id,
        rd1_0.cantidad_ingrediente,
        rd1_0.receta_id,
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        r1_0.nombre 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    left join
        receta_detalle rd1_0 
            on i1_0.id=rd1_0.ingrediente_id 
    left join
        receta r1_0 
            on r1_0.id=rd1_0.receta_id 
    where
        i1_0.id=?
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        i1_0.receta_id,
        i1_0.id,
        i1_0.cantidad_ingrediente,
        i1_0.ingrediente_id,
        i2_0.id,
        i2_0.activo,
        i2_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i2_0.nombre,
        i2_0.precio,
        i2_0.stock_actual,
        i2_0.stock_minimo,
        i2_0.unidad_medida 
    from
        receta_detalle i1_0 
    left join
        ingrediente i2_0 
            on i2_0.id=i1_0.ingrediente_id 
    left join
        empresa e1_0 
            on e1_0.id=i2_0.empresa_id 
    where
        i1_0.receta_id=?
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:29 [http-nio-8080-exec-4] INFO  j.s.s.s.CierreInventarioDiarioService - Inventario ajustado: 2 ingredientes, 0 productos
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        s1_0.nombre,
        s1_0.telefono,
        d1_0.cierre_id,
        d1_0.id,
        d1_0.costo_unitario,
        d1_0.diferencia,
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida,
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        p1_0.receta_id,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta,
        d1_0.stock_desperdicio,
        d1_0.stock_merma,
        d1_0.stock_real,
        d1_0.stock_teorico,
        d1_0.valor_diferencia 
    from
        cierre_inventario_diario cid1_0 
    join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=cid1_0.usuario_id 
    left join
        empresa e2_0 
            on e2_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        detalle_cierre_inventario_diario d1_0 
            on cid1_0.id=d1_0.cierre_id 
    left join
        ingrediente i1_0 
            on i1_0.id=d1_0.ingrediente_id 
    left join
        producto p1_0 
            on p1_0.id=d1_0.producto_id 
    where
        cid1_0.id=?
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        rd1_0.ingrediente_id,
        rd1_0.id,
        rd1_0.cantidad_ingrediente,
        rd1_0.receta_id,
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        r1_0.nombre 
    from
        receta_detalle rd1_0 
    left join
        receta r1_0 
            on r1_0.id=rd1_0.receta_id 
    left join
        empresa e1_0 
            on e1_0.id=r1_0.empresa_id 
    where
        rd1_0.ingrediente_id=?
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        rd1_0.ingrediente_id,
        rd1_0.id,
        rd1_0.cantidad_ingrediente,
        rd1_0.receta_id,
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        r1_0.nombre 
    from
        receta_detalle rd1_0 
    left join
        receta r1_0 
            on r1_0.id=rd1_0.receta_id 
    left join
        empresa e1_0 
            on e1_0.id=r1_0.empresa_id 
    where
        rd1_0.ingrediente_id=?
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    update
        cierre_inventario_diario 
    set
        cantidad_facturas=?,
        empresa_id=?,
        estado=?,
        fecha=?,
        observaciones=?,
        total_ventas=?,
        usuario_id=? 
    where
        id=?
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:INTEGER) <- [0]
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [COMPLETADO]
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DATE) <- [2026-01-25]
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [Cierre para fecha espec√≠fica 2026-01-25]
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DOUBLE) <- [0.0]
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:BIGINT) <- [1]
2026-01-25 13:03:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:BIGINT) <- [5]
2026-01-25 13:03:29 [http-nio-8080-exec-4] INFO  j.s.s.s.CierreInventarioDiarioService - Cierre completado definitivamente ID: 5 para empresa ID: 1. Total ventas: 0.0, Cantidad facturas: 0
2026-01-25 13:03:29 [http-nio-8080-exec-4] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚úÖ Cierre completado definitivamente ID: 5
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 44, Tenant anterior: 1
2026-01-25 13:03:29 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 44, Request: /cierres/completar-definitivo/5, Empresa ID anterior: 1
2026-01-25 13:03:29 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres
2026-01-25 13:03:29 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=CAB428E1CB594BEFAC92C68009F5E762], Granted Authorities=[ROLE_ADMIN]]]
2026-01-25 13:03:29 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres
2026-01-25 13:03:29 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres, M√©todo: GET
2026-01-25 13:03:29 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-25 13:03:29 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-25 13:03:29 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-25 13:03:29 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-25 13:03:29 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 45
2026-01-25 13:03:29 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-25 13:03:29 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-25 13:03:29 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-25 13:03:29 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-25 13:03:29 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-25 13:03:29 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:03:29 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:03:29 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:29 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-25 13:03:29 [http-nio-8080-exec-5] INFO  j.s.s.c.CierreInventarioDiarioControlador - üìã GET /cierres - Listando cierres diarios
2026-01-25 13:03:29 [http-nio-8080-exec-5] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo todos los cierres para empresa ID: 1
2026-01-25 13:03:29 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        e1_0.id=?
2026-01-25 13:03:29 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:29 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:03:29 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:29 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-25 13:03:29 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:29 [http-nio-8080-exec-5] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 5 cierres para empresa ID: 1
2026-01-25 13:03:29 [http-nio-8080-exec-5] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Encontrados 5 cierres
2026-01-25 13:03:29 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 45, Tenant anterior: 1
2026-01-25 13:03:29 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 45, Request: /cierres, Empresa ID anterior: 1
2026-01-25 13:03:31 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-25 13:03:31 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=CAB428E1CB594BEFAC92C68009F5E762], Granted Authorities=[ROLE_ADMIN]]]
2026-01-25 13:03:31 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-25 13:03:31 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-25 13:03:31 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-25 13:03:31 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-25 13:03:31 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-25 13:03:31 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-25 13:03:31 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 46
2026-01-25 13:03:31 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-25 13:03:31 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-25 13:03:31 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-25 13:03:31 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-25 13:03:31 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-25 13:03:31 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:03:31 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:03:31 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:31 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-25 13:03:31 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 1
2026-01-25 13:03:31 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-25, Hora: 13:00
2026-01-25 13:03:31 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-25 13:03:31 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-25 13:03:31 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-25 13:03:31 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-25 13:03:31 [http-nio-8080-exec-6] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ ¬°HOY YA EST√Å CERRADO! - Bloqueando acceso. Empresa ID: 1, Fecha: 2026-01-25
2026-01-25 13:03:31 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 46, Tenant anterior: 1
2026-01-25 13:03:31 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 46, Request: /principal, Empresa ID anterior: 1
2026-01-25 13:03:31 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/bloqueado?proximoAcceso=2026-01-26%2005:00
2026-01-25 13:03:31 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=CAB428E1CB594BEFAC92C68009F5E762], Granted Authorities=[ROLE_ADMIN]]]
2026-01-25 13:03:31 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/bloqueado?proximoAcceso=2026-01-26%2005:00
2026-01-25 13:03:31 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/bloqueado, M√©todo: GET
2026-01-25 13:03:31 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-25 13:03:31 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-25 13:03:31 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-25 13:03:31 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-25 13:03:31 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 47
2026-01-25 13:03:31 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-25 13:03:31 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-25 13:03:31 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-25 13:03:31 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-25 13:03:31 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-25 13:03:31 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:03:31 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:03:31 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:31 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-25 13:03:31 [http-nio-8080-exec-7] WARN  j.s.s.c.CierreInventarioDiarioControlador - ‚õî GET /cierres/bloqueado - Sistema bloqueado. Pr√≥ximo acceso: 2026-01-26 05:00
2026-01-25 13:03:31 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 47, Tenant anterior: 1
2026-01-25 13:03:31 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 47, Request: /cierres/bloqueado, Empresa ID anterior: 1
2026-01-25 13:03:43 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /
2026-01-25 13:03:43 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /
2026-01-25 13:03:43 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /, M√©todo: GET
2026-01-25 13:03:43 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-25 13:03:43 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-25 13:03:43 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-25 13:03:43 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-25 13:03:43 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 48
2026-01-25 13:03:43 [http-nio-8080-exec-8] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-25 13:03:43 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=CAB428E1CB594BEFAC92C68009F5E762], Granted Authorities=[ROLE_ADMIN]]]
2026-01-25 13:03:43 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-25 13:03:43 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-25 13:03:43 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-25 13:03:43 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-25 13:03:43 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:03:43 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:03:43 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:43 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-25 13:03:43 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /, Empresa ID: 1
2026-01-25 13:03:43 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-25, Hora: 13:00
2026-01-25 13:03:43 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-25 13:03:43 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-25 13:03:43 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-25 13:03:43 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-25 13:03:43 [http-nio-8080-exec-8] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ ¬°HOY YA EST√Å CERRADO! - Bloqueando acceso. Empresa ID: 1, Fecha: 2026-01-25
2026-01-25 13:03:43 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 48, Tenant anterior: 1
2026-01-25 13:03:43 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 48, Request: /, Empresa ID anterior: 1
2026-01-25 13:03:43 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/bloqueado?proximoAcceso=2026-01-26%2005:00
2026-01-25 13:03:43 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=CAB428E1CB594BEFAC92C68009F5E762], Granted Authorities=[ROLE_ADMIN]]]
2026-01-25 13:03:43 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/bloqueado?proximoAcceso=2026-01-26%2005:00
2026-01-25 13:03:43 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/bloqueado, M√©todo: GET
2026-01-25 13:03:43 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-25 13:03:43 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-25 13:03:43 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-25 13:03:43 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-25 13:03:43 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 49
2026-01-25 13:03:43 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-25 13:03:43 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-25 13:03:43 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-25 13:03:43 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-25 13:03:43 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-25 13:03:43 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:03:43 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:03:43 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:43 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-25 13:03:43 [http-nio-8080-exec-9] WARN  j.s.s.c.CierreInventarioDiarioControlador - ‚õî GET /cierres/bloqueado - Sistema bloqueado. Pr√≥ximo acceso: 2026-01-26 05:00
2026-01-25 13:03:43 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 49, Tenant anterior: 1
2026-01-25 13:03:43 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 49, Request: /cierres/bloqueado, Empresa ID anterior: 1
2026-01-25 13:03:48 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /
2026-01-25 13:03:48 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /
2026-01-25 13:03:48 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /, M√©todo: GET
2026-01-25 13:03:48 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-25 13:03:48 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-25 13:03:48 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-25 13:03:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-25 13:03:48 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 50
2026-01-25 13:03:48 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-25 13:03:48 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=CAB428E1CB594BEFAC92C68009F5E762], Granted Authorities=[ROLE_ADMIN]]]
2026-01-25 13:03:48 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-25 13:03:48 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-25 13:03:48 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-25 13:03:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-25 13:03:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:03:48 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:03:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:48 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-25 13:03:48 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /, Empresa ID: 1
2026-01-25 13:03:48 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-25, Hora: 13:00
2026-01-25 13:03:48 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-25 13:03:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-25 13:03:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-25 13:03:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-25 13:03:48 [http-nio-8080-exec-10] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ ¬°HOY YA EST√Å CERRADO! - Bloqueando acceso. Empresa ID: 1, Fecha: 2026-01-25
2026-01-25 13:03:48 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 50, Tenant anterior: 1
2026-01-25 13:03:48 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 50, Request: /, Empresa ID anterior: 1
2026-01-25 13:03:48 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/bloqueado?proximoAcceso=2026-01-26%2005:00
2026-01-25 13:03:48 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=CAB428E1CB594BEFAC92C68009F5E762], Granted Authorities=[ROLE_ADMIN]]]
2026-01-25 13:03:48 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/bloqueado?proximoAcceso=2026-01-26%2005:00
2026-01-25 13:03:48 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/bloqueado, M√©todo: GET
2026-01-25 13:03:48 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-25 13:03:48 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-25 13:03:48 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-25 13:03:48 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-25 13:03:48 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 41
2026-01-25 13:03:48 [http-nio-8080-exec-1] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-25 13:03:48 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-25 13:03:48 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-25 13:03:48 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-25 13:03:48 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-25 13:03:48 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-25 13:03:48 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-25 13:03:48 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-25 13:03:48 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-25 13:03:48 [http-nio-8080-exec-1] WARN  j.s.s.c.CierreInventarioDiarioControlador - ‚õî GET /cierres/bloqueado - Sistema bloqueado. Pr√≥ximo acceso: 2026-01-26 05:00
2026-01-25 13:03:48 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 41, Tenant anterior: 1
2026-01-25 13:03:48 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 41, Request: /cierres/bloqueado, Empresa ID anterior: 1
