2026-01-23 10:40:10 [restartedMain] INFO  j.s.s.SistemadefacturacioneinventarioApplication - Starting SistemadefacturacioneinventarioApplication using Java 17.0.17 with PID 44938 (/home/josepino/Desktop/SistemaFacturaEInventario/sistemadefacturacioneinventario/target/classes started by josepino in /home/josepino/Desktop/SistemaFacturaEInventario/sistemadefacturacioneinventario)
2026-01-23 10:40:10 [restartedMain] DEBUG j.s.s.SistemadefacturacioneinventarioApplication - Running with Spring Boot v3.5.8, Spring v6.2.14
2026-01-23 10:40:10 [restartedMain] INFO  j.s.s.SistemadefacturacioneinventarioApplication - No active profile set, falling back to 1 default profile: "default"
2026-01-23 10:40:11 [restartedMain] INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2026-01-23 10:40:11 [restartedMain] INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2026-01-23 10:40:11 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-23 10:40:11 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 64 ms. Found 14 JPA repository interfaces.
2026-01-23 10:40:12 [restartedMain] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2026-01-23 10:40:12 [restartedMain] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2026-01-23 10:40:12 [restartedMain] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.49]
2026-01-23 10:40:12 [restartedMain] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2026-01-23 10:40:12 [restartedMain] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1345 ms
2026-01-23 10:40:12 [restartedMain] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-23 10:40:12 [restartedMain] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.6.36.Final
2026-01-23 10:40:12 [restartedMain] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2026-01-23 10:40:12 [restartedMain] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-23 10:40:12 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2026-01-23 10:40:13 [restartedMain] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@336c3f5a
2026-01-23 10:40:13 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2026-01-23 10:40:13 [restartedMain] INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 8.0.44
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2026-01-23 10:40:13 [restartedMain] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-23 10:40:14 [restartedMain] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-23 10:40:14 [restartedMain] DEBUG o.h.s.internal.StatisticsInitiator - Statistics initialized [enabled=false]
2026-01-23 10:40:14 [restartedMain] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2026-01-23 10:40:14 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - üîê Configurando BCryptPasswordEncoder para encriptaci√≥n de contrase√±as
2026-01-23 10:40:15 [restartedMain] INFO  j.s.s.config.WebConfig - ‚öôÔ∏è Configurando interceptores de Spring MVC
2026-01-23 10:40:15 [restartedMain] DEBUG j.s.s.config.WebConfig - Registrando CierreDiarioInterceptor
2026-01-23 10:40:15 [restartedMain] DEBUG j.s.s.config.WebConfig - CierreDiarioInterceptor configurado. Patrones incluidos: /**
2026-01-23 10:40:15 [restartedMain] DEBUG j.s.s.config.WebConfig - Patrones excluidos: /cierres/**, /login, /css/**, /js/**, /error
2026-01-23 10:40:15 [restartedMain] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name usuarioServicio
2026-01-23 10:40:15 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - üõ°Ô∏è Configurando SecurityFilterChain para SUPERADMIN (Orden 1)
2026-01-23 10:40:15 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - ‚úÖ SecurityFilterChain SUPERADMIN configurado
2026-01-23 10:40:15 [restartedMain] DEBUG o.s.s.web.DefaultSecurityFilterChain - Will secure Or [Mvc [pattern='/superadmin/**']] with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CsrfFilter, LogoutFilter, UsernamePasswordAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-23 10:40:15 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - üõ°Ô∏è Configurando SecurityFilterChain - Iniciando configuraci√≥n de seguridad
2026-01-23 10:40:15 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - ‚úÖ SecurityFilterChain configurado exitosamente
2026-01-23 10:40:15 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - Configuraci√≥n de seguridad aplicada:
2026-01-23 10:40:15 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - P√°ginas p√∫blicas: /, /login, /acceso-denegado, /css/**, /js/**, /error
2026-01-23 10:40:15 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - Solo ADMIN: /compras/**, /proveedores/**
2026-01-23 10:40:15 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - ADMIN o DEV: /productos/**, /ingredientes/**, /recetas/**, /reportes/**, /cierres/**
2026-01-23 10:40:15 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - Login: /login, Logout: /logout
2026-01-23 10:40:15 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - P√°gina acceso denegado: /acceso-denegado
2026-01-23 10:40:15 [restartedMain] DEBUG o.s.s.web.DefaultSecurityFilterChain - Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CsrfFilter, LogoutFilter, UsernamePasswordAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-23 10:40:15 [restartedMain] INFO  o.s.b.d.a.OptionalLiveReloadServer - LiveReload server is running on port 35729
2026-01-23 10:40:15 [restartedMain] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2026-01-23 10:40:15 [restartedMain] INFO  j.s.s.SistemadefacturacioneinventarioApplication - Started SistemadefacturacioneinventarioApplication in 5.386 seconds (process running for 5.743)
2026-01-23 10:40:15 [SpringApplicationShutdownHook] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2026-01-23 10:40:15 [tomcat-shutdown] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2026-01-23 10:40:15 [restartedMain] INFO  j.s.s.config.UsuarioInicial - üîß Iniciando carga de usuarios iniciales
2026-01-23 10:40:15 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2026-01-23 10:40:15 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2026-01-23 10:40:15 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2026-01-23 10:40:16 [restartedMain] WARN  c.zaxxer.hikari.pool.ProxyConnection - HikariPool-1 - Connection com.mysql.cj.jdbc.ConnectionImpl@336c3f5a marked as broken because of SQLSTATE(08003), ErrorCode(0)
java.sql.SQLNonTransientConnectionException: No operations allowed after connection closed.
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:102)
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:89)
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:81)
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:55)
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:65)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:64)
	at com.mysql.cj.jdbc.ConnectionImpl.rollback(ConnectionImpl.java:1926)
	at com.zaxxer.hikari.pool.ProxyConnection.rollback(ProxyConnection.java:386)
	at com.zaxxer.hikari.pool.HikariProxyConnection.rollback(HikariProxyConnection.java)
	at org.hibernate.resource.jdbc.internal.AbstractLogicalConnectionImplementor.rollback(AbstractLogicalConnectionImplementor.java:127)
	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl$TransactionDriverControlImpl.rollback(JdbcResourceLocalTransactionCoordinatorImpl.java:289)
	at org.hibernate.engine.transaction.internal.TransactionImpl.rollback(TransactionImpl.java:142)
	at org.springframework.orm.jpa.JpaTransactionManager.doRollback(JpaTransactionManager.java:590)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.processRollback(AbstractPlatformTransactionManager.java:897)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.rollback(AbstractPlatformTransactionManager.java:866)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.completeTransactionAfterThrowing(TransactionAspectSupport.java:716)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:384)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728)
	at jpd.sistemafacinv.sistemadefacturacioneinventario.config.UsuarioInicial$$SpringCGLIB$$0.run(<generated>)
	at org.springframework.boot.SpringApplication.lambda$callRunner$5(SpringApplication.java:788)
	at org.springframework.util.function.ThrowingConsumer$1.acceptWithException(ThrowingConsumer.java:82)
	at org.springframework.util.function.ThrowingConsumer.accept(ThrowingConsumer.java:60)
	at org.springframework.util.function.ThrowingConsumer$1.accept(ThrowingConsumer.java:86)
	at org.springframework.boot.SpringApplication.callRunner(SpringApplication.java:796)
	at org.springframework.boot.SpringApplication.callRunner(SpringApplication.java:787)
	at org.springframework.boot.SpringApplication.lambda$callRunners$3(SpringApplication.java:772)
	at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:183)
	at java.base/java.util.stream.SortedOps$SizedRefSortingSink.end(SortedOps.java:357)
	at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:510)
	at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)
	at java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:150)
	at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:173)
	at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.base/java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:596)
	at org.springframework.boot.SpringApplication.callRunners(SpringApplication.java:772)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:325)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1361)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1350)
	at jpd.sistemafacinv.sistemadefacturacioneinventario.SistemadefacturacioneinventarioApplication.main(SistemadefacturacioneinventarioApplication.java:10)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.boot.devtools.restart.RestartLauncher.run(RestartLauncher.java:50)
Caused by: com.mysql.cj.exceptions.ConnectionIsClosedException: No operations allowed after connection closed.
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:500)
	at java.base/java.lang.reflect.Constructor.newInstance(Constructor.java:481)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:52)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:95)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:140)
	at com.mysql.cj.NativeSession.checkClosed(NativeSession.java:929)
	at com.mysql.cj.jdbc.ConnectionImpl.checkClosed(ConnectionImpl.java:558)
	at com.mysql.cj.jdbc.ConnectionImpl.rollback(ConnectionImpl.java:1889)
	... 39 common frames omitted
2026-01-23 10:40:16 [restartedMain] INFO  j.s.s.SistemadefacturacioneinventarioApplication - Starting SistemadefacturacioneinventarioApplication using Java 17.0.17 with PID 45107 (/home/josepino/Desktop/SistemaFacturaEInventario/sistemadefacturacioneinventario/target/classes started by josepino in /home/josepino/Desktop/SistemaFacturaEInventario/sistemadefacturacioneinventario)
2026-01-23 10:40:16 [restartedMain] DEBUG j.s.s.SistemadefacturacioneinventarioApplication - Running with Spring Boot v3.5.8, Spring v6.2.14
2026-01-23 10:40:16 [restartedMain] INFO  j.s.s.SistemadefacturacioneinventarioApplication - No active profile set, falling back to 1 default profile: "default"
2026-01-23 10:40:17 [restartedMain] INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2026-01-23 10:40:17 [restartedMain] INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2026-01-23 10:40:17 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-23 10:40:17 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 71 ms. Found 14 JPA repository interfaces.
2026-01-23 10:40:18 [restartedMain] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2026-01-23 10:40:18 [restartedMain] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2026-01-23 10:40:18 [restartedMain] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.49]
2026-01-23 10:40:18 [restartedMain] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2026-01-23 10:40:18 [restartedMain] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1249 ms
2026-01-23 10:40:18 [restartedMain] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-23 10:40:18 [restartedMain] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.6.36.Final
2026-01-23 10:40:18 [restartedMain] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2026-01-23 10:40:18 [restartedMain] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-23 10:40:18 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2026-01-23 10:40:18 [restartedMain] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@7d5d9375
2026-01-23 10:40:18 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2026-01-23 10:40:19 [restartedMain] INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 8.0.44
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2026-01-23 10:40:19 [restartedMain] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-23 10:40:19 [restartedMain] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-23 10:40:19 [restartedMain] DEBUG o.h.s.internal.StatisticsInitiator - Statistics initialized [enabled=false]
2026-01-23 10:40:20 [restartedMain] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2026-01-23 10:40:20 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - üîê Configurando BCryptPasswordEncoder para encriptaci√≥n de contrase√±as
2026-01-23 10:40:21 [restartedMain] INFO  j.s.s.config.WebConfig - ‚öôÔ∏è Configurando interceptores de Spring MVC
2026-01-23 10:40:21 [restartedMain] DEBUG j.s.s.config.WebConfig - Registrando CierreDiarioInterceptor
2026-01-23 10:40:21 [restartedMain] DEBUG j.s.s.config.WebConfig - CierreDiarioInterceptor configurado. Patrones incluidos: /**
2026-01-23 10:40:21 [restartedMain] DEBUG j.s.s.config.WebConfig - Patrones excluidos: /cierres/**, /login, /css/**, /js/**, /error
2026-01-23 10:40:21 [restartedMain] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name usuarioServicio
2026-01-23 10:40:21 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - üõ°Ô∏è Configurando SecurityFilterChain para SUPERADMIN (Orden 1)
2026-01-23 10:40:21 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - ‚úÖ SecurityFilterChain SUPERADMIN configurado
2026-01-23 10:40:21 [restartedMain] DEBUG o.s.s.web.DefaultSecurityFilterChain - Will secure Or [Mvc [pattern='/superadmin/**']] with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CsrfFilter, LogoutFilter, UsernamePasswordAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-23 10:40:21 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - üõ°Ô∏è Configurando SecurityFilterChain - Iniciando configuraci√≥n de seguridad
2026-01-23 10:40:21 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - ‚úÖ SecurityFilterChain configurado exitosamente
2026-01-23 10:40:21 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - Configuraci√≥n de seguridad aplicada:
2026-01-23 10:40:21 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - P√°ginas p√∫blicas: /, /login, /acceso-denegado, /css/**, /js/**, /error
2026-01-23 10:40:21 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - Solo ADMIN: /compras/**, /proveedores/**
2026-01-23 10:40:21 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - ADMIN o DEV: /productos/**, /ingredientes/**, /recetas/**, /reportes/**, /cierres/**
2026-01-23 10:40:21 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - Login: /login, Logout: /logout
2026-01-23 10:40:21 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - P√°gina acceso denegado: /acceso-denegado
2026-01-23 10:40:21 [restartedMain] DEBUG o.s.s.web.DefaultSecurityFilterChain - Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CsrfFilter, LogoutFilter, UsernamePasswordAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-23 10:40:21 [restartedMain] INFO  o.s.b.d.a.OptionalLiveReloadServer - LiveReload server is running on port 35729
2026-01-23 10:40:21 [restartedMain] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2026-01-23 10:40:21 [restartedMain] INFO  j.s.s.SistemadefacturacioneinventarioApplication - Started SistemadefacturacioneinventarioApplication in 5.107 seconds (process running for 5.434)
2026-01-23 10:40:21 [restartedMain] INFO  j.s.s.config.UsuarioInicial - üîß Iniciando carga de usuarios iniciales
2026-01-23 10:40:21 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        count(*) 
    from
        empresa e1_0
2026-01-23 10:40:21 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0
2026-01-23 10:40:21 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        count(u1_0.id) 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:40:21 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:40:21 [restartedMain] DEBUG j.s.s.config.UsuarioInicial - Usuarios existentes en BD para empresa Sistema por Defecto: 3
2026-01-23 10:40:21 [restartedMain] INFO  j.s.s.config.UsuarioInicial - ‚úÖ Ya existen usuarios para empresa Sistema por Defecto. No se crean nuevos.
2026-01-23 10:40:21 [restartedMain] INFO  j.s.s.config.DataInitializer - üöÄ INICIANDO CARGA DE DATOS INICIALES DEL SISTEMA
2026-01-23 10:40:21 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        count(*) 
    from
        empresa e1_0
2026-01-23 10:40:21 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0
2026-01-23 10:40:21 [restartedMain] INFO  j.s.s.config.DataInitializer - ‚úÖ Empresa existente encontrada: Sistema por Defecto (ID: 1)
2026-01-23 10:40:21 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        c1_0.id 
    from
        cliente c1_0 
    left join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    where
        c1_0.nombre=? 
        and e1_0.id=? 
    limit
        ?
2026-01-23 10:40:21 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Consumidor Final]
2026-01-23 10:40:21 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-23 10:40:21 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:INTEGER) <- [1]
2026-01-23 10:40:21 [restartedMain] INFO  j.s.s.config.DataInitializer - ‚úÖ Cliente 'Consumidor Final' ya existe para empresa Sistema por Defecto
2026-01-23 10:40:21 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        count(u1_0.id) 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:40:21 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:40:21 [restartedMain] INFO  j.s.s.config.DataInitializer - ‚úÖ Ya existen 3 usuarios para empresa Sistema por Defecto. No se crean nuevos.
2026-01-23 10:40:21 [restartedMain] INFO  j.s.s.config.DataInitializer - üëë Verificando existencia de usuario SUPER_ADMIN
2026-01-23 10:40:21 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        u1_0.id 
    from
        usuario u1_0 
    where
        u1_0.rol=? 
    limit
        ?
2026-01-23 10:40:21 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [SUPER_ADMIN]
2026-01-23 10:40:21 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [1]
2026-01-23 10:40:21 [restartedMain] INFO  j.s.s.config.DataInitializer - ‚úÖ Usuario SUPER_ADMIN ya existe en el sistema
2026-01-23 10:40:21 [restartedMain] INFO  j.s.s.config.DataInitializer - ‚úÖ CARGA DE DATOS INICIALES COMPLETADA EXITOSAMENTE
2026-01-23 10:40:40 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2026-01-23 10:40:40 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2026-01-23 10:40:40 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2026-01-23 10:40:40 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/login
2026-01-23 10:40:40 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/login
2026-01-23 10:40:40 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/login
2026-01-23 10:40:40 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/login, Empresa ID: null
2026-01-23 10:40:40 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/login
2026-01-23 10:40:40 [http-nio-8080-exec-1] INFO  j.s.s.c.SuperAdminController - üîì Mostrando p√°gina de login para SUPER_ADMIN
2026-01-23 10:40:40 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-23 10:40:40 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 41, Request: /superadmin/login, Empresa ID anterior: null
2026-01-23 10:40:40 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-23 10:40:40 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-23 10:40:40 [http-nio-8080-exec-2] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to http://localhost:8080/login
2026-01-23 10:40:40 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login
2026-01-23 10:40:40 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login
2026-01-23 10:40:40 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-23 10:40:40 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: localhost
2026-01-23 10:40:40 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: localhost
2026-01-23 10:40:40 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:40:40 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-23 10:40:40 [http-nio-8080-exec-3] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@1231982819 wrapping com.mysql.cj.jdbc.ConnectionImpl@7d5d9375] read-only
2026-01-23 10:40:40 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:40:40 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:40:40 [http-nio-8080-exec-3] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@1231982819 wrapping com.mysql.cj.jdbc.ConnectionImpl@7d5d9375]
2026-01-23 10:40:40 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 43
2026-01-23 10:40:40 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚ö†Ô∏è Usando empresa por defecto (localhost): 1 - Sistema por Defecto
2026-01-23 10:40:40 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-23 10:40:40 [http-nio-8080-exec-3] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-23 10:40:40 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 43, Tenant anterior: 1
2026-01-23 10:40:40 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /login, Empresa ID anterior: 1
2026-01-23 10:40:45 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing POST /superadmin/login
2026-01-23 10:40:45 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: josepino para la empresa ID: null
2026-01-23 10:40:45 [http-nio-8080-exec-4] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: josepino | Subdominio: localhost
2026-01-23 10:40:45 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=?
2026-01-23 10:40:45 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [josepino]
2026-01-23 10:40:45 [http-nio-8080-exec-4] INFO  j.s.s.servicios.UsuarioServicio - ‚úÖ SUPER_ADMIN cargado: josepino - Rol: SUPER_ADMIN
2026-01-23 10:40:45 [http-nio-8080-exec-4] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Authenticated user
2026-01-23 10:40:45 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.s.ChangeSessionIdAuthenticationStrategy - Changed session id from 8D61E703D2250066D40A110E07A06444
2026-01-23 10:40:45 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.CsrfAuthenticationStrategy - Replaced CSRF Token
2026-01-23 10:40:45 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Stored SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=8D61E703D2250066D40A110E07A06444], Granted Authorities=[ROLE_SUPER_ADMIN]]] to HttpSession [org.apache.catalina.session.StandardSessionFacade@57e13e15]
2026-01-23 10:40:45 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.UsernamePasswordAuthenticationFilter - Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=8D61E703D2250066D40A110E07A06444], Granted Authorities=[ROLE_SUPER_ADMIN]]
2026-01-23 10:40:45 [http-nio-8080-exec-4] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /superadmin/dashboard
2026-01-23 10:40:45 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/dashboard
2026-01-23 10:40:45 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=8D61E703D2250066D40A110E07A06444], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-23 10:40:45 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/dashboard
2026-01-23 10:40:45 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/dashboard
2026-01-23 10:40:45 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/dashboard, Empresa ID: null
2026-01-23 10:40:45 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/dashboard
2026-01-23 10:40:45 [http-nio-8080-exec-5] INFO  j.s.s.c.SuperAdminController - üìä Accediendo al dashboard SUPER_ADMIN
2026-01-23 10:40:45 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 45, Request: /superadmin/dashboard, Empresa ID anterior: null
2026-01-23 10:40:45 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/empresas
2026-01-23 10:40:45 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=8D61E703D2250066D40A110E07A06444], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-23 10:40:45 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/empresas
2026-01-23 10:40:45 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/empresas
2026-01-23 10:40:45 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/empresas, Empresa ID: null
2026-01-23 10:40:45 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/empresas
2026-01-23 10:40:45 [http-nio-8080-exec-6] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@1142093431 wrapping com.mysql.cj.jdbc.ConnectionImpl@7d5d9375] read-only
2026-01-23 10:40:45 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0
2026-01-23 10:40:45 [http-nio-8080-exec-6] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@1142093431 wrapping com.mysql.cj.jdbc.ConnectionImpl@7d5d9375]
2026-01-23 10:40:45 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 46, Request: /superadmin/empresas, Empresa ID anterior: null
2026-01-23 10:40:45 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-23 10:40:45 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=8D61E703D2250066D40A110E07A06444], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-23 10:40:45 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-23 10:40:45 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-23 10:40:45 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: localhost
2026-01-23 10:40:45 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: localhost
2026-01-23 10:40:45 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:40:45 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-23 10:40:45 [http-nio-8080-exec-7] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@1736996854 wrapping com.mysql.cj.jdbc.ConnectionImpl@7d5d9375] read-only
2026-01-23 10:40:45 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:40:45 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:40:45 [http-nio-8080-exec-7] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@1736996854 wrapping com.mysql.cj.jdbc.ConnectionImpl@7d5d9375]
2026-01-23 10:40:45 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 47
2026-01-23 10:40:45 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚ö†Ô∏è Usando empresa por defecto (localhost): 1 - Sistema por Defecto
2026-01-23 10:40:45 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: josepino
2026-01-23 10:40:45 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: josepino en empresa ID: 1
2026-01-23 10:40:45 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:40:45 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [josepino]
2026-01-23 10:40:45 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-23 10:40:45 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 1
2026-01-23 10:40:45 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:40:45 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:40:45 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:40:45 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:40:45 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-23 10:40:45 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:40:45 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:40:45 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:40:45 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:40:45 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-23 10:40:45 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: false (Empresa ID: 1)
2026-01-23 10:40:45 [http-nio-8080-exec-7] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-22 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-23 10:40:45 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 47, Tenant anterior: 1
2026-01-23 10:40:45 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 47, Request: /favicon.ico, Empresa ID anterior: 1
2026-01-23 10:40:45 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-22
2026-01-23 10:40:45 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=8D61E703D2250066D40A110E07A06444], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-23 10:40:45 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AccessDeniedHandlerImpl - Forwarding to /acceso-denegado with status code 403
2026-01-23 10:40:45 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /acceso-denegado?fecha=2026-01-22
2026-01-23 10:40:45 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /acceso-denegado?fecha=2026-01-22
2026-01-23 10:40:45 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /acceso-denegado, Empresa ID: null
2026-01-23 10:40:45 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì Interceptando acceso-denegado - EMPRESA: null
2026-01-23 10:40:45 [http-nio-8080-exec-8] WARN  j.s.s.controladores.InicioController - ‚õî GET /acceso-denigado - Mostrando p√°gina de acceso denegado
2026-01-23 10:40:48 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /
2026-01-23 10:40:48 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /
2026-01-23 10:40:48 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /, M√©todo: GET
2026-01-23 10:40:48 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:40:48 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:40:48 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:40:48 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:40:48 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 49
2026-01-23 10:40:48 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:40:48 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-23 10:40:48 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /, Empresa ID: 2
2026-01-23 10:40:48 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:40:48 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:40:48 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:40:48 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:40:48 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:40:48 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:40:48 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:40:48 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:40:48 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:40:48 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:40:48 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: false (Empresa ID: 2)
2026-01-23 10:40:48 [http-nio-8080-exec-9] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-22 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-23 10:40:48 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 49, Tenant anterior: 2
2026-01-23 10:40:48 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 49, Request: /, Empresa ID anterior: 2
2026-01-23 10:40:48 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-22
2026-01-23 10:40:48 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-23 10:40:48 [http-nio-8080-exec-10] DEBUG o.s.s.w.s.HttpSessionRequestCache - Saved request http://jose.localhost:8080/cierres/obligatorio?fecha=2026-01-22&continue to session
2026-01-23 10:40:48 [http-nio-8080-exec-10] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to http://jose.localhost:8080/login
2026-01-23 10:40:48 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login
2026-01-23 10:40:48 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login
2026-01-23 10:40:48 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-23 10:40:48 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:40:48 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:40:48 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:40:48 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:40:48 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 41
2026-01-23 10:40:48 [http-nio-8080-exec-1] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:40:48 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-23 10:40:48 [http-nio-8080-exec-1] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-23 10:40:48 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 41, Tenant anterior: 2
2026-01-23 10:40:48 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 41, Request: /login, Empresa ID anterior: 2
2026-01-23 10:40:48 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-23 10:40:48 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-23 10:40:48 [http-nio-8080-exec-2] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to http://jose.localhost:8080/login
2026-01-23 10:40:48 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login
2026-01-23 10:40:48 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login
2026-01-23 10:40:48 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-23 10:40:48 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:40:48 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:40:48 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:40:48 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:40:48 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 43
2026-01-23 10:40:48 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:40:48 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-23 10:40:48 [http-nio-8080-exec-3] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-23 10:40:48 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 43, Tenant anterior: 2
2026-01-23 10:40:48 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /login, Empresa ID anterior: 2
2026-01-23 10:40:54 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-23 10:40:54 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: admin para la empresa ID: null
2026-01-23 10:40:54 [http-nio-8080-exec-4] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: jose
2026-01-23 10:40:54 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:40:54 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:40:54 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: jose | Empresa ID: 2 | Empresa Nombre: Empresa JOse
2026-01-23 10:40:54 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:40:54 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:40:54 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:40:54 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:40:54 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:40:54 [http-nio-8080-exec-4] INFO  j.s.s.servicios.UsuarioServicio - üîê Encontrado usuario: admin
2026-01-23 10:40:54 [http-nio-8080-exec-4] INFO  j.s.s.servicios.UsuarioServicio - üîê Rol: ADMIN
2026-01-23 10:40:54 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - üîê Activo: true
2026-01-23 10:40:54 [http-nio-8080-exec-4] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Authenticated user
2026-01-23 10:40:54 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.s.ChangeSessionIdAuthenticationStrategy - Changed session id from B04EBE3DA9229FD10093C50E877629BB
2026-01-23 10:40:54 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.CsrfAuthenticationStrategy - Replaced CSRF Token
2026-01-23 10:40:54 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Stored SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]] to HttpSession [org.apache.catalina.session.StandardSessionFacade@23b046b1]
2026-01-23 10:40:54 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.UsernamePasswordAuthenticationFilter - Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]
2026-01-23 10:40:54 [http-nio-8080-exec-4] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /principal
2026-01-23 10:40:54 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-23 10:40:54 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:40:54 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-23 10:40:54 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-23 10:40:54 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:40:54 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:40:54 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:40:54 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:40:54 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 45
2026-01-23 10:40:54 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:40:54 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:40:54 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:40:54 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:40:54 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:40:54 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:40:54 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:40:54 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:40:54 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:40:54 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-23 10:40:54 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:40:54 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:40:54 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:40:54 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:40:54 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:40:54 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:40:54 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:40:54 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:40:54 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:40:54 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:40:54 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: false (Empresa ID: 2)
2026-01-23 10:40:54 [http-nio-8080-exec-5] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-22 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-23 10:40:54 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 45, Tenant anterior: 2
2026-01-23 10:40:54 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 45, Request: /principal, Empresa ID anterior: 2
2026-01-23 10:40:54 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-22
2026-01-23 10:40:54 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:40:54 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/obligatorio?fecha=2026-01-22
2026-01-23 10:40:54 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/obligatorio, M√©todo: GET
2026-01-23 10:40:54 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:40:54 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:40:54 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:40:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:40:54 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 46
2026-01-23 10:40:54 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:40:54 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:40:54 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:40:54 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:40:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:40:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:40:54 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:40:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:40:54 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:40:54 [http-nio-8080-exec-6] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚è∞ GET /cierres/obligatorio - Verificando cierre obligatorio
2026-01-23 10:40:54 [http-nio-8080-exec-6] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Hora actual: 10:00, Fecha: 2026-01-23
2026-01-23 10:40:54 [http-nio-8080-exec-6] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Fecha proporcionada: 2026-01-22
2026-01-23 10:40:54 [http-nio-8080-exec-6] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚ö†Ô∏è Cierre obligatorio requerido para fecha: 2026-01-22
2026-01-23 10:40:54 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 46, Tenant anterior: 2
2026-01-23 10:40:54 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 46, Request: /cierres/obligatorio, Empresa ID anterior: 2
2026-01-23 10:40:54 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-23 10:40:54 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:40:54 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-23 10:40:54 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-23 10:40:54 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:40:54 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:40:54 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:40:54 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:40:54 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 47
2026-01-23 10:40:54 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:40:54 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:40:54 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:40:54 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:40:54 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:40:54 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:40:54 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:40:54 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:40:54 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:40:54 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 2
2026-01-23 10:40:54 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:40:54 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:40:54 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:40:54 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:40:54 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:40:54 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:40:54 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:40:54 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:40:54 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:40:54 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:40:54 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: false (Empresa ID: 2)
2026-01-23 10:40:54 [http-nio-8080-exec-7] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-22 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-23 10:40:54 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 47, Tenant anterior: 2
2026-01-23 10:40:54 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 47, Request: /favicon.ico, Empresa ID anterior: 2
2026-01-23 10:40:54 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-22
2026-01-23 10:40:54 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:40:54 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/obligatorio?fecha=2026-01-22
2026-01-23 10:40:54 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/obligatorio, M√©todo: GET
2026-01-23 10:40:54 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:40:54 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:40:54 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:40:54 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:40:54 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 48
2026-01-23 10:40:54 [http-nio-8080-exec-8] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:40:54 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:40:54 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:40:54 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:40:54 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:40:54 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:40:54 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:40:54 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:40:54 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:40:54 [http-nio-8080-exec-8] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚è∞ GET /cierres/obligatorio - Verificando cierre obligatorio
2026-01-23 10:40:54 [http-nio-8080-exec-8] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Hora actual: 10:00, Fecha: 2026-01-23
2026-01-23 10:40:54 [http-nio-8080-exec-8] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Fecha proporcionada: 2026-01-22
2026-01-23 10:40:54 [http-nio-8080-exec-8] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚ö†Ô∏è Cierre obligatorio requerido para fecha: 2026-01-22
2026-01-23 10:40:54 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 48, Tenant anterior: 2
2026-01-23 10:40:54 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 48, Request: /cierres/obligatorio, Empresa ID anterior: 2
2026-01-23 10:41:14 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/iniciar?fecha=2026-01-21
2026-01-23 10:41:14 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:41:14 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/iniciar?fecha=2026-01-21
2026-01-23 10:41:14 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/iniciar, M√©todo: GET
2026-01-23 10:41:14 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:41:14 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:41:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:41:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:41:14 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 49
2026-01-23 10:41:14 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:41:14 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:41:14 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:41:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:41:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:41:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:14 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:41:14 [http-nio-8080-exec-9] INFO  j.s.s.c.CierreInventarioDiarioControlador - üöÄ GET /cierres/iniciar - Iniciando nuevo cierre. Usuario: admin, Fecha: 2026-01-21
2026-01-23 10:41:14 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:41:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:41:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:41:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:14 [http-nio-8080-exec-9] INFO  j.s.s.s.CierreInventarioDiarioService - Iniciando cierre para fecha espec√≠fica: 2026-01-21 para empresa ID: 2, Usuario: admin
2026-01-23 10:41:14 [http-nio-8080-exec-9] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@959362632 wrapping com.mysql.cj.jdbc.ConnectionImpl@7d5d9375] read-only
2026-01-23 10:41:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:14 [http-nio-8080-exec-9] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@959362632 wrapping com.mysql.cj.jdbc.ConnectionImpl@7d5d9375]
2026-01-23 10:41:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.fecha=? 
        and e1_0.id=?
2026-01-23 10:41:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-23 10:41:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-23 10:41:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-23 10:41:14 [http-nio-8080-exec-9] WARN  j.s.s.s.CierreInventarioDiarioService - Ya existe un cierre para la fecha: 2026-01-21 - Estado: COMPLETADO, ID: 1
2026-01-23 10:41:14 [http-nio-8080-exec-9] ERROR j.s.s.c.CierreInventarioDiarioControlador - ‚ùå Error al iniciar cierre. Usuario: admin, Fecha: 2026-01-21, Error: Ya existe un cierre COMPLETADO para la fecha: 2026-01-21
java.lang.RuntimeException: Ya existe un cierre COMPLETADO para la fecha: 2026-01-21
	at jpd.sistemafacinv.sistemadefacturacioneinventario.servicios.CierreInventarioDiarioService.iniciarCierreParaFecha(CierreInventarioDiarioService.java:369)
	at jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.CierreInventarioDiarioControlador.iniciarNuevoCierre(CierreInventarioDiarioControlador.java:62)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at jpd.sistemafacinv.sistemadefacturacioneinventario.context.TenantFilter.doFilter(TenantFilter.java:123)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at jpd.sistemafacinv.sistemadefacturacioneinventario.context.TenantContextCleanupFilter.doFilter(TenantContextCleanupFilter.java:45)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:365)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:101)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:125)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:119)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:235)
	at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:229)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.csrf.CsrfFilter.doFilterInternal(CsrfFilter.java:117)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.ServletRequestPathFilter.doFilter(ServletRequestPathFilter.java:52)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebSecurityConfiguration.java:319)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$4(HandlerMappingIntrospector.java:267)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:240)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:362)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:278)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:88)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:113)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:83)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:72)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:399)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1774)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:973)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:491)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:840)
2026-01-23 10:41:14 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 49, Tenant anterior: 2
2026-01-23 10:41:14 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 49, Request: /cierres/iniciar, Empresa ID anterior: 2
2026-01-23 10:41:14 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio
2026-01-23 10:41:14 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:41:14 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/obligatorio
2026-01-23 10:41:14 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/obligatorio, M√©todo: GET
2026-01-23 10:41:14 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:41:14 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:41:14 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:41:14 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:41:14 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 50
2026-01-23 10:41:14 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:41:14 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:41:14 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:41:14 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:41:14 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:41:14 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:14 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:14 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:14 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:41:14 [http-nio-8080-exec-10] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚è∞ GET /cierres/obligatorio - Verificando cierre obligatorio
2026-01-23 10:41:14 [http-nio-8080-exec-10] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Hora actual: 10:00, Fecha: 2026-01-23
2026-01-23 10:41:14 [http-nio-8080-exec-10] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Despu√©s de 5 AM, fecha pendiente: 2026-01-22 (ayer)
2026-01-23 10:41:14 [http-nio-8080-exec-10] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚ö†Ô∏è Cierre obligatorio requerido para fecha: 2026-01-22
2026-01-23 10:41:14 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 50, Tenant anterior: 2
2026-01-23 10:41:14 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 50, Request: /cierres/obligatorio, Empresa ID anterior: 2
2026-01-23 10:41:14 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-23 10:41:14 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:41:14 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-23 10:41:14 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-23 10:41:14 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:41:14 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:41:14 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:41:14 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:41:14 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 41
2026-01-23 10:41:14 [http-nio-8080-exec-1] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:41:14 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:41:14 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:41:14 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:41:14 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:41:14 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:14 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:14 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:14 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:41:14 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 2
2026-01-23 10:41:14 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:41:14 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:41:14 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:41:14 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:41:14 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:41:14 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:41:14 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:41:14 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:41:14 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:41:14 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:41:14 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: false (Empresa ID: 2)
2026-01-23 10:41:14 [http-nio-8080-exec-1] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-22 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-23 10:41:14 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 41, Tenant anterior: 2
2026-01-23 10:41:14 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 41, Request: /favicon.ico, Empresa ID anterior: 2
2026-01-23 10:41:14 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-22
2026-01-23 10:41:14 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:41:14 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/obligatorio?fecha=2026-01-22
2026-01-23 10:41:14 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/obligatorio, M√©todo: GET
2026-01-23 10:41:14 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:41:14 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:41:14 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:41:14 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:41:14 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 42
2026-01-23 10:41:14 [http-nio-8080-exec-2] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:41:14 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:41:14 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:41:14 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:41:14 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:41:14 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:14 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:14 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:14 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:41:14 [http-nio-8080-exec-2] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚è∞ GET /cierres/obligatorio - Verificando cierre obligatorio
2026-01-23 10:41:14 [http-nio-8080-exec-2] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Hora actual: 10:00, Fecha: 2026-01-23
2026-01-23 10:41:14 [http-nio-8080-exec-2] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Fecha proporcionada: 2026-01-22
2026-01-23 10:41:14 [http-nio-8080-exec-2] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚ö†Ô∏è Cierre obligatorio requerido para fecha: 2026-01-22
2026-01-23 10:41:14 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 42, Tenant anterior: 2
2026-01-23 10:41:14 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 42, Request: /cierres/obligatorio, Empresa ID anterior: 2
2026-01-23 10:41:15 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/iniciar?fecha=2026-01-22
2026-01-23 10:41:15 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:41:15 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/iniciar?fecha=2026-01-22
2026-01-23 10:41:15 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/iniciar, M√©todo: GET
2026-01-23 10:41:15 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:41:15 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:41:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:41:15 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:41:15 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 43
2026-01-23 10:41:15 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:41:15 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:41:15 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:41:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:41:15 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:41:15 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:15 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:15 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:41:15 [http-nio-8080-exec-3] INFO  j.s.s.c.CierreInventarioDiarioControlador - üöÄ GET /cierres/iniciar - Iniciando nuevo cierre. Usuario: admin, Fecha: 2026-01-22
2026-01-23 10:41:15 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:41:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:41:15 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:41:15 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:15 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:15 [http-nio-8080-exec-3] INFO  j.s.s.s.CierreInventarioDiarioService - Iniciando cierre para fecha espec√≠fica: 2026-01-22 para empresa ID: 2, Usuario: admin
2026-01-23 10:41:15 [http-nio-8080-exec-3] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@781403448 wrapping com.mysql.cj.jdbc.ConnectionImpl@7d5d9375] read-only
2026-01-23 10:41:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:15 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:15 [http-nio-8080-exec-3] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@781403448 wrapping com.mysql.cj.jdbc.ConnectionImpl@7d5d9375]
2026-01-23 10:41:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.fecha=? 
        and e1_0.id=?
2026-01-23 10:41:15 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:41:15 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:15 [http-nio-8080-exec-3] DEBUG j.s.s.s.CierreInventarioDiarioService - No hay cierre existente para fecha: 2026-01-22
2026-01-23 10:41:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        cierre_inventario_diario
        (cantidad_facturas, empresa_id, estado, fecha, observaciones, total_ventas, usuario_id) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-23 10:41:15 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:INTEGER) <- [0]
2026-01-23 10:41:15 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:15 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [EN_PROCESO]
2026-01-23 10:41:15 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DATE) <- [2026-01-22]
2026-01-23 10:41:15 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [Cierre para fecha espec√≠fica 2026-01-22]
2026-01-23 10:41:15 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DOUBLE) <- [0.0]
2026-01-23 10:41:15 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:BIGINT) <- [5]
2026-01-23 10:41:15 [http-nio-8080-exec-3] INFO  j.s.s.s.CierreInventarioDiarioService - ‚úÖ Cierre creado para fecha espec√≠fica ID: 2 - Fecha: 2026-01-22, Usuario: admin
2026-01-23 10:41:15 [http-nio-8080-exec-3] DEBUG j.s.s.s.CierreInventarioDiarioService - Precargando detalles para cierre ID: 2
2026-01-23 10:41:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    left join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:41:15 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:15 [http-nio-8080-exec-3] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 0 ingredientes para empresa ID: 2
2026-01-23 10:41:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        p1_0.receta_id,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta 
    from
        producto p1_0 
    left join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        e1_0.id=? 
        and not(p1_0.tiene_receta)
2026-01-23 10:41:15 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:15 [http-nio-8080-exec-3] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 0 productos sin receta para empresa ID: 2
2026-01-23 10:41:15 [http-nio-8080-exec-3] INFO  j.s.s.s.CierreInventarioDiarioService - Detalles precargados: 0 totales para cierre ID: 2
2026-01-23 10:41:15 [http-nio-8080-exec-3] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚úÖ Cierre iniciado para fecha espec√≠fica: 2026-01-22 por usuario: admin
2026-01-23 10:41:15 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 43, Tenant anterior: 2
2026-01-23 10:41:15 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /cierres/iniciar, Empresa ID anterior: 2
2026-01-23 10:41:15 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/en-proceso
2026-01-23 10:41:15 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:41:15 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/en-proceso
2026-01-23 10:41:15 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/en-proceso, M√©todo: GET
2026-01-23 10:41:15 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:41:15 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:41:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:41:15 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:41:15 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 44
2026-01-23 10:41:15 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:41:15 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:41:15 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:41:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:41:15 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:41:15 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:15 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:15 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:41:15 [http-nio-8080-exec-4] INFO  j.s.s.c.CierreInventarioDiarioControlador - üîç GET /cierres/en-proceso - Viendo cierre en proceso
2026-01-23 10:41:15 [http-nio-8080-exec-4] DEBUG j.s.s.s.CierreInventarioDiarioService - Buscando cierre en proceso para empresa ID: 2
2026-01-23 10:41:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.estado=? 
        and e1_0.id=?
2026-01-23 10:41:15 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [EN_PROCESO]
2026-01-23 10:41:15 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:15 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-23 10:41:15 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-23 10:41:15 [http-nio-8080-exec-4] DEBUG j.s.s.s.CierreInventarioDiarioService - Cierre en proceso encontrado ID: 2 para empresa ID: 2
2026-01-23 10:41:15 [http-nio-8080-exec-4] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo detalles para cierre ID: 2
2026-01-23 10:41:15 [http-nio-8080-exec-4] DEBUG j.s.s.s.CierreInventarioDiarioService - Buscando cierre ID: 2 para empresa ID: 2
2026-01-23 10:41:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.id=? 
        and e1_0.id=?
2026-01-23 10:41:15 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:15 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:15 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-23 10:41:15 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-23 10:41:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        dcid1_0.ingrediente_id,
        dcid1_0.producto_id,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    where
        dcid1_0.cierre_id=?
2026-01-23 10:41:15 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:15 [http-nio-8080-exec-4] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 0 detalles para cierre ID: 2
2026-01-23 10:41:15 [http-nio-8080-exec-4] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Cierre en proceso ID: 2, Estado: EN_PROCESO, Detalles: 0, Total diferencia: 0.0
2026-01-23 10:41:15 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 44, Tenant anterior: 2
2026-01-23 10:41:15 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 44, Request: /cierres/en-proceso, Empresa ID anterior: 2
2026-01-23 10:41:15 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-23 10:41:15 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:41:15 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-23 10:41:15 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-23 10:41:15 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:41:15 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:41:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:41:15 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:41:15 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 45
2026-01-23 10:41:15 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:41:15 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:41:15 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:41:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:41:15 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:41:15 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:15 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:15 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:41:15 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 2
2026-01-23 10:41:15 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:41:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:41:15 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:41:15 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:41:15 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:41:15 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:41:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:41:15 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:41:15 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:41:15 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:41:15 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: false (Empresa ID: 2)
2026-01-23 10:41:15 [http-nio-8080-exec-5] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-22 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-23 10:41:15 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 45, Tenant anterior: 2
2026-01-23 10:41:15 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 45, Request: /favicon.ico, Empresa ID anterior: 2
2026-01-23 10:41:15 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-22
2026-01-23 10:41:15 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:41:15 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/obligatorio?fecha=2026-01-22
2026-01-23 10:41:15 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/obligatorio, M√©todo: GET
2026-01-23 10:41:15 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:41:15 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:41:15 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:41:15 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:41:15 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 46
2026-01-23 10:41:15 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:41:15 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:41:15 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:41:15 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:41:15 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:41:15 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:15 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:15 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:15 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:41:15 [http-nio-8080-exec-6] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚è∞ GET /cierres/obligatorio - Verificando cierre obligatorio
2026-01-23 10:41:15 [http-nio-8080-exec-6] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Hora actual: 10:00, Fecha: 2026-01-23
2026-01-23 10:41:15 [http-nio-8080-exec-6] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Fecha proporcionada: 2026-01-22
2026-01-23 10:41:15 [http-nio-8080-exec-6] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚ö†Ô∏è Cierre obligatorio requerido para fecha: 2026-01-22
2026-01-23 10:41:15 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 46, Tenant anterior: 2
2026-01-23 10:41:15 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 46, Request: /cierres/obligatorio, Empresa ID anterior: 2
2026-01-23 10:41:17 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing POST /cierres/completar/2
2026-01-23 10:41:17 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:41:17 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured POST /cierres/completar/2
2026-01-23 10:41:17 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/completar/2, M√©todo: POST
2026-01-23 10:41:17 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:41:17 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:41:17 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:41:17 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:41:17 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 47
2026-01-23 10:41:17 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:41:17 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:41:17 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:41:17 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:41:17 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:41:17 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:17 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:17 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:17 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:41:17 [http-nio-8080-exec-7] INFO  j.s.s.c.CierreInventarioDiarioControlador - üìù POST /cierres/completar/2 - Completando cierre (PRE-COMPLETADO)
2026-01-23 10:41:17 [http-nio-8080-exec-7] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Recibidos 0 detalles para guardar
2026-01-23 10:41:17 [http-nio-8080-exec-7] DEBUG j.s.s.c.CierreInventarioDiarioControlador - 0 detalles actualizados
2026-01-23 10:41:17 [http-nio-8080-exec-7] INFO  j.s.s.s.CierreInventarioDiarioService - Completando cierre ID: 2 para empresa ID: 2
2026-01-23 10:41:17 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.id=? 
        and e1_0.id=?
2026-01-23 10:41:17 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:17 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:17 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:17 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:17 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-23 10:41:17 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-23 10:41:17 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        dcid1_0.ingrediente_id,
        dcid1_0.producto_id,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    where
        dcid1_0.cierre_id=?
2026-01-23 10:41:17 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:17 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        s1_0.nombre,
        s1_0.telefono,
        d1_0.cierre_id,
        d1_0.id,
        d1_0.costo_unitario,
        d1_0.diferencia,
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida,
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        p1_0.receta_id,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta,
        d1_0.stock_desperdicio,
        d1_0.stock_merma,
        d1_0.stock_real,
        d1_0.stock_teorico,
        d1_0.valor_diferencia 
    from
        cierre_inventario_diario cid1_0 
    join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=cid1_0.usuario_id 
    left join
        empresa e2_0 
            on e2_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        detalle_cierre_inventario_diario d1_0 
            on cid1_0.id=d1_0.cierre_id 
    left join
        ingrediente i1_0 
            on i1_0.id=d1_0.ingrediente_id 
    left join
        producto p1_0 
            on p1_0.id=d1_0.producto_id 
    where
        cid1_0.id=?
2026-01-23 10:41:17 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:17 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    update
        cierre_inventario_diario 
    set
        cantidad_facturas=?,
        empresa_id=?,
        estado=?,
        fecha=?,
        observaciones=?,
        total_ventas=?,
        usuario_id=? 
    where
        id=?
2026-01-23 10:41:17 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:INTEGER) <- [0]
2026-01-23 10:41:17 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:17 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [PRE-COMPLETADO]
2026-01-23 10:41:17 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DATE) <- [2026-01-22]
2026-01-23 10:41:17 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [Cierre para fecha espec√≠fica 2026-01-22]
2026-01-23 10:41:17 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DOUBLE) <- [0.0]
2026-01-23 10:41:17 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:BIGINT) <- [5]
2026-01-23 10:41:17 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:BIGINT) <- [2]
2026-01-23 10:41:17 [http-nio-8080-exec-7] INFO  j.s.s.s.CierreInventarioDiarioService - Cierre marcado como PRE-COMPLETADO ID: 2 para empresa ID: 2
2026-01-23 10:41:17 [http-nio-8080-exec-7] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚úÖ Cierre marcado como PRE-COMPLETADO ID: 2
2026-01-23 10:41:17 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 47, Tenant anterior: 2
2026-01-23 10:41:17 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 47, Request: /cierres/completar/2, Empresa ID anterior: 2
2026-01-23 10:41:17 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres
2026-01-23 10:41:17 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:41:17 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres
2026-01-23 10:41:17 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres, M√©todo: GET
2026-01-23 10:41:17 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:41:17 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:41:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:41:17 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:41:17 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 48
2026-01-23 10:41:17 [http-nio-8080-exec-8] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:41:17 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:41:17 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:41:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:41:17 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:41:17 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:17 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:17 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:41:17 [http-nio-8080-exec-8] INFO  j.s.s.c.CierreInventarioDiarioControlador - üìã GET /cierres - Listando cierres diarios
2026-01-23 10:41:17 [http-nio-8080-exec-8] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo todos los cierres para empresa ID: 2
2026-01-23 10:41:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:41:17 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:17 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-23 10:41:17 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-23 10:41:17 [http-nio-8080-exec-8] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 2 cierres para empresa ID: 2
2026-01-23 10:41:17 [http-nio-8080-exec-8] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Encontrados 2 cierres
2026-01-23 10:41:17 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 48, Tenant anterior: 2
2026-01-23 10:41:17 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 48, Request: /cierres, Empresa ID anterior: 2
2026-01-23 10:41:17 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-23 10:41:17 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:41:17 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-23 10:41:17 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-23 10:41:17 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:41:17 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:41:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:41:17 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:41:17 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 49
2026-01-23 10:41:17 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:41:17 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:41:17 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:41:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:41:17 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:41:17 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:17 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:17 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:41:17 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 2
2026-01-23 10:41:17 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:41:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:41:17 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:41:17 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:41:17 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:41:17 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:41:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:41:17 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:41:17 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:41:17 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:41:17 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: false (Empresa ID: 2)
2026-01-23 10:41:17 [http-nio-8080-exec-9] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-22 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-23 10:41:17 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 49, Tenant anterior: 2
2026-01-23 10:41:17 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 49, Request: /favicon.ico, Empresa ID anterior: 2
2026-01-23 10:41:17 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-22
2026-01-23 10:41:17 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:41:17 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/obligatorio?fecha=2026-01-22
2026-01-23 10:41:17 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/obligatorio, M√©todo: GET
2026-01-23 10:41:17 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:41:17 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:41:17 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:41:17 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:41:17 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 50
2026-01-23 10:41:17 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:41:17 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:41:17 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:41:17 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:41:17 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:41:17 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:17 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:17 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:17 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:41:17 [http-nio-8080-exec-10] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚è∞ GET /cierres/obligatorio - Verificando cierre obligatorio
2026-01-23 10:41:17 [http-nio-8080-exec-10] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Hora actual: 10:00, Fecha: 2026-01-23
2026-01-23 10:41:17 [http-nio-8080-exec-10] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Fecha proporcionada: 2026-01-22
2026-01-23 10:41:17 [http-nio-8080-exec-10] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚ö†Ô∏è Cierre obligatorio requerido para fecha: 2026-01-22
2026-01-23 10:41:17 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 50, Tenant anterior: 2
2026-01-23 10:41:17 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 50, Request: /cierres/obligatorio, Empresa ID anterior: 2
2026-01-23 10:41:32 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/en-proceso
2026-01-23 10:41:32 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:41:32 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/en-proceso
2026-01-23 10:41:32 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/en-proceso, M√©todo: GET
2026-01-23 10:41:32 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:41:32 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:41:32 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:41:32 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:41:32 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 41
2026-01-23 10:41:32 [http-nio-8080-exec-1] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:41:32 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:41:32 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:41:32 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:41:32 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:41:32 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:32 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:32 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:32 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:41:32 [http-nio-8080-exec-1] INFO  j.s.s.c.CierreInventarioDiarioControlador - üîç GET /cierres/en-proceso - Viendo cierre en proceso
2026-01-23 10:41:32 [http-nio-8080-exec-1] DEBUG j.s.s.s.CierreInventarioDiarioService - Buscando cierre en proceso para empresa ID: 2
2026-01-23 10:41:32 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.estado=? 
        and e1_0.id=?
2026-01-23 10:41:32 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [EN_PROCESO]
2026-01-23 10:41:32 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:32 [http-nio-8080-exec-1] DEBUG j.s.s.s.CierreInventarioDiarioService - No hay cierre en proceso para empresa ID: 2
2026-01-23 10:41:32 [http-nio-8080-exec-1] WARN  j.s.s.c.CierreInventarioDiarioControlador - ‚ö†Ô∏è No hay cierre en proceso. Redirigiendo a lista de cierres
2026-01-23 10:41:32 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 41, Tenant anterior: 2
2026-01-23 10:41:32 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 41, Request: /cierres/en-proceso, Empresa ID anterior: 2
2026-01-23 10:41:32 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres
2026-01-23 10:41:32 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:41:32 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres
2026-01-23 10:41:32 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres, M√©todo: GET
2026-01-23 10:41:32 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:41:32 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:41:32 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:41:32 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:41:32 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 42
2026-01-23 10:41:32 [http-nio-8080-exec-2] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:41:32 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:41:32 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:41:32 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:41:32 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:41:32 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:32 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:32 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:32 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:41:32 [http-nio-8080-exec-2] INFO  j.s.s.c.CierreInventarioDiarioControlador - üìã GET /cierres - Listando cierres diarios
2026-01-23 10:41:32 [http-nio-8080-exec-2] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo todos los cierres para empresa ID: 2
2026-01-23 10:41:32 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:41:32 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:32 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:32 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:32 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-23 10:41:32 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-23 10:41:32 [http-nio-8080-exec-2] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 2 cierres para empresa ID: 2
2026-01-23 10:41:32 [http-nio-8080-exec-2] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Encontrados 2 cierres
2026-01-23 10:41:32 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 42, Tenant anterior: 2
2026-01-23 10:41:32 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 42, Request: /cierres, Empresa ID anterior: 2
2026-01-23 10:41:32 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-23 10:41:32 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:41:32 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-23 10:41:32 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-23 10:41:32 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:41:32 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:41:32 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:41:32 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:41:32 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 43
2026-01-23 10:41:32 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:41:32 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:41:32 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:41:32 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:41:32 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:41:32 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:32 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:32 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:32 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:41:32 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 2
2026-01-23 10:41:32 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:41:32 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:41:32 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:41:32 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:41:32 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:41:32 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:41:32 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:41:32 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:41:32 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:41:32 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:41:32 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: false (Empresa ID: 2)
2026-01-23 10:41:32 [http-nio-8080-exec-3] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-22 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-23 10:41:32 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 43, Tenant anterior: 2
2026-01-23 10:41:32 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /favicon.ico, Empresa ID anterior: 2
2026-01-23 10:41:32 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-22
2026-01-23 10:41:32 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:41:32 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/obligatorio?fecha=2026-01-22
2026-01-23 10:41:32 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/obligatorio, M√©todo: GET
2026-01-23 10:41:32 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:41:32 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:41:32 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:41:32 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:41:32 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 44
2026-01-23 10:41:32 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:41:32 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:41:32 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:41:32 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:41:32 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:41:32 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:32 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:32 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:32 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:41:32 [http-nio-8080-exec-4] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚è∞ GET /cierres/obligatorio - Verificando cierre obligatorio
2026-01-23 10:41:32 [http-nio-8080-exec-4] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Hora actual: 10:00, Fecha: 2026-01-23
2026-01-23 10:41:32 [http-nio-8080-exec-4] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Fecha proporcionada: 2026-01-22
2026-01-23 10:41:32 [http-nio-8080-exec-4] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚ö†Ô∏è Cierre obligatorio requerido para fecha: 2026-01-22
2026-01-23 10:41:32 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 44, Tenant anterior: 2
2026-01-23 10:41:32 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 44, Request: /cierres/obligatorio, Empresa ID anterior: 2
2026-01-23 10:41:33 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/detalle/2
2026-01-23 10:41:33 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:41:33 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/detalle/2
2026-01-23 10:41:33 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/detalle/2, M√©todo: GET
2026-01-23 10:41:33 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:41:33 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:41:33 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:41:33 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:41:33 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 45
2026-01-23 10:41:33 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:41:33 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:41:33 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:41:33 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:41:33 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:41:33 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:33 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:33 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:33 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:41:33 [http-nio-8080-exec-5] INFO  j.s.s.c.CierreInventarioDiarioControlador - üëÅÔ∏è GET /cierres/detalle/2 - Viendo detalles de cierre
2026-01-23 10:41:33 [http-nio-8080-exec-5] DEBUG j.s.s.s.CierreInventarioDiarioService - Buscando cierre ID: 2 para empresa ID: 2
2026-01-23 10:41:33 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.id=? 
        and e1_0.id=?
2026-01-23 10:41:33 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:33 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:33 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:33 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:33 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-23 10:41:33 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-23 10:41:33 [http-nio-8080-exec-5] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo detalles para cierre ID: 2
2026-01-23 10:41:33 [http-nio-8080-exec-5] DEBUG j.s.s.s.CierreInventarioDiarioService - Buscando cierre ID: 2 para empresa ID: 2
2026-01-23 10:41:33 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.id=? 
        and e1_0.id=?
2026-01-23 10:41:33 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:33 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:33 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:33 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:33 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-23 10:41:33 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-23 10:41:33 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        dcid1_0.ingrediente_id,
        dcid1_0.producto_id,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    where
        dcid1_0.cierre_id=?
2026-01-23 10:41:33 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:33 [http-nio-8080-exec-5] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 0 detalles para cierre ID: 2
2026-01-23 10:41:33 [http-nio-8080-exec-5] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Cierre ID: 2, Estado: PRE-COMPLETADO, Detalles: 0, Diferencia total: 0.0
2026-01-23 10:41:33 [http-nio-8080-exec-5] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Cierre PRE-COMPLETADO, mostrando vista para editar
2026-01-23 10:41:33 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 45, Tenant anterior: 2
2026-01-23 10:41:33 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 45, Request: /cierres/detalle/2, Empresa ID anterior: 2
2026-01-23 10:41:33 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-23 10:41:33 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:41:33 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-23 10:41:33 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-23 10:41:33 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:41:33 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:41:33 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:41:33 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:41:33 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 46
2026-01-23 10:41:33 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:41:33 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:41:33 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:41:33 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:41:33 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:41:33 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:33 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:33 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:33 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:41:33 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 2
2026-01-23 10:41:33 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:41:33 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:41:33 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:41:33 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:41:33 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:41:33 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:41:33 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:41:33 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:41:33 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:41:33 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:41:33 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: false (Empresa ID: 2)
2026-01-23 10:41:33 [http-nio-8080-exec-6] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-22 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-23 10:41:33 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 46, Tenant anterior: 2
2026-01-23 10:41:33 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 46, Request: /favicon.ico, Empresa ID anterior: 2
2026-01-23 10:41:33 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-22
2026-01-23 10:41:33 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:41:33 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/obligatorio?fecha=2026-01-22
2026-01-23 10:41:33 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/obligatorio, M√©todo: GET
2026-01-23 10:41:33 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:41:33 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:41:33 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:41:33 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:41:33 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 47
2026-01-23 10:41:33 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:41:33 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:41:33 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:41:33 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:41:33 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:41:33 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:33 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:33 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:33 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:41:33 [http-nio-8080-exec-7] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚è∞ GET /cierres/obligatorio - Verificando cierre obligatorio
2026-01-23 10:41:33 [http-nio-8080-exec-7] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Hora actual: 10:00, Fecha: 2026-01-23
2026-01-23 10:41:33 [http-nio-8080-exec-7] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Fecha proporcionada: 2026-01-22
2026-01-23 10:41:33 [http-nio-8080-exec-7] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚ö†Ô∏è Cierre obligatorio requerido para fecha: 2026-01-22
2026-01-23 10:41:33 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 47, Tenant anterior: 2
2026-01-23 10:41:33 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 47, Request: /cierres/obligatorio, Empresa ID anterior: 2
2026-01-23 10:41:36 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing POST /cierres/completar-definitivo/2
2026-01-23 10:41:36 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:41:36 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured POST /cierres/completar-definitivo/2
2026-01-23 10:41:36 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/completar-definitivo/2, M√©todo: POST
2026-01-23 10:41:36 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:41:36 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:41:36 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:41:36 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:41:36 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 48
2026-01-23 10:41:36 [http-nio-8080-exec-8] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:41:36 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:41:36 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:41:36 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:41:36 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:41:36 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:36 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:36 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:36 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:41:36 [http-nio-8080-exec-8] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚úÖ POST /cierres/completar-definitivo/2 - Completando cierre definitivamente
2026-01-23 10:41:36 [http-nio-8080-exec-8] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Actualizando 0 detalles antes de completar
2026-01-23 10:41:36 [http-nio-8080-exec-8] INFO  j.s.s.s.CierreInventarioDiarioService - Completando cierre definitivo ID: 2
2026-01-23 10:41:36 [http-nio-8080-exec-8] DEBUG j.s.s.s.CierreInventarioDiarioService - Buscando cierre ID: 2 para empresa ID: 2
2026-01-23 10:41:36 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.id=? 
        and e1_0.id=?
2026-01-23 10:41:36 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:36 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:36 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:36 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:36 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-23 10:41:36 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-23 10:41:36 [http-nio-8080-exec-8] DEBUG j.s.s.s.CierreInventarioDiarioService - Calculando ventas del d√≠a para cierre ID: 2
2026-01-23 10:41:36 [http-nio-8080-exec-8] DEBUG j.s.s.s.CierreInventarioDiarioService - Calculando ventas del d√≠a 2026-01-22 para empresa ID: 2
2026-01-23 10:41:36 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        f1_0.id,
        f1_0.cliente_id,
        f1_0.empresa_id,
        f1_0.estado,
        f1_0.fecha,
        f1_0.forma_pago,
        f1_0.iva,
        f1_0.numero_factura,
        f1_0.subtotal,
        f1_0.total 
    from
        factura f1_0 
    left join
        empresa e1_0 
            on e1_0.id=f1_0.empresa_id 
    where
        f1_0.fecha=? 
        and f1_0.estado=? 
        and e1_0.id=?
2026-01-23 10:41:36 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:41:36 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [PAGADA]
2026-01-23 10:41:36 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:41:36 [http-nio-8080-exec-8] DEBUG j.s.s.s.CierreInventarioDiarioService - Ventas calculadas: 0 facturas, Total: 0.0 para fecha: 2026-01-22
2026-01-23 10:41:36 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        dcid1_0.ingrediente_id,
        dcid1_0.producto_id,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    where
        dcid1_0.cierre_id=?
2026-01-23 10:41:36 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:36 [http-nio-8080-exec-8] DEBUG j.s.s.s.CierreInventarioDiarioService - Ajustando inventario para 0 detalles
2026-01-23 10:41:36 [http-nio-8080-exec-8] DEBUG j.s.s.s.CierreInventarioDiarioService - Ajustando inventario para 0 detalles
2026-01-23 10:41:36 [http-nio-8080-exec-8] INFO  j.s.s.s.CierreInventarioDiarioService - Inventario ajustado: 0 ingredientes, 0 productos
2026-01-23 10:41:36 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        s1_0.nombre,
        s1_0.telefono,
        d1_0.cierre_id,
        d1_0.id,
        d1_0.costo_unitario,
        d1_0.diferencia,
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida,
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        p1_0.receta_id,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta,
        d1_0.stock_desperdicio,
        d1_0.stock_merma,
        d1_0.stock_real,
        d1_0.stock_teorico,
        d1_0.valor_diferencia 
    from
        cierre_inventario_diario cid1_0 
    join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=cid1_0.usuario_id 
    left join
        empresa e2_0 
            on e2_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        detalle_cierre_inventario_diario d1_0 
            on cid1_0.id=d1_0.cierre_id 
    left join
        ingrediente i1_0 
            on i1_0.id=d1_0.ingrediente_id 
    left join
        producto p1_0 
            on p1_0.id=d1_0.producto_id 
    where
        cid1_0.id=?
2026-01-23 10:41:36 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:36 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    update
        cierre_inventario_diario 
    set
        cantidad_facturas=?,
        empresa_id=?,
        estado=?,
        fecha=?,
        observaciones=?,
        total_ventas=?,
        usuario_id=? 
    where
        id=?
2026-01-23 10:41:36 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:INTEGER) <- [0]
2026-01-23 10:41:36 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:36 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [COMPLETADO]
2026-01-23 10:41:36 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DATE) <- [2026-01-22]
2026-01-23 10:41:36 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [Cierre para fecha espec√≠fica 2026-01-22]
2026-01-23 10:41:36 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DOUBLE) <- [0.0]
2026-01-23 10:41:36 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:BIGINT) <- [5]
2026-01-23 10:41:36 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:BIGINT) <- [2]
2026-01-23 10:41:36 [http-nio-8080-exec-8] INFO  j.s.s.s.CierreInventarioDiarioService - Cierre completado definitivamente ID: 2 para empresa ID: 2. Total ventas: 0.0, Cantidad facturas: 0
2026-01-23 10:41:36 [http-nio-8080-exec-8] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚úÖ Cierre completado definitivamente ID: 2
2026-01-23 10:41:36 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 48, Tenant anterior: 2
2026-01-23 10:41:36 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 48, Request: /cierres/completar-definitivo/2, Empresa ID anterior: 2
2026-01-23 10:41:36 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres
2026-01-23 10:41:36 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:41:36 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres
2026-01-23 10:41:36 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres, M√©todo: GET
2026-01-23 10:41:36 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:41:36 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:41:36 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:41:36 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:41:36 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 49
2026-01-23 10:41:36 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:41:36 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:41:36 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:41:36 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:41:36 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:41:36 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:36 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:36 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:36 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:41:36 [http-nio-8080-exec-9] INFO  j.s.s.c.CierreInventarioDiarioControlador - üìã GET /cierres - Listando cierres diarios
2026-01-23 10:41:36 [http-nio-8080-exec-9] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo todos los cierres para empresa ID: 2
2026-01-23 10:41:36 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:41:36 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:36 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:36 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:36 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-23 10:41:36 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-23 10:41:36 [http-nio-8080-exec-9] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 2 cierres para empresa ID: 2
2026-01-23 10:41:36 [http-nio-8080-exec-9] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Encontrados 2 cierres
2026-01-23 10:41:36 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 49, Tenant anterior: 2
2026-01-23 10:41:36 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 49, Request: /cierres, Empresa ID anterior: 2
2026-01-23 10:41:36 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-23 10:41:36 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:41:36 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-23 10:41:36 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-23 10:41:36 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:41:36 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:41:36 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:41:36 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:41:36 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 50
2026-01-23 10:41:36 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:41:36 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:41:36 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:41:36 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:41:36 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:41:36 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:36 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:36 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:36 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:41:36 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 2
2026-01-23 10:41:36 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:41:36 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:41:36 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:41:36 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:41:36 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:41:36 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:41:36 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:41:36 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:41:36 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:41:36 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:41:36 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:41:36 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:41:36 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 50, Tenant anterior: 2
2026-01-23 10:41:36 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 50, Request: /favicon.ico, Empresa ID anterior: 2
2026-01-23 10:41:36 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /error
2026-01-23 10:41:36 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /error
2026-01-23 10:41:36 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:41:43 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-23 10:41:43 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:41:43 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-23 10:41:43 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-23 10:41:43 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:41:43 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:41:43 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:41:43 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:41:43 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 41
2026-01-23 10:41:43 [http-nio-8080-exec-1] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:41:43 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:41:43 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:41:43 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:41:43 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:41:43 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:43 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:43 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:43 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:41:43 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-23 10:41:43 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:41:43 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:41:43 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:41:43 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:41:43 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:41:43 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:41:43 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:41:43 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:41:43 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:41:43 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:41:43 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:41:43 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:41:43 [http-nio-8080-exec-1] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-23
2026-01-23 10:41:43 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-23 10:41:43 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:41:43 [http-nio-8080-exec-1] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-23
2026-01-23 10:41:43 [http-nio-8080-exec-1] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-23 10:41:43 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 41, Tenant anterior: 2
2026-01-23 10:41:43 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 41, Request: /principal, Empresa ID anterior: 2
2026-01-23 10:41:49 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres
2026-01-23 10:41:49 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:41:49 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres
2026-01-23 10:41:49 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres, M√©todo: GET
2026-01-23 10:41:49 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:41:49 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:41:49 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:41:49 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:41:49 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 43
2026-01-23 10:41:49 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:41:49 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:41:49 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:41:49 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:41:49 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:41:49 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:49 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:49 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:49 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:41:49 [http-nio-8080-exec-3] INFO  j.s.s.c.CierreInventarioDiarioControlador - üìã GET /cierres - Listando cierres diarios
2026-01-23 10:41:49 [http-nio-8080-exec-3] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo todos los cierres para empresa ID: 2
2026-01-23 10:41:49 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:41:49 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:49 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:49 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:49 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-23 10:41:49 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-23 10:41:49 [http-nio-8080-exec-3] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 2 cierres para empresa ID: 2
2026-01-23 10:41:49 [http-nio-8080-exec-3] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Encontrados 2 cierres
2026-01-23 10:41:49 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 43, Tenant anterior: 2
2026-01-23 10:41:49 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /cierres, Empresa ID anterior: 2
2026-01-23 10:41:50 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-23 10:41:50 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:41:50 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-23 10:41:50 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-23 10:41:50 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:41:50 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:41:50 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:41:50 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:41:50 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 44
2026-01-23 10:41:50 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:41:50 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:41:50 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:41:50 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:41:50 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:41:50 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:50 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:50 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:50 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:41:50 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-23 10:41:50 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:41:50 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:41:50 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:41:50 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:41:50 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:41:50 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:41:50 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:41:50 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:41:50 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:41:50 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:41:50 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:41:50 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:41:50 [http-nio-8080-exec-4] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-23
2026-01-23 10:41:50 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-23 10:41:50 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:41:50 [http-nio-8080-exec-4] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-23
2026-01-23 10:41:50 [http-nio-8080-exec-4] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-23 10:41:50 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 44, Tenant anterior: 2
2026-01-23 10:41:50 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 44, Request: /principal, Empresa ID anterior: 2
2026-01-23 10:41:52 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios
2026-01-23 10:41:52 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:41:52 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios
2026-01-23 10:41:52 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios, M√©todo: GET
2026-01-23 10:41:52 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:41:52 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:41:52 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:41:52 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:41:52 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 45
2026-01-23 10:41:52 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:41:52 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:41:52 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:41:52 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:41:52 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:41:52 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:52 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:52 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:52 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:41:52 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios, Empresa ID: 2
2026-01-23 10:41:52 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:41:52 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:41:52 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:41:52 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:41:52 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:41:52 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:41:52 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:41:52 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:41:52 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:41:52 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:41:52 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:41:52 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:41:52 [http-nio-8080-exec-5] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-23 10:41:52 [http-nio-8080-exec-5] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-23 10:41:52 [http-nio-8080-exec-5] INFO  j.s.s.c.UsuarioControlador - üìã GET /admin/usuarios - Listando usuarios
2026-01-23 10:41:52 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Listando usuarios para empresa ID: 2
2026-01-23 10:41:52 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:41:52 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:52 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:52 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:52 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 45, Tenant anterior: 2
2026-01-23 10:41:52 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 45, Request: /admin/usuarios, Empresa ID anterior: 2
2026-01-23 10:41:58 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios/nuevo
2026-01-23 10:41:58 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:41:58 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios/nuevo
2026-01-23 10:41:58 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios/nuevo, M√©todo: GET
2026-01-23 10:41:58 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:41:58 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:41:58 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:41:58 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:41:58 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 46
2026-01-23 10:41:58 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:41:58 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:41:58 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:41:58 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:41:58 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:41:58 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:41:58 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:41:58 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:41:58 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:41:58 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios/nuevo, Empresa ID: 2
2026-01-23 10:41:58 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:41:58 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:41:58 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:41:58 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:41:58 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:41:58 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:41:58 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:41:58 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:41:58 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:41:58 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:41:58 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:41:58 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:41:58 [http-nio-8080-exec-6] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.mostrarFormularioCrear(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-23 10:41:58 [http-nio-8080-exec-6] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.mostrarFormularioCrear(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-23 10:41:58 [http-nio-8080-exec-6] INFO  j.s.s.c.UsuarioControlador - üìù GET /admin/usuarios/nuevo - Mostrando formulario crear usuario
2026-01-23 10:41:58 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 46, Tenant anterior: 2
2026-01-23 10:41:58 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 46, Request: /admin/usuarios/nuevo, Empresa ID anterior: 2
2026-01-23 10:42:09 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing POST /admin/usuarios/guardar
2026-01-23 10:42:09 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:42:09 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured POST /admin/usuarios/guardar
2026-01-23 10:42:09 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios/guardar, M√©todo: POST
2026-01-23 10:42:09 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:42:09 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:42:09 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:42:09 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:42:09 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 47
2026-01-23 10:42:09 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:42:09 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:42:09 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:42:09 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:42:09 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:42:09 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:42:09 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:42:09 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:42:09 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:42:09 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios/guardar, Empresa ID: 2
2026-01-23 10:42:09 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:42:09 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:42:09 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:42:09 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:42:09 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:42:09 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:42:09 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:42:09 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:42:09 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:42:09 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:42:09 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:42:09 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:42:09 [http-nio-8080-exec-7] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.guardarUsuario(jpd.sistemafacinv.sistemadefacturacioneinventario.modelos.Usuario,java.lang.String,org.springframework.web.servlet.mvc.support.RedirectAttributes); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-23 10:42:09 [http-nio-8080-exec-7] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.guardarUsuario(jpd.sistemafacinv.sistemadefacturacioneinventario.modelos.Usuario,java.lang.String,org.springframework.web.servlet.mvc.support.RedirectAttributes); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-23 10:42:09 [http-nio-8080-exec-7] INFO  j.s.s.c.UsuarioControlador - üíæ POST /admin/usuarios/guardar - Creando usuario: jose
2026-01-23 10:42:09 [http-nio-8080-exec-7] DEBUG j.s.s.c.UsuarioControlador - Datos usuario - Rol: CAJERO, Activo: true
2026-01-23 10:42:09 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Creando usuario: jose para empresa ID: 2
2026-01-23 10:42:09 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        u1_0.nombre_usuario=? 
        and e1_0.id=? 
    limit
        ?
2026-01-23 10:42:09 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:42:09 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:42:09 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:INTEGER) <- [1]
2026-01-23 10:42:09 [http-nio-8080-exec-7] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@560826032 wrapping com.mysql.cj.jdbc.ConnectionImpl@7d5d9375] read-only
2026-01-23 10:42:09 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:42:09 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:42:09 [http-nio-8080-exec-7] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@560826032 wrapping com.mysql.cj.jdbc.ConnectionImpl@7d5d9375]
2026-01-23 10:42:09 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        usuario
        (activo, contrasenna, empresa_id, nombre_usuario, rol, sucursal_id) 
    values
        (?, ?, ?, ?, ?, ?)
2026-01-23 10:42:09 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-23 10:42:09 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [$2a$10$J/Nxrc3I8OUnZsp8dL7OdeKPpoWj.gy9rpPU.W3IE0RO68JKTqHha]
2026-01-23 10:42:09 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:42:09 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [jose]
2026-01-23 10:42:09 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [CAJERO]
2026-01-23 10:42:09 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:BIGINT) <- [null]
2026-01-23 10:42:09 [http-nio-8080-exec-7] INFO  j.s.s.servicios.UsuarioServicio - Usuario creado exitosamente: jose con ID: 7
2026-01-23 10:42:09 [http-nio-8080-exec-7] INFO  j.s.s.c.UsuarioControlador - ‚úÖ Usuario creado exitosamente: jose (ID: 7)
2026-01-23 10:42:09 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 47, Tenant anterior: 2
2026-01-23 10:42:09 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 47, Request: /admin/usuarios/guardar, Empresa ID anterior: 2
2026-01-23 10:42:09 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios
2026-01-23 10:42:09 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:42:09 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios
2026-01-23 10:42:09 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios, M√©todo: GET
2026-01-23 10:42:09 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:42:09 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:42:09 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:42:09 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:42:09 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 48
2026-01-23 10:42:09 [http-nio-8080-exec-8] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:42:09 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:42:09 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:42:09 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:42:09 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:42:09 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:42:09 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:42:09 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:42:09 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:42:09 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios, Empresa ID: 2
2026-01-23 10:42:09 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:42:09 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:42:09 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:42:09 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:42:09 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:42:09 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:42:09 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:42:09 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:42:09 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:42:09 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:42:09 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:42:09 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:42:09 [http-nio-8080-exec-8] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-23 10:42:09 [http-nio-8080-exec-8] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-23 10:42:09 [http-nio-8080-exec-8] INFO  j.s.s.c.UsuarioControlador - üìã GET /admin/usuarios - Listando usuarios
2026-01-23 10:42:09 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Listando usuarios para empresa ID: 2
2026-01-23 10:42:09 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:42:09 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:42:09 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:42:09 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:42:09 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 48, Tenant anterior: 2
2026-01-23 10:42:09 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 48, Request: /admin/usuarios, Empresa ID anterior: 2
2026-01-23 10:42:14 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-23 10:42:14 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:42:14 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-23 10:42:14 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-23 10:42:14 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:42:14 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:42:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:42:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:42:14 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 49
2026-01-23 10:42:14 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:42:14 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:42:14 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:42:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:42:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:42:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:42:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:42:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:42:14 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:42:14 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-23 10:42:14 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:42:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:42:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:42:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:42:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:42:14 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:42:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:42:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:42:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:42:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:42:14 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:42:14 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:42:14 [http-nio-8080-exec-9] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-23
2026-01-23 10:42:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-23 10:42:14 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:42:14 [http-nio-8080-exec-9] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-23
2026-01-23 10:42:14 [http-nio-8080-exec-9] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-23 10:42:14 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 49, Tenant anterior: 2
2026-01-23 10:42:14 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 49, Request: /principal, Empresa ID anterior: 2
2026-01-23 10:42:15 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing POST /logout
2026-01-23 10:42:15 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:42:15 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.logout.LogoutFilter - Logging out [UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B04EBE3DA9229FD10093C50E877629BB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:42:15 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.l.SecurityContextLogoutHandler - Invalidated session CDEB3C4DF2E9E26BD82206FC5838B8C1
2026-01-23 10:42:15 [http-nio-8080-exec-10] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /login?logout
2026-01-23 10:42:15 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login?logout
2026-01-23 10:42:15 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login?logout
2026-01-23 10:42:15 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-23 10:42:15 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:42:15 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:42:15 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:42:15 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:42:15 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 41
2026-01-23 10:42:15 [http-nio-8080-exec-1] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:42:15 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-23 10:42:15 [http-nio-8080-exec-1] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-23 10:42:15 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 41, Tenant anterior: 2
2026-01-23 10:42:15 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 41, Request: /login, Empresa ID anterior: 2
2026-01-23 10:42:18 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-23 10:42:18 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: jose para la empresa ID: null
2026-01-23 10:42:18 [http-nio-8080-exec-2] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: jose | Subdominio: jose
2026-01-23 10:42:18 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:42:18 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:42:18 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: jose | Subdominio: jose | Empresa ID: 2 | Empresa Nombre: Empresa JOse
2026-01-23 10:42:18 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:42:18 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:42:18 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:42:18 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:42:18 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:42:18 [http-nio-8080-exec-2] INFO  j.s.s.servicios.UsuarioServicio - üîê Encontrado usuario: jose
2026-01-23 10:42:18 [http-nio-8080-exec-2] INFO  j.s.s.servicios.UsuarioServicio - üîê Rol: CAJERO
2026-01-23 10:42:18 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - üîê Activo: true
2026-01-23 10:42:18 [http-nio-8080-exec-2] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Authenticated user
2026-01-23 10:42:18 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.s.ChangeSessionIdAuthenticationStrategy - Changed session id from 2613EABEE02FDC6A7B294641AF52581B
2026-01-23 10:42:18 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.CsrfAuthenticationStrategy - Replaced CSRF Token
2026-01-23 10:42:18 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Stored SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=jose, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=2613EABEE02FDC6A7B294641AF52581B], Granted Authorities=[ROLE_CAJERO]]] to HttpSession [org.apache.catalina.session.StandardSessionFacade@6dd1e5eb]
2026-01-23 10:42:18 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.UsernamePasswordAuthenticationFilter - Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=jose, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=2613EABEE02FDC6A7B294641AF52581B], Granted Authorities=[ROLE_CAJERO]]
2026-01-23 10:42:18 [http-nio-8080-exec-2] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /principal
2026-01-23 10:42:18 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-23 10:42:18 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=jose, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=2613EABEE02FDC6A7B294641AF52581B], Granted Authorities=[ROLE_CAJERO]]]
2026-01-23 10:42:18 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-23 10:42:18 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-23 10:42:18 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:42:18 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:42:18 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:42:18 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:42:18 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 43
2026-01-23 10:42:18 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:42:18 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: jose
2026-01-23 10:42:18 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: jose en empresa ID: 2
2026-01-23 10:42:18 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:42:18 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:42:18 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:42:18 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:42:18 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:42:18 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario jose validado para empresa 2
2026-01-23 10:42:18 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-23 10:42:18 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:42:18 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:42:18 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:42:18 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:42:18 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:42:18 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:42:18 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:42:18 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:42:18 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:42:18 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:42:18 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:42:18 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:42:18 [http-nio-8080-exec-3] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-23
2026-01-23 10:42:18 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-23 10:42:18 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:42:18 [http-nio-8080-exec-3] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-23
2026-01-23 10:42:18 [http-nio-8080-exec-3] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-23 10:42:18 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 43, Tenant anterior: 2
2026-01-23 10:42:18 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /principal, Empresa ID anterior: 2
2026-01-23 10:42:23 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing POST /logout
2026-01-23 10:42:23 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=jose, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=2613EABEE02FDC6A7B294641AF52581B], Granted Authorities=[ROLE_CAJERO]]]
2026-01-23 10:42:23 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.logout.LogoutFilter - Logging out [UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=jose, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=2613EABEE02FDC6A7B294641AF52581B], Granted Authorities=[ROLE_CAJERO]]]
2026-01-23 10:42:23 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.l.SecurityContextLogoutHandler - Invalidated session F85604A3919C3A98B31B620D34EE6C22
2026-01-23 10:42:23 [http-nio-8080-exec-4] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /login?logout
2026-01-23 10:42:23 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login?logout
2026-01-23 10:42:23 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login?logout
2026-01-23 10:42:23 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-23 10:42:23 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:42:23 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:42:23 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:42:23 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:42:23 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 45
2026-01-23 10:42:23 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:42:23 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-23 10:42:23 [http-nio-8080-exec-5] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-23 10:42:23 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 45, Tenant anterior: 2
2026-01-23 10:42:23 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 45, Request: /login, Empresa ID anterior: 2
2026-01-23 10:42:27 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-23 10:42:27 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: admin para la empresa ID: null
2026-01-23 10:42:27 [http-nio-8080-exec-6] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: jose
2026-01-23 10:42:27 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:42:27 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:42:27 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: jose | Empresa ID: 2 | Empresa Nombre: Empresa JOse
2026-01-23 10:42:27 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:42:27 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:42:27 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:42:27 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:42:27 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:42:27 [http-nio-8080-exec-6] INFO  j.s.s.servicios.UsuarioServicio - üîê Encontrado usuario: admin
2026-01-23 10:42:27 [http-nio-8080-exec-6] INFO  j.s.s.servicios.UsuarioServicio - üîê Rol: ADMIN
2026-01-23 10:42:27 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - üîê Activo: true
2026-01-23 10:42:27 [http-nio-8080-exec-6] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Authenticated user
2026-01-23 10:42:27 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.s.ChangeSessionIdAuthenticationStrategy - Changed session id from 73A310DBB3F1927D851EF7F9E9271F8E
2026-01-23 10:42:27 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.CsrfAuthenticationStrategy - Replaced CSRF Token
2026-01-23 10:42:27 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Stored SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=73A310DBB3F1927D851EF7F9E9271F8E], Granted Authorities=[ROLE_ADMIN]]] to HttpSession [org.apache.catalina.session.StandardSessionFacade@5f766af6]
2026-01-23 10:42:27 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.UsernamePasswordAuthenticationFilter - Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=73A310DBB3F1927D851EF7F9E9271F8E], Granted Authorities=[ROLE_ADMIN]]
2026-01-23 10:42:27 [http-nio-8080-exec-6] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /principal
2026-01-23 10:42:27 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-23 10:42:27 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=73A310DBB3F1927D851EF7F9E9271F8E], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:42:27 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-23 10:42:27 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-23 10:42:27 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:42:27 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:42:27 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:42:27 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:42:27 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 47
2026-01-23 10:42:27 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:42:27 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:42:27 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:42:27 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:42:27 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:42:27 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:42:27 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:42:27 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:42:27 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:42:27 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-23 10:42:27 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:42:27 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:42:27 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:42:27 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:42:27 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:42:27 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:42:27 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:42:27 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:42:27 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:42:27 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:42:27 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:42:27 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:42:27 [http-nio-8080-exec-7] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-23
2026-01-23 10:42:27 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-23 10:42:27 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:42:27 [http-nio-8080-exec-7] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-23
2026-01-23 10:42:27 [http-nio-8080-exec-7] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-23 10:42:27 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 47, Tenant anterior: 2
2026-01-23 10:42:27 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 47, Request: /principal, Empresa ID anterior: 2
2026-01-23 10:42:29 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios
2026-01-23 10:42:29 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=73A310DBB3F1927D851EF7F9E9271F8E], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:42:29 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios
2026-01-23 10:42:29 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios, M√©todo: GET
2026-01-23 10:42:29 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:42:29 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:42:29 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:42:29 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:42:29 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 48
2026-01-23 10:42:29 [http-nio-8080-exec-8] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:42:29 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:42:29 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:42:29 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:42:29 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:42:29 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:42:29 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:42:29 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:42:29 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:42:29 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios, Empresa ID: 2
2026-01-23 10:42:29 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:42:29 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:42:29 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:42:29 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:42:29 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:42:29 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:42:29 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:42:29 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:42:29 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:42:29 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:42:29 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:42:29 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:42:29 [http-nio-8080-exec-8] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-23 10:42:29 [http-nio-8080-exec-8] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-23 10:42:29 [http-nio-8080-exec-8] INFO  j.s.s.c.UsuarioControlador - üìã GET /admin/usuarios - Listando usuarios
2026-01-23 10:42:29 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Listando usuarios para empresa ID: 2
2026-01-23 10:42:29 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:42:29 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:42:29 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:42:29 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:42:29 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 48, Tenant anterior: 2
2026-01-23 10:42:29 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 48, Request: /admin/usuarios, Empresa ID anterior: 2
2026-01-23 10:42:30 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios/editar/7
2026-01-23 10:42:30 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=73A310DBB3F1927D851EF7F9E9271F8E], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:42:30 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios/editar/7
2026-01-23 10:42:30 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios/editar/7, M√©todo: GET
2026-01-23 10:42:30 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:42:30 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:42:30 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:42:30 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:42:30 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 49
2026-01-23 10:42:30 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:42:30 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:42:30 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:42:30 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:42:30 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:42:30 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:42:30 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:42:30 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:42:30 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:42:30 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios/editar/7, Empresa ID: 2
2026-01-23 10:42:30 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:42:30 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:42:30 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:42:30 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:42:30 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:42:30 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:42:30 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:42:30 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:42:30 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:42:30 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:42:30 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:42:30 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:42:30 [http-nio-8080-exec-9] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.mostrarFormularioEditar(java.lang.Long,org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-23 10:42:30 [http-nio-8080-exec-9] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.mostrarFormularioEditar(java.lang.Long,org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-23 10:42:30 [http-nio-8080-exec-9] INFO  j.s.s.c.UsuarioControlador - ‚úèÔ∏è GET /admin/usuarios/editar/7 - Editando usuario
2026-01-23 10:42:30 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Obteniendo usuario ID: 7 para empresa ID: 2
2026-01-23 10:42:30 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        u1_0.id=? 
        and e1_0.id=?
2026-01-23 10:42:30 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [7]
2026-01-23 10:42:30 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:42:30 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:42:30 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:42:30 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 49, Tenant anterior: 2
2026-01-23 10:42:30 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 49, Request: /admin/usuarios/editar/7, Empresa ID anterior: 2
2026-01-23 10:42:36 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing POST /admin/usuarios/actualizar/7
2026-01-23 10:42:36 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=73A310DBB3F1927D851EF7F9E9271F8E], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:42:36 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured POST /admin/usuarios/actualizar/7
2026-01-23 10:42:36 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios/actualizar/7, M√©todo: POST
2026-01-23 10:42:36 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:42:36 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:42:36 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:42:36 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:42:36 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 50
2026-01-23 10:42:36 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:42:36 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:42:36 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:42:36 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:42:36 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:42:36 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:42:36 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:42:36 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:42:36 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:42:36 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios/actualizar/7, Empresa ID: 2
2026-01-23 10:42:36 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:42:36 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:42:36 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:42:36 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:42:36 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:42:36 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:42:36 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:42:36 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:42:36 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:42:36 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:42:36 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:42:36 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:42:36 [http-nio-8080-exec-10] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.actualizarUsuario(java.lang.Long,jpd.sistemafacinv.sistemadefacturacioneinventario.modelos.Usuario,java.lang.String,java.lang.String,org.springframework.web.servlet.mvc.support.RedirectAttributes); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-23 10:42:36 [http-nio-8080-exec-10] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.actualizarUsuario(java.lang.Long,jpd.sistemafacinv.sistemadefacturacioneinventario.modelos.Usuario,java.lang.String,java.lang.String,org.springframework.web.servlet.mvc.support.RedirectAttributes); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-23 10:42:36 [http-nio-8080-exec-10] INFO  j.s.s.c.UsuarioControlador - üîÑ POST /admin/usuarios/actualizar/7 - Actualizando usuario
2026-01-23 10:42:36 [http-nio-8080-exec-10] DEBUG j.s.s.c.UsuarioControlador - Usuario autenticado: admin, Roles: [ROLE_ADMIN]
2026-01-23 10:42:36 [http-nio-8080-exec-10] DEBUG j.s.s.c.UsuarioControlador - Contrase√±a no cambiada para usuario ID: 7
2026-01-23 10:42:36 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Obteniendo usuario ID: 7 para empresa ID: 2
2026-01-23 10:42:36 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        u1_0.id=? 
        and e1_0.id=?
2026-01-23 10:42:36 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [7]
2026-01-23 10:42:36 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:42:36 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:42:36 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:42:36 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Actualizando usuario ID: 7 en empresa ID: 2
2026-01-23 10:42:36 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        u1_0.id=? 
        and e1_0.id=?
2026-01-23 10:42:36 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [7]
2026-01-23 10:42:36 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:42:36 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:42:36 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:42:36 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-23 10:42:36 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [7]
2026-01-23 10:42:36 [http-nio-8080-exec-10] INFO  j.s.s.servicios.UsuarioServicio - Usuario actualizado exitosamente: jose (ID: 7)
2026-01-23 10:42:36 [http-nio-8080-exec-10] INFO  j.s.s.c.UsuarioControlador - ‚úÖ Usuario actualizado exitosamente ID: 7 - Nuevo rol: CAJERO
2026-01-23 10:42:36 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 50, Tenant anterior: 2
2026-01-23 10:42:36 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 50, Request: /admin/usuarios/actualizar/7, Empresa ID anterior: 2
2026-01-23 10:42:36 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios
2026-01-23 10:42:36 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=73A310DBB3F1927D851EF7F9E9271F8E], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:42:36 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios
2026-01-23 10:42:36 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios, M√©todo: GET
2026-01-23 10:42:36 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:42:36 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:42:36 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:42:36 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:42:36 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 41
2026-01-23 10:42:36 [http-nio-8080-exec-1] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:42:36 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:42:36 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:42:36 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:42:36 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:42:36 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:42:36 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:42:36 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:42:36 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:42:36 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios, Empresa ID: 2
2026-01-23 10:42:36 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:42:36 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:42:36 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:42:36 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:42:36 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:42:36 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:42:36 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:42:36 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:42:36 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:42:36 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:42:36 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:42:36 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:42:36 [http-nio-8080-exec-1] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-23 10:42:36 [http-nio-8080-exec-1] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-23 10:42:36 [http-nio-8080-exec-1] INFO  j.s.s.c.UsuarioControlador - üìã GET /admin/usuarios - Listando usuarios
2026-01-23 10:42:36 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Listando usuarios para empresa ID: 2
2026-01-23 10:42:36 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:42:36 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:42:36 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:42:36 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:42:36 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 41, Tenant anterior: 2
2026-01-23 10:42:36 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 41, Request: /admin/usuarios, Empresa ID anterior: 2
2026-01-23 10:42:41 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-23 10:42:41 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=73A310DBB3F1927D851EF7F9E9271F8E], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:42:41 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-23 10:42:41 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-23 10:42:41 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:42:41 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:42:41 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:42:41 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:42:41 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 42
2026-01-23 10:42:41 [http-nio-8080-exec-2] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:42:41 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:42:41 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:42:41 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:42:41 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:42:41 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:42:41 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:42:41 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:42:41 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:42:41 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-23 10:42:41 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:42:41 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:42:41 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:42:41 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:42:41 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:42:41 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:42:41 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:42:41 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:42:41 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:42:41 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:42:41 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:42:41 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:42:41 [http-nio-8080-exec-2] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-23
2026-01-23 10:42:41 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-23 10:42:41 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:42:41 [http-nio-8080-exec-2] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-23
2026-01-23 10:42:41 [http-nio-8080-exec-2] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-23 10:42:41 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 42, Tenant anterior: 2
2026-01-23 10:42:41 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 42, Request: /principal, Empresa ID anterior: 2
2026-01-23 10:42:42 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing POST /logout
2026-01-23 10:42:42 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=73A310DBB3F1927D851EF7F9E9271F8E], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:42:42 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.logout.LogoutFilter - Logging out [UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=73A310DBB3F1927D851EF7F9E9271F8E], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:42:42 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.l.SecurityContextLogoutHandler - Invalidated session 4E22A09D3B6488BB66298E38B6DDB5BE
2026-01-23 10:42:42 [http-nio-8080-exec-3] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /login?logout
2026-01-23 10:42:42 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login?logout
2026-01-23 10:42:42 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login?logout
2026-01-23 10:42:42 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-23 10:42:42 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:42:42 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:42:42 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:42:42 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:42:42 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 44
2026-01-23 10:42:42 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:42:42 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-23 10:42:42 [http-nio-8080-exec-4] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-23 10:42:42 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 44, Tenant anterior: 2
2026-01-23 10:42:42 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 44, Request: /login, Empresa ID anterior: 2
2026-01-23 10:42:46 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-23 10:42:46 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: jose para la empresa ID: null
2026-01-23 10:42:46 [http-nio-8080-exec-5] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: jose | Subdominio: jose
2026-01-23 10:42:46 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:42:46 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:42:46 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: jose | Subdominio: jose | Empresa ID: 2 | Empresa Nombre: Empresa JOse
2026-01-23 10:42:46 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:42:46 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:42:46 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:42:46 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:42:46 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:42:46 [http-nio-8080-exec-5] INFO  j.s.s.servicios.UsuarioServicio - üîê Encontrado usuario: jose
2026-01-23 10:42:46 [http-nio-8080-exec-5] INFO  j.s.s.servicios.UsuarioServicio - üîê Rol: CAJERO
2026-01-23 10:42:46 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - üîê Activo: true
2026-01-23 10:42:46 [http-nio-8080-exec-5] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Failed to authenticate since password does not match stored value
2026-01-23 10:42:46 [http-nio-8080-exec-5] DEBUG o.s.s.authentication.ProviderManager - Authentication failed with provider DaoAuthenticationProvider since Bad credentials
2026-01-23 10:42:46 [http-nio-8080-exec-5] DEBUG o.s.s.authentication.ProviderManager - Denying authentication since all attempted providers failed
2026-01-23 10:42:46 [http-nio-8080-exec-5] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /login?error
2026-01-23 10:42:46 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login?error
2026-01-23 10:42:46 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login?error
2026-01-23 10:42:46 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-23 10:42:46 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:42:46 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:42:46 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:42:46 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:42:46 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 46
2026-01-23 10:42:46 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:42:46 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-23 10:42:46 [http-nio-8080-exec-6] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-23 10:42:46 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 46, Tenant anterior: 2
2026-01-23 10:42:46 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 46, Request: /login, Empresa ID anterior: 2
2026-01-23 10:45:02 [File Watcher] INFO  o.s.b.d.a.LocalDevToolsAutoConfiguration$RestartingClassPathChangeChangedEventListener - Restarting due to 1 class path change (0 additions, 0 deletions, 1 modification)
2026-01-23 10:45:02 [Thread-5] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2026-01-23 10:45:02 [tomcat-shutdown] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2026-01-23 10:45:02 [Thread-5] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2026-01-23 10:45:02 [Thread-5] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2026-01-23 10:45:02 [Thread-5] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2026-01-23 10:45:02 [restartedMain] INFO  j.s.s.SistemadefacturacioneinventarioApplication - Starting SistemadefacturacioneinventarioApplication using Java 17.0.17 with PID 45107 (/home/josepino/Desktop/SistemaFacturaEInventario/sistemadefacturacioneinventario/target/classes started by josepino in /home/josepino/Desktop/SistemaFacturaEInventario/sistemadefacturacioneinventario)
2026-01-23 10:45:02 [restartedMain] DEBUG j.s.s.SistemadefacturacioneinventarioApplication - Running with Spring Boot v3.5.8, Spring v6.2.14
2026-01-23 10:45:02 [restartedMain] INFO  j.s.s.SistemadefacturacioneinventarioApplication - No active profile set, falling back to 1 default profile: "default"
2026-01-23 10:45:02 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-23 10:45:02 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 19 ms. Found 14 JPA repository interfaces.
2026-01-23 10:45:02 [restartedMain] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2026-01-23 10:45:02 [restartedMain] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2026-01-23 10:45:02 [restartedMain] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.49]
2026-01-23 10:45:02 [restartedMain] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2026-01-23 10:45:02 [restartedMain] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 254 ms
2026-01-23 10:45:02 [restartedMain] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-23 10:45:02 [restartedMain] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2026-01-23 10:45:02 [restartedMain] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-23 10:45:02 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-2 - Starting...
2026-01-23 10:45:02 [restartedMain] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-2 - Added connection com.mysql.cj.jdbc.ConnectionImpl@15d264e1
2026-01-23 10:45:02 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-2 - Start completed.
2026-01-23 10:45:02 [restartedMain] INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-2)']
	Database driver: undefined/unknown
	Database version: 8.0.44
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2026-01-23 10:45:03 [restartedMain] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-23 10:45:03 [restartedMain] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-23 10:45:03 [restartedMain] DEBUG o.h.s.internal.StatisticsInitiator - Statistics initialized [enabled=false]
2026-01-23 10:45:03 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - üîê Configurando BCryptPasswordEncoder para encriptaci√≥n de contrase√±as
2026-01-23 10:45:03 [restartedMain] INFO  j.s.s.config.WebConfig - ‚öôÔ∏è Configurando interceptores de Spring MVC
2026-01-23 10:45:03 [restartedMain] DEBUG j.s.s.config.WebConfig - Registrando CierreDiarioInterceptor
2026-01-23 10:45:03 [restartedMain] DEBUG j.s.s.config.WebConfig - CierreDiarioInterceptor configurado. Patrones incluidos: /**
2026-01-23 10:45:03 [restartedMain] DEBUG j.s.s.config.WebConfig - Patrones excluidos: /cierres/**, /login, /css/**, /js/**, /error
2026-01-23 10:45:03 [restartedMain] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name usuarioServicio
2026-01-23 10:45:03 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - üõ°Ô∏è Configurando SecurityFilterChain para SUPERADMIN (Orden 1)
2026-01-23 10:45:03 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - ‚úÖ SecurityFilterChain SUPERADMIN configurado
2026-01-23 10:45:03 [restartedMain] DEBUG o.s.s.web.DefaultSecurityFilterChain - Will secure Or [Mvc [pattern='/superadmin/**']] with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CsrfFilter, LogoutFilter, UsernamePasswordAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-23 10:45:03 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - üõ°Ô∏è Configurando SecurityFilterChain - Iniciando configuraci√≥n de seguridad
2026-01-23 10:45:03 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - ‚úÖ SecurityFilterChain configurado exitosamente
2026-01-23 10:45:03 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - Configuraci√≥n de seguridad aplicada:
2026-01-23 10:45:03 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - P√°ginas p√∫blicas: /, /login, /acceso-denegado, /css/**, /js/**, /error
2026-01-23 10:45:03 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - Solo ADMIN: /compras/**, /proveedores/**
2026-01-23 10:45:03 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - ADMIN o DEV: /productos/**, /ingredientes/**, /recetas/**, /reportes/**, /cierres/**
2026-01-23 10:45:03 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - Login: /login, Logout: /logout
2026-01-23 10:45:03 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - P√°gina acceso denegado: /acceso-denegado
2026-01-23 10:45:03 [restartedMain] DEBUG o.s.s.web.DefaultSecurityFilterChain - Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CsrfFilter, LogoutFilter, UsernamePasswordAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-23 10:45:03 [restartedMain] INFO  o.s.b.d.a.OptionalLiveReloadServer - LiveReload server is running on port 35729
2026-01-23 10:45:03 [restartedMain] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2026-01-23 10:45:03 [restartedMain] INFO  j.s.s.SistemadefacturacioneinventarioApplication - Started SistemadefacturacioneinventarioApplication in 1.271 seconds (process running for 287.387)
2026-01-23 10:45:03 [restartedMain] INFO  j.s.s.config.DataInitializer - üöÄ INICIANDO CARGA DE DATOS INICIALES DEL SISTEMA
2026-01-23 10:45:03 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        count(*) 
    from
        empresa e1_0
2026-01-23 10:45:03 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0
2026-01-23 10:45:03 [restartedMain] INFO  j.s.s.config.DataInitializer - ‚úÖ Empresa existente encontrada: Sistema por Defecto (ID: 1)
2026-01-23 10:45:03 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        c1_0.id 
    from
        cliente c1_0 
    left join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    where
        c1_0.nombre=? 
        and e1_0.id=? 
    limit
        ?
2026-01-23 10:45:03 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Consumidor Final]
2026-01-23 10:45:03 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-23 10:45:03 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:INTEGER) <- [1]
2026-01-23 10:45:03 [restartedMain] INFO  j.s.s.config.DataInitializer - ‚úÖ Cliente 'Consumidor Final' ya existe para empresa Sistema por Defecto
2026-01-23 10:45:03 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        count(u1_0.id) 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:45:03 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:45:03 [restartedMain] INFO  j.s.s.config.DataInitializer - ‚úÖ Ya existen 3 usuarios para empresa Sistema por Defecto. No se crean nuevos.
2026-01-23 10:45:03 [restartedMain] INFO  j.s.s.config.DataInitializer - üëë Verificando existencia de usuario SUPER_ADMIN
2026-01-23 10:45:03 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        u1_0.id 
    from
        usuario u1_0 
    where
        u1_0.rol=? 
    limit
        ?
2026-01-23 10:45:03 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [SUPER_ADMIN]
2026-01-23 10:45:03 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [1]
2026-01-23 10:45:03 [restartedMain] INFO  j.s.s.config.DataInitializer - ‚úÖ Usuario SUPER_ADMIN ya existe en el sistema
2026-01-23 10:45:03 [restartedMain] INFO  j.s.s.config.DataInitializer - ‚úÖ CARGA DE DATOS INICIALES COMPLETADA EXITOSAMENTE
2026-01-23 10:45:03 [restartedMain] INFO  j.s.s.config.UsuarioInicial - üîß Iniciando carga de usuarios iniciales
2026-01-23 10:45:03 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        count(*) 
    from
        empresa e1_0
2026-01-23 10:45:03 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0
2026-01-23 10:45:03 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        count(u1_0.id) 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:45:03 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:45:03 [restartedMain] DEBUG j.s.s.config.UsuarioInicial - Usuarios existentes en BD para empresa Sistema por Defecto: 3
2026-01-23 10:45:03 [restartedMain] INFO  j.s.s.config.UsuarioInicial - ‚úÖ Ya existen usuarios para empresa Sistema por Defecto. No se crean nuevos.
2026-01-23 10:45:03 [restartedMain] INFO  o.s.b.d.a.ConditionEvaluationDeltaLoggingListener - Condition evaluation unchanged
2026-01-23 10:45:08 [File Watcher] INFO  o.s.b.d.a.LocalDevToolsAutoConfiguration$RestartingClassPathChangeChangedEventListener - Restarting due to 1 class path change (0 additions, 0 deletions, 1 modification)
2026-01-23 10:45:08 [Thread-7] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2026-01-23 10:45:08 [tomcat-shutdown] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2026-01-23 10:45:08 [Thread-7] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2026-01-23 10:45:08 [Thread-7] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-2 - Shutdown initiated...
2026-01-23 10:45:08 [Thread-7] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-2 - Shutdown completed.
2026-01-23 10:45:08 [restartedMain] INFO  j.s.s.SistemadefacturacioneinventarioApplication - Starting SistemadefacturacioneinventarioApplication using Java 17.0.17 with PID 45107 (/home/josepino/Desktop/SistemaFacturaEInventario/sistemadefacturacioneinventario/target/classes started by josepino in /home/josepino/Desktop/SistemaFacturaEInventario/sistemadefacturacioneinventario)
2026-01-23 10:45:08 [restartedMain] DEBUG j.s.s.SistemadefacturacioneinventarioApplication - Running with Spring Boot v3.5.8, Spring v6.2.14
2026-01-23 10:45:08 [restartedMain] INFO  j.s.s.SistemadefacturacioneinventarioApplication - No active profile set, falling back to 1 default profile: "default"
2026-01-23 10:45:08 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-23 10:45:08 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 16 ms. Found 14 JPA repository interfaces.
2026-01-23 10:45:08 [restartedMain] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2026-01-23 10:45:08 [restartedMain] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2026-01-23 10:45:08 [restartedMain] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.49]
2026-01-23 10:45:08 [restartedMain] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2026-01-23 10:45:08 [restartedMain] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 178 ms
2026-01-23 10:45:08 [restartedMain] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-23 10:45:08 [restartedMain] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2026-01-23 10:45:08 [restartedMain] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-23 10:45:08 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-3 - Starting...
2026-01-23 10:45:08 [restartedMain] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-3 - Added connection com.mysql.cj.jdbc.ConnectionImpl@4c0d9b23
2026-01-23 10:45:08 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-3 - Start completed.
2026-01-23 10:45:08 [restartedMain] INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-3)']
	Database driver: undefined/unknown
	Database version: 8.0.44
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2026-01-23 10:45:08 [restartedMain] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-23 10:45:08 [restartedMain] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-23 10:45:08 [restartedMain] DEBUG o.h.s.internal.StatisticsInitiator - Statistics initialized [enabled=false]
2026-01-23 10:45:08 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - üîê Configurando BCryptPasswordEncoder para encriptaci√≥n de contrase√±as
2026-01-23 10:45:09 [restartedMain] INFO  j.s.s.config.WebConfig - ‚öôÔ∏è Configurando interceptores de Spring MVC
2026-01-23 10:45:09 [restartedMain] DEBUG j.s.s.config.WebConfig - Registrando CierreDiarioInterceptor
2026-01-23 10:45:09 [restartedMain] DEBUG j.s.s.config.WebConfig - CierreDiarioInterceptor configurado. Patrones incluidos: /**
2026-01-23 10:45:09 [restartedMain] DEBUG j.s.s.config.WebConfig - Patrones excluidos: /cierres/**, /login, /css/**, /js/**, /error
2026-01-23 10:45:09 [restartedMain] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name usuarioServicio
2026-01-23 10:45:09 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - üõ°Ô∏è Configurando SecurityFilterChain para SUPERADMIN (Orden 1)
2026-01-23 10:45:09 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - ‚úÖ SecurityFilterChain SUPERADMIN configurado
2026-01-23 10:45:09 [restartedMain] DEBUG o.s.s.web.DefaultSecurityFilterChain - Will secure Or [Mvc [pattern='/superadmin/**']] with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CsrfFilter, LogoutFilter, UsernamePasswordAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-23 10:45:09 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - üõ°Ô∏è Configurando SecurityFilterChain - Iniciando configuraci√≥n de seguridad
2026-01-23 10:45:09 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - ‚úÖ SecurityFilterChain configurado exitosamente
2026-01-23 10:45:09 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - Configuraci√≥n de seguridad aplicada:
2026-01-23 10:45:09 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - P√°ginas p√∫blicas: /, /login, /acceso-denegado, /css/**, /js/**, /error
2026-01-23 10:45:09 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - Solo ADMIN: /compras/**, /proveedores/**
2026-01-23 10:45:09 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - ADMIN o DEV: /productos/**, /ingredientes/**, /recetas/**, /reportes/**, /cierres/**
2026-01-23 10:45:09 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - Login: /login, Logout: /logout
2026-01-23 10:45:09 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - P√°gina acceso denegado: /acceso-denegado
2026-01-23 10:45:09 [restartedMain] DEBUG o.s.s.web.DefaultSecurityFilterChain - Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CsrfFilter, LogoutFilter, UsernamePasswordAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-23 10:45:09 [restartedMain] INFO  o.s.b.d.a.OptionalLiveReloadServer - LiveReload server is running on port 35729
2026-01-23 10:45:09 [restartedMain] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2026-01-23 10:45:09 [restartedMain] INFO  j.s.s.SistemadefacturacioneinventarioApplication - Started SistemadefacturacioneinventarioApplication in 0.903 seconds (process running for 292.758)
2026-01-23 10:45:09 [restartedMain] INFO  j.s.s.config.UsuarioInicial - üîß Iniciando carga de usuarios iniciales
2026-01-23 10:45:09 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        count(*) 
    from
        empresa e1_0
2026-01-23 10:45:09 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0
2026-01-23 10:45:09 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        count(u1_0.id) 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:45:09 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:45:09 [restartedMain] DEBUG j.s.s.config.UsuarioInicial - Usuarios existentes en BD para empresa Sistema por Defecto: 3
2026-01-23 10:45:09 [restartedMain] INFO  j.s.s.config.UsuarioInicial - ‚úÖ Ya existen usuarios para empresa Sistema por Defecto. No se crean nuevos.
2026-01-23 10:45:09 [restartedMain] INFO  j.s.s.config.DataInitializer - üöÄ INICIANDO CARGA DE DATOS INICIALES DEL SISTEMA
2026-01-23 10:45:09 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        count(*) 
    from
        empresa e1_0
2026-01-23 10:45:09 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0
2026-01-23 10:45:09 [restartedMain] INFO  j.s.s.config.DataInitializer - ‚úÖ Empresa existente encontrada: Sistema por Defecto (ID: 1)
2026-01-23 10:45:09 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        c1_0.id 
    from
        cliente c1_0 
    left join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    where
        c1_0.nombre=? 
        and e1_0.id=? 
    limit
        ?
2026-01-23 10:45:09 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Consumidor Final]
2026-01-23 10:45:09 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-23 10:45:09 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:INTEGER) <- [1]
2026-01-23 10:45:09 [restartedMain] INFO  j.s.s.config.DataInitializer - ‚úÖ Cliente 'Consumidor Final' ya existe para empresa Sistema por Defecto
2026-01-23 10:45:09 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        count(u1_0.id) 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:45:09 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:45:09 [restartedMain] INFO  j.s.s.config.DataInitializer - ‚úÖ Ya existen 3 usuarios para empresa Sistema por Defecto. No se crean nuevos.
2026-01-23 10:45:09 [restartedMain] INFO  j.s.s.config.DataInitializer - üëë Verificando existencia de usuario SUPER_ADMIN
2026-01-23 10:45:09 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        u1_0.id 
    from
        usuario u1_0 
    where
        u1_0.rol=? 
    limit
        ?
2026-01-23 10:45:09 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [SUPER_ADMIN]
2026-01-23 10:45:09 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [1]
2026-01-23 10:45:09 [restartedMain] INFO  j.s.s.config.DataInitializer - ‚úÖ Usuario SUPER_ADMIN ya existe en el sistema
2026-01-23 10:45:09 [restartedMain] INFO  j.s.s.config.DataInitializer - ‚úÖ CARGA DE DATOS INICIALES COMPLETADA EXITOSAMENTE
2026-01-23 10:45:09 [restartedMain] INFO  o.s.b.d.a.ConditionEvaluationDeltaLoggingListener - Condition evaluation unchanged
2026-01-23 10:45:10 [File Watcher] INFO  o.s.b.d.a.LocalDevToolsAutoConfiguration$RestartingClassPathChangeChangedEventListener - Restarting due to 1 class path change (0 additions, 0 deletions, 1 modification)
2026-01-23 10:45:10 [Thread-11] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2026-01-23 10:45:10 [tomcat-shutdown] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2026-01-23 10:45:10 [Thread-11] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2026-01-23 10:45:10 [Thread-11] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-3 - Shutdown initiated...
2026-01-23 10:45:10 [Thread-11] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-3 - Shutdown completed.
2026-01-23 10:45:10 [restartedMain] INFO  j.s.s.SistemadefacturacioneinventarioApplication - Starting SistemadefacturacioneinventarioApplication using Java 17.0.17 with PID 45107 (/home/josepino/Desktop/SistemaFacturaEInventario/sistemadefacturacioneinventario/target/classes started by josepino in /home/josepino/Desktop/SistemaFacturaEInventario/sistemadefacturacioneinventario)
2026-01-23 10:45:10 [restartedMain] DEBUG j.s.s.SistemadefacturacioneinventarioApplication - Running with Spring Boot v3.5.8, Spring v6.2.14
2026-01-23 10:45:10 [restartedMain] INFO  j.s.s.SistemadefacturacioneinventarioApplication - No active profile set, falling back to 1 default profile: "default"
2026-01-23 10:45:10 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-23 10:45:10 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 15 ms. Found 14 JPA repository interfaces.
2026-01-23 10:45:10 [restartedMain] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2026-01-23 10:45:10 [restartedMain] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2026-01-23 10:45:10 [restartedMain] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.49]
2026-01-23 10:45:10 [restartedMain] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2026-01-23 10:45:10 [restartedMain] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 183 ms
2026-01-23 10:45:10 [restartedMain] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-23 10:45:10 [restartedMain] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2026-01-23 10:45:10 [restartedMain] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-23 10:45:10 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-4 - Starting...
2026-01-23 10:45:10 [restartedMain] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-4 - Added connection com.mysql.cj.jdbc.ConnectionImpl@2723543e
2026-01-23 10:45:10 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-4 - Start completed.
2026-01-23 10:45:10 [restartedMain] INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-4)']
	Database driver: undefined/unknown
	Database version: 8.0.44
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2026-01-23 10:45:10 [restartedMain] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-23 10:45:11 [restartedMain] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-23 10:45:11 [restartedMain] DEBUG o.h.s.internal.StatisticsInitiator - Statistics initialized [enabled=false]
2026-01-23 10:45:11 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - üîê Configurando BCryptPasswordEncoder para encriptaci√≥n de contrase√±as
2026-01-23 10:45:11 [restartedMain] INFO  j.s.s.config.WebConfig - ‚öôÔ∏è Configurando interceptores de Spring MVC
2026-01-23 10:45:11 [restartedMain] DEBUG j.s.s.config.WebConfig - Registrando CierreDiarioInterceptor
2026-01-23 10:45:11 [restartedMain] DEBUG j.s.s.config.WebConfig - CierreDiarioInterceptor configurado. Patrones incluidos: /**
2026-01-23 10:45:11 [restartedMain] DEBUG j.s.s.config.WebConfig - Patrones excluidos: /cierres/**, /login, /css/**, /js/**, /error
2026-01-23 10:45:11 [restartedMain] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name usuarioServicio
2026-01-23 10:45:11 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - üõ°Ô∏è Configurando SecurityFilterChain para SUPERADMIN (Orden 1)
2026-01-23 10:45:11 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - ‚úÖ SecurityFilterChain SUPERADMIN configurado
2026-01-23 10:45:11 [restartedMain] DEBUG o.s.s.web.DefaultSecurityFilterChain - Will secure Or [Mvc [pattern='/superadmin/**']] with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CsrfFilter, LogoutFilter, UsernamePasswordAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-23 10:45:11 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - üõ°Ô∏è Configurando SecurityFilterChain - Iniciando configuraci√≥n de seguridad
2026-01-23 10:45:11 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - ‚úÖ SecurityFilterChain configurado exitosamente
2026-01-23 10:45:11 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - Configuraci√≥n de seguridad aplicada:
2026-01-23 10:45:11 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - P√°ginas p√∫blicas: /, /login, /acceso-denegado, /css/**, /js/**, /error
2026-01-23 10:45:11 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - Solo ADMIN: /compras/**, /proveedores/**
2026-01-23 10:45:11 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - ADMIN o DEV: /productos/**, /ingredientes/**, /recetas/**, /reportes/**, /cierres/**
2026-01-23 10:45:11 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - Login: /login, Logout: /logout
2026-01-23 10:45:11 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - P√°gina acceso denegado: /acceso-denegado
2026-01-23 10:45:11 [restartedMain] DEBUG o.s.s.web.DefaultSecurityFilterChain - Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CsrfFilter, LogoutFilter, UsernamePasswordAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-23 10:45:11 [restartedMain] INFO  o.s.b.d.a.OptionalLiveReloadServer - LiveReload server is running on port 35729
2026-01-23 10:45:11 [restartedMain] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2026-01-23 10:45:11 [restartedMain] INFO  j.s.s.SistemadefacturacioneinventarioApplication - Started SistemadefacturacioneinventarioApplication in 0.784 seconds (process running for 295.0)
2026-01-23 10:45:11 [restartedMain] INFO  j.s.s.config.UsuarioInicial - üîß Iniciando carga de usuarios iniciales
2026-01-23 10:45:11 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        count(*) 
    from
        empresa e1_0
2026-01-23 10:45:11 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0
2026-01-23 10:45:11 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        count(u1_0.id) 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:45:11 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:45:11 [restartedMain] DEBUG j.s.s.config.UsuarioInicial - Usuarios existentes en BD para empresa Sistema por Defecto: 3
2026-01-23 10:45:11 [restartedMain] INFO  j.s.s.config.UsuarioInicial - ‚úÖ Ya existen usuarios para empresa Sistema por Defecto. No se crean nuevos.
2026-01-23 10:45:11 [restartedMain] INFO  j.s.s.config.DataInitializer - üöÄ INICIANDO CARGA DE DATOS INICIALES DEL SISTEMA
2026-01-23 10:45:11 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        count(*) 
    from
        empresa e1_0
2026-01-23 10:45:11 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0
2026-01-23 10:45:11 [restartedMain] INFO  j.s.s.config.DataInitializer - ‚úÖ Empresa existente encontrada: Sistema por Defecto (ID: 1)
2026-01-23 10:45:11 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        c1_0.id 
    from
        cliente c1_0 
    left join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    where
        c1_0.nombre=? 
        and e1_0.id=? 
    limit
        ?
2026-01-23 10:45:11 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Consumidor Final]
2026-01-23 10:45:11 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-23 10:45:11 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:INTEGER) <- [1]
2026-01-23 10:45:11 [restartedMain] INFO  j.s.s.config.DataInitializer - ‚úÖ Cliente 'Consumidor Final' ya existe para empresa Sistema por Defecto
2026-01-23 10:45:11 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        count(u1_0.id) 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:45:11 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:45:11 [restartedMain] INFO  j.s.s.config.DataInitializer - ‚úÖ Ya existen 3 usuarios para empresa Sistema por Defecto. No se crean nuevos.
2026-01-23 10:45:11 [restartedMain] INFO  j.s.s.config.DataInitializer - üëë Verificando existencia de usuario SUPER_ADMIN
2026-01-23 10:45:11 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        u1_0.id 
    from
        usuario u1_0 
    where
        u1_0.rol=? 
    limit
        ?
2026-01-23 10:45:11 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [SUPER_ADMIN]
2026-01-23 10:45:11 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [1]
2026-01-23 10:45:11 [restartedMain] INFO  j.s.s.config.DataInitializer - ‚úÖ Usuario SUPER_ADMIN ya existe en el sistema
2026-01-23 10:45:11 [restartedMain] INFO  j.s.s.config.DataInitializer - ‚úÖ CARGA DE DATOS INICIALES COMPLETADA EXITOSAMENTE
2026-01-23 10:45:11 [restartedMain] INFO  o.s.b.d.a.ConditionEvaluationDeltaLoggingListener - Condition evaluation unchanged
2026-01-23 10:45:15 [File Watcher] INFO  o.s.b.d.a.LocalDevToolsAutoConfiguration$RestartingClassPathChangeChangedEventListener - Restarting due to 1 class path change (0 additions, 0 deletions, 1 modification)
2026-01-23 10:45:15 [Thread-15] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2026-01-23 10:45:15 [tomcat-shutdown] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2026-01-23 10:45:15 [Thread-15] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2026-01-23 10:45:15 [Thread-15] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-4 - Shutdown initiated...
2026-01-23 10:45:15 [Thread-15] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-4 - Shutdown completed.
2026-01-23 10:45:15 [restartedMain] INFO  j.s.s.SistemadefacturacioneinventarioApplication - Starting SistemadefacturacioneinventarioApplication using Java 17.0.17 with PID 45107 (/home/josepino/Desktop/SistemaFacturaEInventario/sistemadefacturacioneinventario/target/classes started by josepino in /home/josepino/Desktop/SistemaFacturaEInventario/sistemadefacturacioneinventario)
2026-01-23 10:45:15 [restartedMain] DEBUG j.s.s.SistemadefacturacioneinventarioApplication - Running with Spring Boot v3.5.8, Spring v6.2.14
2026-01-23 10:45:15 [restartedMain] INFO  j.s.s.SistemadefacturacioneinventarioApplication - No active profile set, falling back to 1 default profile: "default"
2026-01-23 10:45:15 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-23 10:45:15 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 18 ms. Found 14 JPA repository interfaces.
2026-01-23 10:45:16 [restartedMain] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2026-01-23 10:45:16 [restartedMain] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2026-01-23 10:45:16 [restartedMain] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.49]
2026-01-23 10:45:16 [restartedMain] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2026-01-23 10:45:16 [restartedMain] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 170 ms
2026-01-23 10:45:16 [restartedMain] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-23 10:45:16 [restartedMain] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2026-01-23 10:45:16 [restartedMain] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-23 10:45:16 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-5 - Starting...
2026-01-23 10:45:16 [restartedMain] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-5 - Added connection com.mysql.cj.jdbc.ConnectionImpl@197c8e02
2026-01-23 10:45:16 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-5 - Start completed.
2026-01-23 10:45:16 [restartedMain] INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-5)']
	Database driver: undefined/unknown
	Database version: 8.0.44
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2026-01-23 10:45:16 [restartedMain] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-23 10:45:16 [restartedMain] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-23 10:45:16 [restartedMain] DEBUG o.h.s.internal.StatisticsInitiator - Statistics initialized [enabled=false]
2026-01-23 10:45:16 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - üîê Configurando BCryptPasswordEncoder para encriptaci√≥n de contrase√±as
2026-01-23 10:45:16 [restartedMain] INFO  j.s.s.config.WebConfig - ‚öôÔ∏è Configurando interceptores de Spring MVC
2026-01-23 10:45:16 [restartedMain] DEBUG j.s.s.config.WebConfig - Registrando CierreDiarioInterceptor
2026-01-23 10:45:16 [restartedMain] DEBUG j.s.s.config.WebConfig - CierreDiarioInterceptor configurado. Patrones incluidos: /**
2026-01-23 10:45:16 [restartedMain] DEBUG j.s.s.config.WebConfig - Patrones excluidos: /cierres/**, /login, /css/**, /js/**, /error
2026-01-23 10:45:16 [restartedMain] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name usuarioServicio
2026-01-23 10:45:16 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - üõ°Ô∏è Configurando SecurityFilterChain para SUPERADMIN (Orden 1)
2026-01-23 10:45:16 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - ‚úÖ SecurityFilterChain SUPERADMIN configurado
2026-01-23 10:45:16 [restartedMain] DEBUG o.s.s.web.DefaultSecurityFilterChain - Will secure Or [Mvc [pattern='/superadmin/**']] with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CsrfFilter, LogoutFilter, UsernamePasswordAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-23 10:45:16 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - üõ°Ô∏è Configurando SecurityFilterChain - Iniciando configuraci√≥n de seguridad
2026-01-23 10:45:16 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - ‚úÖ SecurityFilterChain configurado exitosamente
2026-01-23 10:45:16 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - Configuraci√≥n de seguridad aplicada:
2026-01-23 10:45:16 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - P√°ginas p√∫blicas: /, /login, /acceso-denegado, /css/**, /js/**, /error
2026-01-23 10:45:16 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - Solo ADMIN: /compras/**, /proveedores/**
2026-01-23 10:45:16 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - ADMIN o DEV: /productos/**, /ingredientes/**, /recetas/**, /reportes/**, /cierres/**
2026-01-23 10:45:16 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - Login: /login, Logout: /logout
2026-01-23 10:45:16 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - P√°gina acceso denegado: /acceso-denegado
2026-01-23 10:45:16 [restartedMain] DEBUG o.s.s.web.DefaultSecurityFilterChain - Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CsrfFilter, LogoutFilter, UsernamePasswordAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-23 10:45:16 [restartedMain] INFO  o.s.b.d.a.OptionalLiveReloadServer - LiveReload server is running on port 35729
2026-01-23 10:45:16 [restartedMain] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2026-01-23 10:45:16 [restartedMain] INFO  j.s.s.SistemadefacturacioneinventarioApplication - Started SistemadefacturacioneinventarioApplication in 0.74 seconds (process running for 300.212)
2026-01-23 10:45:16 [restartedMain] INFO  j.s.s.config.DataInitializer - üöÄ INICIANDO CARGA DE DATOS INICIALES DEL SISTEMA
2026-01-23 10:45:16 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        count(*) 
    from
        empresa e1_0
2026-01-23 10:45:16 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0
2026-01-23 10:45:16 [restartedMain] INFO  j.s.s.config.DataInitializer - ‚úÖ Empresa existente encontrada: Sistema por Defecto (ID: 1)
2026-01-23 10:45:16 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        c1_0.id 
    from
        cliente c1_0 
    left join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    where
        c1_0.nombre=? 
        and e1_0.id=? 
    limit
        ?
2026-01-23 10:45:16 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Consumidor Final]
2026-01-23 10:45:16 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-23 10:45:16 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:INTEGER) <- [1]
2026-01-23 10:45:16 [restartedMain] INFO  j.s.s.config.DataInitializer - ‚úÖ Cliente 'Consumidor Final' ya existe para empresa Sistema por Defecto
2026-01-23 10:45:16 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        count(u1_0.id) 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:45:16 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:45:16 [restartedMain] INFO  j.s.s.config.DataInitializer - ‚úÖ Ya existen 3 usuarios para empresa Sistema por Defecto. No se crean nuevos.
2026-01-23 10:45:16 [restartedMain] INFO  j.s.s.config.DataInitializer - üëë Verificando existencia de usuario SUPER_ADMIN
2026-01-23 10:45:16 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        u1_0.id 
    from
        usuario u1_0 
    where
        u1_0.rol=? 
    limit
        ?
2026-01-23 10:45:16 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [SUPER_ADMIN]
2026-01-23 10:45:16 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [1]
2026-01-23 10:45:16 [restartedMain] INFO  j.s.s.config.DataInitializer - ‚úÖ Usuario SUPER_ADMIN ya existe en el sistema
2026-01-23 10:45:16 [restartedMain] INFO  j.s.s.config.DataInitializer - ‚úÖ CARGA DE DATOS INICIALES COMPLETADA EXITOSAMENTE
2026-01-23 10:45:16 [restartedMain] INFO  j.s.s.config.UsuarioInicial - üîß Iniciando carga de usuarios iniciales
2026-01-23 10:45:16 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        count(*) 
    from
        empresa e1_0
2026-01-23 10:45:16 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0
2026-01-23 10:45:16 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        count(u1_0.id) 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:45:16 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:45:16 [restartedMain] DEBUG j.s.s.config.UsuarioInicial - Usuarios existentes en BD para empresa Sistema por Defecto: 3
2026-01-23 10:45:16 [restartedMain] INFO  j.s.s.config.UsuarioInicial - ‚úÖ Ya existen usuarios para empresa Sistema por Defecto. No se crean nuevos.
2026-01-23 10:45:16 [restartedMain] INFO  o.s.b.d.a.ConditionEvaluationDeltaLoggingListener - Condition evaluation unchanged
2026-01-23 10:45:46 [File Watcher] INFO  o.s.b.d.a.LocalDevToolsAutoConfiguration$RestartingClassPathChangeChangedEventListener - Restarting due to 1 class path change (0 additions, 0 deletions, 1 modification)
2026-01-23 10:45:46 [Thread-19] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2026-01-23 10:45:46 [tomcat-shutdown] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2026-01-23 10:45:46 [Thread-19] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2026-01-23 10:45:46 [Thread-19] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-5 - Shutdown initiated...
2026-01-23 10:45:46 [Thread-19] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-5 - Shutdown completed.
2026-01-23 10:45:46 [restartedMain] INFO  j.s.s.SistemadefacturacioneinventarioApplication - Starting SistemadefacturacioneinventarioApplication using Java 17.0.17 with PID 45107 (/home/josepino/Desktop/SistemaFacturaEInventario/sistemadefacturacioneinventario/target/classes started by josepino in /home/josepino/Desktop/SistemaFacturaEInventario/sistemadefacturacioneinventario)
2026-01-23 10:45:46 [restartedMain] DEBUG j.s.s.SistemadefacturacioneinventarioApplication - Running with Spring Boot v3.5.8, Spring v6.2.14
2026-01-23 10:45:46 [restartedMain] INFO  j.s.s.SistemadefacturacioneinventarioApplication - No active profile set, falling back to 1 default profile: "default"
2026-01-23 10:45:46 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-23 10:45:46 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 12 ms. Found 14 JPA repository interfaces.
2026-01-23 10:45:46 [restartedMain] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2026-01-23 10:45:46 [restartedMain] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2026-01-23 10:45:46 [restartedMain] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.49]
2026-01-23 10:45:46 [restartedMain] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2026-01-23 10:45:46 [restartedMain] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 155 ms
2026-01-23 10:45:46 [restartedMain] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-23 10:45:46 [restartedMain] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2026-01-23 10:45:46 [restartedMain] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-23 10:45:46 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-6 - Starting...
2026-01-23 10:45:46 [restartedMain] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-6 - Added connection com.mysql.cj.jdbc.ConnectionImpl@72ce6d41
2026-01-23 10:45:46 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-6 - Start completed.
2026-01-23 10:45:46 [restartedMain] INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-6)']
	Database driver: undefined/unknown
	Database version: 8.0.44
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2026-01-23 10:45:46 [restartedMain] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-23 10:45:46 [restartedMain] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-23 10:45:46 [restartedMain] DEBUG o.h.s.internal.StatisticsInitiator - Statistics initialized [enabled=false]
2026-01-23 10:45:46 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - üîê Configurando BCryptPasswordEncoder para encriptaci√≥n de contrase√±as
2026-01-23 10:45:46 [restartedMain] INFO  j.s.s.config.WebConfig - ‚öôÔ∏è Configurando interceptores de Spring MVC
2026-01-23 10:45:46 [restartedMain] DEBUG j.s.s.config.WebConfig - Registrando CierreDiarioInterceptor
2026-01-23 10:45:46 [restartedMain] DEBUG j.s.s.config.WebConfig - CierreDiarioInterceptor configurado. Patrones incluidos: /**
2026-01-23 10:45:46 [restartedMain] DEBUG j.s.s.config.WebConfig - Patrones excluidos: /cierres/**, /login, /css/**, /js/**, /error
2026-01-23 10:45:46 [restartedMain] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name usuarioServicio
2026-01-23 10:45:46 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - üõ°Ô∏è Configurando SecurityFilterChain para SUPERADMIN (Orden 1)
2026-01-23 10:45:46 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - ‚úÖ SecurityFilterChain SUPERADMIN configurado
2026-01-23 10:45:46 [restartedMain] DEBUG o.s.s.web.DefaultSecurityFilterChain - Will secure Or [Mvc [pattern='/superadmin/**']] with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CsrfFilter, LogoutFilter, UsernamePasswordAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-23 10:45:46 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - üõ°Ô∏è Configurando SecurityFilterChain - Iniciando configuraci√≥n de seguridad
2026-01-23 10:45:46 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - ‚úÖ SecurityFilterChain configurado exitosamente
2026-01-23 10:45:46 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - Configuraci√≥n de seguridad aplicada:
2026-01-23 10:45:46 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - P√°ginas p√∫blicas: /, /login, /acceso-denegado, /css/**, /js/**, /error
2026-01-23 10:45:46 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - Solo ADMIN: /compras/**, /proveedores/**
2026-01-23 10:45:46 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - ADMIN o DEV: /productos/**, /ingredientes/**, /recetas/**, /reportes/**, /cierres/**
2026-01-23 10:45:46 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - Login: /login, Logout: /logout
2026-01-23 10:45:46 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - P√°gina acceso denegado: /acceso-denegado
2026-01-23 10:45:46 [restartedMain] DEBUG o.s.s.web.DefaultSecurityFilterChain - Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CsrfFilter, LogoutFilter, UsernamePasswordAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-23 10:45:46 [restartedMain] INFO  o.s.b.d.a.OptionalLiveReloadServer - LiveReload server is running on port 35729
2026-01-23 10:45:46 [restartedMain] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2026-01-23 10:45:46 [restartedMain] INFO  j.s.s.SistemadefacturacioneinventarioApplication - Started SistemadefacturacioneinventarioApplication in 0.682 seconds (process running for 330.484)
2026-01-23 10:45:46 [restartedMain] INFO  j.s.s.config.UsuarioInicial - üîß Iniciando carga de usuarios iniciales
2026-01-23 10:45:46 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        count(*) 
    from
        empresa e1_0
2026-01-23 10:45:46 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0
2026-01-23 10:45:46 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        count(u1_0.id) 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:45:46 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:45:46 [restartedMain] DEBUG j.s.s.config.UsuarioInicial - Usuarios existentes en BD para empresa Sistema por Defecto: 3
2026-01-23 10:45:46 [restartedMain] INFO  j.s.s.config.UsuarioInicial - ‚úÖ Ya existen usuarios para empresa Sistema por Defecto. No se crean nuevos.
2026-01-23 10:45:46 [restartedMain] INFO  j.s.s.config.DataInitializer - üöÄ INICIANDO CARGA DE DATOS INICIALES DEL SISTEMA
2026-01-23 10:45:46 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        count(*) 
    from
        empresa e1_0
2026-01-23 10:45:46 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0
2026-01-23 10:45:46 [restartedMain] INFO  j.s.s.config.DataInitializer - ‚úÖ Empresa existente encontrada: Sistema por Defecto (ID: 1)
2026-01-23 10:45:46 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        c1_0.id 
    from
        cliente c1_0 
    left join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    where
        c1_0.nombre=? 
        and e1_0.id=? 
    limit
        ?
2026-01-23 10:45:46 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Consumidor Final]
2026-01-23 10:45:46 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-23 10:45:46 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:INTEGER) <- [1]
2026-01-23 10:45:46 [restartedMain] INFO  j.s.s.config.DataInitializer - ‚úÖ Cliente 'Consumidor Final' ya existe para empresa Sistema por Defecto
2026-01-23 10:45:46 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        count(u1_0.id) 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:45:46 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:45:46 [restartedMain] INFO  j.s.s.config.DataInitializer - ‚úÖ Ya existen 3 usuarios para empresa Sistema por Defecto. No se crean nuevos.
2026-01-23 10:45:46 [restartedMain] INFO  j.s.s.config.DataInitializer - üëë Verificando existencia de usuario SUPER_ADMIN
2026-01-23 10:45:46 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        u1_0.id 
    from
        usuario u1_0 
    where
        u1_0.rol=? 
    limit
        ?
2026-01-23 10:45:46 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [SUPER_ADMIN]
2026-01-23 10:45:46 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [1]
2026-01-23 10:45:46 [restartedMain] INFO  j.s.s.config.DataInitializer - ‚úÖ Usuario SUPER_ADMIN ya existe en el sistema
2026-01-23 10:45:46 [restartedMain] INFO  j.s.s.config.DataInitializer - ‚úÖ CARGA DE DATOS INICIALES COMPLETADA EXITOSAMENTE
2026-01-23 10:45:46 [restartedMain] INFO  o.s.b.d.a.ConditionEvaluationDeltaLoggingListener - Condition evaluation unchanged
2026-01-23 10:45:55 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2026-01-23 10:45:55 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2026-01-23 10:45:55 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2026-01-23 10:45:55 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-23 10:45:55 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: admin para la empresa ID: null
2026-01-23 10:45:55 [http-nio-8080-exec-1] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: jose
2026-01-23 10:45:55 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:45:55 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:45:55 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: jose | Empresa ID: 2 | Empresa Nombre: Empresa JOse
2026-01-23 10:45:55 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:45:55 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:45:55 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:45:55 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:45:55 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:45:55 [http-nio-8080-exec-1] INFO  j.s.s.servicios.UsuarioServicio - üîê Encontrado usuario: admin
2026-01-23 10:45:55 [http-nio-8080-exec-1] INFO  j.s.s.servicios.UsuarioServicio - üîê Rol: ADMIN
2026-01-23 10:45:55 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - üîê Activo: true
2026-01-23 10:45:55 [http-nio-8080-exec-1] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Authenticated user
2026-01-23 10:45:55 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.s.ChangeSessionIdAuthenticationStrategy - Changed session id from 9D64803F2BC6DABC061D148D4EB62228
2026-01-23 10:45:55 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.CsrfAuthenticationStrategy - Replaced CSRF Token
2026-01-23 10:45:55 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Stored SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=9D64803F2BC6DABC061D148D4EB62228], Granted Authorities=[ROLE_ADMIN]]] to HttpSession [org.apache.catalina.session.StandardSessionFacade@27b829ee]
2026-01-23 10:45:55 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.UsernamePasswordAuthenticationFilter - Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=9D64803F2BC6DABC061D148D4EB62228], Granted Authorities=[ROLE_ADMIN]]
2026-01-23 10:45:55 [http-nio-8080-exec-1] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /principal
2026-01-23 10:45:55 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-23 10:45:55 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=9D64803F2BC6DABC061D148D4EB62228], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:45:55 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-23 10:45:55 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-23 10:45:55 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:45:55 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:45:55 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:45:55 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:45:55 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 163
2026-01-23 10:45:55 [http-nio-8080-exec-2] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:45:55 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:45:55 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:45:55 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:45:55 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:45:55 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:45:55 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:45:55 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:45:55 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:45:55 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-23 10:45:55 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:45:55 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:45:55 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:45:55 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:45:55 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:45:55 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:45:55 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:45:55 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:45:55 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:45:55 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:45:55 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:45:55 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:45:55 [http-nio-8080-exec-2] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-23
2026-01-23 10:45:55 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-23 10:45:55 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:45:55 [http-nio-8080-exec-2] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-23
2026-01-23 10:45:55 [http-nio-8080-exec-2] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-23 10:45:55 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 163, Tenant anterior: 2
2026-01-23 10:45:55 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 163, Request: /principal, Empresa ID anterior: 2
2026-01-23 10:45:57 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios
2026-01-23 10:45:57 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=9D64803F2BC6DABC061D148D4EB62228], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:45:57 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios
2026-01-23 10:45:57 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios, M√©todo: GET
2026-01-23 10:45:57 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:45:57 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:45:57 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:45:57 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:45:57 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 164
2026-01-23 10:45:57 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:45:57 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:45:57 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:45:57 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:45:57 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:45:57 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:45:57 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:45:57 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:45:57 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:45:57 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios, Empresa ID: 2
2026-01-23 10:45:57 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:45:57 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:45:57 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:45:57 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:45:57 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:45:57 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:45:57 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:45:57 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:45:57 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:45:57 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:45:57 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:45:57 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:45:57 [http-nio-8080-exec-3] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-23 10:45:57 [http-nio-8080-exec-3] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-23 10:45:57 [http-nio-8080-exec-3] INFO  j.s.s.c.UsuarioControlador - üìã GET /admin/usuarios - Listando usuarios
2026-01-23 10:45:57 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Listando usuarios para empresa ID: 2
2026-01-23 10:45:57 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:45:57 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:45:57 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:45:57 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:45:57 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 164, Tenant anterior: 2
2026-01-23 10:45:57 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 164, Request: /admin/usuarios, Empresa ID anterior: 2
2026-01-23 10:46:01 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios/editar/7
2026-01-23 10:46:01 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=9D64803F2BC6DABC061D148D4EB62228], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:46:01 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios/editar/7
2026-01-23 10:46:01 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios/editar/7, M√©todo: GET
2026-01-23 10:46:01 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:46:01 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:46:01 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:46:01 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:46:01 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 165
2026-01-23 10:46:01 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:46:01 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:46:01 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:46:01 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:46:01 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:46:01 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:46:01 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:46:01 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:46:01 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:46:01 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios/editar/7, Empresa ID: 2
2026-01-23 10:46:01 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:46:01 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:46:01 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:46:01 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:46:01 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:46:01 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:46:01 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:46:01 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:46:01 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:46:01 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:46:01 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:46:01 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:46:01 [http-nio-8080-exec-4] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.mostrarFormularioEditar(java.lang.Long,org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-23 10:46:01 [http-nio-8080-exec-4] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.mostrarFormularioEditar(java.lang.Long,org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-23 10:46:01 [http-nio-8080-exec-4] INFO  j.s.s.c.UsuarioControlador - ‚úèÔ∏è GET /admin/usuarios/editar/7 - Editando usuario
2026-01-23 10:46:01 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Obteniendo usuario ID: 7 para empresa ID: 2
2026-01-23 10:46:01 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        u1_0.id=? 
        and e1_0.id=?
2026-01-23 10:46:01 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [7]
2026-01-23 10:46:01 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:46:01 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:46:01 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:46:01 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 165, Tenant anterior: 2
2026-01-23 10:46:01 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 165, Request: /admin/usuarios/editar/7, Empresa ID anterior: 2
2026-01-23 10:46:07 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing POST /admin/usuarios/actualizar/7
2026-01-23 10:46:07 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=9D64803F2BC6DABC061D148D4EB62228], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:46:07 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured POST /admin/usuarios/actualizar/7
2026-01-23 10:46:07 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios/actualizar/7, M√©todo: POST
2026-01-23 10:46:07 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:46:07 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:46:07 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:46:07 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:46:07 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 166
2026-01-23 10:46:07 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:46:07 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:46:07 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:46:07 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:46:07 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:46:07 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:46:07 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:46:07 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:46:07 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:46:07 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios/actualizar/7, Empresa ID: 2
2026-01-23 10:46:07 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:46:07 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:46:07 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:46:07 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:46:07 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:46:07 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:46:07 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:46:07 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:46:07 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:46:07 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:46:07 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:46:07 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:46:07 [http-nio-8080-exec-5] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.actualizarUsuario(java.lang.Long,jpd.sistemafacinv.sistemadefacturacioneinventario.modelos.Usuario,java.lang.String,java.lang.String,org.springframework.web.servlet.mvc.support.RedirectAttributes); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-23 10:46:07 [http-nio-8080-exec-5] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.actualizarUsuario(java.lang.Long,jpd.sistemafacinv.sistemadefacturacioneinventario.modelos.Usuario,java.lang.String,java.lang.String,org.springframework.web.servlet.mvc.support.RedirectAttributes); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-23 10:46:07 [http-nio-8080-exec-5] INFO  j.s.s.c.UsuarioControlador - üîÑ POST /admin/usuarios/actualizar/7 - Actualizando usuario
2026-01-23 10:46:07 [http-nio-8080-exec-5] DEBUG j.s.s.c.UsuarioControlador - Usuario autenticado: admin, Roles: [ROLE_ADMIN]
2026-01-23 10:46:07 [http-nio-8080-exec-5] DEBUG j.s.s.c.UsuarioControlador - Contrase√±a actualizada para usuario ID: 7
2026-01-23 10:46:07 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Obteniendo usuario ID: 7 para empresa ID: 2
2026-01-23 10:46:07 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        u1_0.id=? 
        and e1_0.id=?
2026-01-23 10:46:07 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [7]
2026-01-23 10:46:07 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:46:07 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:46:07 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:46:07 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Actualizando usuario ID: 7 en empresa ID: 2
2026-01-23 10:46:07 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        u1_0.id=? 
        and e1_0.id=?
2026-01-23 10:46:07 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [7]
2026-01-23 10:46:07 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:46:07 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:46:07 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:46:07 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Actualizando contrase√±a para usuario ID: 7
2026-01-23 10:46:07 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-23 10:46:07 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [7]
2026-01-23 10:46:07 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    update
        usuario 
    set
        activo=?,
        contrasenna=?,
        empresa_id=?,
        nombre_usuario=?,
        rol=?,
        sucursal_id=? 
    where
        id=?
2026-01-23 10:46:07 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-23 10:46:07 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [$2a$10$Zfd66grp0JvmV3CqKEEGjuS8TS7CHPt1TKuXQZRZRQvkb.yypJ0fi]
2026-01-23 10:46:07 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:46:07 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [jose]
2026-01-23 10:46:07 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [CAJERO]
2026-01-23 10:46:07 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:BIGINT) <- [null]
2026-01-23 10:46:07 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:BIGINT) <- [7]
2026-01-23 10:46:07 [http-nio-8080-exec-5] INFO  j.s.s.servicios.UsuarioServicio - Usuario actualizado exitosamente: jose (ID: 7)
2026-01-23 10:46:07 [http-nio-8080-exec-5] INFO  j.s.s.c.UsuarioControlador - ‚úÖ Usuario actualizado exitosamente ID: 7 - Nuevo rol: CAJERO
2026-01-23 10:46:07 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 166, Tenant anterior: 2
2026-01-23 10:46:07 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 166, Request: /admin/usuarios/actualizar/7, Empresa ID anterior: 2
2026-01-23 10:46:07 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios
2026-01-23 10:46:07 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=9D64803F2BC6DABC061D148D4EB62228], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:46:07 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios
2026-01-23 10:46:07 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios, M√©todo: GET
2026-01-23 10:46:07 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:46:07 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:46:07 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:46:07 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:46:07 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 167
2026-01-23 10:46:07 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:46:07 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:46:07 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:46:07 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:46:07 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:46:07 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:46:07 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:46:07 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:46:07 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:46:07 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios, Empresa ID: 2
2026-01-23 10:46:07 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:46:07 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:46:07 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:46:07 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:46:07 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:46:07 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:46:07 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:46:07 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:46:07 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:46:07 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:46:07 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:46:07 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:46:07 [http-nio-8080-exec-6] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-23 10:46:07 [http-nio-8080-exec-6] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-23 10:46:07 [http-nio-8080-exec-6] INFO  j.s.s.c.UsuarioControlador - üìã GET /admin/usuarios - Listando usuarios
2026-01-23 10:46:07 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Listando usuarios para empresa ID: 2
2026-01-23 10:46:07 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:46:07 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:46:07 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:46:07 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:46:07 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 167, Tenant anterior: 2
2026-01-23 10:46:07 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 167, Request: /admin/usuarios, Empresa ID anterior: 2
2026-01-23 10:46:08 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-23 10:46:08 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=9D64803F2BC6DABC061D148D4EB62228], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:46:08 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-23 10:46:08 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-23 10:46:08 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:46:08 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:46:08 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:46:08 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:46:08 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 168
2026-01-23 10:46:08 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:46:08 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:46:08 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:46:08 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:46:08 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:46:08 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:46:08 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:46:08 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:46:08 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:46:08 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-23 10:46:08 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:46:08 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:46:08 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:46:08 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:46:08 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:46:08 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:46:08 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:46:08 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:46:08 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:46:08 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:46:08 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:46:08 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:46:08 [http-nio-8080-exec-7] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-23
2026-01-23 10:46:08 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-23 10:46:08 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:46:08 [http-nio-8080-exec-7] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-23
2026-01-23 10:46:08 [http-nio-8080-exec-7] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-23 10:46:08 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 168, Tenant anterior: 2
2026-01-23 10:46:08 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 168, Request: /principal, Empresa ID anterior: 2
2026-01-23 10:46:09 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing POST /logout
2026-01-23 10:46:09 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=9D64803F2BC6DABC061D148D4EB62228], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:46:09 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.logout.LogoutFilter - Logging out [UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=9D64803F2BC6DABC061D148D4EB62228], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:46:09 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.l.SecurityContextLogoutHandler - Invalidated session 7CAB82EDFB9ADDF904031DCC93475CAA
2026-01-23 10:46:09 [http-nio-8080-exec-8] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /login?logout
2026-01-23 10:46:09 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login?logout
2026-01-23 10:46:09 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login?logout
2026-01-23 10:46:09 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-23 10:46:09 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:46:09 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:46:09 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:46:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:46:09 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 170
2026-01-23 10:46:09 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:46:09 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-23 10:46:09 [http-nio-8080-exec-9] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-23 10:46:09 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 170, Tenant anterior: 2
2026-01-23 10:46:09 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 170, Request: /login, Empresa ID anterior: 2
2026-01-23 10:46:13 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-23 10:46:13 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: jose para la empresa ID: null
2026-01-23 10:46:13 [http-nio-8080-exec-10] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: jose | Subdominio: jose
2026-01-23 10:46:13 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:46:13 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:46:13 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: jose | Subdominio: jose | Empresa ID: 2 | Empresa Nombre: Empresa JOse
2026-01-23 10:46:13 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:46:13 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:46:13 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:46:13 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:46:13 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:46:13 [http-nio-8080-exec-10] INFO  j.s.s.servicios.UsuarioServicio - üîê Encontrado usuario: jose
2026-01-23 10:46:13 [http-nio-8080-exec-10] INFO  j.s.s.servicios.UsuarioServicio - üîê Rol: CAJERO
2026-01-23 10:46:13 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - üîê Activo: true
2026-01-23 10:46:13 [http-nio-8080-exec-10] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Authenticated user
2026-01-23 10:46:13 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.s.ChangeSessionIdAuthenticationStrategy - Changed session id from E1932D7C2C8C8A71E618B150DB0EB39F
2026-01-23 10:46:13 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.CsrfAuthenticationStrategy - Replaced CSRF Token
2026-01-23 10:46:13 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Stored SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=jose, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=E1932D7C2C8C8A71E618B150DB0EB39F], Granted Authorities=[ROLE_CAJERO]]] to HttpSession [org.apache.catalina.session.StandardSessionFacade@12dcbf5a]
2026-01-23 10:46:13 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.UsernamePasswordAuthenticationFilter - Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=jose, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=E1932D7C2C8C8A71E618B150DB0EB39F], Granted Authorities=[ROLE_CAJERO]]
2026-01-23 10:46:13 [http-nio-8080-exec-10] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /principal
2026-01-23 10:46:13 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-23 10:46:13 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=jose, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=E1932D7C2C8C8A71E618B150DB0EB39F], Granted Authorities=[ROLE_CAJERO]]]
2026-01-23 10:46:13 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-23 10:46:13 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-23 10:46:13 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:46:13 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:46:13 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:46:13 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:46:13 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 162
2026-01-23 10:46:13 [http-nio-8080-exec-1] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:46:13 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: jose
2026-01-23 10:46:13 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: jose en empresa ID: 2
2026-01-23 10:46:13 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:46:13 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:46:13 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:46:13 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:46:13 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:46:13 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario jose validado para empresa 2
2026-01-23 10:46:13 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-23 10:46:13 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:46:13 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:46:13 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:46:13 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:46:13 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:46:13 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:46:13 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:46:13 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:46:13 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:46:13 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:46:13 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:46:13 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:46:13 [http-nio-8080-exec-1] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-23
2026-01-23 10:46:13 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-23 10:46:13 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:46:13 [http-nio-8080-exec-1] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-23
2026-01-23 10:46:13 [http-nio-8080-exec-1] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-23 10:46:13 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 162, Tenant anterior: 2
2026-01-23 10:46:13 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 162, Request: /principal, Empresa ID anterior: 2
2026-01-23 10:46:15 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios
2026-01-23 10:46:15 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=jose, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=E1932D7C2C8C8A71E618B150DB0EB39F], Granted Authorities=[ROLE_CAJERO]]]
2026-01-23 10:46:15 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios
2026-01-23 10:46:15 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios, M√©todo: GET
2026-01-23 10:46:15 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:46:15 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:46:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:46:15 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:46:15 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 163
2026-01-23 10:46:15 [http-nio-8080-exec-2] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:46:15 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: jose
2026-01-23 10:46:15 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: jose en empresa ID: 2
2026-01-23 10:46:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:46:15 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:46:15 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:46:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:46:15 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:46:15 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario jose validado para empresa 2
2026-01-23 10:46:15 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios, Empresa ID: 2
2026-01-23 10:46:15 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:46:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:46:15 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:46:15 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:46:15 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:46:15 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:46:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:46:15 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:46:15 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:46:15 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:46:15 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:46:15 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:46:15 [http-nio-8080-exec-2] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-23 10:46:15 [http-nio-8080-exec-2] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Failed to authorize ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador] with authorization manager org.springframework.security.authorization.method.PreAuthorizeAuthorizationManager@4adde2a9 and result ExpressionAuthorizationDecision [granted=false, expressionAttribute=hasAnyRole('ADMIN', 'DEV')]
2026-01-23 10:46:15 [http-nio-8080-exec-2] ERROR j.s.s.context.TenantFilter - ‚ùå Error en TenantFilter: Request processing failed: org.springframework.security.authorization.AuthorizationDeniedException: Access Denied
jakarta.servlet.ServletException: Request processing failed: org.springframework.security.authorization.AuthorizationDeniedException: Access Denied
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1022) ~[spring-webmvc-6.2.14.jar:6.2.14]
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903) ~[spring-webmvc-6.2.14.jar:6.2.14]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564) ~[tomcat-embed-core-10.1.49.jar:6.0]
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885) ~[spring-webmvc-6.2.14.jar:6.2.14]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658) ~[tomcat-embed-core-10.1.49.jar:6.0]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51) ~[tomcat-embed-websocket-10.1.49.jar:10.1.49]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at jpd.sistemafacinv.sistemadefacturacioneinventario.context.TenantFilter.doFilter(TenantFilter.java:123) ~[classes/:na]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at jpd.sistemafacinv.sistemadefacturacioneinventario.context.TenantContextCleanupFilter.doFilter(TenantContextCleanupFilter.java:45) ~[classes/:na]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:365) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:101) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:125) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:119) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:235) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:229) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.csrf.CsrfFilter.doFilterInternal(CsrfFilter.java:117) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.web.filter.ServletRequestPathFilter.doFilter(ServletRequestPathFilter.java:52) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebSecurityConfiguration.java:319) ~[spring-security-config-6.5.7.jar:6.5.7]
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$4(HandlerMappingIntrospector.java:267) ~[spring-webmvc-6.2.14.jar:6.2.14]
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:240) ~[spring-security-config-6.5.7.jar:6.5.7]
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:362) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:278) ~[spring-web-6.2.14.jar:6.2.14]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.14.jar:6.2.14]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.14.jar:6.2.14]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.14.jar:6.2.14]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101) ~[spring-web-6.2.14.jar:6.2.14]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:88) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:113) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:83) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:72) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:399) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1774) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:973) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:491) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at java.base/java.lang.Thread.run(Thread.java:840) ~[na:na]
Caused by: org.springframework.security.authorization.AuthorizationDeniedException: Access Denied
	at org.springframework.security.authorization.method.ThrowingMethodAuthorizationDeniedHandler.handleDeniedInvocation(ThrowingMethodAuthorizationDeniedHandler.java:38) ~[spring-security-core-6.5.7.jar:6.5.7]
	at org.springframework.security.authorization.method.PreAuthorizeAuthorizationManager.handleDeniedInvocation(PreAuthorizeAuthorizationManager.java:108) ~[spring-security-core-6.5.7.jar:6.5.7]
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.handle(AuthorizationManagerBeforeMethodInterceptor.java:287) ~[spring-security-core-6.5.7.jar:6.5.7]
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.attemptAuthorization(AuthorizationManagerBeforeMethodInterceptor.java:260) ~[spring-security-core-6.5.7.jar:6.5.7]
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.invoke(AuthorizationManagerBeforeMethodInterceptor.java:196) ~[spring-security-core-6.5.7.jar:6.5.7]
	at org.springframework.security.config.annotation.method.configuration.DeferringMethodInterceptor.invoke(DeferringMethodInterceptor.java:44) ~[spring-security-config-6.5.7.jar:6.5.7]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.14.jar:6.2.14]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.14.jar:6.2.14]
	at jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador$$SpringCGLIB$$0.listarUsuarios(<generated>) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:569) ~[na:na]
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118) ~[spring-webmvc-6.2.14.jar:6.2.14]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991) ~[spring-webmvc-6.2.14.jar:6.2.14]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896) ~[spring-webmvc-6.2.14.jar:6.2.14]
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-6.2.14.jar:6.2.14]
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089) ~[spring-webmvc-6.2.14.jar:6.2.14]
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979) ~[spring-webmvc-6.2.14.jar:6.2.14]
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014) ~[spring-webmvc-6.2.14.jar:6.2.14]
	... 99 common frames omitted
2026-01-23 10:46:15 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 163, Tenant anterior: 2
2026-01-23 10:46:15 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 163, Request: /admin/usuarios, Empresa ID anterior: 2
2026-01-23 10:46:15 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AccessDeniedHandlerImpl - Forwarding to /acceso-denegado with status code 403
2026-01-23 10:46:15 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /acceso-denegado
2026-01-23 10:46:15 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured GET /acceso-denegado
2026-01-23 10:46:15 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /acceso-denegado, Empresa ID: null
2026-01-23 10:46:15 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì Interceptando acceso-denegado - EMPRESA: null
2026-01-23 10:46:15 [http-nio-8080-exec-2] WARN  j.s.s.controladores.InicioController - ‚õî GET /acceso-denigado - Mostrando p√°gina de acceso denegado
2026-01-23 10:46:17 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-23 10:46:17 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=jose, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=E1932D7C2C8C8A71E618B150DB0EB39F], Granted Authorities=[ROLE_CAJERO]]]
2026-01-23 10:46:17 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-23 10:46:17 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-23 10:46:17 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:46:17 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:46:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:46:17 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:46:17 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 164
2026-01-23 10:46:17 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:46:17 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: jose
2026-01-23 10:46:17 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: jose en empresa ID: 2
2026-01-23 10:46:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:46:17 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:46:17 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:46:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:46:17 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:46:17 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario jose validado para empresa 2
2026-01-23 10:46:17 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-23 10:46:17 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:46:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:46:17 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:46:17 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:46:17 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:46:17 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:46:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:46:17 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:46:17 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:46:17 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:46:17 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:46:17 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:46:17 [http-nio-8080-exec-3] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-23
2026-01-23 10:46:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-23 10:46:17 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:46:17 [http-nio-8080-exec-3] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-23
2026-01-23 10:46:17 [http-nio-8080-exec-3] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-23 10:46:17 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 164, Tenant anterior: 2
2026-01-23 10:46:17 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 164, Request: /principal, Empresa ID anterior: 2
2026-01-23 10:46:18 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing POST /logout
2026-01-23 10:46:18 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=jose, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=E1932D7C2C8C8A71E618B150DB0EB39F], Granted Authorities=[ROLE_CAJERO]]]
2026-01-23 10:46:18 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.logout.LogoutFilter - Logging out [UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=jose, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=E1932D7C2C8C8A71E618B150DB0EB39F], Granted Authorities=[ROLE_CAJERO]]]
2026-01-23 10:46:18 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.l.SecurityContextLogoutHandler - Invalidated session 2C5AE1018DB5EF6A29BC012BC6D7CA80
2026-01-23 10:46:18 [http-nio-8080-exec-4] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /login?logout
2026-01-23 10:46:18 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login?logout
2026-01-23 10:46:18 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login?logout
2026-01-23 10:46:18 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-23 10:46:18 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:46:18 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:46:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:46:18 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:46:18 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 166
2026-01-23 10:46:18 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:46:18 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-23 10:46:18 [http-nio-8080-exec-5] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-23 10:46:18 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 166, Tenant anterior: 2
2026-01-23 10:46:18 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 166, Request: /login, Empresa ID anterior: 2
2026-01-23 10:46:23 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-23 10:46:23 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: jose para la empresa ID: null
2026-01-23 10:46:23 [http-nio-8080-exec-6] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: jose | Subdominio: jose
2026-01-23 10:46:23 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:46:23 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:46:23 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: jose | Subdominio: jose | Empresa ID: 2 | Empresa Nombre: Empresa JOse
2026-01-23 10:46:23 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:46:23 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:46:23 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:46:23 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:46:23 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:46:23 [http-nio-8080-exec-6] INFO  j.s.s.servicios.UsuarioServicio - üîê Encontrado usuario: jose
2026-01-23 10:46:23 [http-nio-8080-exec-6] INFO  j.s.s.servicios.UsuarioServicio - üîê Rol: CAJERO
2026-01-23 10:46:23 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - üîê Activo: true
2026-01-23 10:46:23 [http-nio-8080-exec-6] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Failed to authenticate since password does not match stored value
2026-01-23 10:46:23 [http-nio-8080-exec-6] DEBUG o.s.s.authentication.ProviderManager - Authentication failed with provider DaoAuthenticationProvider since Bad credentials
2026-01-23 10:46:23 [http-nio-8080-exec-6] DEBUG o.s.s.authentication.ProviderManager - Denying authentication since all attempted providers failed
2026-01-23 10:46:23 [http-nio-8080-exec-6] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /login?error
2026-01-23 10:46:23 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login?error
2026-01-23 10:46:23 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login?error
2026-01-23 10:46:23 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-23 10:46:23 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:46:23 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:46:23 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:46:23 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:46:23 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 168
2026-01-23 10:46:23 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:46:23 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-23 10:46:23 [http-nio-8080-exec-7] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-23 10:46:23 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 168, Tenant anterior: 2
2026-01-23 10:46:23 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 168, Request: /login, Empresa ID anterior: 2
2026-01-23 10:46:27 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-23 10:46:27 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: jose para la empresa ID: null
2026-01-23 10:46:27 [http-nio-8080-exec-8] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: jose | Subdominio: jose
2026-01-23 10:46:27 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:46:27 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:46:27 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: jose | Subdominio: jose | Empresa ID: 2 | Empresa Nombre: Empresa JOse
2026-01-23 10:46:27 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:46:27 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:46:27 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:46:27 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:46:27 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:46:27 [http-nio-8080-exec-8] INFO  j.s.s.servicios.UsuarioServicio - üîê Encontrado usuario: jose
2026-01-23 10:46:27 [http-nio-8080-exec-8] INFO  j.s.s.servicios.UsuarioServicio - üîê Rol: CAJERO
2026-01-23 10:46:27 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - üîê Activo: true
2026-01-23 10:46:27 [http-nio-8080-exec-8] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Authenticated user
2026-01-23 10:46:27 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.s.ChangeSessionIdAuthenticationStrategy - Changed session id from 0FB7C6316FB2834EAF0F25852D092C7C
2026-01-23 10:46:27 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.CsrfAuthenticationStrategy - Replaced CSRF Token
2026-01-23 10:46:27 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Stored SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=jose, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=0FB7C6316FB2834EAF0F25852D092C7C], Granted Authorities=[ROLE_CAJERO]]] to HttpSession [org.apache.catalina.session.StandardSessionFacade@67ba4bed]
2026-01-23 10:46:27 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.UsernamePasswordAuthenticationFilter - Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=jose, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=0FB7C6316FB2834EAF0F25852D092C7C], Granted Authorities=[ROLE_CAJERO]]
2026-01-23 10:46:27 [http-nio-8080-exec-8] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /principal
2026-01-23 10:46:27 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-23 10:46:27 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=jose, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=0FB7C6316FB2834EAF0F25852D092C7C], Granted Authorities=[ROLE_CAJERO]]]
2026-01-23 10:46:27 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-23 10:46:27 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-23 10:46:27 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:46:27 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:46:27 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:46:27 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:46:27 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 170
2026-01-23 10:46:27 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:46:27 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: jose
2026-01-23 10:46:27 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: jose en empresa ID: 2
2026-01-23 10:46:27 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:46:27 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:46:27 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:46:27 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:46:27 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:46:27 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario jose validado para empresa 2
2026-01-23 10:46:27 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-23 10:46:27 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:46:27 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:46:27 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:46:27 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:46:27 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:46:27 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:46:27 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:46:27 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:46:27 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:46:27 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:46:27 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:46:27 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:46:27 [http-nio-8080-exec-9] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-23
2026-01-23 10:46:27 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-23 10:46:27 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:46:27 [http-nio-8080-exec-9] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-23
2026-01-23 10:46:27 [http-nio-8080-exec-9] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-23 10:46:27 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 170, Tenant anterior: 2
2026-01-23 10:46:27 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 170, Request: /principal, Empresa ID anterior: 2
2026-01-23 10:46:29 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios
2026-01-23 10:46:29 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=jose, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=0FB7C6316FB2834EAF0F25852D092C7C], Granted Authorities=[ROLE_CAJERO]]]
2026-01-23 10:46:29 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios
2026-01-23 10:46:29 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios, M√©todo: GET
2026-01-23 10:46:29 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:46:29 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:46:29 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:46:29 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:46:29 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 171
2026-01-23 10:46:29 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:46:29 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: jose
2026-01-23 10:46:29 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: jose en empresa ID: 2
2026-01-23 10:46:29 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:46:29 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:46:29 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:46:29 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:46:29 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:46:29 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario jose validado para empresa 2
2026-01-23 10:46:29 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios, Empresa ID: 2
2026-01-23 10:46:29 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:46:29 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:46:29 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:46:29 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:46:29 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:46:29 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:46:29 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:46:29 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:46:29 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:46:29 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:46:29 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:46:29 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:46:29 [http-nio-8080-exec-10] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-23 10:46:29 [http-nio-8080-exec-10] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Failed to authorize ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador] with authorization manager org.springframework.security.authorization.method.PreAuthorizeAuthorizationManager@4adde2a9 and result ExpressionAuthorizationDecision [granted=false, expressionAttribute=hasAnyRole('ADMIN', 'DEV')]
2026-01-23 10:46:29 [http-nio-8080-exec-10] ERROR j.s.s.context.TenantFilter - ‚ùå Error en TenantFilter: Request processing failed: org.springframework.security.authorization.AuthorizationDeniedException: Access Denied
jakarta.servlet.ServletException: Request processing failed: org.springframework.security.authorization.AuthorizationDeniedException: Access Denied
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1022) ~[spring-webmvc-6.2.14.jar:6.2.14]
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903) ~[spring-webmvc-6.2.14.jar:6.2.14]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564) ~[tomcat-embed-core-10.1.49.jar:6.0]
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885) ~[spring-webmvc-6.2.14.jar:6.2.14]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658) ~[tomcat-embed-core-10.1.49.jar:6.0]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51) ~[tomcat-embed-websocket-10.1.49.jar:10.1.49]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at jpd.sistemafacinv.sistemadefacturacioneinventario.context.TenantFilter.doFilter(TenantFilter.java:123) ~[classes/:na]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at jpd.sistemafacinv.sistemadefacturacioneinventario.context.TenantContextCleanupFilter.doFilter(TenantContextCleanupFilter.java:45) ~[classes/:na]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:365) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:101) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:125) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:119) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:235) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:229) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.csrf.CsrfFilter.doFilterInternal(CsrfFilter.java:117) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191) ~[spring-security-web-6.5.7.jar:6.5.7]
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.web.filter.ServletRequestPathFilter.doFilter(ServletRequestPathFilter.java:52) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebSecurityConfiguration.java:319) ~[spring-security-config-6.5.7.jar:6.5.7]
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$4(HandlerMappingIntrospector.java:267) ~[spring-webmvc-6.2.14.jar:6.2.14]
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:240) ~[spring-security-config-6.5.7.jar:6.5.7]
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:362) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:278) ~[spring-web-6.2.14.jar:6.2.14]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.14.jar:6.2.14]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.14.jar:6.2.14]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.14.jar:6.2.14]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101) ~[spring-web-6.2.14.jar:6.2.14]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:88) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:113) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:83) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:72) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:399) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1774) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:973) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:491) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63) ~[tomcat-embed-core-10.1.49.jar:10.1.49]
	at java.base/java.lang.Thread.run(Thread.java:840) ~[na:na]
Caused by: org.springframework.security.authorization.AuthorizationDeniedException: Access Denied
	at org.springframework.security.authorization.method.ThrowingMethodAuthorizationDeniedHandler.handleDeniedInvocation(ThrowingMethodAuthorizationDeniedHandler.java:38) ~[spring-security-core-6.5.7.jar:6.5.7]
	at org.springframework.security.authorization.method.PreAuthorizeAuthorizationManager.handleDeniedInvocation(PreAuthorizeAuthorizationManager.java:108) ~[spring-security-core-6.5.7.jar:6.5.7]
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.handle(AuthorizationManagerBeforeMethodInterceptor.java:287) ~[spring-security-core-6.5.7.jar:6.5.7]
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.attemptAuthorization(AuthorizationManagerBeforeMethodInterceptor.java:260) ~[spring-security-core-6.5.7.jar:6.5.7]
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.invoke(AuthorizationManagerBeforeMethodInterceptor.java:196) ~[spring-security-core-6.5.7.jar:6.5.7]
	at org.springframework.security.config.annotation.method.configuration.DeferringMethodInterceptor.invoke(DeferringMethodInterceptor.java:44) ~[spring-security-config-6.5.7.jar:6.5.7]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.14.jar:6.2.14]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.14.jar:6.2.14]
	at jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador$$SpringCGLIB$$0.listarUsuarios(<generated>) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:569) ~[na:na]
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191) ~[spring-web-6.2.14.jar:6.2.14]
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118) ~[spring-webmvc-6.2.14.jar:6.2.14]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991) ~[spring-webmvc-6.2.14.jar:6.2.14]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896) ~[spring-webmvc-6.2.14.jar:6.2.14]
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-6.2.14.jar:6.2.14]
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089) ~[spring-webmvc-6.2.14.jar:6.2.14]
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979) ~[spring-webmvc-6.2.14.jar:6.2.14]
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014) ~[spring-webmvc-6.2.14.jar:6.2.14]
	... 99 common frames omitted
2026-01-23 10:46:29 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 171, Tenant anterior: 2
2026-01-23 10:46:29 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 171, Request: /admin/usuarios, Empresa ID anterior: 2
2026-01-23 10:46:29 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AccessDeniedHandlerImpl - Forwarding to /acceso-denegado with status code 403
2026-01-23 10:46:29 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /acceso-denegado
2026-01-23 10:46:29 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /acceso-denegado
2026-01-23 10:46:29 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /acceso-denegado, Empresa ID: null
2026-01-23 10:46:29 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì Interceptando acceso-denegado - EMPRESA: null
2026-01-23 10:46:29 [http-nio-8080-exec-10] WARN  j.s.s.controladores.InicioController - ‚õî GET /acceso-denigado - Mostrando p√°gina de acceso denegado
2026-01-23 10:46:30 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /logout
2026-01-23 10:46:30 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=jose, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=0FB7C6316FB2834EAF0F25852D092C7C], Granted Authorities=[ROLE_CAJERO]]]
2026-01-23 10:46:30 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.logout.LogoutFilter - Logging out [UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=jose, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=0FB7C6316FB2834EAF0F25852D092C7C], Granted Authorities=[ROLE_CAJERO]]]
2026-01-23 10:46:30 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.l.SecurityContextLogoutHandler - Invalidated session 5A120DCC0D4B219969D65FFE4F8472D1
2026-01-23 10:46:30 [http-nio-8080-exec-1] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /login?logout
2026-01-23 10:46:30 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login?logout
2026-01-23 10:46:30 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login?logout
2026-01-23 10:46:30 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-23 10:46:30 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:46:30 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:46:30 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:46:30 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:46:30 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 163
2026-01-23 10:46:30 [http-nio-8080-exec-2] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:46:30 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-23 10:46:30 [http-nio-8080-exec-2] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-23 10:46:30 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 163, Tenant anterior: 2
2026-01-23 10:46:30 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 163, Request: /login, Empresa ID anterior: 2
2026-01-23 10:46:35 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-23 10:46:35 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: admin para la empresa ID: null
2026-01-23 10:46:35 [http-nio-8080-exec-3] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: jose
2026-01-23 10:46:35 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:46:35 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:46:35 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: jose | Empresa ID: 2 | Empresa Nombre: Empresa JOse
2026-01-23 10:46:35 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:46:35 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:46:35 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:46:35 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:46:35 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:46:35 [http-nio-8080-exec-3] INFO  j.s.s.servicios.UsuarioServicio - üîê Encontrado usuario: admin
2026-01-23 10:46:35 [http-nio-8080-exec-3] INFO  j.s.s.servicios.UsuarioServicio - üîê Rol: ADMIN
2026-01-23 10:46:35 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - üîê Activo: true
2026-01-23 10:46:35 [http-nio-8080-exec-3] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Authenticated user
2026-01-23 10:46:35 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.s.ChangeSessionIdAuthenticationStrategy - Changed session id from A11F72C660D79CD7E9F90113C122D160
2026-01-23 10:46:35 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.CsrfAuthenticationStrategy - Replaced CSRF Token
2026-01-23 10:46:35 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Stored SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A11F72C660D79CD7E9F90113C122D160], Granted Authorities=[ROLE_ADMIN]]] to HttpSession [org.apache.catalina.session.StandardSessionFacade@3f8771c7]
2026-01-23 10:46:35 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.UsernamePasswordAuthenticationFilter - Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A11F72C660D79CD7E9F90113C122D160], Granted Authorities=[ROLE_ADMIN]]
2026-01-23 10:46:35 [http-nio-8080-exec-3] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /principal
2026-01-23 10:46:35 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-23 10:46:35 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A11F72C660D79CD7E9F90113C122D160], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:46:35 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-23 10:46:35 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-23 10:46:35 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:46:35 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:46:35 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:46:35 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:46:35 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 165
2026-01-23 10:46:35 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:46:35 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:46:35 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:46:35 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:46:35 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:46:35 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:46:35 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:46:35 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:46:35 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:46:35 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-23 10:46:35 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:46:35 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:46:35 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:46:35 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:46:35 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:46:35 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:46:35 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:46:35 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:46:35 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:46:35 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:46:35 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:46:35 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:46:35 [http-nio-8080-exec-4] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-23
2026-01-23 10:46:35 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-23 10:46:35 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:46:35 [http-nio-8080-exec-4] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-23
2026-01-23 10:46:35 [http-nio-8080-exec-4] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-23 10:46:35 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 165, Tenant anterior: 2
2026-01-23 10:46:35 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 165, Request: /principal, Empresa ID anterior: 2
2026-01-23 10:46:36 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios
2026-01-23 10:46:36 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A11F72C660D79CD7E9F90113C122D160], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:46:36 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios
2026-01-23 10:46:36 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios, M√©todo: GET
2026-01-23 10:46:36 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:46:36 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:46:36 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:46:36 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:46:36 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 166
2026-01-23 10:46:36 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:46:36 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:46:36 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:46:36 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:46:36 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:46:36 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:46:36 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:46:36 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:46:36 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:46:36 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios, Empresa ID: 2
2026-01-23 10:46:36 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:46:36 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:46:36 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:46:36 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:46:36 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:46:36 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:46:36 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:46:36 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:46:36 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:46:36 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:46:36 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:46:36 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:46:36 [http-nio-8080-exec-5] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-23 10:46:36 [http-nio-8080-exec-5] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-23 10:46:36 [http-nio-8080-exec-5] INFO  j.s.s.c.UsuarioControlador - üìã GET /admin/usuarios - Listando usuarios
2026-01-23 10:46:36 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Listando usuarios para empresa ID: 2
2026-01-23 10:46:36 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:46:36 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:46:36 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:46:36 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:46:36 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 166, Tenant anterior: 2
2026-01-23 10:46:36 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 166, Request: /admin/usuarios, Empresa ID anterior: 2
2026-01-23 10:46:38 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios/editar/5
2026-01-23 10:46:38 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A11F72C660D79CD7E9F90113C122D160], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:46:38 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios/editar/5
2026-01-23 10:46:38 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios/editar/5, M√©todo: GET
2026-01-23 10:46:38 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:46:38 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:46:38 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:46:38 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:46:38 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 167
2026-01-23 10:46:38 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:46:38 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:46:38 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:46:38 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:46:38 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:46:38 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:46:38 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:46:38 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:46:38 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:46:38 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios/editar/5, Empresa ID: 2
2026-01-23 10:46:38 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:46:38 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:46:38 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:46:38 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:46:38 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:46:38 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:46:38 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:46:38 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:46:38 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:46:38 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:46:38 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:46:38 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:46:38 [http-nio-8080-exec-6] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.mostrarFormularioEditar(java.lang.Long,org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-23 10:46:38 [http-nio-8080-exec-6] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.mostrarFormularioEditar(java.lang.Long,org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-23 10:46:38 [http-nio-8080-exec-6] INFO  j.s.s.c.UsuarioControlador - ‚úèÔ∏è GET /admin/usuarios/editar/5 - Editando usuario
2026-01-23 10:46:38 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Obteniendo usuario ID: 5 para empresa ID: 2
2026-01-23 10:46:38 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        u1_0.id=? 
        and e1_0.id=?
2026-01-23 10:46:38 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-23 10:46:38 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:46:38 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:46:38 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:46:38 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 167, Tenant anterior: 2
2026-01-23 10:46:38 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 167, Request: /admin/usuarios/editar/5, Empresa ID anterior: 2
2026-01-23 10:46:45 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing POST /admin/usuarios/actualizar/5
2026-01-23 10:46:45 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A11F72C660D79CD7E9F90113C122D160], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:46:45 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured POST /admin/usuarios/actualizar/5
2026-01-23 10:46:45 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios/actualizar/5, M√©todo: POST
2026-01-23 10:46:45 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:46:45 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:46:45 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:46:45 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:46:45 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 168
2026-01-23 10:46:45 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:46:45 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:46:45 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:46:45 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:46:45 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:46:45 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:46:45 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:46:45 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:46:45 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:46:45 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios/actualizar/5, Empresa ID: 2
2026-01-23 10:46:45 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:46:45 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:46:45 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:46:45 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:46:45 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:46:45 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:46:45 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:46:45 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:46:45 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:46:45 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:46:45 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:46:45 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:46:45 [http-nio-8080-exec-7] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.actualizarUsuario(java.lang.Long,jpd.sistemafacinv.sistemadefacturacioneinventario.modelos.Usuario,java.lang.String,java.lang.String,org.springframework.web.servlet.mvc.support.RedirectAttributes); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-23 10:46:45 [http-nio-8080-exec-7] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.actualizarUsuario(java.lang.Long,jpd.sistemafacinv.sistemadefacturacioneinventario.modelos.Usuario,java.lang.String,java.lang.String,org.springframework.web.servlet.mvc.support.RedirectAttributes); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-23 10:46:45 [http-nio-8080-exec-7] INFO  j.s.s.c.UsuarioControlador - üîÑ POST /admin/usuarios/actualizar/5 - Actualizando usuario
2026-01-23 10:46:45 [http-nio-8080-exec-7] DEBUG j.s.s.c.UsuarioControlador - Usuario autenticado: admin, Roles: [ROLE_ADMIN]
2026-01-23 10:46:45 [http-nio-8080-exec-7] DEBUG j.s.s.c.UsuarioControlador - Contrase√±a actualizada para usuario ID: 5
2026-01-23 10:46:45 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Obteniendo usuario ID: 5 para empresa ID: 2
2026-01-23 10:46:45 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        u1_0.id=? 
        and e1_0.id=?
2026-01-23 10:46:45 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-23 10:46:45 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:46:45 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:46:45 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:46:45 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Actualizando usuario ID: 5 en empresa ID: 2
2026-01-23 10:46:45 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        u1_0.id=? 
        and e1_0.id=?
2026-01-23 10:46:45 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-23 10:46:45 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:46:45 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:46:45 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:46:45 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Actualizando contrase√±a para usuario ID: 5
2026-01-23 10:46:45 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-23 10:46:45 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-23 10:46:45 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    update
        usuario 
    set
        activo=?,
        contrasenna=?,
        empresa_id=?,
        nombre_usuario=?,
        rol=?,
        sucursal_id=? 
    where
        id=?
2026-01-23 10:46:45 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-23 10:46:45 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [$2a$10$2qH/DDvcPUmqfsRjkzxDtOlUQAjrAss0ZZ7u52j6seizlHXtvQQ8.]
2026-01-23 10:46:45 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:46:45 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [admin]
2026-01-23 10:46:45 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [ADMIN]
2026-01-23 10:46:45 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:BIGINT) <- [null]
2026-01-23 10:46:45 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:BIGINT) <- [5]
2026-01-23 10:46:45 [http-nio-8080-exec-7] INFO  j.s.s.servicios.UsuarioServicio - Usuario actualizado exitosamente: admin (ID: 5)
2026-01-23 10:46:45 [http-nio-8080-exec-7] INFO  j.s.s.c.UsuarioControlador - ‚úÖ Usuario actualizado exitosamente ID: 5 - Nuevo rol: ADMIN
2026-01-23 10:46:45 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 168, Tenant anterior: 2
2026-01-23 10:46:45 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 168, Request: /admin/usuarios/actualizar/5, Empresa ID anterior: 2
2026-01-23 10:46:45 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios
2026-01-23 10:46:45 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A11F72C660D79CD7E9F90113C122D160], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:46:45 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios
2026-01-23 10:46:45 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios, M√©todo: GET
2026-01-23 10:46:45 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:46:45 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:46:45 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:46:45 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:46:45 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 169
2026-01-23 10:46:45 [http-nio-8080-exec-8] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:46:45 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:46:45 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:46:45 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:46:45 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:46:45 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:46:45 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:46:45 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:46:45 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:46:45 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios, Empresa ID: 2
2026-01-23 10:46:45 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:46:45 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:46:45 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:46:45 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:46:45 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:46:45 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:46:45 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:46:45 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:46:45 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:46:45 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:46:45 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:46:45 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:46:45 [http-nio-8080-exec-8] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-23 10:46:45 [http-nio-8080-exec-8] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-23 10:46:45 [http-nio-8080-exec-8] INFO  j.s.s.c.UsuarioControlador - üìã GET /admin/usuarios - Listando usuarios
2026-01-23 10:46:45 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Listando usuarios para empresa ID: 2
2026-01-23 10:46:45 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:46:45 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:46:45 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:46:45 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:46:45 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 169, Tenant anterior: 2
2026-01-23 10:46:45 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 169, Request: /admin/usuarios, Empresa ID anterior: 2
2026-01-23 10:46:46 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-23 10:46:46 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A11F72C660D79CD7E9F90113C122D160], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:46:46 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-23 10:46:46 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-23 10:46:46 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:46:46 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:46:46 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:46:46 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:46:46 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 170
2026-01-23 10:46:46 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:46:46 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:46:46 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:46:46 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:46:46 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:46:46 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:46:46 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:46:46 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:46:46 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:46:46 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-23 10:46:46 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:46:46 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:46:46 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:46:46 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:46:46 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:46:46 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:46:46 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:46:46 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:46:46 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:46:46 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:46:46 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:46:46 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:46:46 [http-nio-8080-exec-9] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-23
2026-01-23 10:46:46 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-23 10:46:46 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:46:46 [http-nio-8080-exec-9] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-23
2026-01-23 10:46:46 [http-nio-8080-exec-9] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-23 10:46:46 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 170, Tenant anterior: 2
2026-01-23 10:46:46 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 170, Request: /principal, Empresa ID anterior: 2
2026-01-23 10:46:47 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing POST /logout
2026-01-23 10:46:47 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A11F72C660D79CD7E9F90113C122D160], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:46:47 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.logout.LogoutFilter - Logging out [UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A11F72C660D79CD7E9F90113C122D160], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:46:47 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.l.SecurityContextLogoutHandler - Invalidated session 793CB169ABC9536D2BC9639C31F899DE
2026-01-23 10:46:47 [http-nio-8080-exec-10] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /login?logout
2026-01-23 10:46:47 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login?logout
2026-01-23 10:46:47 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login?logout
2026-01-23 10:46:47 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-23 10:46:47 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:46:47 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:46:47 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:46:47 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:46:47 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 162
2026-01-23 10:46:47 [http-nio-8080-exec-1] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:46:47 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-23 10:46:47 [http-nio-8080-exec-1] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-23 10:46:47 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 162, Tenant anterior: 2
2026-01-23 10:46:47 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 162, Request: /login, Empresa ID anterior: 2
2026-01-23 10:46:53 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-23 10:46:53 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: admin para la empresa ID: null
2026-01-23 10:46:53 [http-nio-8080-exec-2] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: jose
2026-01-23 10:46:53 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:46:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:46:53 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: jose | Empresa ID: 2 | Empresa Nombre: Empresa JOse
2026-01-23 10:46:53 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:46:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:46:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:46:53 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:46:53 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:46:53 [http-nio-8080-exec-2] INFO  j.s.s.servicios.UsuarioServicio - üîê Encontrado usuario: admin
2026-01-23 10:46:53 [http-nio-8080-exec-2] INFO  j.s.s.servicios.UsuarioServicio - üîê Rol: ADMIN
2026-01-23 10:46:53 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - üîê Activo: true
2026-01-23 10:46:53 [http-nio-8080-exec-2] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Failed to authenticate since password does not match stored value
2026-01-23 10:46:53 [http-nio-8080-exec-2] DEBUG o.s.s.authentication.ProviderManager - Authentication failed with provider DaoAuthenticationProvider since Bad credentials
2026-01-23 10:46:53 [http-nio-8080-exec-2] DEBUG o.s.s.authentication.ProviderManager - Denying authentication since all attempted providers failed
2026-01-23 10:46:53 [http-nio-8080-exec-2] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /login?error
2026-01-23 10:46:53 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login?error
2026-01-23 10:46:53 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login?error
2026-01-23 10:46:53 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-23 10:46:53 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:46:53 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:46:53 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:46:53 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:46:53 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 164
2026-01-23 10:46:53 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:46:53 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-23 10:46:53 [http-nio-8080-exec-3] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-23 10:46:53 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 164, Tenant anterior: 2
2026-01-23 10:46:53 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 164, Request: /login, Empresa ID anterior: 2
2026-01-23 10:46:57 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-23 10:46:57 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: admin para la empresa ID: null
2026-01-23 10:46:57 [http-nio-8080-exec-4] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: jose
2026-01-23 10:46:57 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:46:57 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:46:57 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: jose | Empresa ID: 2 | Empresa Nombre: Empresa JOse
2026-01-23 10:46:57 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:46:57 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:46:57 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:46:57 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:46:57 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:46:57 [http-nio-8080-exec-4] INFO  j.s.s.servicios.UsuarioServicio - üîê Encontrado usuario: admin
2026-01-23 10:46:57 [http-nio-8080-exec-4] INFO  j.s.s.servicios.UsuarioServicio - üîê Rol: ADMIN
2026-01-23 10:46:57 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - üîê Activo: true
2026-01-23 10:46:57 [http-nio-8080-exec-4] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Authenticated user
2026-01-23 10:46:57 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.s.ChangeSessionIdAuthenticationStrategy - Changed session id from 29879B214A291DA8C9F8881B16370065
2026-01-23 10:46:57 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.CsrfAuthenticationStrategy - Replaced CSRF Token
2026-01-23 10:46:57 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Stored SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=29879B214A291DA8C9F8881B16370065], Granted Authorities=[ROLE_ADMIN]]] to HttpSession [org.apache.catalina.session.StandardSessionFacade@2041ac17]
2026-01-23 10:46:57 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.UsernamePasswordAuthenticationFilter - Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=29879B214A291DA8C9F8881B16370065], Granted Authorities=[ROLE_ADMIN]]
2026-01-23 10:46:57 [http-nio-8080-exec-4] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /principal
2026-01-23 10:46:57 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-23 10:46:57 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=29879B214A291DA8C9F8881B16370065], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:46:57 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-23 10:46:57 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-23 10:46:57 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:46:57 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:46:57 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:46:57 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:46:57 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 166
2026-01-23 10:46:57 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:46:57 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:46:57 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:46:57 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:46:57 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:46:57 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:46:57 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:46:57 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:46:57 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:46:57 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-23 10:46:57 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:46:57 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:46:57 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:46:57 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:46:57 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:46:57 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:46:57 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:46:57 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:46:57 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:46:57 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:46:57 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:46:57 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:46:57 [http-nio-8080-exec-5] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-23
2026-01-23 10:46:57 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-23 10:46:57 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:46:57 [http-nio-8080-exec-5] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-23
2026-01-23 10:46:57 [http-nio-8080-exec-5] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-23 10:46:57 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 166, Tenant anterior: 2
2026-01-23 10:46:57 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 166, Request: /principal, Empresa ID anterior: 2
2026-01-23 10:47:05 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /logout
2026-01-23 10:47:05 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=8D61E703D2250066D40A110E07A06444], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-23 10:47:05 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.logout.LogoutFilter - Logging out [UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=8D61E703D2250066D40A110E07A06444], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-23 10:47:05 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.l.SecurityContextLogoutHandler - Invalidated session D5FE7696B2F72BDF4E75D2C3738A9421
2026-01-23 10:47:05 [http-nio-8080-exec-6] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /login?logout
2026-01-23 10:47:05 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login?logout
2026-01-23 10:47:05 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login?logout
2026-01-23 10:47:05 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-23 10:47:05 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: localhost
2026-01-23 10:47:05 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: localhost
2026-01-23 10:47:05 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:47:05 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-23 10:47:05 [http-nio-8080-exec-7] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@907033395 wrapping com.mysql.cj.jdbc.ConnectionImpl@72ce6d41] read-only
2026-01-23 10:47:05 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:47:05 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:47:05 [http-nio-8080-exec-7] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@907033395 wrapping com.mysql.cj.jdbc.ConnectionImpl@72ce6d41]
2026-01-23 10:47:05 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 168
2026-01-23 10:47:05 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚ö†Ô∏è Usando empresa por defecto (localhost): 1 - Sistema por Defecto
2026-01-23 10:47:05 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-23 10:47:05 [http-nio-8080-exec-7] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-23 10:47:05 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 168, Tenant anterior: 1
2026-01-23 10:47:05 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 168, Request: /login, Empresa ID anterior: 1
2026-01-23 10:47:05 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-23 10:47:05 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-23 10:47:05 [http-nio-8080-exec-8] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to http://localhost:8080/login
2026-01-23 10:47:05 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login
2026-01-23 10:47:05 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login
2026-01-23 10:47:05 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-23 10:47:05 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: localhost
2026-01-23 10:47:05 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: localhost
2026-01-23 10:47:05 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:47:05 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-23 10:47:05 [http-nio-8080-exec-9] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@1324359473 wrapping com.mysql.cj.jdbc.ConnectionImpl@72ce6d41] read-only
2026-01-23 10:47:05 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:47:05 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:47:05 [http-nio-8080-exec-9] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@1324359473 wrapping com.mysql.cj.jdbc.ConnectionImpl@72ce6d41]
2026-01-23 10:47:05 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 170
2026-01-23 10:47:05 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚ö†Ô∏è Usando empresa por defecto (localhost): 1 - Sistema por Defecto
2026-01-23 10:47:05 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-23 10:47:05 [http-nio-8080-exec-9] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-23 10:47:05 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 170, Tenant anterior: 1
2026-01-23 10:47:05 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 170, Request: /login, Empresa ID anterior: 1
2026-01-23 10:47:32 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-23 10:47:32 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: admin para la empresa ID: null
2026-01-23 10:47:32 [http-nio-8080-exec-10] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: localhost
2026-01-23 10:47:32 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:47:32 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-23 10:47:32 [http-nio-8080-exec-10] ERROR j.s.s.servicios.UsuarioServicio - Empresa no encontrada para subdominio: localhost
2026-01-23 10:47:32 [http-nio-8080-exec-10] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Failed to find user 'admin'
2026-01-23 10:47:32 [http-nio-8080-exec-10] DEBUG o.s.s.authentication.ProviderManager - Authentication failed with provider DaoAuthenticationProvider since Bad credentials
2026-01-23 10:47:32 [http-nio-8080-exec-10] DEBUG o.s.s.authentication.ProviderManager - Denying authentication since all attempted providers failed
2026-01-23 10:47:32 [http-nio-8080-exec-10] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /login?error
2026-01-23 10:47:32 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login?error
2026-01-23 10:47:32 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login?error
2026-01-23 10:47:32 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-23 10:47:32 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üåê Server Name: localhost
2026-01-23 10:47:32 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: localhost
2026-01-23 10:47:32 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:47:32 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-23 10:47:32 [http-nio-8080-exec-1] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@1002208080 wrapping com.mysql.cj.jdbc.ConnectionImpl@72ce6d41] read-only
2026-01-23 10:47:32 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:47:32 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:47:32 [http-nio-8080-exec-1] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@1002208080 wrapping com.mysql.cj.jdbc.ConnectionImpl@72ce6d41]
2026-01-23 10:47:32 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 162
2026-01-23 10:47:32 [http-nio-8080-exec-1] INFO  j.s.s.context.TenantFilter - ‚ö†Ô∏è Usando empresa por defecto (localhost): 1 - Sistema por Defecto
2026-01-23 10:47:32 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-23 10:47:32 [http-nio-8080-exec-1] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-23 10:47:32 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 162, Tenant anterior: 1
2026-01-23 10:47:32 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 162, Request: /login, Empresa ID anterior: 1
2026-01-23 10:47:32 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-23 10:47:32 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-23 10:47:32 [http-nio-8080-exec-2] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to http://localhost:8080/login
2026-01-23 10:47:32 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login
2026-01-23 10:47:32 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login
2026-01-23 10:47:32 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-23 10:47:32 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: localhost
2026-01-23 10:47:32 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: localhost
2026-01-23 10:47:32 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:47:32 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-23 10:47:32 [http-nio-8080-exec-3] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@209837757 wrapping com.mysql.cj.jdbc.ConnectionImpl@72ce6d41] read-only
2026-01-23 10:47:32 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:47:32 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:47:32 [http-nio-8080-exec-3] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@209837757 wrapping com.mysql.cj.jdbc.ConnectionImpl@72ce6d41]
2026-01-23 10:47:32 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 164
2026-01-23 10:47:32 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚ö†Ô∏è Usando empresa por defecto (localhost): 1 - Sistema por Defecto
2026-01-23 10:47:32 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-23 10:47:32 [http-nio-8080-exec-3] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-23 10:47:32 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 164, Tenant anterior: 1
2026-01-23 10:47:32 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 164, Request: /login, Empresa ID anterior: 1
2026-01-23 10:47:36 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-23 10:47:36 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: admin para la empresa ID: null
2026-01-23 10:47:36 [http-nio-8080-exec-4] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: localhost
2026-01-23 10:47:36 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:47:36 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-23 10:47:36 [http-nio-8080-exec-4] ERROR j.s.s.servicios.UsuarioServicio - Empresa no encontrada para subdominio: localhost
2026-01-23 10:47:36 [http-nio-8080-exec-4] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Failed to find user 'admin'
2026-01-23 10:47:36 [http-nio-8080-exec-4] DEBUG o.s.s.authentication.ProviderManager - Authentication failed with provider DaoAuthenticationProvider since Bad credentials
2026-01-23 10:47:36 [http-nio-8080-exec-4] DEBUG o.s.s.authentication.ProviderManager - Denying authentication since all attempted providers failed
2026-01-23 10:47:36 [http-nio-8080-exec-4] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /login?error
2026-01-23 10:47:36 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login?error
2026-01-23 10:47:36 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login?error
2026-01-23 10:47:36 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-23 10:47:36 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: localhost
2026-01-23 10:47:36 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: localhost
2026-01-23 10:47:36 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:47:36 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-23 10:47:36 [http-nio-8080-exec-5] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@2056717019 wrapping com.mysql.cj.jdbc.ConnectionImpl@72ce6d41] read-only
2026-01-23 10:47:36 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:47:36 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:47:36 [http-nio-8080-exec-5] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@2056717019 wrapping com.mysql.cj.jdbc.ConnectionImpl@72ce6d41]
2026-01-23 10:47:36 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 166
2026-01-23 10:47:36 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚ö†Ô∏è Usando empresa por defecto (localhost): 1 - Sistema por Defecto
2026-01-23 10:47:36 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-23 10:47:36 [http-nio-8080-exec-5] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-23 10:47:36 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 166, Tenant anterior: 1
2026-01-23 10:47:36 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 166, Request: /login, Empresa ID anterior: 1
2026-01-23 10:47:36 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-23 10:47:36 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-23 10:47:36 [http-nio-8080-exec-6] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to http://localhost:8080/login
2026-01-23 10:47:36 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login
2026-01-23 10:47:36 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login
2026-01-23 10:47:36 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-23 10:47:36 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: localhost
2026-01-23 10:47:36 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: localhost
2026-01-23 10:47:36 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:47:36 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-23 10:47:36 [http-nio-8080-exec-7] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@1512633670 wrapping com.mysql.cj.jdbc.ConnectionImpl@72ce6d41] read-only
2026-01-23 10:47:36 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:47:36 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:47:36 [http-nio-8080-exec-7] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@1512633670 wrapping com.mysql.cj.jdbc.ConnectionImpl@72ce6d41]
2026-01-23 10:47:36 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 168
2026-01-23 10:47:36 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚ö†Ô∏è Usando empresa por defecto (localhost): 1 - Sistema por Defecto
2026-01-23 10:47:36 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-23 10:47:36 [http-nio-8080-exec-7] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-23 10:47:36 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 168, Tenant anterior: 1
2026-01-23 10:47:36 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 168, Request: /login, Empresa ID anterior: 1
2026-01-23 10:47:41 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/login
2026-01-23 10:47:41 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/login
2026-01-23 10:47:41 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/login
2026-01-23 10:47:41 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/login, Empresa ID: null
2026-01-23 10:47:41 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/login
2026-01-23 10:47:41 [http-nio-8080-exec-8] INFO  j.s.s.c.SuperAdminController - üîì Mostrando p√°gina de login para SUPER_ADMIN
2026-01-23 10:47:41 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-23 10:47:41 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 169, Request: /superadmin/login, Empresa ID anterior: null
2026-01-23 10:47:41 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-23 10:47:41 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-23 10:47:41 [http-nio-8080-exec-9] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to http://localhost:8080/login
2026-01-23 10:47:41 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login
2026-01-23 10:47:41 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login
2026-01-23 10:47:41 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-23 10:47:41 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: localhost
2026-01-23 10:47:41 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: localhost
2026-01-23 10:47:41 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:47:41 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-23 10:47:41 [http-nio-8080-exec-10] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@1002379792 wrapping com.mysql.cj.jdbc.ConnectionImpl@72ce6d41] read-only
2026-01-23 10:47:41 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:47:41 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:47:41 [http-nio-8080-exec-10] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@1002379792 wrapping com.mysql.cj.jdbc.ConnectionImpl@72ce6d41]
2026-01-23 10:47:41 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 171
2026-01-23 10:47:41 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚ö†Ô∏è Usando empresa por defecto (localhost): 1 - Sistema por Defecto
2026-01-23 10:47:41 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-23 10:47:41 [http-nio-8080-exec-10] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-23 10:47:41 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 171, Tenant anterior: 1
2026-01-23 10:47:41 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 171, Request: /login, Empresa ID anterior: 1
2026-01-23 10:47:47 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing POST /superadmin/login
2026-01-23 10:47:47 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: josepino para la empresa ID: null
2026-01-23 10:47:47 [http-nio-8080-exec-1] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: josepino | Subdominio: localhost
2026-01-23 10:47:47 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=?
2026-01-23 10:47:47 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [josepino]
2026-01-23 10:47:47 [http-nio-8080-exec-1] INFO  j.s.s.servicios.UsuarioServicio - ‚úÖ SUPER_ADMIN cargado: josepino - Rol: SUPER_ADMIN
2026-01-23 10:47:47 [http-nio-8080-exec-1] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Authenticated user
2026-01-23 10:47:47 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.s.ChangeSessionIdAuthenticationStrategy - Changed session id from B03015C72FCD293EB319BB90C7474710
2026-01-23 10:47:47 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.CsrfAuthenticationStrategy - Replaced CSRF Token
2026-01-23 10:47:47 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Stored SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B03015C72FCD293EB319BB90C7474710], Granted Authorities=[ROLE_SUPER_ADMIN]]] to HttpSession [org.apache.catalina.session.StandardSessionFacade@7231d4e6]
2026-01-23 10:47:47 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.UsernamePasswordAuthenticationFilter - Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B03015C72FCD293EB319BB90C7474710], Granted Authorities=[ROLE_SUPER_ADMIN]]
2026-01-23 10:47:47 [http-nio-8080-exec-1] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /superadmin/dashboard
2026-01-23 10:47:47 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/dashboard
2026-01-23 10:47:47 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B03015C72FCD293EB319BB90C7474710], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-23 10:47:47 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/dashboard
2026-01-23 10:47:47 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/dashboard
2026-01-23 10:47:47 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/dashboard, Empresa ID: null
2026-01-23 10:47:47 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/dashboard
2026-01-23 10:47:47 [http-nio-8080-exec-2] INFO  j.s.s.c.SuperAdminController - üìä Accediendo al dashboard SUPER_ADMIN
2026-01-23 10:47:47 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 163, Request: /superadmin/dashboard, Empresa ID anterior: null
2026-01-23 10:47:47 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/empresas
2026-01-23 10:47:47 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B03015C72FCD293EB319BB90C7474710], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-23 10:47:47 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/empresas
2026-01-23 10:47:47 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/empresas
2026-01-23 10:47:47 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/empresas, Empresa ID: null
2026-01-23 10:47:47 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/empresas
2026-01-23 10:47:47 [http-nio-8080-exec-3] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@1459872009 wrapping com.mysql.cj.jdbc.ConnectionImpl@72ce6d41] read-only
2026-01-23 10:47:47 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0
2026-01-23 10:47:47 [http-nio-8080-exec-3] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@1459872009 wrapping com.mysql.cj.jdbc.ConnectionImpl@72ce6d41]
2026-01-23 10:47:47 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 164, Request: /superadmin/empresas, Empresa ID anterior: null
2026-01-23 10:47:47 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-23 10:47:47 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B03015C72FCD293EB319BB90C7474710], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-23 10:47:47 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-23 10:47:47 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-23 10:47:47 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: localhost
2026-01-23 10:47:47 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: localhost
2026-01-23 10:47:47 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:47:47 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-23 10:47:47 [http-nio-8080-exec-4] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@224673627 wrapping com.mysql.cj.jdbc.ConnectionImpl@72ce6d41] read-only
2026-01-23 10:47:47 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:47:47 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:47:47 [http-nio-8080-exec-4] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@224673627 wrapping com.mysql.cj.jdbc.ConnectionImpl@72ce6d41]
2026-01-23 10:47:47 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 165
2026-01-23 10:47:47 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚ö†Ô∏è Usando empresa por defecto (localhost): 1 - Sistema por Defecto
2026-01-23 10:47:47 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: josepino
2026-01-23 10:47:47 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: josepino en empresa ID: 1
2026-01-23 10:47:47 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:47:47 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [josepino]
2026-01-23 10:47:47 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-23 10:47:47 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 1
2026-01-23 10:47:47 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:47:47 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:47:47 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:47:47 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:47:47 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-23 10:47:47 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:47:47 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:47:47 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:47:47 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:47:47 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-23 10:47:47 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: false (Empresa ID: 1)
2026-01-23 10:47:47 [http-nio-8080-exec-4] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-22 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-23 10:47:47 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 165, Tenant anterior: 1
2026-01-23 10:47:47 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 165, Request: /favicon.ico, Empresa ID anterior: 1
2026-01-23 10:47:47 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-22
2026-01-23 10:47:47 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B03015C72FCD293EB319BB90C7474710], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-23 10:47:47 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AccessDeniedHandlerImpl - Forwarding to /acceso-denegado with status code 403
2026-01-23 10:47:47 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /acceso-denegado?fecha=2026-01-22
2026-01-23 10:47:47 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /acceso-denegado?fecha=2026-01-22
2026-01-23 10:47:47 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /acceso-denegado, Empresa ID: null
2026-01-23 10:47:47 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì Interceptando acceso-denegado - EMPRESA: null
2026-01-23 10:47:47 [http-nio-8080-exec-5] WARN  j.s.s.controladores.InicioController - ‚õî GET /acceso-denigado - Mostrando p√°gina de acceso denegado
2026-01-23 10:47:48 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /
2026-01-23 10:47:48 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /
2026-01-23 10:47:48 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /, M√©todo: GET
2026-01-23 10:47:48 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:47:48 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:47:48 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:47:48 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:47:48 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 167
2026-01-23 10:47:48 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:47:48 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=29879B214A291DA8C9F8881B16370065], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:47:48 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:47:48 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:47:48 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:47:48 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:47:48 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:47:48 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:47:48 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:47:48 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:47:48 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /, Empresa ID: 2
2026-01-23 10:47:48 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:47:48 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:47:48 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:47:48 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:47:48 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:47:48 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:47:48 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:47:48 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:47:48 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:47:48 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:47:48 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:47:48 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:47:48 [http-nio-8080-exec-6] INFO  j.s.s.controladores.InicioController - üîÄ GET / - Redirigiendo a /login
2026-01-23 10:47:48 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 167, Tenant anterior: 2
2026-01-23 10:47:48 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 167, Request: /, Empresa ID anterior: 2
2026-01-23 10:47:48 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login
2026-01-23 10:47:48 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login
2026-01-23 10:47:48 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-23 10:47:48 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:47:48 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:47:48 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:47:48 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:47:48 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 168
2026-01-23 10:47:48 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:47:48 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=29879B214A291DA8C9F8881B16370065], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:47:48 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:47:48 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:47:48 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:47:48 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:47:48 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:47:48 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:47:48 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:47:48 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:47:48 [http-nio-8080-exec-7] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-23 10:47:48 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 168, Tenant anterior: 2
2026-01-23 10:47:48 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 168, Request: /login, Empresa ID anterior: 2
2026-01-23 10:47:56 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-23 10:47:56 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: admin para la empresa ID: null
2026-01-23 10:47:56 [http-nio-8080-exec-8] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: jose
2026-01-23 10:47:56 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:47:56 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:47:56 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: jose | Empresa ID: 2 | Empresa Nombre: Empresa JOse
2026-01-23 10:47:56 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:47:56 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:47:56 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:47:56 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:47:56 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:47:56 [http-nio-8080-exec-8] INFO  j.s.s.servicios.UsuarioServicio - üîê Encontrado usuario: admin
2026-01-23 10:47:56 [http-nio-8080-exec-8] INFO  j.s.s.servicios.UsuarioServicio - üîê Rol: ADMIN
2026-01-23 10:47:56 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - üîê Activo: true
2026-01-23 10:47:56 [http-nio-8080-exec-8] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Authenticated user
2026-01-23 10:47:56 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.s.ChangeSessionIdAuthenticationStrategy - Changed session id from 18ACE8CC555EA638BB9EBA4EF5F0FD40
2026-01-23 10:47:56 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.CsrfAuthenticationStrategy - Replaced CSRF Token
2026-01-23 10:47:56 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Stored SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]] to HttpSession [org.apache.catalina.session.StandardSessionFacade@2041ac17]
2026-01-23 10:47:56 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.UsernamePasswordAuthenticationFilter - Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]
2026-01-23 10:47:56 [http-nio-8080-exec-8] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /principal
2026-01-23 10:47:56 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-23 10:47:56 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:47:56 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-23 10:47:56 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-23 10:47:56 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:47:56 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:47:56 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:47:56 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:47:56 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 170
2026-01-23 10:47:56 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:47:56 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:47:56 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:47:56 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:47:56 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:47:56 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:47:56 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:47:56 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:47:56 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:47:56 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-23 10:47:56 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:47:56 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:47:56 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:47:56 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:47:56 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:47:56 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:47:56 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:47:56 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:47:56 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:47:56 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:47:56 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:47:56 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:47:56 [http-nio-8080-exec-9] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-23
2026-01-23 10:47:56 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-23 10:47:56 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:47:56 [http-nio-8080-exec-9] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-23
2026-01-23 10:47:56 [http-nio-8080-exec-9] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-23 10:47:56 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 170, Tenant anterior: 2
2026-01-23 10:47:56 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 170, Request: /principal, Empresa ID anterior: 2
2026-01-23 10:47:59 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /compras/nueva
2026-01-23 10:47:59 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:47:59 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /compras/nueva
2026-01-23 10:47:59 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /compras/nueva, M√©todo: GET
2026-01-23 10:47:59 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:47:59 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:47:59 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:47:59 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:47:59 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 171
2026-01-23 10:47:59 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:47:59 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:47:59 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:47:59 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:47:59 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:47:59 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:47:59 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:47:59 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:47:59 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:47:59 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /compras/nueva, Empresa ID: 2
2026-01-23 10:47:59 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:47:59 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:47:59 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:47:59 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:47:59 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:47:59 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:47:59 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:47:59 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:47:59 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:47:59 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:47:59 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:47:59 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:47:59 [http-nio-8080-exec-10] INFO  j.s.s.c.FacturaProveedorControlador - üìù GET /compras/nueva - Mostrando formulario nueva compra
2026-01-23 10:47:59 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.ProveedorServicio - Listando proveedores para empresa ID: 2
2026-01-23 10:47:59 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.correo,
        p1_0.empresa_id,
        p1_0.identificacion,
        p1_0.nombre,
        p1_0.telefono 
    from
        proveedor p1_0 
    left join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:47:59 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:47:59 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.ProveedorServicio - Encontrados 0 proveedores para empresa ID: 2
2026-01-23 10:47:59 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.IngredienteServicio - Listando ingredientes para empresa ID: 2
2026-01-23 10:47:59 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    left join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:47:59 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:47:59 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.IngredienteServicio - Encontrados 0 ingredientes para empresa ID: 2
2026-01-23 10:47:59 [http-nio-8080-exec-10] DEBUG j.s.s.c.FacturaProveedorControlador - Formulario cargado - Proveedores activos: 0, Ingredientes: 0
2026-01-23 10:47:59 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 171, Tenant anterior: 2
2026-01-23 10:47:59 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 171, Request: /compras/nueva, Empresa ID anterior: 2
2026-01-23 10:48:02 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-23 10:48:02 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:48:02 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-23 10:48:02 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-23 10:48:02 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:48:02 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:48:02 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:48:02 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:48:02 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 162
2026-01-23 10:48:02 [http-nio-8080-exec-1] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:48:02 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:48:02 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:48:02 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:48:02 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:48:02 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:48:02 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:48:02 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:48:02 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:48:02 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-23 10:48:02 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:48:02 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:02 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:48:02 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:02 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:02 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:48:02 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:02 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:48:02 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:02 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:02 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:48:02 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:48:02 [http-nio-8080-exec-1] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-23
2026-01-23 10:48:02 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-23 10:48:02 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:48:02 [http-nio-8080-exec-1] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-23
2026-01-23 10:48:02 [http-nio-8080-exec-1] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-23 10:48:02 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 162, Tenant anterior: 2
2026-01-23 10:48:02 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 162, Request: /principal, Empresa ID anterior: 2
2026-01-23 10:48:03 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /compras
2026-01-23 10:48:03 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:48:03 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured GET /compras
2026-01-23 10:48:03 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /compras, M√©todo: GET
2026-01-23 10:48:03 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:48:03 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:48:03 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:48:03 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:48:03 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 163
2026-01-23 10:48:03 [http-nio-8080-exec-2] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:48:03 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:48:03 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:48:03 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:48:03 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:48:03 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:48:03 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:48:03 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:48:03 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:48:03 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /compras, Empresa ID: 2
2026-01-23 10:48:03 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:48:03 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:03 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:48:03 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:03 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:03 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:48:03 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:03 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:48:03 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:03 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:03 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:48:03 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:48:03 [http-nio-8080-exec-2] INFO  j.s.s.c.FacturaProveedorControlador - üìã GET /compras - Listando compras a proveedores
2026-01-23 10:48:03 [http-nio-8080-exec-2] DEBUG j.s.s.s.FacturaProveedorServicio - Listando facturas de proveedor para empresa ID: 2
2026-01-23 10:48:03 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fp1_0.id,
        fp1_0.empresa_id,
        fp1_0.estado,
        fp1_0.fecha,
        fp1_0.iva,
        fp1_0.numero_factura,
        fp1_0.proveedor_id,
        fp1_0.subtotal,
        fp1_0.total 
    from
        factura_proveedor fp1_0 
    left join
        empresa e1_0 
            on e1_0.id=fp1_0.empresa_id 
    where
        e1_0.id=? 
    order by
        fp1_0.fecha desc
2026-01-23 10:48:03 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:48:03 [http-nio-8080-exec-2] DEBUG j.s.s.s.FacturaProveedorServicio - Encontradas 0 facturas de proveedor para empresa ID: 2
2026-01-23 10:48:03 [http-nio-8080-exec-2] DEBUG j.s.s.c.FacturaProveedorControlador - Encontradas 0 compras
2026-01-23 10:48:03 [http-nio-8080-exec-2] DEBUG j.s.s.c.FacturaProveedorControlador - Estad√≠sticas - Pagadas: 0, Anuladas: 0, Total valor: 0.0
2026-01-23 10:48:03 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 163, Tenant anterior: 2
2026-01-23 10:48:03 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 163, Request: /compras, Empresa ID anterior: 2
2026-01-23 10:48:05 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-23 10:48:05 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:48:05 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-23 10:48:05 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-23 10:48:05 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:48:05 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:48:05 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:48:05 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:48:05 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 164
2026-01-23 10:48:05 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:48:05 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:48:05 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:48:05 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:48:05 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:48:05 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:48:05 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:48:05 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:48:05 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:48:05 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-23 10:48:05 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:48:05 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:05 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:48:05 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:05 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:05 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:48:05 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:05 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:48:05 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:05 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:05 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:48:05 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:48:05 [http-nio-8080-exec-3] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-23
2026-01-23 10:48:05 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-23 10:48:05 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:48:05 [http-nio-8080-exec-3] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-23
2026-01-23 10:48:05 [http-nio-8080-exec-3] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-23 10:48:05 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 164, Tenant anterior: 2
2026-01-23 10:48:05 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 164, Request: /principal, Empresa ID anterior: 2
2026-01-23 10:48:06 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /compras/nueva
2026-01-23 10:48:06 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:48:06 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /compras/nueva
2026-01-23 10:48:06 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /compras/nueva, M√©todo: GET
2026-01-23 10:48:06 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:48:06 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:48:06 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:48:06 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:48:06 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 165
2026-01-23 10:48:06 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:48:06 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:48:06 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:48:06 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:48:06 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:48:06 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:48:06 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:48:06 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:48:06 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:48:06 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /compras/nueva, Empresa ID: 2
2026-01-23 10:48:06 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:48:06 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:06 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:48:06 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:06 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:06 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:48:06 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:06 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:48:06 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:06 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:06 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:48:06 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:48:06 [http-nio-8080-exec-4] INFO  j.s.s.c.FacturaProveedorControlador - üìù GET /compras/nueva - Mostrando formulario nueva compra
2026-01-23 10:48:06 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.ProveedorServicio - Listando proveedores para empresa ID: 2
2026-01-23 10:48:06 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.correo,
        p1_0.empresa_id,
        p1_0.identificacion,
        p1_0.nombre,
        p1_0.telefono 
    from
        proveedor p1_0 
    left join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:48:06 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:48:06 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.ProveedorServicio - Encontrados 0 proveedores para empresa ID: 2
2026-01-23 10:48:06 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.IngredienteServicio - Listando ingredientes para empresa ID: 2
2026-01-23 10:48:06 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    left join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:48:06 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:48:06 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.IngredienteServicio - Encontrados 0 ingredientes para empresa ID: 2
2026-01-23 10:48:06 [http-nio-8080-exec-4] DEBUG j.s.s.c.FacturaProveedorControlador - Formulario cargado - Proveedores activos: 0, Ingredientes: 0
2026-01-23 10:48:06 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 165, Tenant anterior: 2
2026-01-23 10:48:06 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 165, Request: /compras/nueva, Empresa ID anterior: 2
2026-01-23 10:48:11 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-23 10:48:11 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:48:11 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-23 10:48:11 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-23 10:48:11 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:48:11 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:48:11 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:48:11 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:48:11 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 166
2026-01-23 10:48:11 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:48:11 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:48:11 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:48:11 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:48:11 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:48:11 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:48:11 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:48:11 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:48:11 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:48:11 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-23 10:48:11 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:48:11 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:11 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:48:11 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:11 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:11 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:48:11 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:11 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:48:11 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:11 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:11 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:48:11 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:48:11 [http-nio-8080-exec-5] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-23
2026-01-23 10:48:11 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-23 10:48:11 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:48:11 [http-nio-8080-exec-5] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-23
2026-01-23 10:48:11 [http-nio-8080-exec-5] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-23 10:48:11 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 166, Tenant anterior: 2
2026-01-23 10:48:11 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 166, Request: /principal, Empresa ID anterior: 2
2026-01-23 10:48:12 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /productos
2026-01-23 10:48:12 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:48:12 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /productos
2026-01-23 10:48:12 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /productos, M√©todo: GET
2026-01-23 10:48:12 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:48:12 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:48:12 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:48:12 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:48:12 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 167
2026-01-23 10:48:12 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:48:12 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:48:12 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:48:12 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:48:12 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:48:12 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:48:12 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:48:12 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:48:12 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:48:12 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /productos, Empresa ID: 2
2026-01-23 10:48:12 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:48:12 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:12 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:48:12 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:12 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:12 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:48:12 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:12 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:48:12 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:12 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:12 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:48:12 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:48:12 [http-nio-8080-exec-6] INFO  j.s.s.c.ProductoControlador - üìã GET /productos - Listando productos
2026-01-23 10:48:12 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.ProductoServicio - Listando productos para empresa ID: 2
2026-01-23 10:48:12 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        p1_0.receta_id,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta 
    from
        producto p1_0 
    left join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:48:12 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:48:12 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.ProductoServicio - Encontrados 0 productos para empresa ID: 2
2026-01-23 10:48:12 [http-nio-8080-exec-6] DEBUG j.s.s.c.ProductoControlador - Encontrados 0 productos
2026-01-23 10:48:12 [http-nio-8080-exec-6] DEBUG j.s.s.c.ProductoControlador - Stock posible calculado para 0 productos con receta
2026-01-23 10:48:12 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 167, Tenant anterior: 2
2026-01-23 10:48:12 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 167, Request: /productos, Empresa ID anterior: 2
2026-01-23 10:48:14 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-23 10:48:14 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:48:14 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-23 10:48:14 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-23 10:48:14 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:48:14 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:48:14 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:48:14 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:48:14 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 168
2026-01-23 10:48:14 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:48:14 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:48:14 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:48:14 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:48:14 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:48:14 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:48:14 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:48:14 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:48:14 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:48:14 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-23 10:48:14 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:48:14 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:14 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:48:14 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:14 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:14 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:48:14 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:14 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:48:14 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:14 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:14 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:48:14 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:48:14 [http-nio-8080-exec-7] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-23
2026-01-23 10:48:14 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-23 10:48:14 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:48:14 [http-nio-8080-exec-7] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-23
2026-01-23 10:48:14 [http-nio-8080-exec-7] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-23 10:48:14 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 168, Tenant anterior: 2
2026-01-23 10:48:14 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 168, Request: /principal, Empresa ID anterior: 2
2026-01-23 10:48:15 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /ingredientes
2026-01-23 10:48:15 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:48:15 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /ingredientes
2026-01-23 10:48:15 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /ingredientes, M√©todo: GET
2026-01-23 10:48:15 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:48:15 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:48:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:48:15 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:48:15 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 169
2026-01-23 10:48:15 [http-nio-8080-exec-8] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:48:15 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:48:15 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:48:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:48:15 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:48:15 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:48:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:48:15 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:48:15 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:48:15 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /ingredientes, Empresa ID: 2
2026-01-23 10:48:15 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:48:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:15 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:48:15 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:15 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:15 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:48:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:15 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:48:15 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:15 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:15 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:48:15 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:48:15 [http-nio-8080-exec-8] INFO  j.s.s.c.IngredienteControlador - üìã GET /ingredientes - Listando ingredientes
2026-01-23 10:48:15 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.IngredienteServicio - Listando ingredientes para empresa ID: 2
2026-01-23 10:48:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    left join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:48:15 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:48:15 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.IngredienteServicio - Encontrados 0 ingredientes para empresa ID: 2
2026-01-23 10:48:15 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 169, Tenant anterior: 2
2026-01-23 10:48:15 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 169, Request: /ingredientes, Empresa ID anterior: 2
2026-01-23 10:48:16 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-23 10:48:16 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:48:16 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-23 10:48:16 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-23 10:48:16 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:48:16 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:48:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:48:16 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:48:16 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 170
2026-01-23 10:48:16 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:48:16 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:48:16 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:48:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:48:16 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:48:16 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:48:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:48:16 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:48:16 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:48:16 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-23 10:48:16 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:48:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:16 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:48:16 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:16 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:16 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:48:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:16 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:48:16 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:16 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:16 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:48:16 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:48:16 [http-nio-8080-exec-9] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-23
2026-01-23 10:48:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-23 10:48:16 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:48:16 [http-nio-8080-exec-9] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-23
2026-01-23 10:48:16 [http-nio-8080-exec-9] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-23 10:48:16 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 170, Tenant anterior: 2
2026-01-23 10:48:16 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 170, Request: /principal, Empresa ID anterior: 2
2026-01-23 10:48:19 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /proveedores
2026-01-23 10:48:19 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:48:19 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /proveedores
2026-01-23 10:48:19 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /proveedores, M√©todo: GET
2026-01-23 10:48:19 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:48:19 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:48:19 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:48:19 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:48:19 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 171
2026-01-23 10:48:19 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:48:19 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:48:19 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:48:19 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:48:19 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:48:19 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:48:19 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:48:19 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:48:19 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:48:19 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /proveedores, Empresa ID: 2
2026-01-23 10:48:19 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:48:19 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:19 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:48:19 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:19 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:19 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:48:19 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:19 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:48:19 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:19 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:19 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:48:19 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:48:19 [http-nio-8080-exec-10] INFO  j.s.s.c.ProveedorControlador - üìã GET /proveedores - Listando proveedores
2026-01-23 10:48:19 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.ProveedorServicio - Listando proveedores para empresa ID: 2
2026-01-23 10:48:19 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.correo,
        p1_0.empresa_id,
        p1_0.identificacion,
        p1_0.nombre,
        p1_0.telefono 
    from
        proveedor p1_0 
    left join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:48:19 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:48:19 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.ProveedorServicio - Encontrados 0 proveedores para empresa ID: 2
2026-01-23 10:48:19 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 171, Tenant anterior: 2
2026-01-23 10:48:19 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 171, Request: /proveedores, Empresa ID anterior: 2
2026-01-23 10:48:20 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /proveedores/nuevo
2026-01-23 10:48:20 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:48:20 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /proveedores/nuevo
2026-01-23 10:48:20 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /proveedores/nuevo, M√©todo: GET
2026-01-23 10:48:20 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:48:20 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:48:20 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:48:20 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:48:20 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 162
2026-01-23 10:48:20 [http-nio-8080-exec-1] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:48:20 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:48:20 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:48:20 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:48:20 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:48:20 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:48:20 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:48:20 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:48:20 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:48:20 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /proveedores/nuevo, Empresa ID: 2
2026-01-23 10:48:20 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:48:20 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:20 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:48:20 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:20 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:20 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:48:20 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:20 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:48:20 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:20 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:20 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:48:20 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:48:20 [http-nio-8080-exec-1] INFO  j.s.s.c.ProveedorControlador - üìù GET /proveedores/nuevo - Mostrando formulario nuevo proveedor
2026-01-23 10:48:20 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 162, Tenant anterior: 2
2026-01-23 10:48:20 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 162, Request: /proveedores/nuevo, Empresa ID anterior: 2
2026-01-23 10:48:27 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing POST /proveedores/guardar
2026-01-23 10:48:27 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:48:27 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured POST /proveedores/guardar
2026-01-23 10:48:27 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /proveedores/guardar, M√©todo: POST
2026-01-23 10:48:27 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:48:27 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:48:27 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:48:27 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:48:27 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 163
2026-01-23 10:48:27 [http-nio-8080-exec-2] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:48:27 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:48:27 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:48:27 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:48:27 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:48:27 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:48:27 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:48:27 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:48:27 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:48:27 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /proveedores/guardar, Empresa ID: 2
2026-01-23 10:48:27 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:48:27 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:27 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:48:27 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:27 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:27 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:48:27 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:27 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:48:27 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:27 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:27 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:48:27 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:48:27 [http-nio-8080-exec-2] INFO  j.s.s.c.ProveedorControlador - üíæ POST /proveedores/guardar - Guardando proveedor: Jose Pino
2026-01-23 10:48:27 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.ProveedorServicio - Guardando proveedor 'Jose Pino' para empresa ID: 2
2026-01-23 10:48:27 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.ProveedorServicio - Validando identificaci√≥n √∫nica: 19473453 para empresa ID: 2
2026-01-23 10:48:27 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        p1_0.id 
    from
        proveedor p1_0 
    left join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        p1_0.identificacion=? 
        and e1_0.id=? 
    limit
        ?
2026-01-23 10:48:27 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [19473453]
2026-01-23 10:48:27 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:48:27 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:INTEGER) <- [1]
2026-01-23 10:48:27 [http-nio-8080-exec-2] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@1763665264 wrapping com.mysql.cj.jdbc.ConnectionImpl@72ce6d41] read-only
2026-01-23 10:48:27 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:48:27 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:48:27 [http-nio-8080-exec-2] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@1763665264 wrapping com.mysql.cj.jdbc.ConnectionImpl@72ce6d41]
2026-01-23 10:48:27 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        proveedor
        (activo, correo, empresa_id, identificacion, nombre, telefono) 
    values
        (?, ?, ?, ?, ?, ?)
2026-01-23 10:48:27 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-23 10:48:27 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [jose@gmail.com]
2026-01-23 10:48:27 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:27 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [19473453]
2026-01-23 10:48:27 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [Jose Pino]
2026-01-23 10:48:27 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [3115470418]
2026-01-23 10:48:27 [http-nio-8080-exec-2] INFO  j.s.s.servicios.ProveedorServicio - Proveedor guardado exitosamente: 'Jose Pino' (ID: 1) para empresa ID: 2
2026-01-23 10:48:27 [http-nio-8080-exec-2] INFO  j.s.s.c.ProveedorControlador - ‚úÖ Proveedor guardado exitosamente: Jose Pino (ID: 1)
2026-01-23 10:48:27 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 163, Tenant anterior: 2
2026-01-23 10:48:27 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 163, Request: /proveedores/guardar, Empresa ID anterior: 2
2026-01-23 10:48:27 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /proveedores
2026-01-23 10:48:27 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:48:27 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /proveedores
2026-01-23 10:48:27 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /proveedores, M√©todo: GET
2026-01-23 10:48:27 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:48:27 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:48:27 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:48:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:48:27 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 164
2026-01-23 10:48:27 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:48:27 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:48:27 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:48:27 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:48:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:48:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:48:27 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:48:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:48:27 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:48:27 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /proveedores, Empresa ID: 2
2026-01-23 10:48:27 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:48:27 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:48:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:27 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:48:27 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:48:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:27 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:48:27 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:48:27 [http-nio-8080-exec-3] INFO  j.s.s.c.ProveedorControlador - üìã GET /proveedores - Listando proveedores
2026-01-23 10:48:27 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.ProveedorServicio - Listando proveedores para empresa ID: 2
2026-01-23 10:48:27 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.correo,
        p1_0.empresa_id,
        p1_0.identificacion,
        p1_0.nombre,
        p1_0.telefono 
    from
        proveedor p1_0 
    left join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:48:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:48:27 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:48:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:48:27 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.ProveedorServicio - Encontrados 1 proveedores para empresa ID: 2
2026-01-23 10:48:27 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 164, Tenant anterior: 2
2026-01-23 10:48:27 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 164, Request: /proveedores, Empresa ID anterior: 2
2026-01-23 10:48:29 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-23 10:48:29 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:48:29 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-23 10:48:29 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-23 10:48:29 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:48:29 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:48:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:48:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:48:29 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 165
2026-01-23 10:48:29 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:48:29 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:48:29 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:48:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:48:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:48:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:48:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:48:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:48:29 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:48:29 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-23 10:48:29 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:48:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:48:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:29 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:48:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:48:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:29 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:48:29 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:48:29 [http-nio-8080-exec-4] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-23
2026-01-23 10:48:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-23 10:48:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:48:29 [http-nio-8080-exec-4] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-23
2026-01-23 10:48:29 [http-nio-8080-exec-4] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-23 10:48:29 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 165, Tenant anterior: 2
2026-01-23 10:48:29 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 165, Request: /principal, Empresa ID anterior: 2
2026-01-23 10:48:31 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /ingredientes
2026-01-23 10:48:31 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:48:31 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /ingredientes
2026-01-23 10:48:31 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /ingredientes, M√©todo: GET
2026-01-23 10:48:31 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:48:31 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:48:31 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:48:31 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:48:31 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 166
2026-01-23 10:48:31 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:48:31 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:48:31 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:48:31 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:48:31 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:48:31 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:48:31 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:48:31 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:48:31 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:48:31 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /ingredientes, Empresa ID: 2
2026-01-23 10:48:31 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:48:31 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:31 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:48:31 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:31 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:31 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:48:31 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:31 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:48:31 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:31 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:31 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:48:31 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:48:31 [http-nio-8080-exec-5] INFO  j.s.s.c.IngredienteControlador - üìã GET /ingredientes - Listando ingredientes
2026-01-23 10:48:31 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.IngredienteServicio - Listando ingredientes para empresa ID: 2
2026-01-23 10:48:31 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    left join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:48:31 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:48:31 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.IngredienteServicio - Encontrados 0 ingredientes para empresa ID: 2
2026-01-23 10:48:31 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 166, Tenant anterior: 2
2026-01-23 10:48:31 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 166, Request: /ingredientes, Empresa ID anterior: 2
2026-01-23 10:48:32 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /ingredientes/nuevo
2026-01-23 10:48:32 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:48:32 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /ingredientes/nuevo
2026-01-23 10:48:32 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /ingredientes/nuevo, M√©todo: GET
2026-01-23 10:48:32 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:48:32 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:48:32 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:48:32 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:48:32 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 167
2026-01-23 10:48:32 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:48:32 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:48:32 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:48:32 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:48:32 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:48:32 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:48:32 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:48:32 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:48:32 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:48:32 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /ingredientes/nuevo, Empresa ID: 2
2026-01-23 10:48:32 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:48:32 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:32 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:48:32 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:32 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:32 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:48:32 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:32 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:48:32 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:32 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:32 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:48:32 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:48:32 [http-nio-8080-exec-6] INFO  j.s.s.c.IngredienteControlador - üìù GET /ingredientes/nuevo - Mostrando formulario nuevo ingrediente
2026-01-23 10:48:32 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 167, Tenant anterior: 2
2026-01-23 10:48:32 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 167, Request: /ingredientes/nuevo, Empresa ID anterior: 2
2026-01-23 10:48:47 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing POST /ingredientes/guardar
2026-01-23 10:48:47 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:48:47 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured POST /ingredientes/guardar
2026-01-23 10:48:47 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /ingredientes/guardar, M√©todo: POST
2026-01-23 10:48:47 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:48:47 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:48:47 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:48:47 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:48:47 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 168
2026-01-23 10:48:47 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:48:47 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:48:47 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:48:47 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:48:47 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:48:47 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:48:47 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:48:47 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:48:47 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:48:47 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /ingredientes/guardar, Empresa ID: 2
2026-01-23 10:48:47 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:48:47 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:47 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:48:47 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:47 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:47 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:48:47 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:47 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:48:47 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:47 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:47 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:48:47 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:48:47 [http-nio-8080-exec-7] INFO  j.s.s.c.IngredienteControlador - üíæ POST /ingredientes/guardar - Guardando ingrediente: Pepsi 2.5 Litro
2026-01-23 10:48:47 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.IngredienteServicio - Creando ingrediente 'Pepsi 2.5 Litro' para empresa ID: 2
2026-01-23 10:48:47 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        ingrediente
        (activo, empresa_id, nombre, precio, stock_actual, stock_minimo, unidad_medida) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-23 10:48:47 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-23 10:48:47 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:48:47 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [Pepsi 2.5 Litro]
2026-01-23 10:48:47 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DOUBLE) <- [4300.0]
2026-01-23 10:48:47 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:DOUBLE) <- [0.0]
2026-01-23 10:48:47 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DOUBLE) <- [0.0]
2026-01-23 10:48:47 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [Unid]
2026-01-23 10:48:47 [http-nio-8080-exec-7] INFO  j.s.s.servicios.IngredienteServicio - Ingrediente creado exitosamente: 'Pepsi 2.5 Litro' (ID: 1) para empresa ID: 2
2026-01-23 10:48:47 [http-nio-8080-exec-7] INFO  j.s.s.c.IngredienteControlador - ‚úÖ Ingrediente guardado exitosamente: Pepsi 2.5 Litro (ID: 1)
2026-01-23 10:48:47 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 168, Tenant anterior: 2
2026-01-23 10:48:47 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 168, Request: /ingredientes/guardar, Empresa ID anterior: 2
2026-01-23 10:48:47 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /ingredientes
2026-01-23 10:48:47 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:48:47 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /ingredientes
2026-01-23 10:48:47 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /ingredientes, M√©todo: GET
2026-01-23 10:48:47 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:48:47 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:48:47 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:48:47 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:48:47 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 169
2026-01-23 10:48:47 [http-nio-8080-exec-8] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:48:47 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:48:47 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:48:47 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:48:47 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:48:47 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:48:47 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:48:47 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:48:47 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:48:47 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /ingredientes, Empresa ID: 2
2026-01-23 10:48:47 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:48:47 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:47 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:48:47 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:47 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:47 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:48:47 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:47 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:48:47 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:47 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:47 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:48:47 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:48:47 [http-nio-8080-exec-8] INFO  j.s.s.c.IngredienteControlador - üìã GET /ingredientes - Listando ingredientes
2026-01-23 10:48:47 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.IngredienteServicio - Listando ingredientes para empresa ID: 2
2026-01-23 10:48:47 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    left join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:48:47 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:48:47 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:48:47 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:48:47 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.IngredienteServicio - Encontrados 1 ingredientes para empresa ID: 2
2026-01-23 10:48:47 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 169, Tenant anterior: 2
2026-01-23 10:48:47 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 169, Request: /ingredientes, Empresa ID anterior: 2
2026-01-23 10:48:52 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-23 10:48:52 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:48:52 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-23 10:48:52 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-23 10:48:52 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:48:52 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:48:52 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:48:52 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:48:52 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 171
2026-01-23 10:48:52 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:48:52 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:48:52 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:48:52 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:48:52 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:48:52 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:48:52 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:48:52 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:48:52 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:48:52 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-23 10:48:52 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:48:52 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:52 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:48:52 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:52 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:52 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:48:52 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:52 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:48:52 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:52 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:52 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:48:52 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:48:52 [http-nio-8080-exec-10] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-23
2026-01-23 10:48:52 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-23 10:48:52 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:48:52 [http-nio-8080-exec-10] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-23
2026-01-23 10:48:52 [http-nio-8080-exec-10] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-23 10:48:52 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 171, Tenant anterior: 2
2026-01-23 10:48:52 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 171, Request: /principal, Empresa ID anterior: 2
2026-01-23 10:48:54 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /compras/nueva
2026-01-23 10:48:54 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:48:54 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /compras/nueva
2026-01-23 10:48:54 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /compras/nueva, M√©todo: GET
2026-01-23 10:48:54 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:48:54 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:48:54 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:48:54 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:48:54 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 162
2026-01-23 10:48:54 [http-nio-8080-exec-1] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:48:54 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:48:54 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:48:54 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:48:54 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:48:54 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:48:54 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:48:54 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:48:54 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:48:54 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /compras/nueva, Empresa ID: 2
2026-01-23 10:48:54 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:48:54 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:54 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:48:54 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:54 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:54 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:48:54 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:48:54 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:48:54 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:48:54 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:48:54 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:48:54 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:48:54 [http-nio-8080-exec-1] INFO  j.s.s.c.FacturaProveedorControlador - üìù GET /compras/nueva - Mostrando formulario nueva compra
2026-01-23 10:48:54 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.ProveedorServicio - Listando proveedores para empresa ID: 2
2026-01-23 10:48:54 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.correo,
        p1_0.empresa_id,
        p1_0.identificacion,
        p1_0.nombre,
        p1_0.telefono 
    from
        proveedor p1_0 
    left join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:48:54 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:48:54 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:48:54 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:48:54 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.ProveedorServicio - Encontrados 1 proveedores para empresa ID: 2
2026-01-23 10:48:54 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.IngredienteServicio - Listando ingredientes para empresa ID: 2
2026-01-23 10:48:54 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    left join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:48:54 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:48:54 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:48:54 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:48:54 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.IngredienteServicio - Encontrados 1 ingredientes para empresa ID: 2
2026-01-23 10:48:54 [http-nio-8080-exec-1] DEBUG j.s.s.c.FacturaProveedorControlador - Formulario cargado - Proveedores activos: 1, Ingredientes: 1
2026-01-23 10:48:54 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 162, Tenant anterior: 2
2026-01-23 10:48:54 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 162, Request: /compras/nueva, Empresa ID anterior: 2
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing POST /compras/guardar
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured POST /compras/guardar
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /compras/guardar, M√©todo: POST
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 163
2026-01-23 10:49:12 [http-nio-8080-exec-2] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /compras/guardar, Empresa ID: 2
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:49:12 [http-nio-8080-exec-2] INFO  j.s.s.c.FacturaProveedorControlador - üíæ POST /compras/guardar - Guardando compra a proveedor
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG j.s.s.c.FacturaProveedorControlador - Datos compra - Proveedor ID: 1, N√∫mero factura: null
2026-01-23 10:49:12 [http-nio-8080-exec-2] INFO  j.s.s.s.FacturaProveedorServicio - Creando factura de proveedor para empresa ID: 2
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG j.s.s.s.FacturaProveedorServicio - Empresa asignada: Empresa JOse (ID: 2)
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.correo,
        p1_0.empresa_id,
        p1_0.identificacion,
        p1_0.nombre,
        p1_0.telefono 
    from
        proveedor p1_0 
    left join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        p1_0.id=? 
        and e1_0.id=?
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG j.s.s.s.FacturaProveedorServicio - Proveedor asignado: Jose Pino (ID: 1)
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        count(fp1_0.id) 
    from
        factura_proveedor fp1_0 
    left join
        empresa e1_0 
            on e1_0.id=fp1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG j.s.s.s.FacturaProveedorServicio - Consecutivo generado: 1 para empresa ID: 2
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG j.s.s.s.FacturaProveedorServicio - N√∫mero de factura generado: FAC-PROV-001-2026
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG j.s.s.s.FacturaProveedorServicio - Procesando 1 detalles de factura
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    left join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=? 
        and e1_0.id=?
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG j.s.s.s.FacturaProveedorServicio - Stock actualizado para ingrediente 'Pepsi 2.5 Litro': Anterior: 0.0, Nuevo: 100.0, Aumento: 100.0
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG j.s.s.s.FacturaProveedorServicio - Totales calculados - Subtotal: 450000.0, IVA: 85500.0, Total: 535500.0
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG j.s.s.s.FacturaProveedorServicio - Estado proporcionado: PENDIENTE
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        factura_proveedor
        (empresa_id, estado, fecha, iva, numero_factura, proveedor_id, subtotal, total) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [PENDIENTE]
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:DATE) <- [2026-01-23]
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DOUBLE) <- [85500.0]
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [FAC-PROV-001-2026]
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:BIGINT) <- [1]
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:DOUBLE) <- [450000.0]
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:DOUBLE) <- [535500.0]
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        factura_detalle_proveedor
        (cantidad, factura_proveedor_id, ingrediente_id, precio_unitario, subtotal) 
    values
        (?, ?, ?, ?, ?)
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DOUBLE) <- [100.0]
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DOUBLE) <- [4500.0]
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:DOUBLE) <- [450000.0]
2026-01-23 10:49:12 [http-nio-8080-exec-2] INFO  j.s.s.s.FacturaProveedorServicio - Factura de proveedor creada exitosamente: FAC-PROV-001-2026 (ID: 1) para empresa ID: 2. Total: 535500.0, Detalles: 1
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    update
        ingrediente 
    set
        activo=?,
        empresa_id=?,
        nombre=?,
        precio=?,
        stock_actual=?,
        stock_minimo=?,
        unidad_medida=? 
    where
        id=?
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [Pepsi 2.5 Litro]
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DOUBLE) <- [4300.0]
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:DOUBLE) <- [100.0]
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DOUBLE) <- [0.0]
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [Unid]
2026-01-23 10:49:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:BIGINT) <- [1]
2026-01-23 10:49:12 [http-nio-8080-exec-2] INFO  j.s.s.c.FacturaProveedorControlador - ‚úÖ Compra a proveedor guardada exitosamente: FAC-PROV-001-2026 (ID: 1)
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 163, Tenant anterior: 2
2026-01-23 10:49:12 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 163, Request: /compras/guardar, Empresa ID anterior: 2
2026-01-23 10:49:12 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /compras
2026-01-23 10:49:12 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:49:12 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /compras
2026-01-23 10:49:12 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /compras, M√©todo: GET
2026-01-23 10:49:12 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:49:12 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:49:12 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:49:12 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:49:12 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 164
2026-01-23 10:49:12 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:49:12 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:49:12 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:49:12 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:49:12 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:49:12 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:49:12 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:49:12 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:12 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:49:12 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /compras, Empresa ID: 2
2026-01-23 10:49:12 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:49:12 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:49:12 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:49:12 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:49:12 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:49:12 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:49:12 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:49:12 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:49:12 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:49:12 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:49:12 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:49:12 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:49:12 [http-nio-8080-exec-3] INFO  j.s.s.c.FacturaProveedorControlador - üìã GET /compras - Listando compras a proveedores
2026-01-23 10:49:12 [http-nio-8080-exec-3] DEBUG j.s.s.s.FacturaProveedorServicio - Listando facturas de proveedor para empresa ID: 2
2026-01-23 10:49:12 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fp1_0.id,
        fp1_0.empresa_id,
        fp1_0.estado,
        fp1_0.fecha,
        fp1_0.iva,
        fp1_0.numero_factura,
        fp1_0.proveedor_id,
        fp1_0.subtotal,
        fp1_0.total 
    from
        factura_proveedor fp1_0 
    left join
        empresa e1_0 
            on e1_0.id=fp1_0.empresa_id 
    where
        e1_0.id=? 
    order by
        fp1_0.fecha desc
2026-01-23 10:49:12 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:12 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:49:12 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:12 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.correo,
        p1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        p1_0.identificacion,
        p1_0.nombre,
        p1_0.telefono 
    from
        proveedor p1_0 
    join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        p1_0.id=?
2026-01-23 10:49:12 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:49:12 [http-nio-8080-exec-3] DEBUG j.s.s.s.FacturaProveedorServicio - Encontradas 1 facturas de proveedor para empresa ID: 2
2026-01-23 10:49:12 [http-nio-8080-exec-3] DEBUG j.s.s.c.FacturaProveedorControlador - Encontradas 1 compras
2026-01-23 10:49:12 [http-nio-8080-exec-3] DEBUG j.s.s.c.FacturaProveedorControlador - Estad√≠sticas - Pagadas: 0, Anuladas: 0, Total valor: 535500.0
2026-01-23 10:49:12 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 164, Tenant anterior: 2
2026-01-23 10:49:12 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 164, Request: /compras, Empresa ID anterior: 2
2026-01-23 10:49:15 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /compras/detalle/1
2026-01-23 10:49:15 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:49:15 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /compras/detalle/1
2026-01-23 10:49:15 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /compras/detalle/1, M√©todo: GET
2026-01-23 10:49:15 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:49:15 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:49:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:49:15 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:49:15 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 165
2026-01-23 10:49:15 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:49:15 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:49:15 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:49:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:49:15 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:49:15 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:49:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:49:15 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:15 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:49:15 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /compras/detalle/1, Empresa ID: 2
2026-01-23 10:49:15 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:49:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:49:15 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:49:15 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:49:15 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:49:15 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:49:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:49:15 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:49:15 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:49:15 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:49:15 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:49:15 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:49:15 [http-nio-8080-exec-4] INFO  j.s.s.c.FacturaProveedorControlador - üëÅÔ∏è GET /compras/detalle/1 - Viendo detalle de compra
2026-01-23 10:49:15 [http-nio-8080-exec-4] DEBUG j.s.s.s.FacturaProveedorServicio - Buscando factura de proveedor ID: 1 para empresa ID: 2
2026-01-23 10:49:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fp1_0.id,
        d1_0.factura_proveedor_id,
        d1_0.id,
        d1_0.cantidad,
        d1_0.ingrediente_id,
        d1_0.precio_unitario,
        d1_0.subtotal,
        fp1_0.empresa_id,
        fp1_0.estado,
        fp1_0.fecha,
        fp1_0.iva,
        fp1_0.numero_factura,
        fp1_0.proveedor_id,
        fp1_0.subtotal,
        fp1_0.total 
    from
        factura_proveedor fp1_0 
    left join
        factura_detalle_proveedor d1_0 
            on fp1_0.id=d1_0.factura_proveedor_id 
    where
        fp1_0.id=? 
        and fp1_0.empresa_id=?
2026-01-23 10:49:15 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:49:15 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:49:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-23 10:49:15 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:49:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.correo,
        p1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        p1_0.identificacion,
        p1_0.nombre,
        p1_0.telefono 
    from
        proveedor p1_0 
    join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        p1_0.id=?
2026-01-23 10:49:15 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:49:15 [http-nio-8080-exec-4] DEBUG j.s.s.c.FacturaProveedorControlador - Compra encontrada: FAC-PROV-001-2026, Estado: PENDIENTE, Total: 535500.0
2026-01-23 10:49:15 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 165, Tenant anterior: 2
2026-01-23 10:49:15 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 165, Request: /compras/detalle/1, Empresa ID anterior: 2
2026-01-23 10:49:18 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /compras
2026-01-23 10:49:18 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:49:18 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /compras
2026-01-23 10:49:18 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /compras, M√©todo: GET
2026-01-23 10:49:18 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:49:18 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:49:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:49:18 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:49:18 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 166
2026-01-23 10:49:18 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:49:18 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:49:18 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:49:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:49:18 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:49:18 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:49:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:49:18 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:18 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:49:18 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /compras, Empresa ID: 2
2026-01-23 10:49:18 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:49:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:49:18 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:49:18 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:49:18 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:49:18 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:49:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:49:18 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:49:18 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:49:18 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:49:18 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:49:18 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:49:18 [http-nio-8080-exec-5] INFO  j.s.s.c.FacturaProveedorControlador - üìã GET /compras - Listando compras a proveedores
2026-01-23 10:49:18 [http-nio-8080-exec-5] DEBUG j.s.s.s.FacturaProveedorServicio - Listando facturas de proveedor para empresa ID: 2
2026-01-23 10:49:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fp1_0.id,
        fp1_0.empresa_id,
        fp1_0.estado,
        fp1_0.fecha,
        fp1_0.iva,
        fp1_0.numero_factura,
        fp1_0.proveedor_id,
        fp1_0.subtotal,
        fp1_0.total 
    from
        factura_proveedor fp1_0 
    left join
        empresa e1_0 
            on e1_0.id=fp1_0.empresa_id 
    where
        e1_0.id=? 
    order by
        fp1_0.fecha desc
2026-01-23 10:49:18 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:49:18 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.correo,
        p1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        p1_0.identificacion,
        p1_0.nombre,
        p1_0.telefono 
    from
        proveedor p1_0 
    join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        p1_0.id=?
2026-01-23 10:49:18 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:49:18 [http-nio-8080-exec-5] DEBUG j.s.s.s.FacturaProveedorServicio - Encontradas 1 facturas de proveedor para empresa ID: 2
2026-01-23 10:49:18 [http-nio-8080-exec-5] DEBUG j.s.s.c.FacturaProveedorControlador - Encontradas 1 compras
2026-01-23 10:49:18 [http-nio-8080-exec-5] DEBUG j.s.s.c.FacturaProveedorControlador - Estad√≠sticas - Pagadas: 0, Anuladas: 0, Total valor: 535500.0
2026-01-23 10:49:18 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 166, Tenant anterior: 2
2026-01-23 10:49:18 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 166, Request: /compras, Empresa ID anterior: 2
2026-01-23 10:49:19 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-23 10:49:19 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:49:19 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-23 10:49:19 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-23 10:49:19 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:49:19 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:49:19 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:49:19 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:49:19 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 167
2026-01-23 10:49:19 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:49:19 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:49:19 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:49:19 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:49:19 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:49:19 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:49:19 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:49:19 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:19 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:49:19 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-23 10:49:19 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:49:19 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:49:19 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:49:19 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:49:19 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:49:19 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:49:19 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:49:19 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:49:19 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:49:19 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:49:19 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:49:19 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:49:19 [http-nio-8080-exec-6] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-23
2026-01-23 10:49:19 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-23 10:49:19 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:49:19 [http-nio-8080-exec-6] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-23
2026-01-23 10:49:19 [http-nio-8080-exec-6] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-23 10:49:19 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 167, Tenant anterior: 2
2026-01-23 10:49:19 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 167, Request: /principal, Empresa ID anterior: 2
2026-01-23 10:49:21 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /compras
2026-01-23 10:49:21 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:49:21 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /compras
2026-01-23 10:49:21 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /compras, M√©todo: GET
2026-01-23 10:49:21 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:49:21 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:49:21 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:49:21 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:49:21 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 168
2026-01-23 10:49:21 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:49:21 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:49:21 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:49:21 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:49:21 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:49:21 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:49:21 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:49:21 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:21 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:49:21 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /compras, Empresa ID: 2
2026-01-23 10:49:21 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:49:21 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:49:21 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:49:21 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:49:21 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:49:21 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:49:21 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:49:21 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:49:21 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:49:21 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:49:21 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:49:21 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:49:21 [http-nio-8080-exec-7] INFO  j.s.s.c.FacturaProveedorControlador - üìã GET /compras - Listando compras a proveedores
2026-01-23 10:49:21 [http-nio-8080-exec-7] DEBUG j.s.s.s.FacturaProveedorServicio - Listando facturas de proveedor para empresa ID: 2
2026-01-23 10:49:21 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fp1_0.id,
        fp1_0.empresa_id,
        fp1_0.estado,
        fp1_0.fecha,
        fp1_0.iva,
        fp1_0.numero_factura,
        fp1_0.proveedor_id,
        fp1_0.subtotal,
        fp1_0.total 
    from
        factura_proveedor fp1_0 
    left join
        empresa e1_0 
            on e1_0.id=fp1_0.empresa_id 
    where
        e1_0.id=? 
    order by
        fp1_0.fecha desc
2026-01-23 10:49:21 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:21 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:49:21 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:21 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.correo,
        p1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        p1_0.identificacion,
        p1_0.nombre,
        p1_0.telefono 
    from
        proveedor p1_0 
    join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        p1_0.id=?
2026-01-23 10:49:21 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:49:21 [http-nio-8080-exec-7] DEBUG j.s.s.s.FacturaProveedorServicio - Encontradas 1 facturas de proveedor para empresa ID: 2
2026-01-23 10:49:21 [http-nio-8080-exec-7] DEBUG j.s.s.c.FacturaProveedorControlador - Encontradas 1 compras
2026-01-23 10:49:21 [http-nio-8080-exec-7] DEBUG j.s.s.c.FacturaProveedorControlador - Estad√≠sticas - Pagadas: 0, Anuladas: 0, Total valor: 535500.0
2026-01-23 10:49:21 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 168, Tenant anterior: 2
2026-01-23 10:49:21 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 168, Request: /compras, Empresa ID anterior: 2
2026-01-23 10:49:25 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-23 10:49:25 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:49:25 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-23 10:49:25 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-23 10:49:25 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:49:25 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:49:25 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:49:25 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:49:25 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 169
2026-01-23 10:49:25 [http-nio-8080-exec-8] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:49:25 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:49:25 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:49:25 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:49:25 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:49:25 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:49:25 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:49:25 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:25 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:49:25 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-23 10:49:25 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:49:25 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:49:25 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:49:25 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:49:25 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:49:25 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:49:25 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:49:25 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:49:25 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:49:25 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:49:25 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:49:25 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:49:25 [http-nio-8080-exec-8] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-23
2026-01-23 10:49:25 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-23 10:49:25 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:49:25 [http-nio-8080-exec-8] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-23
2026-01-23 10:49:25 [http-nio-8080-exec-8] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-23 10:49:25 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 169, Tenant anterior: 2
2026-01-23 10:49:25 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 169, Request: /principal, Empresa ID anterior: 2
2026-01-23 10:49:26 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios
2026-01-23 10:49:26 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:49:26 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios
2026-01-23 10:49:26 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios, M√©todo: GET
2026-01-23 10:49:26 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:49:26 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:49:26 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:49:26 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:49:26 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 170
2026-01-23 10:49:26 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:49:26 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:49:26 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:49:26 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:49:26 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:49:26 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:49:26 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:49:26 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:26 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:49:26 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios, Empresa ID: 2
2026-01-23 10:49:26 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:49:26 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:49:26 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:49:26 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:49:26 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:49:26 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:49:26 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:49:26 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:49:26 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:49:26 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:49:26 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:49:26 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:49:26 [http-nio-8080-exec-9] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-23 10:49:26 [http-nio-8080-exec-9] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-23 10:49:26 [http-nio-8080-exec-9] INFO  j.s.s.c.UsuarioControlador - üìã GET /admin/usuarios - Listando usuarios
2026-01-23 10:49:26 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Listando usuarios para empresa ID: 2
2026-01-23 10:49:26 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:49:26 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:26 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:49:26 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:26 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 170, Tenant anterior: 2
2026-01-23 10:49:26 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 170, Request: /admin/usuarios, Empresa ID anterior: 2
2026-01-23 10:49:29 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-23 10:49:29 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:49:29 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-23 10:49:29 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-23 10:49:29 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:49:29 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:49:29 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:49:29 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:49:29 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 171
2026-01-23 10:49:29 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:49:29 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:49:29 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:49:29 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:49:29 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:49:29 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:49:29 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:49:29 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:29 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:49:29 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-23 10:49:29 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:49:29 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:49:29 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:49:29 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:49:29 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:49:29 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:49:29 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:49:29 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:49:29 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:49:29 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:49:29 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:49:29 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:49:29 [http-nio-8080-exec-10] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-23
2026-01-23 10:49:29 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-23 10:49:29 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:49:29 [http-nio-8080-exec-10] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-23
2026-01-23 10:49:29 [http-nio-8080-exec-10] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-23 10:49:29 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 171, Tenant anterior: 2
2026-01-23 10:49:29 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 171, Request: /principal, Empresa ID anterior: 2
2026-01-23 10:49:29 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /reportes/consumo
2026-01-23 10:49:29 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:49:29 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /reportes/consumo
2026-01-23 10:49:29 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /reportes/consumo, M√©todo: GET
2026-01-23 10:49:29 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:49:29 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:49:29 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:49:29 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:49:29 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 162
2026-01-23 10:49:29 [http-nio-8080-exec-1] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:49:29 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:49:29 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:49:29 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:49:29 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:49:29 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:49:29 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:49:29 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:29 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:49:29 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /reportes/consumo, Empresa ID: 2
2026-01-23 10:49:29 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:49:29 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:49:29 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:49:29 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:49:29 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:49:29 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:49:29 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:49:29 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:49:29 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:49:29 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:49:29 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:49:29 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:49:29 [http-nio-8080-exec-1] INFO  j.s.s.c.ReporteConsumoController - üìä GET /reportes/consumo - Generando reporte. Fechas inicio: null, fin: null
2026-01-23 10:49:29 [http-nio-8080-exec-1] DEBUG j.s.s.c.ReporteConsumoController - Fechas para reporte: 2026-01-16 a 2026-01-23
2026-01-23 10:49:29 [http-nio-8080-exec-1] INFO  j.s.s.s.ReporteConsumoServicio - Generando reporte de consumo desde 2026-01-16 hasta 2026-01-23
2026-01-23 10:49:29 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.ingrediente_id,
        dcid1_0.stock_real 
    from
        detalle_cierre_inventario_diario dcid1_0 
    join
        cierre_inventario_diario c1_0 
            on c1_0.id=dcid1_0.cierre_id 
    where
        c1_0.estado='COMPLETADO' 
        and c1_0.fecha=(
            select
                max(cid1_0.fecha) 
            from
                cierre_inventario_diario cid1_0 
            where
                cid1_0.estado='COMPLETADO' 
                and cid1_0.fecha<?
        ) 
        and dcid1_0.ingrediente_id is not null
2026-01-23 10:49:29 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-23 10:49:29 [http-nio-8080-exec-1] DEBUG j.s.s.s.ReporteConsumoServicio - Stocks iniciales encontrados: 0 registros
2026-01-23 10:49:29 [http-nio-8080-exec-1] INFO  j.s.s.s.ReporteConsumoServicio - üìä Stocks iniciales encontrados: 0
2026-01-23 10:49:29 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.ingrediente_id,
        dcid1_0.stock_real 
    from
        detalle_cierre_inventario_diario dcid1_0 
    join
        cierre_inventario_diario c1_0 
            on c1_0.id=dcid1_0.cierre_id 
    where
        c1_0.estado='COMPLETADO' 
        and c1_0.fecha=(
            select
                max(cid1_0.fecha) 
            from
                cierre_inventario_diario cid1_0 
            where
                cid1_0.estado='COMPLETADO' 
                and cid1_0.fecha<=?
        ) 
        and dcid1_0.ingrediente_id is not null
2026-01-23 10:49:29 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:49:29 [http-nio-8080-exec-1] DEBUG j.s.s.s.ReporteConsumoServicio - Stocks finales encontrados: 0 registros
2026-01-23 10:49:29 [http-nio-8080-exec-1] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@354604710 wrapping com.mysql.cj.jdbc.ConnectionImpl@72ce6d41] read-only
2026-01-23 10:49:29 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0
2026-01-23 10:49:29 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:49:29 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:29 [http-nio-8080-exec-1] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@354604710 wrapping com.mysql.cj.jdbc.ConnectionImpl@72ce6d41]
2026-01-23 10:49:29 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        p1_0.receta_id,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta 
    from
        producto p1_0 
    where
        not(p1_0.tiene_receta)
2026-01-23 10:49:29 [http-nio-8080-exec-1] DEBUG j.s.s.s.ReporteConsumoServicio - Total ingredientes: 1, Productos sin receta: 0
2026-01-23 10:49:29 [http-nio-8080-exec-1] INFO  j.s.s.s.ReporteConsumoServicio - Procesando 1 ingredientes
2026-01-23 10:49:29 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        coalesce(sum(fdp1_0.cantidad), 0) 
    from
        factura_detalle_proveedor fdp1_0 
    join
        factura_proveedor fp1_0 
            on fp1_0.id=fdp1_0.factura_proveedor_id 
    where
        fdp1_0.ingrediente_id=? 
        and fp1_0.fecha between ? and ?
2026-01-23 10:49:29 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:49:29 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:DATE) <- [2026-01-16]
2026-01-23 10:49:29 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:DATE) <- [2026-01-23]
2026-01-23 10:49:29 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        coalesce(sum((i1_0.cantidad_ingrediente*fd1_0.cantidad)), 0) 
    from
        factura_detalle fd1_0 
    join
        producto p1_0 
            on p1_0.id=fd1_0.producto_id 
    join
        receta r1_0 
            on r1_0.id=p1_0.receta_id 
    join
        receta_detalle i1_0 
            on r1_0.id=i1_0.receta_id 
    join
        factura f1_0 
            on f1_0.id=fd1_0.factura_id 
    where
        i1_0.ingrediente_id=? 
        and f1_0.fecha between ? and ? 
        and f1_0.estado='PAGADA'
2026-01-23 10:49:29 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:49:29 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:DATE) <- [2026-01-16]
2026-01-23 10:49:29 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:DATE) <- [2026-01-23]
2026-01-23 10:49:29 [http-nio-8080-exec-1] INFO  j.s.s.s.ReporteConsumoServicio - Procesando 0 productos sin receta
2026-01-23 10:49:29 [http-nio-8080-exec-1] WARN  j.s.s.s.ReporteConsumoServicio - Total consumo valor es 0, porcentaje de diferencia establecido en 0
2026-01-23 10:49:29 [http-nio-8080-exec-1] INFO  j.s.s.s.ReporteConsumoServicio - Reporte generado exitosamente. Total items: 1, Diferencia total: -430000.0, Porcentaje: 0.0%
2026-01-23 10:49:29 [http-nio-8080-exec-1] INFO  j.s.s.c.ReporteConsumoController - ‚úÖ Reporte generado exitosamente. Items: 1
2026-01-23 10:49:29 [http-nio-8080-exec-1] DEBUG j.s.s.c.ReporteConsumoController - Reporte a√±adido al modelo. Total diferencia: -430000.0
2026-01-23 10:49:29 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 162, Tenant anterior: 2
2026-01-23 10:49:29 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 162, Request: /reportes/consumo, Empresa ID anterior: 2
2026-01-23 10:49:38 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-23 10:49:38 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:49:38 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-23 10:49:38 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-23 10:49:38 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:49:38 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:49:38 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:49:38 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:49:38 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 163
2026-01-23 10:49:38 [http-nio-8080-exec-2] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:49:38 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:49:38 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:49:38 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:49:38 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:49:38 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:49:38 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:49:38 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:38 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:49:38 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-23 10:49:38 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:49:38 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:49:38 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:49:38 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:49:38 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:49:38 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:49:38 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:49:38 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:49:38 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:49:38 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:49:38 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:49:38 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:49:38 [http-nio-8080-exec-2] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-23
2026-01-23 10:49:38 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-23 10:49:38 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:49:38 [http-nio-8080-exec-2] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-23
2026-01-23 10:49:38 [http-nio-8080-exec-2] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-23 10:49:38 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 163, Tenant anterior: 2
2026-01-23 10:49:38 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 163, Request: /principal, Empresa ID anterior: 2
2026-01-23 10:49:39 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /proveedores
2026-01-23 10:49:39 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:49:39 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /proveedores
2026-01-23 10:49:39 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /proveedores, M√©todo: GET
2026-01-23 10:49:39 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:49:39 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:49:39 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:49:39 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:49:39 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 164
2026-01-23 10:49:39 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:49:39 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:49:39 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:49:39 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:49:39 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:49:39 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:49:39 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:49:39 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:39 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:49:39 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /proveedores, Empresa ID: 2
2026-01-23 10:49:39 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:49:39 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:49:39 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:49:39 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:49:39 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:49:39 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:49:39 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:49:39 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:49:39 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:49:39 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:49:39 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:49:39 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:49:39 [http-nio-8080-exec-3] INFO  j.s.s.c.ProveedorControlador - üìã GET /proveedores - Listando proveedores
2026-01-23 10:49:39 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.ProveedorServicio - Listando proveedores para empresa ID: 2
2026-01-23 10:49:39 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.correo,
        p1_0.empresa_id,
        p1_0.identificacion,
        p1_0.nombre,
        p1_0.telefono 
    from
        proveedor p1_0 
    left join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:49:39 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:39 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:49:39 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:39 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.ProveedorServicio - Encontrados 1 proveedores para empresa ID: 2
2026-01-23 10:49:39 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 164, Tenant anterior: 2
2026-01-23 10:49:39 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 164, Request: /proveedores, Empresa ID anterior: 2
2026-01-23 10:49:41 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-23 10:49:41 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:49:41 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-23 10:49:41 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-23 10:49:41 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:49:41 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:49:41 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:49:41 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:49:41 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 165
2026-01-23 10:49:41 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:49:41 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:49:41 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:49:41 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:49:41 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:49:41 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:49:41 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:49:41 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:41 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:49:41 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-23 10:49:41 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:49:41 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:49:41 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:49:41 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:49:41 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:49:41 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:49:41 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:49:41 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:49:41 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:49:41 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:49:41 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:49:41 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:49:41 [http-nio-8080-exec-4] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-23
2026-01-23 10:49:41 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-23 10:49:41 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:49:41 [http-nio-8080-exec-4] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-23
2026-01-23 10:49:41 [http-nio-8080-exec-4] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-23 10:49:41 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 165, Tenant anterior: 2
2026-01-23 10:49:41 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 165, Request: /principal, Empresa ID anterior: 2
2026-01-23 10:49:42 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /compras/nueva
2026-01-23 10:49:42 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:49:42 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /compras/nueva
2026-01-23 10:49:42 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /compras/nueva, M√©todo: GET
2026-01-23 10:49:42 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:49:42 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:49:42 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:49:42 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:49:42 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 166
2026-01-23 10:49:42 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:49:42 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:49:42 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:49:42 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:49:42 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:49:42 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:49:42 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:49:42 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:42 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:49:42 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /compras/nueva, Empresa ID: 2
2026-01-23 10:49:42 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:49:42 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:49:42 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:49:42 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:49:42 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:49:42 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:49:42 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:49:42 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:49:42 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:49:42 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:49:42 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:49:42 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:49:42 [http-nio-8080-exec-5] INFO  j.s.s.c.FacturaProveedorControlador - üìù GET /compras/nueva - Mostrando formulario nueva compra
2026-01-23 10:49:42 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.ProveedorServicio - Listando proveedores para empresa ID: 2
2026-01-23 10:49:42 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.correo,
        p1_0.empresa_id,
        p1_0.identificacion,
        p1_0.nombre,
        p1_0.telefono 
    from
        proveedor p1_0 
    left join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:49:42 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:42 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:49:42 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:42 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.ProveedorServicio - Encontrados 1 proveedores para empresa ID: 2
2026-01-23 10:49:42 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.IngredienteServicio - Listando ingredientes para empresa ID: 2
2026-01-23 10:49:42 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    left join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:49:42 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:42 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:49:42 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:42 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.IngredienteServicio - Encontrados 1 ingredientes para empresa ID: 2
2026-01-23 10:49:42 [http-nio-8080-exec-5] DEBUG j.s.s.c.FacturaProveedorControlador - Formulario cargado - Proveedores activos: 1, Ingredientes: 1
2026-01-23 10:49:42 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 166, Tenant anterior: 2
2026-01-23 10:49:42 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 166, Request: /compras/nueva, Empresa ID anterior: 2
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing POST /compras/guardar
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured POST /compras/guardar
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /compras/guardar, M√©todo: POST
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 167
2026-01-23 10:49:54 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /compras/guardar, Empresa ID: 2
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:49:54 [http-nio-8080-exec-6] INFO  j.s.s.c.FacturaProveedorControlador - üíæ POST /compras/guardar - Guardando compra a proveedor
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG j.s.s.c.FacturaProveedorControlador - Datos compra - Proveedor ID: 1, N√∫mero factura: null
2026-01-23 10:49:54 [http-nio-8080-exec-6] INFO  j.s.s.s.FacturaProveedorServicio - Creando factura de proveedor para empresa ID: 2
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG j.s.s.s.FacturaProveedorServicio - Empresa asignada: Empresa JOse (ID: 2)
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.correo,
        p1_0.empresa_id,
        p1_0.identificacion,
        p1_0.nombre,
        p1_0.telefono 
    from
        proveedor p1_0 
    left join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        p1_0.id=? 
        and e1_0.id=?
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG j.s.s.s.FacturaProveedorServicio - Proveedor asignado: Jose Pino (ID: 1)
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        count(fp1_0.id) 
    from
        factura_proveedor fp1_0 
    left join
        empresa e1_0 
            on e1_0.id=fp1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG j.s.s.s.FacturaProveedorServicio - Consecutivo generado: 2 para empresa ID: 2
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG j.s.s.s.FacturaProveedorServicio - N√∫mero de factura generado: FAC-PROV-002-2026
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG j.s.s.s.FacturaProveedorServicio - Procesando 1 detalles de factura
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    left join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=? 
        and e1_0.id=?
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG j.s.s.s.FacturaProveedorServicio - Stock actualizado para ingrediente 'Pepsi 2.5 Litro': Anterior: 100.0, Nuevo: 200.0, Aumento: 100.0
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG j.s.s.s.FacturaProveedorServicio - Totales calculados - Subtotal: 430000.0, IVA: 81700.0, Total: 511700.0
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG j.s.s.s.FacturaProveedorServicio - Estado proporcionado: PENDIENTE
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        factura_proveedor
        (empresa_id, estado, fecha, iva, numero_factura, proveedor_id, subtotal, total) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [PENDIENTE]
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:DATE) <- [2026-01-23]
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DOUBLE) <- [81700.0]
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [FAC-PROV-002-2026]
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:BIGINT) <- [1]
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:DOUBLE) <- [430000.0]
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:DOUBLE) <- [511700.0]
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        factura_detalle_proveedor
        (cantidad, factura_proveedor_id, ingrediente_id, precio_unitario, subtotal) 
    values
        (?, ?, ?, ?, ?)
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DOUBLE) <- [100.0]
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DOUBLE) <- [4300.0]
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:DOUBLE) <- [430000.0]
2026-01-23 10:49:54 [http-nio-8080-exec-6] INFO  j.s.s.s.FacturaProveedorServicio - Factura de proveedor creada exitosamente: FAC-PROV-002-2026 (ID: 2) para empresa ID: 2. Total: 511700.0, Detalles: 1
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    update
        ingrediente 
    set
        activo=?,
        empresa_id=?,
        nombre=?,
        precio=?,
        stock_actual=?,
        stock_minimo=?,
        unidad_medida=? 
    where
        id=?
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [Pepsi 2.5 Litro]
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DOUBLE) <- [4300.0]
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:DOUBLE) <- [200.0]
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DOUBLE) <- [0.0]
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [Unid]
2026-01-23 10:49:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:BIGINT) <- [1]
2026-01-23 10:49:54 [http-nio-8080-exec-6] INFO  j.s.s.c.FacturaProveedorControlador - ‚úÖ Compra a proveedor guardada exitosamente: FAC-PROV-002-2026 (ID: 2)
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 167, Tenant anterior: 2
2026-01-23 10:49:54 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 167, Request: /compras/guardar, Empresa ID anterior: 2
2026-01-23 10:49:54 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /compras
2026-01-23 10:49:54 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:49:54 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /compras
2026-01-23 10:49:54 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /compras, M√©todo: GET
2026-01-23 10:49:54 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:49:54 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:49:54 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:49:54 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:49:54 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 168
2026-01-23 10:49:54 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:49:54 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:49:54 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:49:54 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:49:54 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:49:54 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:49:54 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:49:54 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:54 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:49:54 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /compras, Empresa ID: 2
2026-01-23 10:49:54 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:49:54 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:49:54 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:49:54 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:49:54 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:49:54 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:49:54 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:49:54 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:49:54 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:49:54 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:49:54 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:49:54 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:49:54 [http-nio-8080-exec-7] INFO  j.s.s.c.FacturaProveedorControlador - üìã GET /compras - Listando compras a proveedores
2026-01-23 10:49:54 [http-nio-8080-exec-7] DEBUG j.s.s.s.FacturaProveedorServicio - Listando facturas de proveedor para empresa ID: 2
2026-01-23 10:49:54 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fp1_0.id,
        fp1_0.empresa_id,
        fp1_0.estado,
        fp1_0.fecha,
        fp1_0.iva,
        fp1_0.numero_factura,
        fp1_0.proveedor_id,
        fp1_0.subtotal,
        fp1_0.total 
    from
        factura_proveedor fp1_0 
    left join
        empresa e1_0 
            on e1_0.id=fp1_0.empresa_id 
    where
        e1_0.id=? 
    order by
        fp1_0.fecha desc
2026-01-23 10:49:54 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:54 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:49:54 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:54 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.correo,
        p1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        p1_0.identificacion,
        p1_0.nombre,
        p1_0.telefono 
    from
        proveedor p1_0 
    join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        p1_0.id=?
2026-01-23 10:49:54 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:49:54 [http-nio-8080-exec-7] DEBUG j.s.s.s.FacturaProveedorServicio - Encontradas 2 facturas de proveedor para empresa ID: 2
2026-01-23 10:49:54 [http-nio-8080-exec-7] DEBUG j.s.s.c.FacturaProveedorControlador - Encontradas 2 compras
2026-01-23 10:49:54 [http-nio-8080-exec-7] DEBUG j.s.s.c.FacturaProveedorControlador - Estad√≠sticas - Pagadas: 0, Anuladas: 0, Total valor: 1047200.0
2026-01-23 10:49:54 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 168, Tenant anterior: 2
2026-01-23 10:49:54 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 168, Request: /compras, Empresa ID anterior: 2
2026-01-23 10:49:57 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /compras/nueva
2026-01-23 10:49:57 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:49:57 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /compras/nueva
2026-01-23 10:49:57 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /compras/nueva, M√©todo: GET
2026-01-23 10:49:57 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:49:57 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:49:57 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:49:57 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:49:57 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 169
2026-01-23 10:49:57 [http-nio-8080-exec-8] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:49:57 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:49:57 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:49:57 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:49:57 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:49:57 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:49:57 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:49:57 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:57 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:49:57 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /compras/nueva, Empresa ID: 2
2026-01-23 10:49:57 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:49:57 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:49:57 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:49:57 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:49:57 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:49:57 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:49:57 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:49:57 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:49:57 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:49:57 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:49:57 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:49:57 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:49:57 [http-nio-8080-exec-8] INFO  j.s.s.c.FacturaProveedorControlador - üìù GET /compras/nueva - Mostrando formulario nueva compra
2026-01-23 10:49:57 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.ProveedorServicio - Listando proveedores para empresa ID: 2
2026-01-23 10:49:57 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.correo,
        p1_0.empresa_id,
        p1_0.identificacion,
        p1_0.nombre,
        p1_0.telefono 
    from
        proveedor p1_0 
    left join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:49:57 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:57 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:49:57 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:57 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.ProveedorServicio - Encontrados 1 proveedores para empresa ID: 2
2026-01-23 10:49:57 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.IngredienteServicio - Listando ingredientes para empresa ID: 2
2026-01-23 10:49:57 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    left join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:49:57 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:57 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:49:57 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:49:58 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.IngredienteServicio - Encontrados 1 ingredientes para empresa ID: 2
2026-01-23 10:49:58 [http-nio-8080-exec-8] DEBUG j.s.s.c.FacturaProveedorControlador - Formulario cargado - Proveedores activos: 1, Ingredientes: 1
2026-01-23 10:49:58 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 169, Tenant anterior: 2
2026-01-23 10:49:58 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 169, Request: /compras/nueva, Empresa ID anterior: 2
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing POST /compras/guardar
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured POST /compras/guardar
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /compras/guardar, M√©todo: POST
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 170
2026-01-23 10:50:09 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /compras/guardar, Empresa ID: 2
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:50:09 [http-nio-8080-exec-9] INFO  j.s.s.c.FacturaProveedorControlador - üíæ POST /compras/guardar - Guardando compra a proveedor
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG j.s.s.c.FacturaProveedorControlador - Datos compra - Proveedor ID: 1, N√∫mero factura: null
2026-01-23 10:50:09 [http-nio-8080-exec-9] INFO  j.s.s.s.FacturaProveedorServicio - Creando factura de proveedor para empresa ID: 2
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG j.s.s.s.FacturaProveedorServicio - Empresa asignada: Empresa JOse (ID: 2)
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.correo,
        p1_0.empresa_id,
        p1_0.identificacion,
        p1_0.nombre,
        p1_0.telefono 
    from
        proveedor p1_0 
    left join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        p1_0.id=? 
        and e1_0.id=?
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG j.s.s.s.FacturaProveedorServicio - Proveedor asignado: Jose Pino (ID: 1)
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        count(fp1_0.id) 
    from
        factura_proveedor fp1_0 
    left join
        empresa e1_0 
            on e1_0.id=fp1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG j.s.s.s.FacturaProveedorServicio - Consecutivo generado: 3 para empresa ID: 2
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG j.s.s.s.FacturaProveedorServicio - N√∫mero de factura generado: FAC-PROV-003-2026
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG j.s.s.s.FacturaProveedorServicio - Procesando 1 detalles de factura
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    left join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=? 
        and e1_0.id=?
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG j.s.s.s.FacturaProveedorServicio - Stock actualizado para ingrediente 'Pepsi 2.5 Litro': Anterior: 200.0, Nuevo: 300.0, Aumento: 100.0
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG j.s.s.s.FacturaProveedorServicio - Totales calculados - Subtotal: 430000.0, IVA: 81700.0, Total: 511700.0
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG j.s.s.s.FacturaProveedorServicio - Estado proporcionado: PENDIENTE
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        factura_proveedor
        (empresa_id, estado, fecha, iva, numero_factura, proveedor_id, subtotal, total) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [PENDIENTE]
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:DATE) <- [2026-01-23]
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DOUBLE) <- [81700.0]
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [FAC-PROV-003-2026]
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:BIGINT) <- [1]
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:DOUBLE) <- [430000.0]
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:DOUBLE) <- [511700.0]
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        factura_detalle_proveedor
        (cantidad, factura_proveedor_id, ingrediente_id, precio_unitario, subtotal) 
    values
        (?, ?, ?, ?, ?)
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DOUBLE) <- [100.0]
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DOUBLE) <- [4300.0]
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:DOUBLE) <- [430000.0]
2026-01-23 10:50:09 [http-nio-8080-exec-9] INFO  j.s.s.s.FacturaProveedorServicio - Factura de proveedor creada exitosamente: FAC-PROV-003-2026 (ID: 3) para empresa ID: 2. Total: 511700.0, Detalles: 1
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    update
        ingrediente 
    set
        activo=?,
        empresa_id=?,
        nombre=?,
        precio=?,
        stock_actual=?,
        stock_minimo=?,
        unidad_medida=? 
    where
        id=?
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [Pepsi 2.5 Litro]
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DOUBLE) <- [4300.0]
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:DOUBLE) <- [300.0]
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DOUBLE) <- [0.0]
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [Unid]
2026-01-23 10:50:09 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:BIGINT) <- [1]
2026-01-23 10:50:09 [http-nio-8080-exec-9] INFO  j.s.s.c.FacturaProveedorControlador - ‚úÖ Compra a proveedor guardada exitosamente: FAC-PROV-003-2026 (ID: 3)
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 170, Tenant anterior: 2
2026-01-23 10:50:09 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 170, Request: /compras/guardar, Empresa ID anterior: 2
2026-01-23 10:50:09 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /compras
2026-01-23 10:50:09 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:50:09 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /compras
2026-01-23 10:50:09 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /compras, M√©todo: GET
2026-01-23 10:50:09 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:50:09 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:50:09 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:50:09 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:50:09 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 171
2026-01-23 10:50:09 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:50:09 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:50:09 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:50:09 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:50:09 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:50:09 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:50:09 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:50:09 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:09 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:50:09 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /compras, Empresa ID: 2
2026-01-23 10:50:09 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:50:09 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:50:09 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:50:09 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:50:09 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:50:09 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:50:09 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:50:09 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:50:09 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:50:09 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:50:09 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:50:09 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:50:09 [http-nio-8080-exec-10] INFO  j.s.s.c.FacturaProveedorControlador - üìã GET /compras - Listando compras a proveedores
2026-01-23 10:50:09 [http-nio-8080-exec-10] DEBUG j.s.s.s.FacturaProveedorServicio - Listando facturas de proveedor para empresa ID: 2
2026-01-23 10:50:09 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fp1_0.id,
        fp1_0.empresa_id,
        fp1_0.estado,
        fp1_0.fecha,
        fp1_0.iva,
        fp1_0.numero_factura,
        fp1_0.proveedor_id,
        fp1_0.subtotal,
        fp1_0.total 
    from
        factura_proveedor fp1_0 
    left join
        empresa e1_0 
            on e1_0.id=fp1_0.empresa_id 
    where
        e1_0.id=? 
    order by
        fp1_0.fecha desc
2026-01-23 10:50:09 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:09 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:50:09 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:09 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.correo,
        p1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        p1_0.identificacion,
        p1_0.nombre,
        p1_0.telefono 
    from
        proveedor p1_0 
    join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        p1_0.id=?
2026-01-23 10:50:09 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:50:09 [http-nio-8080-exec-10] DEBUG j.s.s.s.FacturaProveedorServicio - Encontradas 3 facturas de proveedor para empresa ID: 2
2026-01-23 10:50:09 [http-nio-8080-exec-10] DEBUG j.s.s.c.FacturaProveedorControlador - Encontradas 3 compras
2026-01-23 10:50:09 [http-nio-8080-exec-10] DEBUG j.s.s.c.FacturaProveedorControlador - Estad√≠sticas - Pagadas: 0, Anuladas: 0, Total valor: 1558900.0
2026-01-23 10:50:09 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 171, Tenant anterior: 2
2026-01-23 10:50:09 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 171, Request: /compras, Empresa ID anterior: 2
2026-01-23 10:50:18 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-23 10:50:18 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:50:18 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-23 10:50:18 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-23 10:50:18 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:50:18 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:50:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:50:18 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:50:18 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 162
2026-01-23 10:50:18 [http-nio-8080-exec-1] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:50:18 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:50:18 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:50:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:50:18 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:50:18 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:50:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:50:18 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:18 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:50:18 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-23 10:50:18 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:50:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:50:18 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:50:18 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:50:18 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:50:18 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:50:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:50:18 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:50:18 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:50:18 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:50:18 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:50:18 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:50:18 [http-nio-8080-exec-1] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-23
2026-01-23 10:50:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-23 10:50:18 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:50:18 [http-nio-8080-exec-1] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-23
2026-01-23 10:50:18 [http-nio-8080-exec-1] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-23 10:50:18 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 162, Tenant anterior: 2
2026-01-23 10:50:18 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 162, Request: /principal, Empresa ID anterior: 2
2026-01-23 10:50:20 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /productos
2026-01-23 10:50:20 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:50:20 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured GET /productos
2026-01-23 10:50:20 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /productos, M√©todo: GET
2026-01-23 10:50:20 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:50:20 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:50:20 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:50:20 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:50:20 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 163
2026-01-23 10:50:20 [http-nio-8080-exec-2] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:50:20 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:50:20 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:50:20 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:50:20 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:50:20 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:50:20 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:50:20 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:20 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:50:20 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /productos, Empresa ID: 2
2026-01-23 10:50:20 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:50:20 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:50:20 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:50:20 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:50:20 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:50:20 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:50:20 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:50:20 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:50:20 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:50:20 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:50:20 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:50:20 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:50:20 [http-nio-8080-exec-2] INFO  j.s.s.c.ProductoControlador - üìã GET /productos - Listando productos
2026-01-23 10:50:20 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.ProductoServicio - Listando productos para empresa ID: 2
2026-01-23 10:50:20 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        p1_0.receta_id,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta 
    from
        producto p1_0 
    left join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:50:20 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:20 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.ProductoServicio - Encontrados 0 productos para empresa ID: 2
2026-01-23 10:50:20 [http-nio-8080-exec-2] DEBUG j.s.s.c.ProductoControlador - Encontrados 0 productos
2026-01-23 10:50:20 [http-nio-8080-exec-2] DEBUG j.s.s.c.ProductoControlador - Stock posible calculado para 0 productos con receta
2026-01-23 10:50:20 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 163, Tenant anterior: 2
2026-01-23 10:50:20 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 163, Request: /productos, Empresa ID anterior: 2
2026-01-23 10:50:21 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-23 10:50:21 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:50:21 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-23 10:50:21 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-23 10:50:21 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:50:21 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:50:21 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:50:21 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:50:21 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 164
2026-01-23 10:50:21 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:50:21 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:50:21 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:50:21 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:50:21 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:50:21 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:50:21 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:50:21 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:21 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:50:21 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-23 10:50:21 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:50:21 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:50:21 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:50:21 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:50:21 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:50:21 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:50:21 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:50:21 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:50:21 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:50:21 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:50:21 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:50:21 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:50:21 [http-nio-8080-exec-3] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-23
2026-01-23 10:50:21 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-23 10:50:21 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:50:21 [http-nio-8080-exec-3] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-23
2026-01-23 10:50:21 [http-nio-8080-exec-3] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-23 10:50:21 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 164, Tenant anterior: 2
2026-01-23 10:50:21 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 164, Request: /principal, Empresa ID anterior: 2
2026-01-23 10:50:22 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /recetas
2026-01-23 10:50:22 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:50:22 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /recetas
2026-01-23 10:50:22 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /recetas, M√©todo: GET
2026-01-23 10:50:22 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:50:22 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:50:22 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:50:22 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:50:22 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 165
2026-01-23 10:50:22 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:50:22 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:50:22 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:50:22 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:50:22 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:50:22 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:50:22 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:50:22 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:22 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:50:22 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /recetas, Empresa ID: 2
2026-01-23 10:50:22 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:50:22 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:50:22 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:50:22 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:50:22 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:50:22 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:50:22 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:50:22 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:50:22 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:50:22 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:50:22 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:50:22 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:50:22 [http-nio-8080-exec-4] INFO  j.s.s.c.RecetaControlador - üìã GET /recetas - Listando recetas
2026-01-23 10:50:22 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.RecetaServicio - Listando recetas para empresa ID: 2
2026-01-23 10:50:22 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        distinct r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        i1_0.receta_id,
        i1_0.id,
        i1_0.cantidad_ingrediente,
        i1_0.ingrediente_id,
        r1_0.nombre 
    from
        receta r1_0 
    left join
        receta_detalle i1_0 
            on r1_0.id=i1_0.receta_id 
    where
        r1_0.empresa_id=?
2026-01-23 10:50:22 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:22 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.RecetaServicio - Encontradas 0 recetas para empresa ID: 2
2026-01-23 10:50:22 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 165, Tenant anterior: 2
2026-01-23 10:50:22 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 165, Request: /recetas, Empresa ID anterior: 2
2026-01-23 10:50:22 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-23 10:50:22 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:50:22 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-23 10:50:22 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-23 10:50:22 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:50:22 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:50:22 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:50:22 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:50:22 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 166
2026-01-23 10:50:22 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:50:22 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:50:22 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:50:22 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:50:22 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:50:22 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:50:22 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:50:22 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:22 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:50:22 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-23 10:50:22 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:50:22 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:50:22 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:50:22 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:50:22 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:50:22 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-22
2026-01-23 10:50:22 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:50:22 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-23 10:50:22 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:50:22 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:50:22 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-22 cerrado?: true (Empresa ID: 2)
2026-01-23 10:50:22 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-22 cerrado correctamente
2026-01-23 10:50:22 [http-nio-8080-exec-5] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-23
2026-01-23 10:50:22 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-23 10:50:22 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:50:22 [http-nio-8080-exec-5] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-23
2026-01-23 10:50:22 [http-nio-8080-exec-5] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-23 10:50:22 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 166, Tenant anterior: 2
2026-01-23 10:50:22 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 166, Request: /principal, Empresa ID anterior: 2
2026-01-23 10:50:23 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres
2026-01-23 10:50:23 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:50:23 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres
2026-01-23 10:50:23 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres, M√©todo: GET
2026-01-23 10:50:23 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:50:23 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:50:23 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:50:23 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:50:23 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 167
2026-01-23 10:50:23 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:50:23 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:50:23 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:50:23 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:50:23 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:50:23 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:50:23 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:50:23 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:23 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:50:23 [http-nio-8080-exec-6] INFO  j.s.s.c.CierreInventarioDiarioControlador - üìã GET /cierres - Listando cierres diarios
2026-01-23 10:50:23 [http-nio-8080-exec-6] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo todos los cierres para empresa ID: 2
2026-01-23 10:50:23 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:50:23 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:23 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:50:23 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:23 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-23 10:50:23 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-23 10:50:23 [http-nio-8080-exec-6] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 2 cierres para empresa ID: 2
2026-01-23 10:50:23 [http-nio-8080-exec-6] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Encontrados 2 cierres
2026-01-23 10:50:23 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 167, Tenant anterior: 2
2026-01-23 10:50:23 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 167, Request: /cierres, Empresa ID anterior: 2
2026-01-23 10:50:40 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/iniciar?fecha=2026-01-23
2026-01-23 10:50:40 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:50:40 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/iniciar?fecha=2026-01-23
2026-01-23 10:50:40 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/iniciar, M√©todo: GET
2026-01-23 10:50:40 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:50:40 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:50:40 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:50:40 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:50:40 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 168
2026-01-23 10:50:40 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:50:40 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:50:40 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:50:40 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:50:40 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:50:40 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:50:40 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:50:40 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:40 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:50:40 [http-nio-8080-exec-7] INFO  j.s.s.c.CierreInventarioDiarioControlador - üöÄ GET /cierres/iniciar - Iniciando nuevo cierre. Usuario: admin, Fecha: 2026-01-23
2026-01-23 10:50:40 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:50:40 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:50:40 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:50:40 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:50:40 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:50:40 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:40 [http-nio-8080-exec-7] INFO  j.s.s.s.CierreInventarioDiarioService - Iniciando cierre para fecha espec√≠fica: 2026-01-23 para empresa ID: 2, Usuario: admin
2026-01-23 10:50:40 [http-nio-8080-exec-7] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@538988393 wrapping com.mysql.cj.jdbc.ConnectionImpl@72ce6d41] read-only
2026-01-23 10:50:40 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:50:40 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:40 [http-nio-8080-exec-7] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@538988393 wrapping com.mysql.cj.jdbc.ConnectionImpl@72ce6d41]
2026-01-23 10:50:40 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.fecha=? 
        and e1_0.id=?
2026-01-23 10:50:40 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:50:40 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:50:40 [http-nio-8080-exec-7] DEBUG j.s.s.s.CierreInventarioDiarioService - No hay cierre existente para fecha: 2026-01-23
2026-01-23 10:50:40 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        cierre_inventario_diario
        (cantidad_facturas, empresa_id, estado, fecha, observaciones, total_ventas, usuario_id) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-23 10:50:40 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:INTEGER) <- [0]
2026-01-23 10:50:40 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:50:40 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [EN_PROCESO]
2026-01-23 10:50:40 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DATE) <- [2026-01-23]
2026-01-23 10:50:40 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [Cierre para fecha espec√≠fica 2026-01-23]
2026-01-23 10:50:40 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DOUBLE) <- [0.0]
2026-01-23 10:50:40 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:BIGINT) <- [5]
2026-01-23 10:50:40 [http-nio-8080-exec-7] INFO  j.s.s.s.CierreInventarioDiarioService - ‚úÖ Cierre creado para fecha espec√≠fica ID: 3 - Fecha: 2026-01-23, Usuario: admin
2026-01-23 10:50:40 [http-nio-8080-exec-7] DEBUG j.s.s.s.CierreInventarioDiarioService - Precargando detalles para cierre ID: 3
2026-01-23 10:50:40 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    left join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:50:40 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:40 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:50:40 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:40 [http-nio-8080-exec-7] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 1 ingredientes para empresa ID: 2
2026-01-23 10:50:40 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        p1_0.receta_id,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta 
    from
        producto p1_0 
    left join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        e1_0.id=? 
        and not(p1_0.tiene_receta)
2026-01-23 10:50:40 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:40 [http-nio-8080-exec-7] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 0 productos sin receta para empresa ID: 2
2026-01-23 10:50:40 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        detalle_cierre_inventario_diario
        (cierre_id, costo_unitario, diferencia, ingrediente_id, producto_id, stock_desperdicio, stock_merma, stock_real, stock_teorico, valor_diferencia) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2026-01-23 10:50:40 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-23 10:50:40 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:DOUBLE) <- [4300.0]
2026-01-23 10:50:40 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:DOUBLE) <- [0.0]
2026-01-23 10:50:40 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [1]
2026-01-23 10:50:40 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:BIGINT) <- [null]
2026-01-23 10:50:40 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DOUBLE) <- [0.0]
2026-01-23 10:50:40 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:DOUBLE) <- [0.0]
2026-01-23 10:50:40 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:DOUBLE) <- [0.0]
2026-01-23 10:50:40 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:DOUBLE) <- [300.0]
2026-01-23 10:50:40 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:DOUBLE) <- [0.0]
2026-01-23 10:50:40 [http-nio-8080-exec-7] INFO  j.s.s.s.CierreInventarioDiarioService - Detalles precargados: 1 totales para cierre ID: 3
2026-01-23 10:50:40 [http-nio-8080-exec-7] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚úÖ Cierre iniciado para fecha espec√≠fica: 2026-01-23 por usuario: admin
2026-01-23 10:50:40 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 168, Tenant anterior: 2
2026-01-23 10:50:40 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 168, Request: /cierres/iniciar, Empresa ID anterior: 2
2026-01-23 10:50:40 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/en-proceso
2026-01-23 10:50:40 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:50:40 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/en-proceso
2026-01-23 10:50:40 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/en-proceso, M√©todo: GET
2026-01-23 10:50:40 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:50:40 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:50:40 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:50:40 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:50:40 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 169
2026-01-23 10:50:40 [http-nio-8080-exec-8] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:50:40 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:50:40 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:50:40 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:50:40 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:50:40 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:50:40 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:50:40 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:40 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:50:40 [http-nio-8080-exec-8] INFO  j.s.s.c.CierreInventarioDiarioControlador - üîç GET /cierres/en-proceso - Viendo cierre en proceso
2026-01-23 10:50:40 [http-nio-8080-exec-8] DEBUG j.s.s.s.CierreInventarioDiarioService - Buscando cierre en proceso para empresa ID: 2
2026-01-23 10:50:40 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.estado=? 
        and e1_0.id=?
2026-01-23 10:50:40 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [EN_PROCESO]
2026-01-23 10:50:40 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:50:40 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:50:40 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:40 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-23 10:50:40 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-23 10:50:40 [http-nio-8080-exec-8] DEBUG j.s.s.s.CierreInventarioDiarioService - Cierre en proceso encontrado ID: 3 para empresa ID: 2
2026-01-23 10:50:40 [http-nio-8080-exec-8] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo detalles para cierre ID: 3
2026-01-23 10:50:40 [http-nio-8080-exec-8] DEBUG j.s.s.s.CierreInventarioDiarioService - Buscando cierre ID: 3 para empresa ID: 2
2026-01-23 10:50:40 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.id=? 
        and e1_0.id=?
2026-01-23 10:50:40 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-23 10:50:40 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:50:40 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:50:40 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:40 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-23 10:50:40 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-23 10:50:40 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        dcid1_0.ingrediente_id,
        dcid1_0.producto_id,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    where
        dcid1_0.cierre_id=?
2026-01-23 10:50:40 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-23 10:50:40 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        s1_0.nombre,
        s1_0.telefono 
    from
        cierre_inventario_diario cid1_0 
    join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=cid1_0.usuario_id 
    left join
        empresa e2_0 
            on e2_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    where
        cid1_0.id=?
2026-01-23 10:50:40 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-23 10:50:40 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-23 10:50:40 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:50:40 [http-nio-8080-exec-8] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 1 detalles para cierre ID: 3
2026-01-23 10:50:40 [http-nio-8080-exec-8] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Cierre en proceso ID: 3, Estado: EN_PROCESO, Detalles: 1, Total diferencia: 0.0
2026-01-23 10:50:40 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 169, Tenant anterior: 2
2026-01-23 10:50:40 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 169, Request: /cierres/en-proceso, Empresa ID anterior: 2
2026-01-23 10:50:50 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing POST /cierres/completar/3
2026-01-23 10:50:50 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:50:50 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured POST /cierres/completar/3
2026-01-23 10:50:50 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/completar/3, M√©todo: POST
2026-01-23 10:50:50 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:50:50 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:50:50 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:50:50 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 170
2026-01-23 10:50:50 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:50:50 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:50:50 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:50:50 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:50:50 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:50 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:50:50 [http-nio-8080-exec-9] INFO  j.s.s.c.CierreInventarioDiarioControlador - üìù POST /cierres/completar/3 - Completando cierre (PRE-COMPLETADO)
2026-01-23 10:50:50 [http-nio-8080-exec-9] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Recibidos 1 detalles para guardar
2026-01-23 10:50:50 [http-nio-8080-exec-9] DEBUG j.s.s.s.CierreInventarioDiarioService - Actualizando detalle ID: 1 para empresa ID: 2
2026-01-23 10:50:50 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        dcid1_0.ingrediente_id,
        dcid1_0.producto_id,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    left join
        cierre_inventario_diario c1_0 
            on c1_0.id=dcid1_0.cierre_id 
    left join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    where
        dcid1_0.id=? 
        and e1_0.id=?
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:50:50 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        s1_0.nombre,
        s1_0.telefono 
    from
        cierre_inventario_diario cid1_0 
    join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=cid1_0.usuario_id 
    left join
        empresa e2_0 
            on e2_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    where
        cid1_0.id=?
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-23 10:50:50 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:50:50 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        c1_0.id,
        c1_0.cantidad_facturas,
        c1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        c1_0.estado,
        c1_0.fecha,
        c1_0.observaciones,
        c1_0.total_ventas,
        c1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e3_0.id,
        e3_0.email_contacto,
        e3_0.estado,
        e3_0.fecha_creacion,
        e3_0.nombre,
        e3_0.plan,
        e3_0.subdominio,
        e3_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida,
        rd1_0.ingrediente_id,
        rd1_0.id,
        rd1_0.cantidad_ingrediente,
        rd1_0.receta_id,
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        e4_0.id,
        e4_0.email_contacto,
        e4_0.estado,
        e4_0.fecha_creacion,
        e4_0.nombre,
        e4_0.plan,
        e4_0.subdominio,
        e4_0.telefono,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        r2_0.id,
        r2_0.costo_receta,
        r2_0.descripcion,
        r2_0.empresa_id,
        r2_0.nombre,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    join
        cierre_inventario_diario c1_0 
            on c1_0.id=dcid1_0.cierre_id 
    join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=c1_0.usuario_id 
    left join
        ingrediente i1_0 
            on i1_0.id=dcid1_0.ingrediente_id 
    left join
        empresa e3_0 
            on e3_0.id=i1_0.empresa_id 
    left join
        receta_detalle rd1_0 
            on i1_0.id=rd1_0.ingrediente_id 
    left join
        producto p1_0 
            on p1_0.id=dcid1_0.producto_id 
    left join
        empresa e4_0 
            on e4_0.id=p1_0.empresa_id 
    left join
        receta r2_0 
            on r2_0.id=p1_0.receta_id 
    where
        dcid1_0.id=?
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:50:50 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        d1_0.cierre_id,
        d1_0.id,
        d1_0.costo_unitario,
        d1_0.diferencia,
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida,
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        r1_0.nombre,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta,
        d1_0.stock_desperdicio,
        d1_0.stock_merma,
        d1_0.stock_real,
        d1_0.stock_teorico,
        d1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario d1_0 
    left join
        ingrediente i1_0 
            on i1_0.id=d1_0.ingrediente_id 
    left join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    left join
        producto p1_0 
            on p1_0.id=d1_0.producto_id 
    left join
        empresa e2_0 
            on e2_0.id=p1_0.empresa_id 
    left join
        receta r1_0 
            on r1_0.id=p1_0.receta_id 
    where
        d1_0.cierre_id=?
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-23 10:50:50 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    update
        detalle_cierre_inventario_diario 
    set
        cierre_id=?,
        costo_unitario=?,
        diferencia=?,
        ingrediente_id=?,
        producto_id=?,
        stock_desperdicio=?,
        stock_merma=?,
        stock_real=?,
        stock_teorico=?,
        valor_diferencia=? 
    where
        id=?
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:DOUBLE) <- [4300.0]
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:DOUBLE) <- [0.0]
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:BIGINT) <- [1]
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:BIGINT) <- [null]
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DOUBLE) <- [0.0]
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:DOUBLE) <- [0.0]
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:DOUBLE) <- [300.0]
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:DOUBLE) <- [300.0]
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (10:DOUBLE) <- [0.0]
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (11:BIGINT) <- [1]
2026-01-23 10:50:50 [http-nio-8080-exec-9] INFO  j.s.s.s.CierreInventarioDiarioService - Detalle actualizado ID: 1, Stock real: 300.0, Diferencia: 0.0, Valor diferencia: 0.0
2026-01-23 10:50:50 [http-nio-8080-exec-9] DEBUG j.s.s.c.CierreInventarioDiarioControlador - 1 detalles actualizados
2026-01-23 10:50:50 [http-nio-8080-exec-9] INFO  j.s.s.s.CierreInventarioDiarioService - Completando cierre ID: 3 para empresa ID: 2
2026-01-23 10:50:50 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.id=? 
        and e1_0.id=?
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:50:50 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:50 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-23 10:50:50 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        dcid1_0.ingrediente_id,
        dcid1_0.producto_id,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    where
        dcid1_0.cierre_id=?
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-23 10:50:50 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        s1_0.nombre,
        s1_0.telefono 
    from
        cierre_inventario_diario cid1_0 
    join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=cid1_0.usuario_id 
    left join
        empresa e2_0 
            on e2_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    where
        cid1_0.id=?
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-23 10:50:50 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:50:50 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        s1_0.nombre,
        s1_0.telefono,
        d1_0.cierre_id,
        d1_0.id,
        d1_0.costo_unitario,
        d1_0.diferencia,
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida,
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        p1_0.receta_id,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta,
        d1_0.stock_desperdicio,
        d1_0.stock_merma,
        d1_0.stock_real,
        d1_0.stock_teorico,
        d1_0.valor_diferencia 
    from
        cierre_inventario_diario cid1_0 
    join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=cid1_0.usuario_id 
    left join
        empresa e2_0 
            on e2_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        detalle_cierre_inventario_diario d1_0 
            on cid1_0.id=d1_0.cierre_id 
    left join
        ingrediente i1_0 
            on i1_0.id=d1_0.ingrediente_id 
    left join
        producto p1_0 
            on p1_0.id=d1_0.producto_id 
    where
        cid1_0.id=?
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-23 10:50:50 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        rd1_0.ingrediente_id,
        rd1_0.id,
        rd1_0.cantidad_ingrediente,
        rd1_0.receta_id,
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        r1_0.nombre 
    from
        receta_detalle rd1_0 
    left join
        receta r1_0 
            on r1_0.id=rd1_0.receta_id 
    left join
        empresa e1_0 
            on e1_0.id=r1_0.empresa_id 
    where
        rd1_0.ingrediente_id=?
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:50:50 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    update
        cierre_inventario_diario 
    set
        cantidad_facturas=?,
        empresa_id=?,
        estado=?,
        fecha=?,
        observaciones=?,
        total_ventas=?,
        usuario_id=? 
    where
        id=?
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:INTEGER) <- [0]
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [PRE-COMPLETADO]
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DATE) <- [2026-01-23]
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [Cierre para fecha espec√≠fica 2026-01-23]
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DOUBLE) <- [0.0]
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:BIGINT) <- [5]
2026-01-23 10:50:50 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:BIGINT) <- [3]
2026-01-23 10:50:50 [http-nio-8080-exec-9] INFO  j.s.s.s.CierreInventarioDiarioService - Cierre marcado como PRE-COMPLETADO ID: 3 para empresa ID: 2
2026-01-23 10:50:50 [http-nio-8080-exec-9] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚úÖ Cierre marcado como PRE-COMPLETADO ID: 3
2026-01-23 10:50:50 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 170, Tenant anterior: 2
2026-01-23 10:50:50 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 170, Request: /cierres/completar/3, Empresa ID anterior: 2
2026-01-23 10:50:50 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres
2026-01-23 10:50:50 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:50:50 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres
2026-01-23 10:50:50 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres, M√©todo: GET
2026-01-23 10:50:50 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:50:50 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:50:50 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:50:50 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:50:50 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 171
2026-01-23 10:50:50 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:50:50 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:50:50 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:50:50 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:50:50 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:50:50 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:50:50 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:50:50 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:50 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:50:50 [http-nio-8080-exec-10] INFO  j.s.s.c.CierreInventarioDiarioControlador - üìã GET /cierres - Listando cierres diarios
2026-01-23 10:50:50 [http-nio-8080-exec-10] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo todos los cierres para empresa ID: 2
2026-01-23 10:50:50 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:50:50 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:50 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:50:50 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:50 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-23 10:50:50 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-23 10:50:50 [http-nio-8080-exec-10] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 3 cierres para empresa ID: 2
2026-01-23 10:50:50 [http-nio-8080-exec-10] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Encontrados 3 cierres
2026-01-23 10:50:50 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 171, Tenant anterior: 2
2026-01-23 10:50:50 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 171, Request: /cierres, Empresa ID anterior: 2
2026-01-23 10:50:52 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/detalle/3
2026-01-23 10:50:52 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:50:52 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/detalle/3
2026-01-23 10:50:52 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/detalle/3, M√©todo: GET
2026-01-23 10:50:52 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:50:52 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:50:52 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:50:52 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:50:52 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 162
2026-01-23 10:50:52 [http-nio-8080-exec-1] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:50:52 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:50:52 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:50:52 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:50:52 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:50:52 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:50:52 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:50:52 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:52 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:50:52 [http-nio-8080-exec-1] INFO  j.s.s.c.CierreInventarioDiarioControlador - üëÅÔ∏è GET /cierres/detalle/3 - Viendo detalles de cierre
2026-01-23 10:50:52 [http-nio-8080-exec-1] DEBUG j.s.s.s.CierreInventarioDiarioService - Buscando cierre ID: 3 para empresa ID: 2
2026-01-23 10:50:52 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.id=? 
        and e1_0.id=?
2026-01-23 10:50:52 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-23 10:50:52 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:50:52 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:50:52 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:52 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-23 10:50:52 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-23 10:50:52 [http-nio-8080-exec-1] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo detalles para cierre ID: 3
2026-01-23 10:50:52 [http-nio-8080-exec-1] DEBUG j.s.s.s.CierreInventarioDiarioService - Buscando cierre ID: 3 para empresa ID: 2
2026-01-23 10:50:52 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.id=? 
        and e1_0.id=?
2026-01-23 10:50:52 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-23 10:50:52 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:50:52 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:50:52 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:52 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-23 10:50:52 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-23 10:50:52 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        dcid1_0.ingrediente_id,
        dcid1_0.producto_id,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    where
        dcid1_0.cierre_id=?
2026-01-23 10:50:52 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-23 10:50:52 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        s1_0.nombre,
        s1_0.telefono 
    from
        cierre_inventario_diario cid1_0 
    join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=cid1_0.usuario_id 
    left join
        empresa e2_0 
            on e2_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    where
        cid1_0.id=?
2026-01-23 10:50:52 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-23 10:50:52 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-23 10:50:52 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:50:52 [http-nio-8080-exec-1] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 1 detalles para cierre ID: 3
2026-01-23 10:50:52 [http-nio-8080-exec-1] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Cierre ID: 3, Estado: PRE-COMPLETADO, Detalles: 1, Diferencia total: 0.0
2026-01-23 10:50:52 [http-nio-8080-exec-1] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Cierre PRE-COMPLETADO, mostrando vista para editar
2026-01-23 10:50:52 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 162, Tenant anterior: 2
2026-01-23 10:50:52 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 162, Request: /cierres/detalle/3, Empresa ID anterior: 2
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing POST /cierres/completar-definitivo/3
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured POST /cierres/completar-definitivo/3
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/completar-definitivo/3, M√©todo: POST
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:50:56 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 163
2026-01-23 10:50:56 [http-nio-8080-exec-2] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:50:56 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:50:56 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:50:56 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:50:56 [http-nio-8080-exec-2] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚úÖ POST /cierres/completar-definitivo/3 - Completando cierre definitivamente
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Actualizando 1 detalles antes de completar
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG j.s.s.s.CierreInventarioDiarioService - Actualizando detalle ID: 1 para empresa ID: 2
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        dcid1_0.ingrediente_id,
        dcid1_0.producto_id,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    left join
        cierre_inventario_diario c1_0 
            on c1_0.id=dcid1_0.cierre_id 
    left join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    where
        dcid1_0.id=? 
        and e1_0.id=?
2026-01-23 10:50:56 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:50:56 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        s1_0.nombre,
        s1_0.telefono 
    from
        cierre_inventario_diario cid1_0 
    join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=cid1_0.usuario_id 
    left join
        empresa e2_0 
            on e2_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    where
        cid1_0.id=?
2026-01-23 10:50:56 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-23 10:50:56 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        c1_0.id,
        c1_0.cantidad_facturas,
        c1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        c1_0.estado,
        c1_0.fecha,
        c1_0.observaciones,
        c1_0.total_ventas,
        c1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e3_0.id,
        e3_0.email_contacto,
        e3_0.estado,
        e3_0.fecha_creacion,
        e3_0.nombre,
        e3_0.plan,
        e3_0.subdominio,
        e3_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida,
        rd1_0.ingrediente_id,
        rd1_0.id,
        rd1_0.cantidad_ingrediente,
        rd1_0.receta_id,
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        e4_0.id,
        e4_0.email_contacto,
        e4_0.estado,
        e4_0.fecha_creacion,
        e4_0.nombre,
        e4_0.plan,
        e4_0.subdominio,
        e4_0.telefono,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        r2_0.id,
        r2_0.costo_receta,
        r2_0.descripcion,
        r2_0.empresa_id,
        r2_0.nombre,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    join
        cierre_inventario_diario c1_0 
            on c1_0.id=dcid1_0.cierre_id 
    join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=c1_0.usuario_id 
    left join
        ingrediente i1_0 
            on i1_0.id=dcid1_0.ingrediente_id 
    left join
        empresa e3_0 
            on e3_0.id=i1_0.empresa_id 
    left join
        receta_detalle rd1_0 
            on i1_0.id=rd1_0.ingrediente_id 
    left join
        producto p1_0 
            on p1_0.id=dcid1_0.producto_id 
    left join
        empresa e4_0 
            on e4_0.id=p1_0.empresa_id 
    left join
        receta r2_0 
            on r2_0.id=p1_0.receta_id 
    where
        dcid1_0.id=?
2026-01-23 10:50:56 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        d1_0.cierre_id,
        d1_0.id,
        d1_0.costo_unitario,
        d1_0.diferencia,
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida,
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        r1_0.nombre,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta,
        d1_0.stock_desperdicio,
        d1_0.stock_merma,
        d1_0.stock_real,
        d1_0.stock_teorico,
        d1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario d1_0 
    left join
        ingrediente i1_0 
            on i1_0.id=d1_0.ingrediente_id 
    left join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    left join
        producto p1_0 
            on p1_0.id=d1_0.producto_id 
    left join
        empresa e2_0 
            on e2_0.id=p1_0.empresa_id 
    left join
        receta r1_0 
            on r1_0.id=p1_0.receta_id 
    where
        d1_0.cierre_id=?
2026-01-23 10:50:56 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-23 10:50:56 [http-nio-8080-exec-2] INFO  j.s.s.s.CierreInventarioDiarioService - Detalle actualizado ID: 1, Stock real: 300.0, Diferencia: 0.0, Valor diferencia: 0.0
2026-01-23 10:50:56 [http-nio-8080-exec-2] INFO  j.s.s.s.CierreInventarioDiarioService - Completando cierre definitivo ID: 3
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG j.s.s.s.CierreInventarioDiarioService - Buscando cierre ID: 3 para empresa ID: 2
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.id=? 
        and e1_0.id=?
2026-01-23 10:50:56 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-23 10:50:56 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:50:56 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-23 10:50:56 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG j.s.s.s.CierreInventarioDiarioService - Calculando ventas del d√≠a para cierre ID: 3
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG j.s.s.s.CierreInventarioDiarioService - Calculando ventas del d√≠a 2026-01-23 para empresa ID: 2
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        f1_0.id,
        f1_0.cliente_id,
        f1_0.empresa_id,
        f1_0.estado,
        f1_0.fecha,
        f1_0.forma_pago,
        f1_0.iva,
        f1_0.numero_factura,
        f1_0.subtotal,
        f1_0.total 
    from
        factura f1_0 
    left join
        empresa e1_0 
            on e1_0.id=f1_0.empresa_id 
    where
        f1_0.fecha=? 
        and f1_0.estado=? 
        and e1_0.id=?
2026-01-23 10:50:56 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:50:56 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [PAGADA]
2026-01-23 10:50:56 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG j.s.s.s.CierreInventarioDiarioService - Ventas calculadas: 0 facturas, Total: 0.0 para fecha: 2026-01-23
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        dcid1_0.ingrediente_id,
        dcid1_0.producto_id,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    where
        dcid1_0.cierre_id=?
2026-01-23 10:50:56 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        s1_0.nombre,
        s1_0.telefono 
    from
        cierre_inventario_diario cid1_0 
    join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=cid1_0.usuario_id 
    left join
        empresa e2_0 
            on e2_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    where
        cid1_0.id=?
2026-01-23 10:50:56 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-23 10:50:56 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG j.s.s.s.CierreInventarioDiarioService - Ajustando inventario para 1 detalles
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG j.s.s.s.CierreInventarioDiarioService - Ajustando inventario para 1 detalles
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida,
        rd1_0.ingrediente_id,
        rd1_0.id,
        rd1_0.cantidad_ingrediente,
        rd1_0.receta_id,
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        r1_0.nombre 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    left join
        receta_detalle rd1_0 
            on i1_0.id=rd1_0.ingrediente_id 
    left join
        receta r1_0 
            on r1_0.id=rd1_0.receta_id 
    where
        i1_0.id=?
2026-01-23 10:50:56 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:50:56 [http-nio-8080-exec-2] INFO  j.s.s.s.CierreInventarioDiarioService - Inventario ajustado: 1 ingredientes, 0 productos
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        s1_0.nombre,
        s1_0.telefono,
        d1_0.cierre_id,
        d1_0.id,
        d1_0.costo_unitario,
        d1_0.diferencia,
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida,
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        p1_0.receta_id,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta,
        d1_0.stock_desperdicio,
        d1_0.stock_merma,
        d1_0.stock_real,
        d1_0.stock_teorico,
        d1_0.valor_diferencia 
    from
        cierre_inventario_diario cid1_0 
    join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=cid1_0.usuario_id 
    left join
        empresa e2_0 
            on e2_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        detalle_cierre_inventario_diario d1_0 
            on cid1_0.id=d1_0.cierre_id 
    left join
        ingrediente i1_0 
            on i1_0.id=d1_0.ingrediente_id 
    left join
        producto p1_0 
            on p1_0.id=d1_0.producto_id 
    where
        cid1_0.id=?
2026-01-23 10:50:56 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        rd1_0.ingrediente_id,
        rd1_0.id,
        rd1_0.cantidad_ingrediente,
        rd1_0.receta_id,
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        r1_0.nombre 
    from
        receta_detalle rd1_0 
    left join
        receta r1_0 
            on r1_0.id=rd1_0.receta_id 
    left join
        empresa e1_0 
            on e1_0.id=r1_0.empresa_id 
    where
        rd1_0.ingrediente_id=?
2026-01-23 10:50:56 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    update
        cierre_inventario_diario 
    set
        cantidad_facturas=?,
        empresa_id=?,
        estado=?,
        fecha=?,
        observaciones=?,
        total_ventas=?,
        usuario_id=? 
    where
        id=?
2026-01-23 10:50:56 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:INTEGER) <- [0]
2026-01-23 10:50:56 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:50:56 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [COMPLETADO]
2026-01-23 10:50:56 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DATE) <- [2026-01-23]
2026-01-23 10:50:56 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [Cierre para fecha espec√≠fica 2026-01-23]
2026-01-23 10:50:56 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DOUBLE) <- [0.0]
2026-01-23 10:50:56 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:BIGINT) <- [5]
2026-01-23 10:50:56 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:BIGINT) <- [3]
2026-01-23 10:50:56 [http-nio-8080-exec-2] INFO  j.s.s.s.CierreInventarioDiarioService - Cierre completado definitivamente ID: 3 para empresa ID: 2. Total ventas: 0.0, Cantidad facturas: 0
2026-01-23 10:50:56 [http-nio-8080-exec-2] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚úÖ Cierre completado definitivamente ID: 3
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 163, Tenant anterior: 2
2026-01-23 10:50:56 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 163, Request: /cierres/completar-definitivo/3, Empresa ID anterior: 2
2026-01-23 10:50:56 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres
2026-01-23 10:50:56 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:50:56 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres
2026-01-23 10:50:56 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres, M√©todo: GET
2026-01-23 10:50:56 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:50:56 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:50:56 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:50:56 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:50:56 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 164
2026-01-23 10:50:56 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:50:56 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:50:56 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:50:56 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:50:56 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:50:56 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:50:56 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:50:56 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:56 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:50:56 [http-nio-8080-exec-3] INFO  j.s.s.c.CierreInventarioDiarioControlador - üìã GET /cierres - Listando cierres diarios
2026-01-23 10:50:56 [http-nio-8080-exec-3] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo todos los cierres para empresa ID: 2
2026-01-23 10:50:56 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        e1_0.id=?
2026-01-23 10:50:56 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:56 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:50:56 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:56 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-23 10:50:56 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-23 10:50:56 [http-nio-8080-exec-3] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 3 cierres para empresa ID: 2
2026-01-23 10:50:56 [http-nio-8080-exec-3] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Encontrados 3 cierres
2026-01-23 10:50:56 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 164, Tenant anterior: 2
2026-01-23 10:50:56 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 164, Request: /cierres, Empresa ID anterior: 2
2026-01-23 10:50:59 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-23 10:50:59 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:50:59 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-23 10:50:59 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-23 10:50:59 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:50:59 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:50:59 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:50:59 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:50:59 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 165
2026-01-23 10:50:59 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:50:59 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:50:59 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:50:59 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:50:59 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:50:59 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:50:59 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:50:59 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:59 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:50:59 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-23 10:50:59 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-23, Hora: 10:00
2026-01-23 10:50:59 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-23 10:50:59 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-23]
2026-01-23 10:50:59 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-23 10:50:59 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-23 10:50:59 [http-nio-8080-exec-4] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ ¬°HOY YA EST√Å CERRADO! - Bloqueando acceso. Empresa ID: 2, Fecha: 2026-01-23
2026-01-23 10:50:59 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 165, Tenant anterior: 2
2026-01-23 10:50:59 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 165, Request: /principal, Empresa ID anterior: 2
2026-01-23 10:50:59 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/bloqueado?proximoAcceso=2026-01-24%2005:00
2026-01-23 10:50:59 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=18ACE8CC555EA638BB9EBA4EF5F0FD40], Granted Authorities=[ROLE_ADMIN]]]
2026-01-23 10:50:59 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/bloqueado?proximoAcceso=2026-01-24%2005:00
2026-01-23 10:50:59 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/bloqueado, M√©todo: GET
2026-01-23 10:50:59 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-23 10:50:59 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-23 10:50:59 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-23 10:50:59 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-23 10:50:59 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 166
2026-01-23 10:50:59 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-23 10:50:59 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-23 10:50:59 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-23 10:50:59 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-23 10:50:59 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-23 10:50:59 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-23 10:50:59 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-23 10:50:59 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-23 10:50:59 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-23 10:50:59 [http-nio-8080-exec-5] WARN  j.s.s.c.CierreInventarioDiarioControlador - ‚õî GET /cierres/bloqueado - Sistema bloqueado. Pr√≥ximo acceso: 2026-01-24 05:00
2026-01-23 10:50:59 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 166, Tenant anterior: 2
2026-01-23 10:50:59 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 166, Request: /cierres/bloqueado, Empresa ID anterior: 2
