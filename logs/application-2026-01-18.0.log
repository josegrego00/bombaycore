2026-01-18 04:01:08 [main] INFO  j.s.s.SistemadefacturacioneinventarioApplication - Starting SistemadefacturacioneinventarioApplication using Java 17.0.17 with PID 8357 (/home/josepino/Desktop/SistemaFacturaEInventario/sistemadefacturacioneinventario/target/classes started by josepino in /home/josepino/Desktop/SistemaFacturaEInventario/sistemadefacturacioneinventario)
2026-01-18 04:01:08 [main] DEBUG j.s.s.SistemadefacturacioneinventarioApplication - Running with Spring Boot v3.5.8, Spring v6.2.14
2026-01-18 04:01:08 [main] INFO  j.s.s.SistemadefacturacioneinventarioApplication - No active profile set, falling back to 1 default profile: "default"
2026-01-18 04:01:09 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-18 04:01:09 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 67 ms. Found 14 JPA repository interfaces.
2026-01-18 04:01:09 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2026-01-18 04:01:09 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2026-01-18 04:01:09 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.49]
2026-01-18 04:01:09 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2026-01-18 04:01:09 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1159 ms
2026-01-18 04:01:10 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-18 04:01:10 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.6.36.Final
2026-01-18 04:01:10 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2026-01-18 04:01:10 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-18 04:01:10 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2026-01-18 04:01:10 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@4377ed24
2026-01-18 04:01:10 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2026-01-18 04:01:10 [main] INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 8.0.44
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2026-01-18 04:01:11 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-18 04:01:11 [main] DEBUG org.hibernate.SQL - 
    create table cierre_inventario_diario (
        id bigint not null auto_increment,
        cantidad_facturas integer not null,
        estado varchar(255),
        fecha date,
        observaciones varchar(255),
        total_ventas float(53) not null,
        empresa_id bigint not null,
        usuario_id bigint not null,
        primary key (id)
    ) engine=InnoDB
2026-01-18 04:01:11 [main] DEBUG org.hibernate.SQL - 
    create table cliente (
        id bigint not null auto_increment,
        activo bit not null,
        correo varchar(255),
        identificacion varchar(255),
        nombre varchar(255) not null,
        telefono varchar(255),
        empresa_id bigint not null,
        primary key (id)
    ) engine=InnoDB
2026-01-18 04:01:11 [main] DEBUG org.hibernate.SQL - 
    create table detalle_cierre_inventario_diario (
        id bigint not null auto_increment,
        costo_unitario float(53) not null,
        diferencia float(53) not null,
        stock_desperdicio float(53) not null,
        stock_merma float(53) not null,
        stock_real float(53) not null,
        stock_teorico float(53) not null,
        valor_diferencia float(53) not null,
        cierre_id bigint not null,
        ingrediente_id bigint,
        producto_id bigint,
        primary key (id)
    ) engine=InnoDB
2026-01-18 04:01:11 [main] DEBUG org.hibernate.SQL - 
    create table empresa (
        id bigint not null auto_increment,
        email_contacto varchar(255),
        estado bit not null,
        fecha_creacion date,
        nombre varchar(255),
        plan varchar(255),
        subdominio varchar(255),
        telefono varchar(255),
        primary key (id)
    ) engine=InnoDB
2026-01-18 04:01:11 [main] DEBUG org.hibernate.SQL - 
    create table factura (
        id integer not null auto_increment,
        estado varchar(255),
        fecha date,
        forma_pago varchar(255),
        iva float(53) not null,
        numero_factura varchar(255),
        subtotal float(53) not null,
        total float(53) not null,
        cliente_id bigint,
        empresa_id bigint not null,
        primary key (id)
    ) engine=InnoDB
2026-01-18 04:01:11 [main] DEBUG org.hibernate.SQL - 
    create table factura_detalle (
        id bigint not null auto_increment,
        cantidad integer not null,
        precio_unitario float(53) not null,
        subtotal float(53) not null,
        factura_id integer not null,
        producto_id bigint not null,
        primary key (id)
    ) engine=InnoDB
2026-01-18 04:01:11 [main] DEBUG org.hibernate.SQL - 
    create table factura_detalle_proveedor (
        id bigint not null auto_increment,
        cantidad float(53) not null,
        precio_unitario float(53) not null,
        subtotal float(53) not null,
        factura_proveedor_id bigint not null,
        ingrediente_id bigint not null,
        primary key (id)
    ) engine=InnoDB
2026-01-18 04:01:11 [main] DEBUG org.hibernate.SQL - 
    create table factura_proveedor (
        id bigint not null auto_increment,
        estado varchar(255),
        fecha date,
        iva float(53),
        numero_factura varchar(255),
        subtotal float(53),
        total float(53),
        empresa_id bigint not null,
        proveedor_id bigint not null,
        primary key (id)
    ) engine=InnoDB
2026-01-18 04:01:11 [main] DEBUG org.hibernate.SQL - 
    create table ingrediente (
        id bigint not null auto_increment,
        activo bit not null,
        nombre varchar(255),
        precio float(53) not null,
        stock_actual float(53) not null,
        stock_minimo float(53) not null,
        unidad_medida varchar(255),
        empresa_id bigint not null,
        primary key (id)
    ) engine=InnoDB
2026-01-18 04:01:11 [main] DEBUG org.hibernate.SQL - 
    create table producto (
        id bigint not null auto_increment,
        activo bit not null,
        nombre varchar(255),
        precio_compra float(53),
        precio_venta float(53),
        stock float(53),
        tiene_receta bit not null,
        unidad_medida_venta varchar(255),
        empresa_id bigint not null,
        receta_id bigint,
        primary key (id)
    ) engine=InnoDB
2026-01-18 04:01:11 [main] DEBUG org.hibernate.SQL - 
    create table proveedor (
        id bigint not null auto_increment,
        activo bit,
        correo varchar(255),
        identificacion varchar(255),
        nombre varchar(255),
        telefono varchar(255),
        empresa_id bigint not null,
        primary key (id)
    ) engine=InnoDB
2026-01-18 04:01:11 [main] DEBUG org.hibernate.SQL - 
    create table receta (
        id bigint not null auto_increment,
        costo_receta float(53) not null,
        descripcion varchar(255),
        nombre varchar(255),
        empresa_id bigint not null,
        primary key (id)
    ) engine=InnoDB
2026-01-18 04:01:11 [main] DEBUG org.hibernate.SQL - 
    create table receta_detalle (
        id integer not null auto_increment,
        cantidad_ingrediente float(53) not null,
        ingrediente_id bigint not null,
        receta_id bigint not null,
        primary key (id)
    ) engine=InnoDB
2026-01-18 04:01:11 [main] DEBUG org.hibernate.SQL - 
    create table sucursal (
        id bigint not null auto_increment,
        direccion varchar(255),
        email varchar(255),
        nombre varchar(255),
        telefono varchar(255),
        empresa_id bigint not null,
        primary key (id)
    ) engine=InnoDB
2026-01-18 04:01:11 [main] DEBUG org.hibernate.SQL - 
    create table usuario (
        id bigint not null auto_increment,
        activo bit not null,
        contrasenna varchar(255) not null,
        nombre_usuario varchar(255),
        rol varchar(255) not null,
        empresa_id bigint,
        sucursal_id bigint,
        primary key (id)
    ) engine=InnoDB
2026-01-18 04:01:11 [main] DEBUG org.hibernate.SQL - 
    alter table cierre_inventario_diario 
       drop index UK3olt7fv3qt8efj1m5p7q3j1ms
2026-01-18 04:01:11 [main] DEBUG org.hibernate.SQL - 
    alter table cierre_inventario_diario 
       add constraint UK3olt7fv3qt8efj1m5p7q3j1ms unique (empresa_id, fecha)
2026-01-18 04:01:11 [main] DEBUG org.hibernate.SQL - 
    alter table cliente 
       drop index UKhadme0meght491lixmp6qg06b
2026-01-18 04:01:11 [main] DEBUG org.hibernate.SQL - 
    alter table cliente 
       add constraint UKhadme0meght491lixmp6qg06b unique (empresa_id, nombre)
2026-01-18 04:01:11 [main] DEBUG org.hibernate.SQL - 
    alter table detalle_cierre_inventario_diario 
       drop index UKk16g51km9nr5iqw2wxck8b358
2026-01-18 04:01:11 [main] DEBUG org.hibernate.SQL - 
    alter table detalle_cierre_inventario_diario 
       add constraint UKk16g51km9nr5iqw2wxck8b358 unique (cierre_id, producto_id)
2026-01-18 04:01:11 [main] DEBUG org.hibernate.SQL - 
    alter table detalle_cierre_inventario_diario 
       drop index UKca6rduw6wqlirrbdd5tvj3u2c
2026-01-18 04:01:11 [main] DEBUG org.hibernate.SQL - 
    alter table detalle_cierre_inventario_diario 
       add constraint UKca6rduw6wqlirrbdd5tvj3u2c unique (cierre_id, ingrediente_id)
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table empresa 
       drop index UK89dtla0x9lfndxn4iha8gm2al
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table empresa 
       add constraint UK89dtla0x9lfndxn4iha8gm2al unique (subdominio)
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table factura 
       drop index UKa9fu6ob19w8pdw35ilspmgje
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table factura 
       add constraint UKa9fu6ob19w8pdw35ilspmgje unique (empresa_id, numero_factura)
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table factura_detalle 
       drop index UKejw1olg5d69vmcvvmwqglbewj
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table factura_detalle 
       add constraint UKejw1olg5d69vmcvvmwqglbewj unique (factura_id, producto_id)
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table factura_detalle_proveedor 
       drop index UK646r3o8f5xbf9ikhql9qcr81i
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table factura_detalle_proveedor 
       add constraint UK646r3o8f5xbf9ikhql9qcr81i unique (factura_proveedor_id, ingrediente_id)
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table factura_proveedor 
       drop index UK23y7stifd8wv2cixfjhc0g9kq
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table factura_proveedor 
       add constraint UK23y7stifd8wv2cixfjhc0g9kq unique (empresa_id, numero_factura)
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table ingrediente 
       drop index UKjs70l2p4uno2dclt73ffva7c9
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table ingrediente 
       add constraint UKjs70l2p4uno2dclt73ffva7c9 unique (empresa_id, nombre)
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table producto 
       drop index UKbeimg5dnx60dx87os8deoet9l
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table producto 
       add constraint UKbeimg5dnx60dx87os8deoet9l unique (empresa_id, nombre)
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table proveedor 
       drop index UKe0crun39p1g01db6lw29cqgmg
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table proveedor 
       add constraint UKe0crun39p1g01db6lw29cqgmg unique (empresa_id, nombre)
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table proveedor 
       drop index UKq9ef37e05x58intf9g660ubhs
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table proveedor 
       add constraint UKq9ef37e05x58intf9g660ubhs unique (empresa_id, identificacion)
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table proveedor 
       drop index UK5iq7yn62p2yff2ibnyebm81yk
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table proveedor 
       add constraint UK5iq7yn62p2yff2ibnyebm81yk unique (empresa_id, correo)
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table receta 
       drop index UK143eh9phim5gxih4uhnxf5rjy
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table receta 
       add constraint UK143eh9phim5gxih4uhnxf5rjy unique (empresa_id, nombre)
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table receta_detalle 
       drop index UK5i7rpjy4jshlcxwopit7e7l6v
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table receta_detalle 
       add constraint UK5i7rpjy4jshlcxwopit7e7l6v unique (receta_id, ingrediente_id)
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table sucursal 
       drop index UKifuc748bnikr6k2anqbkfcjof
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table sucursal 
       add constraint UKifuc748bnikr6k2anqbkfcjof unique (empresa_id, nombre)
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table usuario 
       drop index UKl3t4o0bbvqig8iki4a9v5l2au
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table usuario 
       add constraint UKl3t4o0bbvqig8iki4a9v5l2au unique (empresa_id, nombre_usuario)
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table cierre_inventario_diario 
       add constraint FKrxj5xe6of8lbbaygm6wn1yglc 
       foreign key (empresa_id) 
       references empresa (id)
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table cierre_inventario_diario 
       add constraint FK7ydwat6wxaari9ti21t61pf2h 
       foreign key (usuario_id) 
       references usuario (id)
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table cliente 
       add constraint FKkbui05oidjdj4nb0283u4t319 
       foreign key (empresa_id) 
       references empresa (id)
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table detalle_cierre_inventario_diario 
       add constraint FKai0hytaggprm1fpr57qs1r16y 
       foreign key (cierre_id) 
       references cierre_inventario_diario (id)
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table detalle_cierre_inventario_diario 
       add constraint FKnhr66xfhrrt2lf9hcr6osvkwi 
       foreign key (ingrediente_id) 
       references ingrediente (id)
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table detalle_cierre_inventario_diario 
       add constraint FKo04686jk3h9e8lercg1o2p4qx 
       foreign key (producto_id) 
       references producto (id)
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table factura 
       add constraint FK2602efsrpmevi8yxg464stfn5 
       foreign key (cliente_id) 
       references cliente (id)
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table factura 
       add constraint FKtmilsq58fksgb0ubkele0rhec 
       foreign key (empresa_id) 
       references empresa (id)
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table factura_detalle 
       add constraint FK82g5tpb19dn0ed3dh8rjepfeo 
       foreign key (factura_id) 
       references factura (id)
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table factura_detalle 
       add constraint FK49cxxxb69hbp79ot7q72d1amt 
       foreign key (producto_id) 
       references producto (id)
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table factura_detalle_proveedor 
       add constraint FKoflc51frkgklo8alhid2j8al7 
       foreign key (factura_proveedor_id) 
       references factura_proveedor (id)
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table factura_detalle_proveedor 
       add constraint FK3hoqatnjgbbmx6xrh35yqppuf 
       foreign key (ingrediente_id) 
       references ingrediente (id)
2026-01-18 04:01:12 [main] DEBUG org.hibernate.SQL - 
    alter table factura_proveedor 
       add constraint FKhlrb8uke31inikggh6lkw2dkd 
       foreign key (empresa_id) 
       references empresa (id)
2026-01-18 04:01:13 [main] DEBUG org.hibernate.SQL - 
    alter table factura_proveedor 
       add constraint FK7f8no9r5msrqi7tdpxtxv5rox 
       foreign key (proveedor_id) 
       references proveedor (id)
2026-01-18 04:01:13 [main] DEBUG org.hibernate.SQL - 
    alter table ingrediente 
       add constraint FK12fcsy4t6kmmc1kqwdvf6qoyb 
       foreign key (empresa_id) 
       references empresa (id)
2026-01-18 04:01:13 [main] DEBUG org.hibernate.SQL - 
    alter table producto 
       add constraint FKc2ad8rakag2tc01ww39eqrbv6 
       foreign key (empresa_id) 
       references empresa (id)
2026-01-18 04:01:13 [main] DEBUG org.hibernate.SQL - 
    alter table producto 
       add constraint FKoug9w3p6qwyhi5ogt6806xkaj 
       foreign key (receta_id) 
       references receta (id)
2026-01-18 04:01:13 [main] DEBUG org.hibernate.SQL - 
    alter table proveedor 
       add constraint FK8cnkydwgpaydac6bnsv9t3fre 
       foreign key (empresa_id) 
       references empresa (id)
2026-01-18 04:01:13 [main] DEBUG org.hibernate.SQL - 
    alter table receta 
       add constraint FKdgije9w7wnv4qr14tddx3d1mb 
       foreign key (empresa_id) 
       references empresa (id)
2026-01-18 04:01:13 [main] DEBUG org.hibernate.SQL - 
    alter table receta_detalle 
       add constraint FKqqxfeku8edppnlksgq3yyetfg 
       foreign key (ingrediente_id) 
       references ingrediente (id)
2026-01-18 04:01:13 [main] DEBUG org.hibernate.SQL - 
    alter table receta_detalle 
       add constraint FK3ymmbjgelr0kjbhi7880bmmk3 
       foreign key (receta_id) 
       references receta (id)
2026-01-18 04:01:13 [main] DEBUG org.hibernate.SQL - 
    alter table sucursal 
       add constraint FK3w56rbjykxbp2e79cdq0xsghd 
       foreign key (empresa_id) 
       references empresa (id)
2026-01-18 04:01:13 [main] DEBUG org.hibernate.SQL - 
    alter table usuario 
       add constraint FK87ckfs30l64gnivnfk7ywp8l6 
       foreign key (empresa_id) 
       references empresa (id)
2026-01-18 04:01:13 [main] DEBUG org.hibernate.SQL - 
    alter table usuario 
       add constraint FKiaauynefn97k8nl88ss4snyl6 
       foreign key (sucursal_id) 
       references sucursal (id)
2026-01-18 04:01:13 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-18 04:01:13 [main] DEBUG o.h.s.internal.StatisticsInitiator - Statistics initialized [enabled=false]
2026-01-18 04:01:13 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2026-01-18 04:01:14 [main] INFO  j.s.s.config.SpringSecurityConfig - üîê Configurando BCryptPasswordEncoder para encriptaci√≥n de contrase√±as
2026-01-18 04:01:14 [main] INFO  j.s.s.config.WebConfig - ‚öôÔ∏è Configurando interceptores de Spring MVC
2026-01-18 04:01:14 [main] DEBUG j.s.s.config.WebConfig - Registrando CierreDiarioInterceptor
2026-01-18 04:01:14 [main] DEBUG j.s.s.config.WebConfig - CierreDiarioInterceptor configurado. Patrones incluidos: /**
2026-01-18 04:01:14 [main] DEBUG j.s.s.config.WebConfig - Patrones excluidos: /cierres/**, /login, /css/**, /js/**, /error
2026-01-18 04:01:15 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name usuarioServicio
2026-01-18 04:01:15 [main] INFO  j.s.s.config.SpringSecurityConfig - üõ°Ô∏è Configurando SecurityFilterChain para SUPERADMIN (Orden 1)
2026-01-18 04:01:15 [main] INFO  j.s.s.config.SpringSecurityConfig - ‚úÖ SecurityFilterChain SUPERADMIN configurado
2026-01-18 04:01:15 [main] DEBUG o.s.s.web.DefaultSecurityFilterChain - Will secure Or [Mvc [pattern='/superadmin/**']] with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CsrfFilter, LogoutFilter, UsernamePasswordAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-18 04:01:15 [main] INFO  j.s.s.config.SpringSecurityConfig - üõ°Ô∏è Configurando SecurityFilterChain - Iniciando configuraci√≥n de seguridad
2026-01-18 04:01:15 [main] INFO  j.s.s.config.SpringSecurityConfig - ‚úÖ SecurityFilterChain configurado exitosamente
2026-01-18 04:01:15 [main] DEBUG j.s.s.config.SpringSecurityConfig - Configuraci√≥n de seguridad aplicada:
2026-01-18 04:01:15 [main] DEBUG j.s.s.config.SpringSecurityConfig - - P√°ginas p√∫blicas: /, /login, /acceso-denegado, /css/**, /js/**, /error
2026-01-18 04:01:15 [main] DEBUG j.s.s.config.SpringSecurityConfig - - Solo ADMIN: /compras/**, /proveedores/**
2026-01-18 04:01:15 [main] DEBUG j.s.s.config.SpringSecurityConfig - - ADMIN o DEV: /productos/**, /ingredientes/**, /recetas/**, /reportes/**, /cierres/**
2026-01-18 04:01:15 [main] DEBUG j.s.s.config.SpringSecurityConfig - - Login: /login, Logout: /logout
2026-01-18 04:01:15 [main] DEBUG j.s.s.config.SpringSecurityConfig - - P√°gina acceso denegado: /acceso-denegado
2026-01-18 04:01:15 [main] DEBUG o.s.s.web.DefaultSecurityFilterChain - Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CsrfFilter, LogoutFilter, UsernamePasswordAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-18 04:01:15 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2026-01-18 04:01:15 [main] INFO  j.s.s.SistemadefacturacioneinventarioApplication - Started SistemadefacturacioneinventarioApplication in 7.188 seconds (process running for 7.566)
2026-01-18 04:01:15 [main] INFO  j.s.s.config.UsuarioInicial - üîß Iniciando carga de usuarios iniciales
2026-01-18 04:01:15 [main] DEBUG org.hibernate.SQL - 
    select
        count(*) 
    from
        empresa e1_0
2026-01-18 04:01:15 [main] WARN  j.s.s.config.UsuarioInicial - ‚ö†Ô∏è No hay empresas en la BD. Los usuarios se crear√°n sin empresa.
2026-01-18 04:01:15 [main] WARN  j.s.s.config.UsuarioInicial - ‚ö†Ô∏è Ejecuta primero el DataInitializer para crear empresa por defecto.
2026-01-18 04:01:15 [main] INFO  j.s.s.config.DataInitializer - üöÄ INICIANDO CARGA DE DATOS INICIALES DEL SISTEMA
2026-01-18 04:01:15 [main] DEBUG org.hibernate.SQL - 
    select
        count(*) 
    from
        empresa e1_0
2026-01-18 04:01:15 [main] INFO  j.s.s.config.DataInitializer - üìÅ No se encontraron empresas. Creando empresa por defecto...
2026-01-18 04:01:15 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        empresa
        (email_contacto, estado, fecha_creacion, nombre, plan, subdominio, telefono) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [null]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BOOLEAN) <- [true]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:DATE) <- [null]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [Sistema por Defecto]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [defecto]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [null]
2026-01-18 04:01:15 [main] INFO  j.s.s.config.DataInitializer - üè¢ Empresa por defecto creada exitosamente:
2026-01-18 04:01:15 [main] INFO  j.s.s.config.DataInitializer -    üìõ Nombre: Sistema por Defecto
2026-01-18 04:01:15 [main] INFO  j.s.s.config.DataInitializer -    üåê Subdominio: defecto
2026-01-18 04:01:15 [main] INFO  j.s.s.config.DataInitializer -    üî¢ ID: 1
2026-01-18 04:01:15 [main] INFO  j.s.s.config.DataInitializer -    üîó Acceso: http://defecto.localhost:8080
2026-01-18 04:01:15 [main] DEBUG org.hibernate.SQL - 
    select
        c1_0.id 
    from
        cliente c1_0 
    left join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    where
        c1_0.nombre=? 
        and e1_0.id=? 
    limit
        ?
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Consumidor Final]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:INTEGER) <- [1]
2026-01-18 04:01:15 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        cliente
        (activo, correo, empresa_id, identificacion, nombre, telefono) 
    values
        (?, ?, ?, ?, ?, ?)
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [consumidor@final.com]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [CF9999999999999]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [Consumidor Final]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [N/A]
2026-01-18 04:01:15 [main] INFO  j.s.s.config.DataInitializer - üë§ Cliente por defecto creado:
2026-01-18 04:01:15 [main] INFO  j.s.s.config.DataInitializer -    üìõ Nombre: Consumidor Final
2026-01-18 04:01:15 [main] INFO  j.s.s.config.DataInitializer -    üî¢ ID: CF9999999999999
2026-01-18 04:01:15 [main] INFO  j.s.s.config.DataInitializer -    üè¢ Para empresa: Sistema por Defecto
2026-01-18 04:01:15 [main] DEBUG org.hibernate.SQL - 
    select
        count(u1_0.id) 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-18 04:01:15 [main] INFO  j.s.s.config.DataInitializer - üë• No hay usuarios para empresa Sistema por Defecto. Creando usuarios por defecto...
2026-01-18 04:01:15 [main] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 1
2026-01-18 04:01:15 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        usuario
        (activo, contrasenna, empresa_id, nombre_usuario, rol, sucursal_id) 
    values
        (?, ?, ?, ?, ?, ?)
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [$2a$10$jxBSjEJBLZJiucK7O2ZxJe90wcwufpBxMTrfwpYyhGWXHnWSyp6Y.]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [admin]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [ADMIN]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:BIGINT) <- [null]
2026-01-18 04:01:15 [main] INFO  j.s.s.config.DataInitializer -    üë§ ADMIN: admin/admin123
2026-01-18 04:01:15 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        usuario
        (activo, contrasenna, empresa_id, nombre_usuario, rol, sucursal_id) 
    values
        (?, ?, ?, ?, ?, ?)
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [$2a$10$JGDWhiQfZ/MrBg5BWAj0p.ZqBnpMSsN59rzxgeLOMwSDxVJ9KZ2VS]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [cajero]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [CAJERO]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:BIGINT) <- [null]
2026-01-18 04:01:15 [main] INFO  j.s.s.config.DataInitializer -    üë§ CAJERO: cajero/cajero123
2026-01-18 04:01:15 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        usuario
        (activo, contrasenna, empresa_id, nombre_usuario, rol, sucursal_id) 
    values
        (?, ?, ?, ?, ?, ?)
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [$2a$10$WIynkcUHWZVmwJoHpqR23OYX5EdZJtCog8EGb2Naaf1rb0yetXfyS]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [dev]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [DEV]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:BIGINT) <- [null]
2026-01-18 04:01:15 [main] INFO  j.s.s.config.DataInitializer -    üë§ DEV: dev/dev123
2026-01-18 04:01:15 [main] INFO  j.s.s.config.DataInitializer - ‚úÖ Usuarios creados exitosamente para empresa Sistema por Defecto
2026-01-18 04:01:15 [main] WARN  j.s.s.config.DataInitializer - ‚ö†Ô∏è  ¬°IMPORTANTE! Cambia estas contrase√±as en producci√≥n.
2026-01-18 04:01:15 [main] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 1, Tenant anterior: 1
2026-01-18 04:01:15 [main] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.fecha=? 
        and e1_0.id=? 
    limit
        ?
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-17]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:INTEGER) <- [1]
2026-01-18 04:01:15 [main] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        u1_0.nombre_usuario=? 
        and e1_0.id=?
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-18 04:01:15 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        cierre_inventario_diario
        (cantidad_facturas, empresa_id, estado, fecha, observaciones, total_ventas, usuario_id) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:INTEGER) <- [0]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [COMPLETADO]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DATE) <- [2026-01-17]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [Cierre inicial generado autom√°ticamente]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DOUBLE) <- [0.0]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:BIGINT) <- [1]
2026-01-18 04:01:15 [main] INFO  j.s.s.config.DataInitializer - üìÖ Cierre diario inicial creado para fecha 2026-01-17 - Empresa: Sistema por Defecto
2026-01-18 04:01:15 [main] INFO  j.s.s.config.DataInitializer - üëë Verificando existencia de usuario SUPER_ADMIN
2026-01-18 04:01:15 [main] DEBUG org.hibernate.SQL - 
    select
        u1_0.id 
    from
        usuario u1_0 
    where
        u1_0.rol=? 
    limit
        ?
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [SUPER_ADMIN]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [1]
2026-01-18 04:01:15 [main] INFO  j.s.s.config.DataInitializer - üëë No existe SUPER_ADMIN. Creando usuario maestro...
2026-01-18 04:01:15 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        usuario
        (activo, contrasenna, empresa_id, nombre_usuario, rol, sucursal_id) 
    values
        (?, ?, ?, ?, ?, ?)
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [$2a$10$iuJ/e6IjhvvG90AXmDuJvOrUX2C1XMaCACzC.kSZb5P.bOaWo1VjC]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [null]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [josepino]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [SUPER_ADMIN]
2026-01-18 04:01:15 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:BIGINT) <- [null]
2026-01-18 04:01:15 [main] WARN  j.s.s.config.DataInitializer - ‚ö†Ô∏è  USUARIO SUPER_ADMIN CREADO:
2026-01-18 04:01:15 [main] WARN  j.s.s.config.DataInitializer -    üé≠ Rol: SUPER_ADMIN
2026-01-18 04:01:15 [main] INFO  j.s.s.config.DataInitializer - ‚úÖ CARGA DE DATOS INICIALES COMPLETADA EXITOSAMENTE
2026-01-18 04:01:33 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2026-01-18 04:01:33 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2026-01-18 04:01:33 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2026-01-18 04:01:33 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/login
2026-01-18 04:01:33 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/login
2026-01-18 04:01:33 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/login
2026-01-18 04:01:33 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/login, Empresa ID: null
2026-01-18 04:01:33 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/login
2026-01-18 04:01:33 [http-nio-8080-exec-1] INFO  j.s.s.c.SuperAdminController - üîì Mostrando p√°gina de login para SUPER_ADMIN
2026-01-18 04:01:33 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-18 04:01:33 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 36, Request: /superadmin/login, Empresa ID anterior: null
2026-01-18 04:01:33 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-18 04:01:33 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-18 04:01:33 [http-nio-8080-exec-2] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to http://localhost:8080/login
2026-01-18 04:01:33 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login
2026-01-18 04:01:33 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login
2026-01-18 04:01:33 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-18 04:01:33 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: localhost
2026-01-18 04:01:33 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: localhost
2026-01-18 04:01:33 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:01:33 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-18 04:01:33 [http-nio-8080-exec-3] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@544116627 wrapping com.mysql.cj.jdbc.ConnectionImpl@4377ed24] read-only
2026-01-18 04:01:33 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:01:33 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-18 04:01:33 [http-nio-8080-exec-3] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@544116627 wrapping com.mysql.cj.jdbc.ConnectionImpl@4377ed24]
2026-01-18 04:01:33 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 38
2026-01-18 04:01:33 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚ö†Ô∏è Usando empresa por defecto (localhost): 1 - Sistema por Defecto
2026-01-18 04:01:33 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-18 04:01:33 [http-nio-8080-exec-3] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-18 04:01:33 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 38, Tenant anterior: 1
2026-01-18 04:01:33 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 38, Request: /login, Empresa ID anterior: 1
2026-01-18 04:01:43 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing POST /superadmin/login
2026-01-18 04:01:43 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: josepino para la empresa ID: null
2026-01-18 04:01:43 [http-nio-8080-exec-4] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: josepino | Subdominio: localhost
2026-01-18 04:01:43 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=?
2026-01-18 04:01:43 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [josepino]
2026-01-18 04:01:43 [http-nio-8080-exec-4] INFO  j.s.s.servicios.UsuarioServicio - ‚úÖ SUPER_ADMIN cargado: josepino - Rol: SUPER_ADMIN
2026-01-18 04:01:43 [http-nio-8080-exec-4] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Authenticated user
2026-01-18 04:01:43 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.s.ChangeSessionIdAuthenticationStrategy - Changed session id from 7532839BC11409BCB6417BDC3CAA82E4
2026-01-18 04:01:43 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.CsrfAuthenticationStrategy - Replaced CSRF Token
2026-01-18 04:01:43 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Stored SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=7532839BC11409BCB6417BDC3CAA82E4], Granted Authorities=[ROLE_SUPER_ADMIN]]] to HttpSession [org.apache.catalina.session.StandardSessionFacade@1ffeddca]
2026-01-18 04:01:43 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.UsernamePasswordAuthenticationFilter - Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=7532839BC11409BCB6417BDC3CAA82E4], Granted Authorities=[ROLE_SUPER_ADMIN]]
2026-01-18 04:01:43 [http-nio-8080-exec-4] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /superadmin/dashboard
2026-01-18 04:01:43 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/dashboard
2026-01-18 04:01:43 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=7532839BC11409BCB6417BDC3CAA82E4], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:01:43 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/dashboard
2026-01-18 04:01:43 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/dashboard
2026-01-18 04:01:43 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/dashboard, Empresa ID: null
2026-01-18 04:01:43 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/dashboard
2026-01-18 04:01:43 [http-nio-8080-exec-5] INFO  j.s.s.c.SuperAdminController - üìä Accediendo al dashboard SUPER_ADMIN
2026-01-18 04:01:43 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 40, Request: /superadmin/dashboard, Empresa ID anterior: null
2026-01-18 04:01:43 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/empresas
2026-01-18 04:01:43 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=7532839BC11409BCB6417BDC3CAA82E4], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:01:43 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/empresas
2026-01-18 04:01:43 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/empresas
2026-01-18 04:01:43 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/empresas, Empresa ID: null
2026-01-18 04:01:43 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/empresas
2026-01-18 04:01:43 [http-nio-8080-exec-6] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@117028690 wrapping com.mysql.cj.jdbc.ConnectionImpl@4377ed24] read-only
2026-01-18 04:01:43 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0
2026-01-18 04:01:43 [http-nio-8080-exec-6] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@117028690 wrapping com.mysql.cj.jdbc.ConnectionImpl@4377ed24]
2026-01-18 04:01:43 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 41, Request: /superadmin/empresas, Empresa ID anterior: null
2026-01-18 04:01:43 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-18 04:01:43 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=7532839BC11409BCB6417BDC3CAA82E4], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:01:43 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-18 04:01:43 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-18 04:01:43 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: localhost
2026-01-18 04:01:43 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: localhost
2026-01-18 04:01:43 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:01:43 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-18 04:01:43 [http-nio-8080-exec-7] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@2107200630 wrapping com.mysql.cj.jdbc.ConnectionImpl@4377ed24] read-only
2026-01-18 04:01:43 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:01:43 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-18 04:01:43 [http-nio-8080-exec-7] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@2107200630 wrapping com.mysql.cj.jdbc.ConnectionImpl@4377ed24]
2026-01-18 04:01:43 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 42
2026-01-18 04:01:43 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚ö†Ô∏è Usando empresa por defecto (localhost): 1 - Sistema por Defecto
2026-01-18 04:01:43 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: josepino
2026-01-18 04:01:43 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: josepino en empresa ID: 1
2026-01-18 04:01:43 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:01:43 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [josepino]
2026-01-18 04:01:43 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-18 04:01:43 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 1
2026-01-18 04:01:43 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:01:43 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:01:43 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:01:43 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:01:43 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:01:43 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:01:43 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:01:43 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:01:43 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:01:43 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:01:43 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: false (Empresa ID: 1)
2026-01-18 04:01:43 [http-nio-8080-exec-7] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-16 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-18 04:01:43 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 42, Tenant anterior: 1
2026-01-18 04:01:43 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 42, Request: /favicon.ico, Empresa ID anterior: 1
2026-01-18 04:01:43 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:01:43 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=7532839BC11409BCB6417BDC3CAA82E4], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:01:43 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AccessDeniedHandlerImpl - Forwarding to /acceso-denegado with status code 403
2026-01-18 04:01:43 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /acceso-denegado?fecha=2026-01-16
2026-01-18 04:01:43 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /acceso-denegado?fecha=2026-01-16
2026-01-18 04:01:43 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /acceso-denegado, Empresa ID: null
2026-01-18 04:01:43 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì Interceptando acceso-denegado - EMPRESA: null
2026-01-18 04:01:43 [http-nio-8080-exec-8] WARN  j.s.s.controladores.InicioController - ‚õî GET /acceso-denigado - Mostrando p√°gina de acceso denegado
2026-01-18 04:01:53 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/empresas/nueva
2026-01-18 04:01:53 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=7532839BC11409BCB6417BDC3CAA82E4], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:01:53 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/empresas/nueva
2026-01-18 04:01:53 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/empresas/nueva
2026-01-18 04:01:53 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/empresas/nueva, Empresa ID: null
2026-01-18 04:01:53 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/empresas/nueva
2026-01-18 04:01:53 [http-nio-8080-exec-9] INFO  j.s.s.c.SuperAdminController - üìÑ [CONTROLLER] Mostrando formulario para crear nueva empresa
2026-01-18 04:01:53 [http-nio-8080-exec-9] DEBUG j.s.s.c.SuperAdminController - üîß Preparando modelo con nuevo EmpresaClienteDTO
2026-01-18 04:01:53 [http-nio-8080-exec-9] INFO  j.s.s.c.SuperAdminController - ‚úÖ Formulario listo para mostrar
2026-01-18 04:01:53 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 44, Request: /superadmin/empresas/nueva, Empresa ID anterior: null
2026-01-18 04:01:53 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-18 04:01:53 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=7532839BC11409BCB6417BDC3CAA82E4], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:01:53 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-18 04:01:53 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-18 04:01:53 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: localhost
2026-01-18 04:01:53 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: localhost
2026-01-18 04:01:53 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:01:53 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-18 04:01:53 [http-nio-8080-exec-10] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@1298126887 wrapping com.mysql.cj.jdbc.ConnectionImpl@4377ed24] read-only
2026-01-18 04:01:53 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:01:53 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-18 04:01:53 [http-nio-8080-exec-10] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@1298126887 wrapping com.mysql.cj.jdbc.ConnectionImpl@4377ed24]
2026-01-18 04:01:53 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 45
2026-01-18 04:01:53 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚ö†Ô∏è Usando empresa por defecto (localhost): 1 - Sistema por Defecto
2026-01-18 04:01:53 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: josepino
2026-01-18 04:01:53 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: josepino en empresa ID: 1
2026-01-18 04:01:53 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:01:53 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [josepino]
2026-01-18 04:01:53 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-18 04:01:53 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 1
2026-01-18 04:01:53 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:01:53 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:01:53 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:01:53 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:01:53 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:01:53 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:01:53 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:01:53 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:01:53 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:01:53 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:01:53 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: false (Empresa ID: 1)
2026-01-18 04:01:53 [http-nio-8080-exec-10] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-16 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-18 04:01:53 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 45, Tenant anterior: 1
2026-01-18 04:01:53 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 45, Request: /favicon.ico, Empresa ID anterior: 1
2026-01-18 04:01:53 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:01:53 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=7532839BC11409BCB6417BDC3CAA82E4], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:01:53 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AccessDeniedHandlerImpl - Forwarding to /acceso-denegado with status code 403
2026-01-18 04:01:53 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /acceso-denegado?fecha=2026-01-16
2026-01-18 04:01:53 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /acceso-denegado?fecha=2026-01-16
2026-01-18 04:01:53 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /acceso-denegado, Empresa ID: null
2026-01-18 04:01:53 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì Interceptando acceso-denegado - EMPRESA: null
2026-01-18 04:01:53 [http-nio-8080-exec-1] WARN  j.s.s.controladores.InicioController - ‚õî GET /acceso-denigado - Mostrando p√°gina de acceso denegado
2026-01-18 04:03:27 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing POST /superadmin/empresas/crear
2026-01-18 04:03:27 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=7532839BC11409BCB6417BDC3CAA82E4], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:03:27 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured POST /superadmin/empresas/crear
2026-01-18 04:03:27 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/empresas/crear
2026-01-18 04:03:27 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/empresas/crear, Empresa ID: null
2026-01-18 04:03:27 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/empresas/crear
2026-01-18 04:03:27 [http-nio-8080-exec-3] INFO  j.s.s.c.SuperAdminController - üì® [CONTROLLER] Recibiendo solicitud para crear nueva empresa
2026-01-18 04:03:27 [http-nio-8080-exec-3] DEBUG j.s.s.c.SuperAdminController - üìã Datos recibidos: Nombre=BombayCore, Subdominio=bombaycore, Email=josepino@gmail.com, Plan=BASICO
2026-01-18 04:03:27 [http-nio-8080-exec-3] DEBUG j.s.s.c.SuperAdminController - ‚öôÔ∏è Configuraci√≥n: crearUsuarios=true, crearDatosIniciales=true
2026-01-18 04:03:27 [http-nio-8080-exec-3] INFO  j.s.s.c.SuperAdminController - üîÑ Delegando creaci√≥n al SuperAdminService...
2026-01-18 04:03:27 [http-nio-8080-exec-3] INFO  j.s.s.servicios.SuperAdminService - üöÄ [SUPERADMIN] Iniciando creaci√≥n de nueva empresa cliente
2026-01-18 04:03:27 [http-nio-8080-exec-3] INFO  j.s.s.servicios.SuperAdminService - üìã Datos recibidos - Nombre: BombayCore, Subdominio: bombaycore, Email: josepino@gmail.com
2026-01-18 04:03:27 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.SuperAdminService - üîç Validando subdominio: bombaycore
2026-01-18 04:03:27 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id 
    from
        empresa e1_0 
    where
        e1_0.subdominio=? 
    limit
        ?
2026-01-18 04:03:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [bombaycore]
2026-01-18 04:03:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [1]
2026-01-18 04:03:27 [http-nio-8080-exec-3] INFO  j.s.s.servicios.SuperAdminService - ‚úÖ Subdominio disponible
2026-01-18 04:03:27 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.SuperAdminService - üèóÔ∏è Creando empresa desde DTO
2026-01-18 04:03:27 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.SuperAdminService - üíæ Guardando empresa en BD
2026-01-18 04:03:27 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        empresa
        (email_contacto, estado, fecha_creacion, nombre, plan, subdominio, telefono) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-18 04:03:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [josepino@gmail.com]
2026-01-18 04:03:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BOOLEAN) <- [true]
2026-01-18 04:03:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:DATE) <- [2026-01-18]
2026-01-18 04:03:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [BombayCore]
2026-01-18 04:03:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2026-01-18 04:03:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [bombaycore]
2026-01-18 04:03:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [311]
2026-01-18 04:03:27 [http-nio-8080-exec-3] INFO  j.s.s.servicios.SuperAdminService - ‚úÖ Empresa creada: BombayCore (ID: 2)
2026-01-18 04:03:27 [http-nio-8080-exec-3] INFO  j.s.s.servicios.SuperAdminService - üë§ Creando usuario administrador...
2026-01-18 04:03:27 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.SuperAdminService - üíæ Guardando usuario admin en BD
2026-01-18 04:03:27 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        usuario
        (activo, contrasenna, empresa_id, nombre_usuario, rol, sucursal_id) 
    values
        (?, ?, ?, ?, ?, ?)
2026-01-18 04:03:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-18 04:03:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [$2a$10$KT50IdzqMBTGLxu/05mi8OzkPBgmkTNj3Zm3co2DW2QRljqeMBsDq]
2026-01-18 04:03:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-18 04:03:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [admin]
2026-01-18 04:03:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [ADMIN]
2026-01-18 04:03:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:BIGINT) <- [null]
2026-01-18 04:03:27 [http-nio-8080-exec-3] INFO  j.s.s.servicios.SuperAdminService - üë§ Usuario creado - Username: admin, Empresa: BombayCore
2026-01-18 04:03:27 [http-nio-8080-exec-3] INFO  j.s.s.servicios.SuperAdminService - ‚úÖ Usuario admin creado para empresa BombayCore
2026-01-18 04:03:27 [http-nio-8080-exec-3] INFO  j.s.s.servicios.SuperAdminService - üì¶ Creando datos iniciales...
2026-01-18 04:03:27 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.SuperAdminService - üíæ Guardando cliente en BD
2026-01-18 04:03:27 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        cliente
        (activo, correo, empresa_id, identificacion, nombre, telefono) 
    values
        (?, ?, ?, ?, ?, ?)
2026-01-18 04:03:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-18 04:03:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [null]
2026-01-18 04:03:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-18 04:03:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [CF9999999999999]
2026-01-18 04:03:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [Consumidor Final]
2026-01-18 04:03:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2026-01-18 04:03:27 [http-nio-8080-exec-3] INFO  j.s.s.servicios.SuperAdminService - üë§ Cliente 'Consumidor Final' creado para empresa BombayCore
2026-01-18 04:03:27 [http-nio-8080-exec-3] INFO  j.s.s.servicios.SuperAdminService - ‚úÖ Datos iniciales creados para empresa BombayCore
2026-01-18 04:03:27 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.SuperAdminService - üìã Asignando plan: BASICO
2026-01-18 04:03:27 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.SuperAdminService - üí∞ Plan 'BASICO' procesado para empresa BombayCore
2026-01-18 04:03:27 [http-nio-8080-exec-3] INFO  j.s.s.servicios.SuperAdminService - üí∞ Plan 'BASICO' asignado a empresa BombayCore
2026-01-18 04:03:27 [http-nio-8080-exec-3] INFO  j.s.s.servicios.SuperAdminService - üéâ Creaci√≥n de empresa cliente completada exitosamente
2026-01-18 04:03:27 [http-nio-8080-exec-3] INFO  j.s.s.c.SuperAdminController - ‚úÖ Empresa creada exitosamente - ID: 2, Nombre: BombayCore
2026-01-18 04:03:27 [http-nio-8080-exec-3] INFO  j.s.s.c.SuperAdminController - üìä Datos empresa creada: Subdominio=bombaycore, Email=josepino@gmail.com
2026-01-18 04:03:27 [http-nio-8080-exec-3] INFO  j.s.s.c.SuperAdminController - üéØ Redirigiendo a p√°gina de √©xito
2026-01-18 04:03:27 [http-nio-8080-exec-3] ERROR org.thymeleaf.TemplateEngine - [THYMELEAF][http-nio-8080-exec-3] Exception processing template "superadmin/empresas/exito": Error resolving template [superadmin/empresas/exito], template might not exist or might not be accessible by any of the configured Template Resolvers
org.thymeleaf.exceptions.TemplateInputException: Error resolving template [superadmin/empresas/exito], template might not exist or might not be accessible by any of the configured Template Resolvers
	at org.thymeleaf.engine.TemplateManager.resolveTemplate(TemplateManager.java:869)
	at org.thymeleaf.engine.TemplateManager.parseAndProcess(TemplateManager.java:607)
	at org.thymeleaf.TemplateEngine.process(TemplateEngine.java:1103)
	at org.thymeleaf.TemplateEngine.process(TemplateEngine.java:1077)
	at org.thymeleaf.spring6.view.ThymeleafView.renderFragment(ThymeleafView.java:372)
	at org.thymeleaf.spring6.view.ThymeleafView.render(ThymeleafView.java:192)
	at org.springframework.web.servlet.DispatcherServlet.render(DispatcherServlet.java:1438)
	at org.springframework.web.servlet.DispatcherServlet.processDispatchResult(DispatcherServlet.java:1168)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1106)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at jpd.sistemafacinv.sistemadefacturacioneinventario.context.TenantFilter.doFilter(TenantFilter.java:46)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at jpd.sistemafacinv.sistemadefacturacioneinventario.context.TenantContextCleanupFilter.doFilter(TenantContextCleanupFilter.java:45)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:365)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:101)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:125)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:119)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:235)
	at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:229)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.csrf.CsrfFilter.doFilterInternal(CsrfFilter.java:134)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.ServletRequestPathFilter.doFilter(ServletRequestPathFilter.java:52)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebSecurityConfiguration.java:319)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$4(HandlerMappingIntrospector.java:267)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:240)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:362)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:278)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:88)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:113)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:83)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:72)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:399)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1774)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:973)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:491)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:840)
2026-01-18 04:03:27 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 38, Request: /superadmin/empresas/crear, Empresa ID anterior: null
2026-01-18 04:03:27 [http-nio-8080-exec-3] ERROR o.a.c.c.C.[.[.[.[dispatcherServlet] - Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed: org.thymeleaf.exceptions.TemplateInputException: Error resolving template [superadmin/empresas/exito], template might not exist or might not be accessible by any of the configured Template Resolvers] with root cause
org.thymeleaf.exceptions.TemplateInputException: Error resolving template [superadmin/empresas/exito], template might not exist or might not be accessible by any of the configured Template Resolvers
	at org.thymeleaf.engine.TemplateManager.resolveTemplate(TemplateManager.java:869)
	at org.thymeleaf.engine.TemplateManager.parseAndProcess(TemplateManager.java:607)
	at org.thymeleaf.TemplateEngine.process(TemplateEngine.java:1103)
	at org.thymeleaf.TemplateEngine.process(TemplateEngine.java:1077)
	at org.thymeleaf.spring6.view.ThymeleafView.renderFragment(ThymeleafView.java:372)
	at org.thymeleaf.spring6.view.ThymeleafView.render(ThymeleafView.java:192)
	at org.springframework.web.servlet.DispatcherServlet.render(DispatcherServlet.java:1438)
	at org.springframework.web.servlet.DispatcherServlet.processDispatchResult(DispatcherServlet.java:1168)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1106)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at jpd.sistemafacinv.sistemadefacturacioneinventario.context.TenantFilter.doFilter(TenantFilter.java:46)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at jpd.sistemafacinv.sistemadefacturacioneinventario.context.TenantContextCleanupFilter.doFilter(TenantContextCleanupFilter.java:45)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:365)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:101)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:125)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:119)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:235)
	at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:229)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.csrf.CsrfFilter.doFilterInternal(CsrfFilter.java:134)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.ServletRequestPathFilter.doFilter(ServletRequestPathFilter.java:52)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebSecurityConfiguration.java:319)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$4(HandlerMappingIntrospector.java:267)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:240)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:362)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:278)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:88)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:113)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:83)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:72)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:399)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1774)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:973)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:491)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:840)
2026-01-18 04:03:27 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing POST /error
2026-01-18 04:03:27 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured POST /error
2026-01-18 04:03:27 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=7532839BC11409BCB6417BDC3CAA82E4], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:03:27 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-18 04:03:27 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=7532839BC11409BCB6417BDC3CAA82E4], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:03:27 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-18 04:03:27 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-18 04:03:27 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: localhost
2026-01-18 04:03:27 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: localhost
2026-01-18 04:03:27 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:03:27 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-18 04:03:27 [http-nio-8080-exec-4] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@1256941227 wrapping com.mysql.cj.jdbc.ConnectionImpl@4377ed24] read-only
2026-01-18 04:03:27 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:03:27 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-18 04:03:27 [http-nio-8080-exec-4] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@1256941227 wrapping com.mysql.cj.jdbc.ConnectionImpl@4377ed24]
2026-01-18 04:03:27 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 39
2026-01-18 04:03:27 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚ö†Ô∏è Usando empresa por defecto (localhost): 1 - Sistema por Defecto
2026-01-18 04:03:27 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: josepino
2026-01-18 04:03:27 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: josepino en empresa ID: 1
2026-01-18 04:03:27 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:03:27 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [josepino]
2026-01-18 04:03:27 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-18 04:03:27 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 1
2026-01-18 04:03:27 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:03:27 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:03:27 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:03:27 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:03:27 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:03:27 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:03:27 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:03:27 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:03:27 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:03:27 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:03:27 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: false (Empresa ID: 1)
2026-01-18 04:03:27 [http-nio-8080-exec-4] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-16 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-18 04:03:27 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 39, Tenant anterior: 1
2026-01-18 04:03:27 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 39, Request: /favicon.ico, Empresa ID anterior: 1
2026-01-18 04:03:27 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:03:27 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=7532839BC11409BCB6417BDC3CAA82E4], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:03:27 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AccessDeniedHandlerImpl - Forwarding to /acceso-denegado with status code 403
2026-01-18 04:03:27 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /acceso-denegado?fecha=2026-01-16
2026-01-18 04:03:27 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /acceso-denegado?fecha=2026-01-16
2026-01-18 04:03:27 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /acceso-denegado, Empresa ID: null
2026-01-18 04:03:27 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì Interceptando acceso-denegado - EMPRESA: null
2026-01-18 04:03:27 [http-nio-8080-exec-5] WARN  j.s.s.controladores.InicioController - ‚õî GET /acceso-denigado - Mostrando p√°gina de acceso denegado
2026-01-18 04:15:48 [SpringApplicationShutdownHook] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2026-01-18 04:15:48 [tomcat-shutdown] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2026-01-18 04:15:48 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2026-01-18 04:15:48 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2026-01-18 04:15:48 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2026-01-18 04:15:54 [main] INFO  j.s.s.SistemadefacturacioneinventarioApplication - Starting SistemadefacturacioneinventarioApplication using Java 17.0.17 with PID 13925 (/home/josepino/Desktop/SistemaFacturaEInventario/sistemadefacturacioneinventario/target/classes started by josepino in /home/josepino/Desktop/SistemaFacturaEInventario/sistemadefacturacioneinventario)
2026-01-18 04:15:54 [main] DEBUG j.s.s.SistemadefacturacioneinventarioApplication - Running with Spring Boot v3.5.8, Spring v6.2.14
2026-01-18 04:15:54 [main] INFO  j.s.s.SistemadefacturacioneinventarioApplication - No active profile set, falling back to 1 default profile: "default"
2026-01-18 04:15:54 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-18 04:15:54 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 59 ms. Found 14 JPA repository interfaces.
2026-01-18 04:15:55 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2026-01-18 04:15:55 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2026-01-18 04:15:55 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.49]
2026-01-18 04:15:55 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2026-01-18 04:15:55 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 990 ms
2026-01-18 04:15:55 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-18 04:15:55 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.6.36.Final
2026-01-18 04:15:55 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2026-01-18 04:15:55 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-18 04:15:55 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2026-01-18 04:15:56 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@4377ed24
2026-01-18 04:15:56 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2026-01-18 04:15:56 [main] INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 8.0.44
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2026-01-18 04:15:56 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-18 04:15:57 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-18 04:15:57 [main] DEBUG o.h.s.internal.StatisticsInitiator - Statistics initialized [enabled=false]
2026-01-18 04:15:57 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2026-01-18 04:15:57 [main] INFO  j.s.s.config.SpringSecurityConfig - üîê Configurando BCryptPasswordEncoder para encriptaci√≥n de contrase√±as
2026-01-18 04:15:58 [main] INFO  j.s.s.config.WebConfig - ‚öôÔ∏è Configurando interceptores de Spring MVC
2026-01-18 04:15:58 [main] DEBUG j.s.s.config.WebConfig - Registrando CierreDiarioInterceptor
2026-01-18 04:15:58 [main] DEBUG j.s.s.config.WebConfig - CierreDiarioInterceptor configurado. Patrones incluidos: /**
2026-01-18 04:15:58 [main] DEBUG j.s.s.config.WebConfig - Patrones excluidos: /cierres/**, /login, /css/**, /js/**, /error
2026-01-18 04:15:58 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name usuarioServicio
2026-01-18 04:15:58 [main] INFO  j.s.s.config.SpringSecurityConfig - üõ°Ô∏è Configurando SecurityFilterChain para SUPERADMIN (Orden 1)
2026-01-18 04:15:58 [main] INFO  j.s.s.config.SpringSecurityConfig - ‚úÖ SecurityFilterChain SUPERADMIN configurado
2026-01-18 04:15:58 [main] DEBUG o.s.s.web.DefaultSecurityFilterChain - Will secure Or [Mvc [pattern='/superadmin/**']] with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CsrfFilter, LogoutFilter, UsernamePasswordAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-18 04:15:58 [main] INFO  j.s.s.config.SpringSecurityConfig - üõ°Ô∏è Configurando SecurityFilterChain - Iniciando configuraci√≥n de seguridad
2026-01-18 04:15:58 [main] INFO  j.s.s.config.SpringSecurityConfig - ‚úÖ SecurityFilterChain configurado exitosamente
2026-01-18 04:15:58 [main] DEBUG j.s.s.config.SpringSecurityConfig - Configuraci√≥n de seguridad aplicada:
2026-01-18 04:15:58 [main] DEBUG j.s.s.config.SpringSecurityConfig - - P√°ginas p√∫blicas: /, /login, /acceso-denegado, /css/**, /js/**, /error
2026-01-18 04:15:58 [main] DEBUG j.s.s.config.SpringSecurityConfig - - Solo ADMIN: /compras/**, /proveedores/**
2026-01-18 04:15:58 [main] DEBUG j.s.s.config.SpringSecurityConfig - - ADMIN o DEV: /productos/**, /ingredientes/**, /recetas/**, /reportes/**, /cierres/**
2026-01-18 04:15:58 [main] DEBUG j.s.s.config.SpringSecurityConfig - - Login: /login, Logout: /logout
2026-01-18 04:15:58 [main] DEBUG j.s.s.config.SpringSecurityConfig - - P√°gina acceso denegado: /acceso-denegado
2026-01-18 04:15:58 [main] DEBUG o.s.s.web.DefaultSecurityFilterChain - Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CsrfFilter, LogoutFilter, UsernamePasswordAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-18 04:15:58 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2026-01-18 04:15:58 [main] INFO  j.s.s.SistemadefacturacioneinventarioApplication - Started SistemadefacturacioneinventarioApplication in 4.719 seconds (process running for 5.012)
2026-01-18 04:15:58 [main] INFO  j.s.s.config.DataInitializer - üöÄ INICIANDO CARGA DE DATOS INICIALES DEL SISTEMA
2026-01-18 04:15:58 [main] DEBUG org.hibernate.SQL - 
    select
        count(*) 
    from
        empresa e1_0
2026-01-18 04:15:58 [main] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0
2026-01-18 04:15:58 [main] INFO  j.s.s.config.DataInitializer - ‚úÖ Empresa existente encontrada: Sistema por Defecto (ID: 1)
2026-01-18 04:15:58 [main] DEBUG org.hibernate.SQL - 
    select
        c1_0.id 
    from
        cliente c1_0 
    left join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    where
        c1_0.nombre=? 
        and e1_0.id=? 
    limit
        ?
2026-01-18 04:15:58 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Consumidor Final]
2026-01-18 04:15:58 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-18 04:15:58 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:INTEGER) <- [1]
2026-01-18 04:15:58 [main] INFO  j.s.s.config.DataInitializer - ‚úÖ Cliente 'Consumidor Final' ya existe para empresa Sistema por Defecto
2026-01-18 04:15:58 [main] DEBUG org.hibernate.SQL - 
    select
        count(u1_0.id) 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-18 04:15:58 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-18 04:15:58 [main] INFO  j.s.s.config.DataInitializer - ‚úÖ Ya existen 3 usuarios para empresa Sistema por Defecto. No se crean nuevos.
2026-01-18 04:15:58 [main] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.fecha=? 
        and e1_0.id=? 
    limit
        ?
2026-01-18 04:15:58 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-17]
2026-01-18 04:15:58 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-18 04:15:58 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:INTEGER) <- [1]
2026-01-18 04:15:58 [main] INFO  j.s.s.config.DataInitializer - ‚úÖ Ya existe cierre diario para hoy (2026-01-17) - Empresa: Sistema por Defecto
2026-01-18 04:15:58 [main] INFO  j.s.s.config.DataInitializer - üëë Verificando existencia de usuario SUPER_ADMIN
2026-01-18 04:15:58 [main] DEBUG org.hibernate.SQL - 
    select
        u1_0.id 
    from
        usuario u1_0 
    where
        u1_0.rol=? 
    limit
        ?
2026-01-18 04:15:58 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [SUPER_ADMIN]
2026-01-18 04:15:58 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [1]
2026-01-18 04:15:58 [main] INFO  j.s.s.config.DataInitializer - ‚úÖ Usuario SUPER_ADMIN ya existe en el sistema
2026-01-18 04:15:58 [main] INFO  j.s.s.config.DataInitializer - ‚úÖ CARGA DE DATOS INICIALES COMPLETADA EXITOSAMENTE
2026-01-18 04:15:58 [main] INFO  j.s.s.config.UsuarioInicial - üîß Iniciando carga de usuarios iniciales
2026-01-18 04:15:58 [main] DEBUG org.hibernate.SQL - 
    select
        count(*) 
    from
        empresa e1_0
2026-01-18 04:15:58 [main] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0
2026-01-18 04:15:58 [main] DEBUG org.hibernate.SQL - 
    select
        count(u1_0.id) 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-18 04:15:58 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-18 04:15:58 [main] DEBUG j.s.s.config.UsuarioInicial - Usuarios existentes en BD para empresa Sistema por Defecto: 3
2026-01-18 04:15:58 [main] INFO  j.s.s.config.UsuarioInicial - ‚úÖ Ya existen usuarios para empresa Sistema por Defecto. No se crean nuevos.
2026-01-18 04:16:05 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2026-01-18 04:16:05 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2026-01-18 04:16:05 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2026-01-18 04:16:05 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/login
2026-01-18 04:16:05 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/login
2026-01-18 04:16:05 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/login
2026-01-18 04:16:05 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/login, Empresa ID: null
2026-01-18 04:16:05 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/login
2026-01-18 04:16:05 [http-nio-8080-exec-1] INFO  j.s.s.c.SuperAdminController - üîì Mostrando p√°gina de login para SUPER_ADMIN
2026-01-18 04:16:05 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-18 04:16:05 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 35, Request: /superadmin/login, Empresa ID anterior: null
2026-01-18 04:16:05 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-18 04:16:05 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-18 04:16:05 [http-nio-8080-exec-2] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to http://localhost:8080/login
2026-01-18 04:16:05 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login
2026-01-18 04:16:05 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login
2026-01-18 04:16:05 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-18 04:16:05 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: localhost
2026-01-18 04:16:05 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: localhost
2026-01-18 04:16:05 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:16:05 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-18 04:16:05 [http-nio-8080-exec-3] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@2053152600 wrapping com.mysql.cj.jdbc.ConnectionImpl@4377ed24] read-only
2026-01-18 04:16:05 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:16:05 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-18 04:16:05 [http-nio-8080-exec-3] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@2053152600 wrapping com.mysql.cj.jdbc.ConnectionImpl@4377ed24]
2026-01-18 04:16:05 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 37
2026-01-18 04:16:05 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚ö†Ô∏è Usando empresa por defecto (localhost): 1 - Sistema por Defecto
2026-01-18 04:16:05 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-18 04:16:05 [http-nio-8080-exec-3] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-18 04:16:05 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 37, Tenant anterior: 1
2026-01-18 04:16:05 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 37, Request: /login, Empresa ID anterior: 1
2026-01-18 04:16:11 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing POST /superadmin/login
2026-01-18 04:16:11 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: josepino para la empresa ID: null
2026-01-18 04:16:11 [http-nio-8080-exec-4] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: josepino | Subdominio: localhost
2026-01-18 04:16:11 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=?
2026-01-18 04:16:11 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [josepino]
2026-01-18 04:16:11 [http-nio-8080-exec-4] INFO  j.s.s.servicios.UsuarioServicio - ‚úÖ SUPER_ADMIN cargado: josepino - Rol: SUPER_ADMIN
2026-01-18 04:16:11 [http-nio-8080-exec-4] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Authenticated user
2026-01-18 04:16:11 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.s.ChangeSessionIdAuthenticationStrategy - Changed session id from B59AF6370B8A6D3A00D9F74A19004297
2026-01-18 04:16:11 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.CsrfAuthenticationStrategy - Replaced CSRF Token
2026-01-18 04:16:11 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Stored SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B59AF6370B8A6D3A00D9F74A19004297], Granted Authorities=[ROLE_SUPER_ADMIN]]] to HttpSession [org.apache.catalina.session.StandardSessionFacade@43f06b0c]
2026-01-18 04:16:11 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.UsernamePasswordAuthenticationFilter - Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B59AF6370B8A6D3A00D9F74A19004297], Granted Authorities=[ROLE_SUPER_ADMIN]]
2026-01-18 04:16:11 [http-nio-8080-exec-4] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /superadmin/dashboard
2026-01-18 04:16:11 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/dashboard
2026-01-18 04:16:11 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B59AF6370B8A6D3A00D9F74A19004297], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:16:11 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/dashboard
2026-01-18 04:16:11 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/dashboard
2026-01-18 04:16:11 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/dashboard, Empresa ID: null
2026-01-18 04:16:11 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/dashboard
2026-01-18 04:16:11 [http-nio-8080-exec-5] INFO  j.s.s.c.SuperAdminController - üìä Accediendo al dashboard SUPER_ADMIN
2026-01-18 04:16:11 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 39, Request: /superadmin/dashboard, Empresa ID anterior: null
2026-01-18 04:16:11 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/empresas
2026-01-18 04:16:11 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B59AF6370B8A6D3A00D9F74A19004297], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:16:11 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/empresas
2026-01-18 04:16:11 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/empresas
2026-01-18 04:16:11 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/empresas, Empresa ID: null
2026-01-18 04:16:11 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/empresas
2026-01-18 04:16:11 [http-nio-8080-exec-6] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@1580985446 wrapping com.mysql.cj.jdbc.ConnectionImpl@4377ed24] read-only
2026-01-18 04:16:11 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0
2026-01-18 04:16:11 [http-nio-8080-exec-6] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@1580985446 wrapping com.mysql.cj.jdbc.ConnectionImpl@4377ed24]
2026-01-18 04:16:11 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 40, Request: /superadmin/empresas, Empresa ID anterior: null
2026-01-18 04:16:11 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-18 04:16:11 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B59AF6370B8A6D3A00D9F74A19004297], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:16:11 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-18 04:16:11 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-18 04:16:11 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: localhost
2026-01-18 04:16:11 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: localhost
2026-01-18 04:16:11 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:16:11 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-18 04:16:11 [http-nio-8080-exec-7] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@399972101 wrapping com.mysql.cj.jdbc.ConnectionImpl@4377ed24] read-only
2026-01-18 04:16:11 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:16:11 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-18 04:16:11 [http-nio-8080-exec-7] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@399972101 wrapping com.mysql.cj.jdbc.ConnectionImpl@4377ed24]
2026-01-18 04:16:11 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 41
2026-01-18 04:16:11 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚ö†Ô∏è Usando empresa por defecto (localhost): 1 - Sistema por Defecto
2026-01-18 04:16:11 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: josepino
2026-01-18 04:16:11 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: josepino en empresa ID: 1
2026-01-18 04:16:11 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:16:11 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [josepino]
2026-01-18 04:16:11 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-18 04:16:11 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 1
2026-01-18 04:16:11 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:16:11 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:16:11 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:16:11 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:16:11 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:16:11 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:16:11 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:16:11 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:16:11 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:16:11 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:16:11 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: false (Empresa ID: 1)
2026-01-18 04:16:11 [http-nio-8080-exec-7] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-16 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-18 04:16:11 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 41, Tenant anterior: 1
2026-01-18 04:16:11 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 41, Request: /favicon.ico, Empresa ID anterior: 1
2026-01-18 04:16:11 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:16:11 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B59AF6370B8A6D3A00D9F74A19004297], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:16:11 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AccessDeniedHandlerImpl - Forwarding to /acceso-denegado with status code 403
2026-01-18 04:16:11 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /acceso-denegado?fecha=2026-01-16
2026-01-18 04:16:11 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /acceso-denegado?fecha=2026-01-16
2026-01-18 04:16:11 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /acceso-denegado, Empresa ID: null
2026-01-18 04:16:11 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì Interceptando acceso-denegado - EMPRESA: null
2026-01-18 04:16:11 [http-nio-8080-exec-8] WARN  j.s.s.controladores.InicioController - ‚õî GET /acceso-denigado - Mostrando p√°gina de acceso denegado
2026-01-18 04:16:12 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/empresas/nueva
2026-01-18 04:16:12 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B59AF6370B8A6D3A00D9F74A19004297], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:16:12 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/empresas/nueva
2026-01-18 04:16:12 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/empresas/nueva
2026-01-18 04:16:12 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/empresas/nueva, Empresa ID: null
2026-01-18 04:16:12 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/empresas/nueva
2026-01-18 04:16:12 [http-nio-8080-exec-9] INFO  j.s.s.c.SuperAdminController - üìÑ [CONTROLLER] Mostrando formulario para crear nueva empresa
2026-01-18 04:16:12 [http-nio-8080-exec-9] DEBUG j.s.s.c.SuperAdminController - üîß Preparando modelo con nuevo EmpresaClienteDTO
2026-01-18 04:16:12 [http-nio-8080-exec-9] INFO  j.s.s.c.SuperAdminController - ‚úÖ Formulario listo para mostrar
2026-01-18 04:16:12 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /superadmin/empresas/nueva, Empresa ID anterior: null
2026-01-18 04:16:12 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-18 04:16:12 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B59AF6370B8A6D3A00D9F74A19004297], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:16:12 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-18 04:16:12 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-18 04:16:12 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: localhost
2026-01-18 04:16:12 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: localhost
2026-01-18 04:16:12 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:16:12 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-18 04:16:12 [http-nio-8080-exec-10] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@1019968486 wrapping com.mysql.cj.jdbc.ConnectionImpl@4377ed24] read-only
2026-01-18 04:16:12 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:16:12 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-18 04:16:12 [http-nio-8080-exec-10] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@1019968486 wrapping com.mysql.cj.jdbc.ConnectionImpl@4377ed24]
2026-01-18 04:16:12 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 44
2026-01-18 04:16:12 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚ö†Ô∏è Usando empresa por defecto (localhost): 1 - Sistema por Defecto
2026-01-18 04:16:12 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: josepino
2026-01-18 04:16:12 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: josepino en empresa ID: 1
2026-01-18 04:16:12 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:16:12 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [josepino]
2026-01-18 04:16:12 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-18 04:16:12 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 1
2026-01-18 04:16:12 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:16:12 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:16:12 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:16:12 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:16:12 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:16:12 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:16:12 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:16:12 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:16:12 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:16:12 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:16:12 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: false (Empresa ID: 1)
2026-01-18 04:16:12 [http-nio-8080-exec-10] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-16 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-18 04:16:12 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 44, Tenant anterior: 1
2026-01-18 04:16:12 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 44, Request: /favicon.ico, Empresa ID anterior: 1
2026-01-18 04:16:12 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:16:12 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B59AF6370B8A6D3A00D9F74A19004297], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:16:12 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AccessDeniedHandlerImpl - Forwarding to /acceso-denegado with status code 403
2026-01-18 04:16:12 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /acceso-denegado?fecha=2026-01-16
2026-01-18 04:16:12 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /acceso-denegado?fecha=2026-01-16
2026-01-18 04:16:12 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /acceso-denegado, Empresa ID: null
2026-01-18 04:16:12 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì Interceptando acceso-denegado - EMPRESA: null
2026-01-18 04:16:12 [http-nio-8080-exec-1] WARN  j.s.s.controladores.InicioController - ‚õî GET /acceso-denigado - Mostrando p√°gina de acceso denegado
2026-01-18 04:16:28 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing POST /superadmin/empresas/crear
2026-01-18 04:16:28 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B59AF6370B8A6D3A00D9F74A19004297], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:16:28 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured POST /superadmin/empresas/crear
2026-01-18 04:16:28 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/empresas/crear
2026-01-18 04:16:28 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/empresas/crear, Empresa ID: null
2026-01-18 04:16:28 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/empresas/crear
2026-01-18 04:16:28 [http-nio-8080-exec-2] INFO  j.s.s.c.SuperAdminController - üì® [CONTROLLER] Recibiendo solicitud para crear nueva empresa
2026-01-18 04:16:28 [http-nio-8080-exec-2] DEBUG j.s.s.c.SuperAdminController - üìã Datos recibidos: Nombre=vallunas, Subdominio=vallunas, Email=valluna@gmail.com, Plan=BASICO
2026-01-18 04:16:28 [http-nio-8080-exec-2] DEBUG j.s.s.c.SuperAdminController - ‚öôÔ∏è Configuraci√≥n: crearUsuarios=true, crearDatosIniciales=true
2026-01-18 04:16:28 [http-nio-8080-exec-2] INFO  j.s.s.c.SuperAdminController - üîÑ Delegando creaci√≥n al SuperAdminService...
2026-01-18 04:16:28 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - üöÄ [SUPERADMIN] Iniciando creaci√≥n de nueva empresa cliente
2026-01-18 04:16:28 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - üìã Datos recibidos - Nombre: vallunas, Subdominio: vallunas, Email: valluna@gmail.com
2026-01-18 04:16:28 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.SuperAdminService - üîç Validando subdominio: vallunas
2026-01-18 04:16:28 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id 
    from
        empresa e1_0 
    where
        e1_0.subdominio=? 
    limit
        ?
2026-01-18 04:16:28 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [vallunas]
2026-01-18 04:16:28 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [1]
2026-01-18 04:16:28 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - ‚úÖ Subdominio disponible
2026-01-18 04:16:28 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.SuperAdminService - üèóÔ∏è Creando empresa desde DTO
2026-01-18 04:16:28 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.SuperAdminService - üíæ Guardando empresa en BD
2026-01-18 04:16:28 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        empresa
        (email_contacto, estado, fecha_creacion, nombre, plan, subdominio, telefono) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-18 04:16:28 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [valluna@gmail.com]
2026-01-18 04:16:28 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BOOLEAN) <- [true]
2026-01-18 04:16:28 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:DATE) <- [2026-01-18]
2026-01-18 04:16:28 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [vallunas]
2026-01-18 04:16:28 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2026-01-18 04:16:28 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [vallunas]
2026-01-18 04:16:28 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [32323]
2026-01-18 04:16:28 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - ‚úÖ Empresa creada: vallunas (ID: 3)
2026-01-18 04:16:28 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - üë§ Creando usuario administrador...
2026-01-18 04:16:28 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.SuperAdminService - üíæ Guardando usuario admin en BD
2026-01-18 04:16:28 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        usuario
        (activo, contrasenna, empresa_id, nombre_usuario, rol, sucursal_id) 
    values
        (?, ?, ?, ?, ?, ?)
2026-01-18 04:16:28 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-18 04:16:28 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [$2a$10$rmMnho4szhlACylipKzeA.Uv8MKIEeATgJiiUq06pRVG2Jmuu99dK]
2026-01-18 04:16:28 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:16:28 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [admin]
2026-01-18 04:16:28 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [ADMIN]
2026-01-18 04:16:28 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:BIGINT) <- [null]
2026-01-18 04:16:28 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - üë§ Usuario creado - Username: admin, Empresa: vallunas
2026-01-18 04:16:28 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - ‚úÖ Usuario admin creado para empresa vallunas
2026-01-18 04:16:28 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - üì¶ Creando datos iniciales...
2026-01-18 04:16:28 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.SuperAdminService - üíæ Guardando cliente en BD
2026-01-18 04:16:28 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        cliente
        (activo, correo, empresa_id, identificacion, nombre, telefono) 
    values
        (?, ?, ?, ?, ?, ?)
2026-01-18 04:16:28 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-18 04:16:28 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [null]
2026-01-18 04:16:28 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:16:28 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [CF9999999999999]
2026-01-18 04:16:28 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [Consumidor Final]
2026-01-18 04:16:28 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2026-01-18 04:16:28 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - üë§ Cliente 'Consumidor Final' creado para empresa vallunas
2026-01-18 04:16:28 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - ‚úÖ Datos iniciales creados para empresa vallunas
2026-01-18 04:16:28 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.SuperAdminService - üìã Asignando plan: BASICO
2026-01-18 04:16:28 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.SuperAdminService - üí∞ Plan 'BASICO' procesado para empresa vallunas
2026-01-18 04:16:28 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - üí∞ Plan 'BASICO' asignado a empresa vallunas
2026-01-18 04:16:28 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - üéâ Creaci√≥n de empresa cliente completada exitosamente
2026-01-18 04:16:28 [http-nio-8080-exec-2] INFO  j.s.s.c.SuperAdminController - ‚úÖ Empresa creada exitosamente - ID: 3, Nombre: vallunas
2026-01-18 04:16:28 [http-nio-8080-exec-2] INFO  j.s.s.c.SuperAdminController - üìä Datos empresa creada: Subdominio=vallunas, Email=valluna@gmail.com
2026-01-18 04:16:28 [http-nio-8080-exec-2] INFO  j.s.s.c.SuperAdminController - üéØ Redirigiendo a p√°gina de √©xito
2026-01-18 04:16:28 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 36, Request: /superadmin/empresas/crear, Empresa ID anterior: null
2026-01-18 04:16:28 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/empresas
2026-01-18 04:16:28 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B59AF6370B8A6D3A00D9F74A19004297], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:16:28 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/empresas
2026-01-18 04:16:28 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/empresas
2026-01-18 04:16:28 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/empresas, Empresa ID: null
2026-01-18 04:16:28 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/empresas
2026-01-18 04:16:28 [http-nio-8080-exec-3] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@1758869627 wrapping com.mysql.cj.jdbc.ConnectionImpl@4377ed24] read-only
2026-01-18 04:16:28 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0
2026-01-18 04:16:28 [http-nio-8080-exec-3] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@1758869627 wrapping com.mysql.cj.jdbc.ConnectionImpl@4377ed24]
2026-01-18 04:16:28 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 37, Request: /superadmin/empresas, Empresa ID anterior: null
2026-01-18 04:16:28 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-18 04:16:28 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B59AF6370B8A6D3A00D9F74A19004297], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:16:28 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-18 04:16:28 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-18 04:16:28 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: localhost
2026-01-18 04:16:28 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: localhost
2026-01-18 04:16:28 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:16:28 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-18 04:16:28 [http-nio-8080-exec-4] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@2110019107 wrapping com.mysql.cj.jdbc.ConnectionImpl@4377ed24] read-only
2026-01-18 04:16:28 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:16:28 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-18 04:16:28 [http-nio-8080-exec-4] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@2110019107 wrapping com.mysql.cj.jdbc.ConnectionImpl@4377ed24]
2026-01-18 04:16:28 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 38
2026-01-18 04:16:28 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚ö†Ô∏è Usando empresa por defecto (localhost): 1 - Sistema por Defecto
2026-01-18 04:16:28 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: josepino
2026-01-18 04:16:28 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: josepino en empresa ID: 1
2026-01-18 04:16:28 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:16:28 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [josepino]
2026-01-18 04:16:28 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-18 04:16:28 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 1
2026-01-18 04:16:28 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:16:28 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:16:28 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:16:28 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:16:28 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:16:28 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:16:28 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:16:28 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:16:28 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:16:28 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:16:28 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: false (Empresa ID: 1)
2026-01-18 04:16:28 [http-nio-8080-exec-4] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-16 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-18 04:16:28 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 38, Tenant anterior: 1
2026-01-18 04:16:28 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 38, Request: /favicon.ico, Empresa ID anterior: 1
2026-01-18 04:16:28 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:16:28 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=B59AF6370B8A6D3A00D9F74A19004297], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:16:28 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AccessDeniedHandlerImpl - Forwarding to /acceso-denegado with status code 403
2026-01-18 04:16:28 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /acceso-denegado?fecha=2026-01-16
2026-01-18 04:16:28 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /acceso-denegado?fecha=2026-01-16
2026-01-18 04:16:28 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /acceso-denegado, Empresa ID: null
2026-01-18 04:16:28 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì Interceptando acceso-denegado - EMPRESA: null
2026-01-18 04:16:28 [http-nio-8080-exec-5] WARN  j.s.s.controladores.InicioController - ‚õî GET /acceso-denigado - Mostrando p√°gina de acceso denegado
2026-01-18 04:16:32 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /
2026-01-18 04:16:32 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /
2026-01-18 04:16:32 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /, M√©todo: GET
2026-01-18 04:16:32 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: vallunas.localhost
2026-01-18 04:16:32 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: vallunas
2026-01-18 04:16:32 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:16:32 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [vallunas]
2026-01-18 04:16:32 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 40
2026-01-18 04:16:32 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: vallunas)
2026-01-18 04:16:32 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-18 04:16:32 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /, Empresa ID: 3
2026-01-18 04:16:32 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:16:32 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:16:32 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:16:32 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:16:32 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:16:32 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:16:32 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:16:32 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:16:32 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:16:32 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:16:32 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: false (Empresa ID: 3)
2026-01-18 04:16:32 [http-nio-8080-exec-6] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-16 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-18 04:16:32 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 40, Tenant anterior: 3
2026-01-18 04:16:32 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 40, Request: /, Empresa ID anterior: 3
2026-01-18 04:16:32 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:16:32 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-18 04:16:32 [http-nio-8080-exec-7] DEBUG o.s.s.w.s.HttpSessionRequestCache - Saved request http://vallunas.localhost:8080/cierres/obligatorio?fecha=2026-01-16&continue to session
2026-01-18 04:16:32 [http-nio-8080-exec-7] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to http://vallunas.localhost:8080/login
2026-01-18 04:16:32 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login
2026-01-18 04:16:32 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login
2026-01-18 04:16:32 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-18 04:16:32 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üåê Server Name: vallunas.localhost
2026-01-18 04:16:32 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: vallunas
2026-01-18 04:16:32 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:16:32 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [vallunas]
2026-01-18 04:16:32 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 42
2026-01-18 04:16:32 [http-nio-8080-exec-8] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: vallunas)
2026-01-18 04:16:32 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-18 04:16:32 [http-nio-8080-exec-8] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-18 04:16:32 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 42, Tenant anterior: 3
2026-01-18 04:16:32 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 42, Request: /login, Empresa ID anterior: 3
2026-01-18 04:16:32 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-18 04:16:32 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-18 04:16:32 [http-nio-8080-exec-9] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to http://vallunas.localhost:8080/login
2026-01-18 04:16:32 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login
2026-01-18 04:16:32 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login
2026-01-18 04:16:32 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-18 04:16:32 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: vallunas.localhost
2026-01-18 04:16:32 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: vallunas
2026-01-18 04:16:32 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:16:32 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [vallunas]
2026-01-18 04:16:32 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 44
2026-01-18 04:16:32 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: vallunas)
2026-01-18 04:16:32 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-18 04:16:32 [http-nio-8080-exec-10] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-18 04:16:32 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 44, Tenant anterior: 3
2026-01-18 04:16:32 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 44, Request: /login, Empresa ID anterior: 3
2026-01-18 04:16:42 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-18 04:16:42 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: admin para la empresa ID: null
2026-01-18 04:16:42 [http-nio-8080-exec-1] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: vallunas
2026-01-18 04:16:42 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:16:42 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [vallunas]
2026-01-18 04:16:42 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: vallunas | Empresa ID: 3 | Empresa Nombre: vallunas
2026-01-18 04:16:42 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:16:42 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:16:42 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:16:42 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:16:42 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:16:42 [http-nio-8080-exec-1] INFO  j.s.s.servicios.UsuarioServicio - üîê Encontrado usuario: admin
2026-01-18 04:16:42 [http-nio-8080-exec-1] INFO  j.s.s.servicios.UsuarioServicio - üîê Rol: ADMIN
2026-01-18 04:16:42 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - üîê Activo: true
2026-01-18 04:16:42 [http-nio-8080-exec-1] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Authenticated user
2026-01-18 04:16:42 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.s.ChangeSessionIdAuthenticationStrategy - Changed session id from D6D1D55106AF32E80222AC70A3EEEE48
2026-01-18 04:16:42 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.CsrfAuthenticationStrategy - Replaced CSRF Token
2026-01-18 04:16:42 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Stored SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D6D1D55106AF32E80222AC70A3EEEE48], Granted Authorities=[ROLE_ADMIN]]] to HttpSession [org.apache.catalina.session.StandardSessionFacade@20cb0621]
2026-01-18 04:16:42 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.UsernamePasswordAuthenticationFilter - Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D6D1D55106AF32E80222AC70A3EEEE48], Granted Authorities=[ROLE_ADMIN]]
2026-01-18 04:16:42 [http-nio-8080-exec-1] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /principal
2026-01-18 04:16:42 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-18 04:16:42 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D6D1D55106AF32E80222AC70A3EEEE48], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:16:42 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-18 04:16:42 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-18 04:16:42 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üåê Server Name: vallunas.localhost
2026-01-18 04:16:42 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: vallunas
2026-01-18 04:16:42 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:16:42 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [vallunas]
2026-01-18 04:16:42 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 36
2026-01-18 04:16:42 [http-nio-8080-exec-2] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: vallunas)
2026-01-18 04:16:42 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-18 04:16:42 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-18 04:16:42 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:16:42 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:16:42 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:16:42 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:16:42 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:16:42 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-18 04:16:42 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 3
2026-01-18 04:16:42 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:16:42 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:16:42 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:16:42 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:16:42 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:16:42 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:16:42 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:16:42 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:16:42 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:16:42 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:16:42 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: false (Empresa ID: 3)
2026-01-18 04:16:42 [http-nio-8080-exec-2] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-16 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-18 04:16:42 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 36, Tenant anterior: 3
2026-01-18 04:16:42 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 36, Request: /principal, Empresa ID anterior: 3
2026-01-18 04:16:42 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:16:42 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D6D1D55106AF32E80222AC70A3EEEE48], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:16:42 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:16:42 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/obligatorio, M√©todo: GET
2026-01-18 04:16:42 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: vallunas.localhost
2026-01-18 04:16:42 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: vallunas
2026-01-18 04:16:42 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:16:42 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [vallunas]
2026-01-18 04:16:42 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 37
2026-01-18 04:16:42 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: vallunas)
2026-01-18 04:16:42 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-18 04:16:42 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-18 04:16:42 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:16:42 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:16:42 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:16:42 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:16:42 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:16:42 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-18 04:16:42 [http-nio-8080-exec-3] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚è∞ GET /cierres/obligatorio - Verificando cierre obligatorio
2026-01-18 04:16:42 [http-nio-8080-exec-3] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Hora actual: 4:00, Fecha: 2026-01-18
2026-01-18 04:16:42 [http-nio-8080-exec-3] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Fecha proporcionada: 2026-01-16
2026-01-18 04:16:42 [http-nio-8080-exec-3] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚ö†Ô∏è Cierre obligatorio requerido para fecha: 2026-01-16
2026-01-18 04:16:42 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 37, Tenant anterior: 3
2026-01-18 04:16:42 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 37, Request: /cierres/obligatorio, Empresa ID anterior: 3
2026-01-18 04:16:42 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-18 04:16:42 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D6D1D55106AF32E80222AC70A3EEEE48], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:16:42 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-18 04:16:42 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-18 04:16:42 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: vallunas.localhost
2026-01-18 04:16:42 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: vallunas
2026-01-18 04:16:42 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:16:42 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [vallunas]
2026-01-18 04:16:42 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 38
2026-01-18 04:16:42 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: vallunas)
2026-01-18 04:16:42 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-18 04:16:42 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-18 04:16:42 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:16:42 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:16:42 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:16:42 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:16:42 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:16:42 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-18 04:16:42 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 3
2026-01-18 04:16:42 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:16:42 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:16:42 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:16:42 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:16:42 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:16:42 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:16:42 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:16:42 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:16:42 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:16:42 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:16:42 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: false (Empresa ID: 3)
2026-01-18 04:16:42 [http-nio-8080-exec-4] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-16 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-18 04:16:42 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 38, Tenant anterior: 3
2026-01-18 04:16:42 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 38, Request: /favicon.ico, Empresa ID anterior: 3
2026-01-18 04:16:42 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:16:42 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D6D1D55106AF32E80222AC70A3EEEE48], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:16:42 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:16:42 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/obligatorio, M√©todo: GET
2026-01-18 04:16:42 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: vallunas.localhost
2026-01-18 04:16:42 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: vallunas
2026-01-18 04:16:42 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:16:42 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [vallunas]
2026-01-18 04:16:42 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 39
2026-01-18 04:16:42 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: vallunas)
2026-01-18 04:16:42 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-18 04:16:42 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-18 04:16:42 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:16:42 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:16:42 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:16:42 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:16:42 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:16:42 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-18 04:16:42 [http-nio-8080-exec-5] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚è∞ GET /cierres/obligatorio - Verificando cierre obligatorio
2026-01-18 04:16:42 [http-nio-8080-exec-5] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Hora actual: 4:00, Fecha: 2026-01-18
2026-01-18 04:16:42 [http-nio-8080-exec-5] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Fecha proporcionada: 2026-01-16
2026-01-18 04:16:42 [http-nio-8080-exec-5] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚ö†Ô∏è Cierre obligatorio requerido para fecha: 2026-01-16
2026-01-18 04:16:42 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 39, Tenant anterior: 3
2026-01-18 04:16:42 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 39, Request: /cierres/obligatorio, Empresa ID anterior: 3
2026-01-18 04:16:46 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres
2026-01-18 04:16:46 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D6D1D55106AF32E80222AC70A3EEEE48], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:16:46 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres
2026-01-18 04:16:46 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres, M√©todo: GET
2026-01-18 04:16:46 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: vallunas.localhost
2026-01-18 04:16:46 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: vallunas
2026-01-18 04:16:46 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:16:46 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [vallunas]
2026-01-18 04:16:46 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 40
2026-01-18 04:16:46 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: vallunas)
2026-01-18 04:16:46 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-18 04:16:46 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-18 04:16:46 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:16:46 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:16:46 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:16:46 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:16:46 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:16:46 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-18 04:16:46 [http-nio-8080-exec-6] INFO  j.s.s.c.CierreInventarioDiarioControlador - üìã GET /cierres - Listando cierres diarios
2026-01-18 04:16:46 [http-nio-8080-exec-6] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo todos los cierres para empresa ID: 3
2026-01-18 04:16:46 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        e1_0.id=?
2026-01-18 04:16:46 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:16:46 [http-nio-8080-exec-6] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 0 cierres para empresa ID: 3
2026-01-18 04:16:46 [http-nio-8080-exec-6] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Encontrados 0 cierres
2026-01-18 04:16:46 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 40, Tenant anterior: 3
2026-01-18 04:16:46 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 40, Request: /cierres, Empresa ID anterior: 3
2026-01-18 04:16:47 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-18 04:16:47 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D6D1D55106AF32E80222AC70A3EEEE48], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:16:47 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-18 04:16:47 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-18 04:16:47 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: vallunas.localhost
2026-01-18 04:16:47 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: vallunas
2026-01-18 04:16:47 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:16:47 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [vallunas]
2026-01-18 04:16:47 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 41
2026-01-18 04:16:47 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: vallunas)
2026-01-18 04:16:47 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-18 04:16:47 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-18 04:16:47 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:16:47 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:16:47 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:16:47 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:16:47 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:16:47 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-18 04:16:47 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 3
2026-01-18 04:16:47 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:16:47 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:16:47 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:16:47 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:16:47 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:16:47 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:16:47 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:16:47 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:16:47 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:16:47 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:16:47 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: false (Empresa ID: 3)
2026-01-18 04:16:47 [http-nio-8080-exec-7] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-16 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-18 04:16:47 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 41, Tenant anterior: 3
2026-01-18 04:16:47 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 41, Request: /favicon.ico, Empresa ID anterior: 3
2026-01-18 04:16:47 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:16:47 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D6D1D55106AF32E80222AC70A3EEEE48], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:16:47 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:16:47 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/obligatorio, M√©todo: GET
2026-01-18 04:16:47 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üåê Server Name: vallunas.localhost
2026-01-18 04:16:47 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: vallunas
2026-01-18 04:16:47 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:16:47 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [vallunas]
2026-01-18 04:16:47 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 42
2026-01-18 04:16:47 [http-nio-8080-exec-8] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: vallunas)
2026-01-18 04:16:47 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-18 04:16:47 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-18 04:16:47 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:16:47 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:16:47 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:16:47 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:16:47 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:16:47 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-18 04:16:47 [http-nio-8080-exec-8] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚è∞ GET /cierres/obligatorio - Verificando cierre obligatorio
2026-01-18 04:16:47 [http-nio-8080-exec-8] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Hora actual: 4:00, Fecha: 2026-01-18
2026-01-18 04:16:47 [http-nio-8080-exec-8] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Fecha proporcionada: 2026-01-16
2026-01-18 04:16:47 [http-nio-8080-exec-8] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚ö†Ô∏è Cierre obligatorio requerido para fecha: 2026-01-16
2026-01-18 04:16:47 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 42, Tenant anterior: 3
2026-01-18 04:16:47 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 42, Request: /cierres/obligatorio, Empresa ID anterior: 3
2026-01-18 04:16:48 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:16:48 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D6D1D55106AF32E80222AC70A3EEEE48], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:16:48 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:16:48 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/obligatorio, M√©todo: GET
2026-01-18 04:16:48 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: vallunas.localhost
2026-01-18 04:16:48 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: vallunas
2026-01-18 04:16:48 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:16:48 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [vallunas]
2026-01-18 04:16:48 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 43
2026-01-18 04:16:48 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: vallunas)
2026-01-18 04:16:48 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-18 04:16:48 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-18 04:16:48 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:16:48 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:16:48 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:16:48 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:16:48 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:16:48 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-18 04:16:48 [http-nio-8080-exec-9] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚è∞ GET /cierres/obligatorio - Verificando cierre obligatorio
2026-01-18 04:16:48 [http-nio-8080-exec-9] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Hora actual: 4:00, Fecha: 2026-01-18
2026-01-18 04:16:48 [http-nio-8080-exec-9] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Fecha proporcionada: 2026-01-16
2026-01-18 04:16:48 [http-nio-8080-exec-9] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚ö†Ô∏è Cierre obligatorio requerido para fecha: 2026-01-16
2026-01-18 04:16:48 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 43, Tenant anterior: 3
2026-01-18 04:16:48 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /cierres/obligatorio, Empresa ID anterior: 3
2026-01-18 04:16:48 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-18 04:16:48 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D6D1D55106AF32E80222AC70A3EEEE48], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:16:48 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-18 04:16:48 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-18 04:16:48 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: vallunas.localhost
2026-01-18 04:16:48 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: vallunas
2026-01-18 04:16:48 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:16:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [vallunas]
2026-01-18 04:16:48 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 44
2026-01-18 04:16:48 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: vallunas)
2026-01-18 04:16:48 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-18 04:16:48 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-18 04:16:48 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:16:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:16:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:16:48 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:16:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:16:48 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-18 04:16:48 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 3
2026-01-18 04:16:48 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:16:48 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:16:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:16:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:16:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:16:48 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:16:48 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:16:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:16:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:16:48 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:16:48 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: false (Empresa ID: 3)
2026-01-18 04:16:48 [http-nio-8080-exec-10] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-16 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-18 04:16:48 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 44, Tenant anterior: 3
2026-01-18 04:16:48 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 44, Request: /favicon.ico, Empresa ID anterior: 3
2026-01-18 04:16:48 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:16:48 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D6D1D55106AF32E80222AC70A3EEEE48], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:16:48 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:16:48 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/obligatorio, M√©todo: GET
2026-01-18 04:16:48 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üåê Server Name: vallunas.localhost
2026-01-18 04:16:48 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: vallunas
2026-01-18 04:16:48 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:16:48 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [vallunas]
2026-01-18 04:16:48 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 35
2026-01-18 04:16:48 [http-nio-8080-exec-1] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: vallunas)
2026-01-18 04:16:48 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-18 04:16:48 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-18 04:16:48 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:16:48 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:16:48 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:16:48 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:16:48 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:16:48 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-18 04:16:48 [http-nio-8080-exec-1] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚è∞ GET /cierres/obligatorio - Verificando cierre obligatorio
2026-01-18 04:16:48 [http-nio-8080-exec-1] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Hora actual: 4:00, Fecha: 2026-01-18
2026-01-18 04:16:48 [http-nio-8080-exec-1] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Fecha proporcionada: 2026-01-16
2026-01-18 04:16:48 [http-nio-8080-exec-1] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚ö†Ô∏è Cierre obligatorio requerido para fecha: 2026-01-16
2026-01-18 04:16:48 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 35, Tenant anterior: 3
2026-01-18 04:16:48 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 35, Request: /cierres/obligatorio, Empresa ID anterior: 3
2026-01-18 04:26:55 [SpringApplicationShutdownHook] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2026-01-18 04:26:55 [tomcat-shutdown] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2026-01-18 04:26:55 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2026-01-18 04:26:55 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2026-01-18 04:26:55 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2026-01-18 04:27:02 [main] INFO  j.s.s.SistemadefacturacioneinventarioApplication - Starting SistemadefacturacioneinventarioApplication using Java 17.0.17 with PID 18090 (/home/josepino/Desktop/SistemaFacturaEInventario/sistemadefacturacioneinventario/target/classes started by josepino in /home/josepino/Desktop/SistemaFacturaEInventario/sistemadefacturacioneinventario)
2026-01-18 04:27:02 [main] DEBUG j.s.s.SistemadefacturacioneinventarioApplication - Running with Spring Boot v3.5.8, Spring v6.2.14
2026-01-18 04:27:02 [main] INFO  j.s.s.SistemadefacturacioneinventarioApplication - No active profile set, falling back to 1 default profile: "default"
2026-01-18 04:27:03 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-18 04:27:03 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 62 ms. Found 14 JPA repository interfaces.
2026-01-18 04:27:04 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2026-01-18 04:27:04 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2026-01-18 04:27:04 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.49]
2026-01-18 04:27:04 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2026-01-18 04:27:04 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1046 ms
2026-01-18 04:27:04 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-18 04:27:04 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.6.36.Final
2026-01-18 04:27:04 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2026-01-18 04:27:04 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-18 04:27:04 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2026-01-18 04:27:04 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@77cc6a28
2026-01-18 04:27:04 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2026-01-18 04:27:04 [main] INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 8.0.44
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2026-01-18 04:27:05 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-18 04:27:05 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-18 04:27:05 [main] DEBUG o.h.s.internal.StatisticsInitiator - Statistics initialized [enabled=false]
2026-01-18 04:27:05 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2026-01-18 04:27:06 [main] INFO  j.s.s.config.SpringSecurityConfig - üîê Configurando BCryptPasswordEncoder para encriptaci√≥n de contrase√±as
2026-01-18 04:27:06 [main] INFO  j.s.s.config.WebConfig - ‚öôÔ∏è Configurando interceptores de Spring MVC
2026-01-18 04:27:06 [main] DEBUG j.s.s.config.WebConfig - Registrando CierreDiarioInterceptor
2026-01-18 04:27:06 [main] DEBUG j.s.s.config.WebConfig - CierreDiarioInterceptor configurado. Patrones incluidos: /**
2026-01-18 04:27:06 [main] DEBUG j.s.s.config.WebConfig - Patrones excluidos: /cierres/**, /login, /css/**, /js/**, /error
2026-01-18 04:27:07 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name usuarioServicio
2026-01-18 04:27:07 [main] INFO  j.s.s.config.SpringSecurityConfig - üõ°Ô∏è Configurando SecurityFilterChain para SUPERADMIN (Orden 1)
2026-01-18 04:27:07 [main] INFO  j.s.s.config.SpringSecurityConfig - ‚úÖ SecurityFilterChain SUPERADMIN configurado
2026-01-18 04:27:07 [main] DEBUG o.s.s.web.DefaultSecurityFilterChain - Will secure Or [Mvc [pattern='/superadmin/**']] with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CsrfFilter, LogoutFilter, UsernamePasswordAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-18 04:27:07 [main] INFO  j.s.s.config.SpringSecurityConfig - üõ°Ô∏è Configurando SecurityFilterChain - Iniciando configuraci√≥n de seguridad
2026-01-18 04:27:07 [main] INFO  j.s.s.config.SpringSecurityConfig - ‚úÖ SecurityFilterChain configurado exitosamente
2026-01-18 04:27:07 [main] DEBUG j.s.s.config.SpringSecurityConfig - Configuraci√≥n de seguridad aplicada:
2026-01-18 04:27:07 [main] DEBUG j.s.s.config.SpringSecurityConfig - - P√°ginas p√∫blicas: /, /login, /acceso-denegado, /css/**, /js/**, /error
2026-01-18 04:27:07 [main] DEBUG j.s.s.config.SpringSecurityConfig - - Solo ADMIN: /compras/**, /proveedores/**
2026-01-18 04:27:07 [main] DEBUG j.s.s.config.SpringSecurityConfig - - ADMIN o DEV: /productos/**, /ingredientes/**, /recetas/**, /reportes/**, /cierres/**
2026-01-18 04:27:07 [main] DEBUG j.s.s.config.SpringSecurityConfig - - Login: /login, Logout: /logout
2026-01-18 04:27:07 [main] DEBUG j.s.s.config.SpringSecurityConfig - - P√°gina acceso denegado: /acceso-denegado
2026-01-18 04:27:07 [main] DEBUG o.s.s.web.DefaultSecurityFilterChain - Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CsrfFilter, LogoutFilter, UsernamePasswordAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-18 04:27:07 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2026-01-18 04:27:07 [main] INFO  j.s.s.SistemadefacturacioneinventarioApplication - Started SistemadefacturacioneinventarioApplication in 4.882 seconds (process running for 5.163)
2026-01-18 04:27:07 [main] INFO  j.s.s.config.DataInitializer - üöÄ INICIANDO CARGA DE DATOS INICIALES DEL SISTEMA
2026-01-18 04:27:07 [main] DEBUG org.hibernate.SQL - 
    select
        count(*) 
    from
        empresa e1_0
2026-01-18 04:27:07 [main] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0
2026-01-18 04:27:07 [main] INFO  j.s.s.config.DataInitializer - ‚úÖ Empresa existente encontrada: Sistema por Defecto (ID: 1)
2026-01-18 04:27:07 [main] DEBUG org.hibernate.SQL - 
    select
        c1_0.id 
    from
        cliente c1_0 
    left join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    where
        c1_0.nombre=? 
        and e1_0.id=? 
    limit
        ?
2026-01-18 04:27:07 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Consumidor Final]
2026-01-18 04:27:07 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-18 04:27:07 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:INTEGER) <- [1]
2026-01-18 04:27:07 [main] INFO  j.s.s.config.DataInitializer - ‚úÖ Cliente 'Consumidor Final' ya existe para empresa Sistema por Defecto
2026-01-18 04:27:07 [main] DEBUG org.hibernate.SQL - 
    select
        count(u1_0.id) 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-18 04:27:07 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-18 04:27:07 [main] INFO  j.s.s.config.DataInitializer - ‚úÖ Ya existen 3 usuarios para empresa Sistema por Defecto. No se crean nuevos.
2026-01-18 04:27:07 [main] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.fecha=? 
        and e1_0.id=? 
    limit
        ?
2026-01-18 04:27:07 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-17]
2026-01-18 04:27:07 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-18 04:27:07 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:INTEGER) <- [1]
2026-01-18 04:27:07 [main] INFO  j.s.s.config.DataInitializer - ‚úÖ Ya existe cierre diario para hoy (2026-01-17) - Empresa: Sistema por Defecto
2026-01-18 04:27:07 [main] INFO  j.s.s.config.DataInitializer - üëë Verificando existencia de usuario SUPER_ADMIN
2026-01-18 04:27:07 [main] DEBUG org.hibernate.SQL - 
    select
        u1_0.id 
    from
        usuario u1_0 
    where
        u1_0.rol=? 
    limit
        ?
2026-01-18 04:27:07 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [SUPER_ADMIN]
2026-01-18 04:27:07 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [1]
2026-01-18 04:27:07 [main] INFO  j.s.s.config.DataInitializer - ‚úÖ Usuario SUPER_ADMIN ya existe en el sistema
2026-01-18 04:27:07 [main] INFO  j.s.s.config.DataInitializer - ‚úÖ CARGA DE DATOS INICIALES COMPLETADA EXITOSAMENTE
2026-01-18 04:27:07 [main] INFO  j.s.s.config.UsuarioInicial - üîß Iniciando carga de usuarios iniciales
2026-01-18 04:27:07 [main] DEBUG org.hibernate.SQL - 
    select
        count(*) 
    from
        empresa e1_0
2026-01-18 04:27:07 [main] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0
2026-01-18 04:27:07 [main] DEBUG org.hibernate.SQL - 
    select
        count(u1_0.id) 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-18 04:27:07 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-18 04:27:07 [main] DEBUG j.s.s.config.UsuarioInicial - Usuarios existentes en BD para empresa Sistema por Defecto: 3
2026-01-18 04:27:07 [main] INFO  j.s.s.config.UsuarioInicial - ‚úÖ Ya existen usuarios para empresa Sistema por Defecto. No se crean nuevos.
2026-01-18 04:27:20 [SpringApplicationShutdownHook] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2026-01-18 04:27:20 [tomcat-shutdown] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2026-01-18 04:27:20 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2026-01-18 04:27:20 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2026-01-18 04:27:20 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2026-01-18 04:27:23 [main] INFO  j.s.s.SistemadefacturacioneinventarioApplication - Starting SistemadefacturacioneinventarioApplication using Java 17.0.17 with PID 18336 (/home/josepino/Desktop/SistemaFacturaEInventario/sistemadefacturacioneinventario/target/classes started by josepino in /home/josepino/Desktop/SistemaFacturaEInventario/sistemadefacturacioneinventario)
2026-01-18 04:27:23 [main] DEBUG j.s.s.SistemadefacturacioneinventarioApplication - Running with Spring Boot v3.5.8, Spring v6.2.14
2026-01-18 04:27:23 [main] INFO  j.s.s.SistemadefacturacioneinventarioApplication - No active profile set, falling back to 1 default profile: "default"
2026-01-18 04:27:23 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-18 04:27:23 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 70 ms. Found 14 JPA repository interfaces.
2026-01-18 04:27:24 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2026-01-18 04:27:24 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2026-01-18 04:27:24 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.49]
2026-01-18 04:27:24 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2026-01-18 04:27:24 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1114 ms
2026-01-18 04:27:24 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-18 04:27:24 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.6.36.Final
2026-01-18 04:27:24 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2026-01-18 04:27:24 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-18 04:27:24 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2026-01-18 04:27:25 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2
2026-01-18 04:27:25 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2026-01-18 04:27:25 [main] INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 8.0.44
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2026-01-18 04:27:25 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-18 04:27:25 [main] DEBUG org.hibernate.SQL - 
    create table cierre_inventario_diario (
        id bigint not null auto_increment,
        cantidad_facturas integer not null,
        estado varchar(255),
        fecha date,
        observaciones varchar(255),
        total_ventas float(53) not null,
        empresa_id bigint not null,
        usuario_id bigint not null,
        primary key (id)
    ) engine=InnoDB
2026-01-18 04:27:25 [main] DEBUG org.hibernate.SQL - 
    create table cliente (
        id bigint not null auto_increment,
        activo bit not null,
        correo varchar(255),
        identificacion varchar(255),
        nombre varchar(255) not null,
        telefono varchar(255),
        empresa_id bigint not null,
        primary key (id)
    ) engine=InnoDB
2026-01-18 04:27:25 [main] DEBUG org.hibernate.SQL - 
    create table detalle_cierre_inventario_diario (
        id bigint not null auto_increment,
        costo_unitario float(53) not null,
        diferencia float(53) not null,
        stock_desperdicio float(53) not null,
        stock_merma float(53) not null,
        stock_real float(53) not null,
        stock_teorico float(53) not null,
        valor_diferencia float(53) not null,
        cierre_id bigint not null,
        ingrediente_id bigint,
        producto_id bigint,
        primary key (id)
    ) engine=InnoDB
2026-01-18 04:27:25 [main] DEBUG org.hibernate.SQL - 
    create table empresa (
        id bigint not null auto_increment,
        email_contacto varchar(255),
        estado bit not null,
        fecha_creacion date,
        nombre varchar(255),
        plan varchar(255),
        subdominio varchar(255),
        telefono varchar(255),
        primary key (id)
    ) engine=InnoDB
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    create table factura (
        id integer not null auto_increment,
        estado varchar(255),
        fecha date,
        forma_pago varchar(255),
        iva float(53) not null,
        numero_factura varchar(255),
        subtotal float(53) not null,
        total float(53) not null,
        cliente_id bigint,
        empresa_id bigint not null,
        primary key (id)
    ) engine=InnoDB
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    create table factura_detalle (
        id bigint not null auto_increment,
        cantidad integer not null,
        precio_unitario float(53) not null,
        subtotal float(53) not null,
        factura_id integer not null,
        producto_id bigint not null,
        primary key (id)
    ) engine=InnoDB
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    create table factura_detalle_proveedor (
        id bigint not null auto_increment,
        cantidad float(53) not null,
        precio_unitario float(53) not null,
        subtotal float(53) not null,
        factura_proveedor_id bigint not null,
        ingrediente_id bigint not null,
        primary key (id)
    ) engine=InnoDB
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    create table factura_proveedor (
        id bigint not null auto_increment,
        estado varchar(255),
        fecha date,
        iva float(53),
        numero_factura varchar(255),
        subtotal float(53),
        total float(53),
        empresa_id bigint not null,
        proveedor_id bigint not null,
        primary key (id)
    ) engine=InnoDB
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    create table ingrediente (
        id bigint not null auto_increment,
        activo bit not null,
        nombre varchar(255),
        precio float(53) not null,
        stock_actual float(53) not null,
        stock_minimo float(53) not null,
        unidad_medida varchar(255),
        empresa_id bigint not null,
        primary key (id)
    ) engine=InnoDB
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    create table producto (
        id bigint not null auto_increment,
        activo bit not null,
        nombre varchar(255),
        precio_compra float(53),
        precio_venta float(53),
        stock float(53),
        tiene_receta bit not null,
        unidad_medida_venta varchar(255),
        empresa_id bigint not null,
        receta_id bigint,
        primary key (id)
    ) engine=InnoDB
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    create table proveedor (
        id bigint not null auto_increment,
        activo bit,
        correo varchar(255),
        identificacion varchar(255),
        nombre varchar(255),
        telefono varchar(255),
        empresa_id bigint not null,
        primary key (id)
    ) engine=InnoDB
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    create table receta (
        id bigint not null auto_increment,
        costo_receta float(53) not null,
        descripcion varchar(255),
        nombre varchar(255),
        empresa_id bigint not null,
        primary key (id)
    ) engine=InnoDB
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    create table receta_detalle (
        id integer not null auto_increment,
        cantidad_ingrediente float(53) not null,
        ingrediente_id bigint not null,
        receta_id bigint not null,
        primary key (id)
    ) engine=InnoDB
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    create table sucursal (
        id bigint not null auto_increment,
        direccion varchar(255),
        email varchar(255),
        nombre varchar(255),
        telefono varchar(255),
        empresa_id bigint not null,
        primary key (id)
    ) engine=InnoDB
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    create table usuario (
        id bigint not null auto_increment,
        activo bit not null,
        contrasenna varchar(255) not null,
        nombre_usuario varchar(255),
        rol varchar(255) not null,
        empresa_id bigint,
        sucursal_id bigint,
        primary key (id)
    ) engine=InnoDB
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table cierre_inventario_diario 
       drop index UK3olt7fv3qt8efj1m5p7q3j1ms
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table cierre_inventario_diario 
       add constraint UK3olt7fv3qt8efj1m5p7q3j1ms unique (empresa_id, fecha)
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table cliente 
       drop index UKhadme0meght491lixmp6qg06b
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table cliente 
       add constraint UKhadme0meght491lixmp6qg06b unique (empresa_id, nombre)
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table detalle_cierre_inventario_diario 
       drop index UKk16g51km9nr5iqw2wxck8b358
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table detalle_cierre_inventario_diario 
       add constraint UKk16g51km9nr5iqw2wxck8b358 unique (cierre_id, producto_id)
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table detalle_cierre_inventario_diario 
       drop index UKca6rduw6wqlirrbdd5tvj3u2c
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table detalle_cierre_inventario_diario 
       add constraint UKca6rduw6wqlirrbdd5tvj3u2c unique (cierre_id, ingrediente_id)
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table empresa 
       drop index UK89dtla0x9lfndxn4iha8gm2al
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table empresa 
       add constraint UK89dtla0x9lfndxn4iha8gm2al unique (subdominio)
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table factura 
       drop index UKa9fu6ob19w8pdw35ilspmgje
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table factura 
       add constraint UKa9fu6ob19w8pdw35ilspmgje unique (empresa_id, numero_factura)
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table factura_detalle 
       drop index UKejw1olg5d69vmcvvmwqglbewj
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table factura_detalle 
       add constraint UKejw1olg5d69vmcvvmwqglbewj unique (factura_id, producto_id)
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table factura_detalle_proveedor 
       drop index UK646r3o8f5xbf9ikhql9qcr81i
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table factura_detalle_proveedor 
       add constraint UK646r3o8f5xbf9ikhql9qcr81i unique (factura_proveedor_id, ingrediente_id)
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table factura_proveedor 
       drop index UK23y7stifd8wv2cixfjhc0g9kq
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table factura_proveedor 
       add constraint UK23y7stifd8wv2cixfjhc0g9kq unique (empresa_id, numero_factura)
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table ingrediente 
       drop index UKjs70l2p4uno2dclt73ffva7c9
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table ingrediente 
       add constraint UKjs70l2p4uno2dclt73ffva7c9 unique (empresa_id, nombre)
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table producto 
       drop index UKbeimg5dnx60dx87os8deoet9l
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table producto 
       add constraint UKbeimg5dnx60dx87os8deoet9l unique (empresa_id, nombre)
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table proveedor 
       drop index UKe0crun39p1g01db6lw29cqgmg
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table proveedor 
       add constraint UKe0crun39p1g01db6lw29cqgmg unique (empresa_id, nombre)
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table proveedor 
       drop index UKq9ef37e05x58intf9g660ubhs
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table proveedor 
       add constraint UKq9ef37e05x58intf9g660ubhs unique (empresa_id, identificacion)
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table proveedor 
       drop index UK5iq7yn62p2yff2ibnyebm81yk
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table proveedor 
       add constraint UK5iq7yn62p2yff2ibnyebm81yk unique (empresa_id, correo)
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table receta 
       drop index UK143eh9phim5gxih4uhnxf5rjy
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table receta 
       add constraint UK143eh9phim5gxih4uhnxf5rjy unique (empresa_id, nombre)
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table receta_detalle 
       drop index UK5i7rpjy4jshlcxwopit7e7l6v
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table receta_detalle 
       add constraint UK5i7rpjy4jshlcxwopit7e7l6v unique (receta_id, ingrediente_id)
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table sucursal 
       drop index UKifuc748bnikr6k2anqbkfcjof
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table sucursal 
       add constraint UKifuc748bnikr6k2anqbkfcjof unique (empresa_id, nombre)
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table usuario 
       drop index UKl3t4o0bbvqig8iki4a9v5l2au
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table usuario 
       add constraint UKl3t4o0bbvqig8iki4a9v5l2au unique (empresa_id, nombre_usuario)
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table cierre_inventario_diario 
       add constraint FKrxj5xe6of8lbbaygm6wn1yglc 
       foreign key (empresa_id) 
       references empresa (id)
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table cierre_inventario_diario 
       add constraint FK7ydwat6wxaari9ti21t61pf2h 
       foreign key (usuario_id) 
       references usuario (id)
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table cliente 
       add constraint FKkbui05oidjdj4nb0283u4t319 
       foreign key (empresa_id) 
       references empresa (id)
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table detalle_cierre_inventario_diario 
       add constraint FKai0hytaggprm1fpr57qs1r16y 
       foreign key (cierre_id) 
       references cierre_inventario_diario (id)
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table detalle_cierre_inventario_diario 
       add constraint FKnhr66xfhrrt2lf9hcr6osvkwi 
       foreign key (ingrediente_id) 
       references ingrediente (id)
2026-01-18 04:27:26 [main] DEBUG org.hibernate.SQL - 
    alter table detalle_cierre_inventario_diario 
       add constraint FKo04686jk3h9e8lercg1o2p4qx 
       foreign key (producto_id) 
       references producto (id)
2026-01-18 04:27:27 [main] DEBUG org.hibernate.SQL - 
    alter table factura 
       add constraint FK2602efsrpmevi8yxg464stfn5 
       foreign key (cliente_id) 
       references cliente (id)
2026-01-18 04:27:27 [main] DEBUG org.hibernate.SQL - 
    alter table factura 
       add constraint FKtmilsq58fksgb0ubkele0rhec 
       foreign key (empresa_id) 
       references empresa (id)
2026-01-18 04:27:27 [main] DEBUG org.hibernate.SQL - 
    alter table factura_detalle 
       add constraint FK82g5tpb19dn0ed3dh8rjepfeo 
       foreign key (factura_id) 
       references factura (id)
2026-01-18 04:27:27 [main] DEBUG org.hibernate.SQL - 
    alter table factura_detalle 
       add constraint FK49cxxxb69hbp79ot7q72d1amt 
       foreign key (producto_id) 
       references producto (id)
2026-01-18 04:27:27 [main] DEBUG org.hibernate.SQL - 
    alter table factura_detalle_proveedor 
       add constraint FKoflc51frkgklo8alhid2j8al7 
       foreign key (factura_proveedor_id) 
       references factura_proveedor (id)
2026-01-18 04:27:27 [main] DEBUG org.hibernate.SQL - 
    alter table factura_detalle_proveedor 
       add constraint FK3hoqatnjgbbmx6xrh35yqppuf 
       foreign key (ingrediente_id) 
       references ingrediente (id)
2026-01-18 04:27:27 [main] DEBUG org.hibernate.SQL - 
    alter table factura_proveedor 
       add constraint FKhlrb8uke31inikggh6lkw2dkd 
       foreign key (empresa_id) 
       references empresa (id)
2026-01-18 04:27:27 [main] DEBUG org.hibernate.SQL - 
    alter table factura_proveedor 
       add constraint FK7f8no9r5msrqi7tdpxtxv5rox 
       foreign key (proveedor_id) 
       references proveedor (id)
2026-01-18 04:27:27 [main] DEBUG org.hibernate.SQL - 
    alter table ingrediente 
       add constraint FK12fcsy4t6kmmc1kqwdvf6qoyb 
       foreign key (empresa_id) 
       references empresa (id)
2026-01-18 04:27:27 [main] DEBUG org.hibernate.SQL - 
    alter table producto 
       add constraint FKc2ad8rakag2tc01ww39eqrbv6 
       foreign key (empresa_id) 
       references empresa (id)
2026-01-18 04:27:27 [main] DEBUG org.hibernate.SQL - 
    alter table producto 
       add constraint FKoug9w3p6qwyhi5ogt6806xkaj 
       foreign key (receta_id) 
       references receta (id)
2026-01-18 04:27:27 [main] DEBUG org.hibernate.SQL - 
    alter table proveedor 
       add constraint FK8cnkydwgpaydac6bnsv9t3fre 
       foreign key (empresa_id) 
       references empresa (id)
2026-01-18 04:27:27 [main] DEBUG org.hibernate.SQL - 
    alter table receta 
       add constraint FKdgije9w7wnv4qr14tddx3d1mb 
       foreign key (empresa_id) 
       references empresa (id)
2026-01-18 04:27:27 [main] DEBUG org.hibernate.SQL - 
    alter table receta_detalle 
       add constraint FKqqxfeku8edppnlksgq3yyetfg 
       foreign key (ingrediente_id) 
       references ingrediente (id)
2026-01-18 04:27:27 [main] DEBUG org.hibernate.SQL - 
    alter table receta_detalle 
       add constraint FK3ymmbjgelr0kjbhi7880bmmk3 
       foreign key (receta_id) 
       references receta (id)
2026-01-18 04:27:27 [main] DEBUG org.hibernate.SQL - 
    alter table sucursal 
       add constraint FK3w56rbjykxbp2e79cdq0xsghd 
       foreign key (empresa_id) 
       references empresa (id)
2026-01-18 04:27:28 [main] DEBUG org.hibernate.SQL - 
    alter table usuario 
       add constraint FK87ckfs30l64gnivnfk7ywp8l6 
       foreign key (empresa_id) 
       references empresa (id)
2026-01-18 04:27:28 [main] DEBUG org.hibernate.SQL - 
    alter table usuario 
       add constraint FKiaauynefn97k8nl88ss4snyl6 
       foreign key (sucursal_id) 
       references sucursal (id)
2026-01-18 04:27:28 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-18 04:27:28 [main] DEBUG o.h.s.internal.StatisticsInitiator - Statistics initialized [enabled=false]
2026-01-18 04:27:28 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2026-01-18 04:27:28 [main] INFO  j.s.s.config.SpringSecurityConfig - üîê Configurando BCryptPasswordEncoder para encriptaci√≥n de contrase√±as
2026-01-18 04:27:29 [main] INFO  j.s.s.config.WebConfig - ‚öôÔ∏è Configurando interceptores de Spring MVC
2026-01-18 04:27:29 [main] DEBUG j.s.s.config.WebConfig - Registrando CierreDiarioInterceptor
2026-01-18 04:27:29 [main] DEBUG j.s.s.config.WebConfig - CierreDiarioInterceptor configurado. Patrones incluidos: /**
2026-01-18 04:27:29 [main] DEBUG j.s.s.config.WebConfig - Patrones excluidos: /cierres/**, /login, /css/**, /js/**, /error
2026-01-18 04:27:29 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name usuarioServicio
2026-01-18 04:27:29 [main] INFO  j.s.s.config.SpringSecurityConfig - üõ°Ô∏è Configurando SecurityFilterChain para SUPERADMIN (Orden 1)
2026-01-18 04:27:29 [main] INFO  j.s.s.config.SpringSecurityConfig - ‚úÖ SecurityFilterChain SUPERADMIN configurado
2026-01-18 04:27:29 [main] DEBUG o.s.s.web.DefaultSecurityFilterChain - Will secure Or [Mvc [pattern='/superadmin/**']] with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CsrfFilter, LogoutFilter, UsernamePasswordAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-18 04:27:29 [main] INFO  j.s.s.config.SpringSecurityConfig - üõ°Ô∏è Configurando SecurityFilterChain - Iniciando configuraci√≥n de seguridad
2026-01-18 04:27:29 [main] INFO  j.s.s.config.SpringSecurityConfig - ‚úÖ SecurityFilterChain configurado exitosamente
2026-01-18 04:27:29 [main] DEBUG j.s.s.config.SpringSecurityConfig - Configuraci√≥n de seguridad aplicada:
2026-01-18 04:27:29 [main] DEBUG j.s.s.config.SpringSecurityConfig - - P√°ginas p√∫blicas: /, /login, /acceso-denegado, /css/**, /js/**, /error
2026-01-18 04:27:29 [main] DEBUG j.s.s.config.SpringSecurityConfig - - Solo ADMIN: /compras/**, /proveedores/**
2026-01-18 04:27:29 [main] DEBUG j.s.s.config.SpringSecurityConfig - - ADMIN o DEV: /productos/**, /ingredientes/**, /recetas/**, /reportes/**, /cierres/**
2026-01-18 04:27:29 [main] DEBUG j.s.s.config.SpringSecurityConfig - - Login: /login, Logout: /logout
2026-01-18 04:27:29 [main] DEBUG j.s.s.config.SpringSecurityConfig - - P√°gina acceso denegado: /acceso-denegado
2026-01-18 04:27:29 [main] DEBUG o.s.s.web.DefaultSecurityFilterChain - Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CsrfFilter, LogoutFilter, UsernamePasswordAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-18 04:27:30 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2026-01-18 04:27:30 [main] INFO  j.s.s.SistemadefacturacioneinventarioApplication - Started SistemadefacturacioneinventarioApplication in 7.257 seconds (process running for 7.552)
2026-01-18 04:27:30 [main] INFO  j.s.s.config.UsuarioInicial - üîß Iniciando carga de usuarios iniciales
2026-01-18 04:27:30 [main] DEBUG org.hibernate.SQL - 
    select
        count(*) 
    from
        empresa e1_0
2026-01-18 04:27:30 [main] WARN  j.s.s.config.UsuarioInicial - ‚ö†Ô∏è No hay empresas en la BD. Los usuarios se crear√°n sin empresa.
2026-01-18 04:27:30 [main] WARN  j.s.s.config.UsuarioInicial - ‚ö†Ô∏è Ejecuta primero el DataInitializer para crear empresa por defecto.
2026-01-18 04:27:30 [main] INFO  j.s.s.config.DataInitializer - üöÄ INICIANDO CARGA DE DATOS INICIALES DEL SISTEMA
2026-01-18 04:27:30 [main] DEBUG org.hibernate.SQL - 
    select
        count(*) 
    from
        empresa e1_0
2026-01-18 04:27:30 [main] INFO  j.s.s.config.DataInitializer - üìÅ No se encontraron empresas. Creando empresa por defecto...
2026-01-18 04:27:30 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        empresa
        (email_contacto, estado, fecha_creacion, nombre, plan, subdominio, telefono) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [null]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BOOLEAN) <- [true]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:DATE) <- [null]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [Sistema por Defecto]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [defecto]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [null]
2026-01-18 04:27:30 [main] INFO  j.s.s.config.DataInitializer - üè¢ Empresa por defecto creada exitosamente:
2026-01-18 04:27:30 [main] INFO  j.s.s.config.DataInitializer -    üìõ Nombre: Sistema por Defecto
2026-01-18 04:27:30 [main] INFO  j.s.s.config.DataInitializer -    üåê Subdominio: defecto
2026-01-18 04:27:30 [main] INFO  j.s.s.config.DataInitializer -    üî¢ ID: 1
2026-01-18 04:27:30 [main] INFO  j.s.s.config.DataInitializer -    üîó Acceso: http://defecto.localhost:8080
2026-01-18 04:27:30 [main] DEBUG org.hibernate.SQL - 
    select
        c1_0.id 
    from
        cliente c1_0 
    left join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    where
        c1_0.nombre=? 
        and e1_0.id=? 
    limit
        ?
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Consumidor Final]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:INTEGER) <- [1]
2026-01-18 04:27:30 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        cliente
        (activo, correo, empresa_id, identificacion, nombre, telefono) 
    values
        (?, ?, ?, ?, ?, ?)
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [consumidor@final.com]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [CF9999999999999]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [Consumidor Final]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [N/A]
2026-01-18 04:27:30 [main] INFO  j.s.s.config.DataInitializer - üë§ Cliente por defecto creado:
2026-01-18 04:27:30 [main] INFO  j.s.s.config.DataInitializer -    üìõ Nombre: Consumidor Final
2026-01-18 04:27:30 [main] INFO  j.s.s.config.DataInitializer -    üî¢ ID: CF9999999999999
2026-01-18 04:27:30 [main] INFO  j.s.s.config.DataInitializer -    üè¢ Para empresa: Sistema por Defecto
2026-01-18 04:27:30 [main] DEBUG org.hibernate.SQL - 
    select
        count(u1_0.id) 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-18 04:27:30 [main] INFO  j.s.s.config.DataInitializer - üë• No hay usuarios para empresa Sistema por Defecto. Creando usuarios por defecto...
2026-01-18 04:27:30 [main] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 1
2026-01-18 04:27:30 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        usuario
        (activo, contrasenna, empresa_id, nombre_usuario, rol, sucursal_id) 
    values
        (?, ?, ?, ?, ?, ?)
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [$2a$10$4FeeBaAuXRpUaWZyqZXBc.eEpTrP3NZD5QpD7kkc6w9BQ.bY48Mq6]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [admin]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [ADMIN]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:BIGINT) <- [null]
2026-01-18 04:27:30 [main] INFO  j.s.s.config.DataInitializer -    üë§ ADMIN: admin/admin123
2026-01-18 04:27:30 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        usuario
        (activo, contrasenna, empresa_id, nombre_usuario, rol, sucursal_id) 
    values
        (?, ?, ?, ?, ?, ?)
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [$2a$10$RxJ.3WTtYKQtiNIVf8gCv.a0XOvYlmdsgvbUIzEtXIOlkEzA0801a]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [cajero]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [CAJERO]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:BIGINT) <- [null]
2026-01-18 04:27:30 [main] INFO  j.s.s.config.DataInitializer -    üë§ CAJERO: cajero/cajero123
2026-01-18 04:27:30 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        usuario
        (activo, contrasenna, empresa_id, nombre_usuario, rol, sucursal_id) 
    values
        (?, ?, ?, ?, ?, ?)
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [$2a$10$dIanQiviyL4JWuAzmNoTgeLy/kf8DhQ9z08BSGv/iycqevogqRvPq]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [dev]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [DEV]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:BIGINT) <- [null]
2026-01-18 04:27:30 [main] INFO  j.s.s.config.DataInitializer -    üë§ DEV: dev/dev123
2026-01-18 04:27:30 [main] INFO  j.s.s.config.DataInitializer - ‚úÖ Usuarios creados exitosamente para empresa Sistema por Defecto
2026-01-18 04:27:30 [main] WARN  j.s.s.config.DataInitializer - ‚ö†Ô∏è  ¬°IMPORTANTE! Cambia estas contrase√±as en producci√≥n.
2026-01-18 04:27:30 [main] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 1, Tenant anterior: 1
2026-01-18 04:27:30 [main] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.fecha=? 
        and e1_0.id=? 
    limit
        ?
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-17]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:INTEGER) <- [1]
2026-01-18 04:27:30 [main] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        u1_0.nombre_usuario=? 
        and e1_0.id=?
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-18 04:27:30 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        cierre_inventario_diario
        (cantidad_facturas, empresa_id, estado, fecha, observaciones, total_ventas, usuario_id) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:INTEGER) <- [0]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [COMPLETADO]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DATE) <- [2026-01-17]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [Cierre inicial generado autom√°ticamente]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DOUBLE) <- [0.0]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:BIGINT) <- [1]
2026-01-18 04:27:30 [main] INFO  j.s.s.config.DataInitializer - üìÖ Cierre diario inicial creado para fecha 2026-01-17 - Empresa: Sistema por Defecto
2026-01-18 04:27:30 [main] INFO  j.s.s.config.DataInitializer - üëë Verificando existencia de usuario SUPER_ADMIN
2026-01-18 04:27:30 [main] DEBUG org.hibernate.SQL - 
    select
        u1_0.id 
    from
        usuario u1_0 
    where
        u1_0.rol=? 
    limit
        ?
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [SUPER_ADMIN]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [1]
2026-01-18 04:27:30 [main] INFO  j.s.s.config.DataInitializer - üëë No existe SUPER_ADMIN. Creando usuario maestro...
2026-01-18 04:27:30 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        usuario
        (activo, contrasenna, empresa_id, nombre_usuario, rol, sucursal_id) 
    values
        (?, ?, ?, ?, ?, ?)
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [$2a$10$VfZNIWOY76dm9FilmkjfveW/yfIAoim5Xxex23lcDkpA5bklkQPY2]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [null]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [josepino]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [SUPER_ADMIN]
2026-01-18 04:27:30 [main] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:BIGINT) <- [null]
2026-01-18 04:27:30 [main] WARN  j.s.s.config.DataInitializer - ‚ö†Ô∏è  USUARIO SUPER_ADMIN CREADO:
2026-01-18 04:27:30 [main] WARN  j.s.s.config.DataInitializer -    üé≠ Rol: SUPER_ADMIN
2026-01-18 04:27:30 [main] INFO  j.s.s.config.DataInitializer - ‚úÖ CARGA DE DATOS INICIALES COMPLETADA EXITOSAMENTE
2026-01-18 04:27:39 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2026-01-18 04:27:39 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2026-01-18 04:27:39 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 0 ms
2026-01-18 04:27:39 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/login
2026-01-18 04:27:39 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/login
2026-01-18 04:27:39 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/login
2026-01-18 04:27:39 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/login, Empresa ID: null
2026-01-18 04:27:39 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/login
2026-01-18 04:27:39 [http-nio-8080-exec-1] INFO  j.s.s.c.SuperAdminController - üîì Mostrando p√°gina de login para SUPER_ADMIN
2026-01-18 04:27:40 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-18 04:27:40 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 35, Request: /superadmin/login, Empresa ID anterior: null
2026-01-18 04:27:40 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-18 04:27:40 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-18 04:27:40 [http-nio-8080-exec-2] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to http://localhost:8080/login
2026-01-18 04:27:40 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login
2026-01-18 04:27:40 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login
2026-01-18 04:27:40 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-18 04:27:40 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: localhost
2026-01-18 04:27:40 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: localhost
2026-01-18 04:27:40 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:27:40 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-18 04:27:40 [http-nio-8080-exec-3] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@2098745596 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2] read-only
2026-01-18 04:27:40 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:27:40 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-18 04:27:40 [http-nio-8080-exec-3] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@2098745596 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2]
2026-01-18 04:27:40 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 37
2026-01-18 04:27:40 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚ö†Ô∏è Usando empresa por defecto (localhost): 1 - Sistema por Defecto
2026-01-18 04:27:40 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-18 04:27:40 [http-nio-8080-exec-3] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-18 04:27:40 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 37, Tenant anterior: 1
2026-01-18 04:27:40 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 37, Request: /login, Empresa ID anterior: 1
2026-01-18 04:27:44 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing POST /superadmin/login
2026-01-18 04:27:44 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: josepino para la empresa ID: null
2026-01-18 04:27:44 [http-nio-8080-exec-4] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: josepino | Subdominio: localhost
2026-01-18 04:27:44 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=?
2026-01-18 04:27:44 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [josepino]
2026-01-18 04:27:44 [http-nio-8080-exec-4] INFO  j.s.s.servicios.UsuarioServicio - ‚úÖ SUPER_ADMIN cargado: josepino - Rol: SUPER_ADMIN
2026-01-18 04:27:44 [http-nio-8080-exec-4] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Authenticated user
2026-01-18 04:27:44 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.s.ChangeSessionIdAuthenticationStrategy - Changed session id from 536E0AC3F94367072D7E6CE8DDD9F962
2026-01-18 04:27:44 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.CsrfAuthenticationStrategy - Replaced CSRF Token
2026-01-18 04:27:44 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Stored SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=536E0AC3F94367072D7E6CE8DDD9F962], Granted Authorities=[ROLE_SUPER_ADMIN]]] to HttpSession [org.apache.catalina.session.StandardSessionFacade@c1e5efd]
2026-01-18 04:27:44 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.UsernamePasswordAuthenticationFilter - Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=536E0AC3F94367072D7E6CE8DDD9F962], Granted Authorities=[ROLE_SUPER_ADMIN]]
2026-01-18 04:27:44 [http-nio-8080-exec-4] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /superadmin/dashboard
2026-01-18 04:27:44 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/dashboard
2026-01-18 04:27:44 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=536E0AC3F94367072D7E6CE8DDD9F962], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:27:44 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/dashboard
2026-01-18 04:27:44 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/dashboard
2026-01-18 04:27:44 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/dashboard, Empresa ID: null
2026-01-18 04:27:44 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/dashboard
2026-01-18 04:27:44 [http-nio-8080-exec-5] INFO  j.s.s.c.SuperAdminController - üìä Accediendo al dashboard SUPER_ADMIN
2026-01-18 04:27:44 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 39, Request: /superadmin/dashboard, Empresa ID anterior: null
2026-01-18 04:27:44 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/empresas
2026-01-18 04:27:44 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=536E0AC3F94367072D7E6CE8DDD9F962], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:27:44 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/empresas
2026-01-18 04:27:44 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/empresas
2026-01-18 04:27:44 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/empresas, Empresa ID: null
2026-01-18 04:27:44 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/empresas
2026-01-18 04:27:44 [http-nio-8080-exec-6] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@2076376209 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2] read-only
2026-01-18 04:27:44 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0
2026-01-18 04:27:44 [http-nio-8080-exec-6] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@2076376209 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2]
2026-01-18 04:27:44 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 40, Request: /superadmin/empresas, Empresa ID anterior: null
2026-01-18 04:27:44 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-18 04:27:44 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=536E0AC3F94367072D7E6CE8DDD9F962], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:27:44 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-18 04:27:44 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-18 04:27:44 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: localhost
2026-01-18 04:27:44 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: localhost
2026-01-18 04:27:44 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:27:44 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-18 04:27:44 [http-nio-8080-exec-7] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@2141675476 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2] read-only
2026-01-18 04:27:44 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:27:44 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-18 04:27:44 [http-nio-8080-exec-7] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@2141675476 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2]
2026-01-18 04:27:44 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 41
2026-01-18 04:27:44 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚ö†Ô∏è Usando empresa por defecto (localhost): 1 - Sistema por Defecto
2026-01-18 04:27:44 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: josepino
2026-01-18 04:27:44 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: josepino en empresa ID: 1
2026-01-18 04:27:44 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:27:44 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [josepino]
2026-01-18 04:27:44 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-18 04:27:44 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 1
2026-01-18 04:27:44 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:27:44 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:27:44 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:27:44 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:27:44 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:27:44 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:27:44 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:27:44 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:27:44 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:27:44 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:27:44 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: false (Empresa ID: 1)
2026-01-18 04:27:44 [http-nio-8080-exec-7] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-16 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-18 04:27:44 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 41, Tenant anterior: 1
2026-01-18 04:27:44 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 41, Request: /favicon.ico, Empresa ID anterior: 1
2026-01-18 04:27:44 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:27:44 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=536E0AC3F94367072D7E6CE8DDD9F962], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:27:44 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AccessDeniedHandlerImpl - Forwarding to /acceso-denegado with status code 403
2026-01-18 04:27:44 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /acceso-denegado?fecha=2026-01-16
2026-01-18 04:27:44 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /acceso-denegado?fecha=2026-01-16
2026-01-18 04:27:44 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /acceso-denegado, Empresa ID: null
2026-01-18 04:27:44 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì Interceptando acceso-denegado - EMPRESA: null
2026-01-18 04:27:44 [http-nio-8080-exec-8] WARN  j.s.s.controladores.InicioController - ‚õî GET /acceso-denigado - Mostrando p√°gina de acceso denegado
2026-01-18 04:27:46 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/empresas/nueva
2026-01-18 04:27:46 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=536E0AC3F94367072D7E6CE8DDD9F962], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:27:46 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/empresas/nueva
2026-01-18 04:27:46 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/empresas/nueva
2026-01-18 04:27:46 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/empresas/nueva, Empresa ID: null
2026-01-18 04:27:46 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/empresas/nueva
2026-01-18 04:27:46 [http-nio-8080-exec-9] INFO  j.s.s.c.SuperAdminController - üìÑ [CONTROLLER] Mostrando formulario para crear nueva empresa
2026-01-18 04:27:46 [http-nio-8080-exec-9] DEBUG j.s.s.c.SuperAdminController - üîß Preparando modelo con nuevo EmpresaClienteDTO
2026-01-18 04:27:46 [http-nio-8080-exec-9] INFO  j.s.s.c.SuperAdminController - ‚úÖ Formulario listo para mostrar
2026-01-18 04:27:46 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /superadmin/empresas/nueva, Empresa ID anterior: null
2026-01-18 04:27:46 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-18 04:27:46 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=536E0AC3F94367072D7E6CE8DDD9F962], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:27:46 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-18 04:27:46 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-18 04:27:46 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: localhost
2026-01-18 04:27:46 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: localhost
2026-01-18 04:27:46 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:27:46 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-18 04:27:46 [http-nio-8080-exec-10] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@941469250 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2] read-only
2026-01-18 04:27:46 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:27:46 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-18 04:27:46 [http-nio-8080-exec-10] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@941469250 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2]
2026-01-18 04:27:46 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 44
2026-01-18 04:27:46 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚ö†Ô∏è Usando empresa por defecto (localhost): 1 - Sistema por Defecto
2026-01-18 04:27:46 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: josepino
2026-01-18 04:27:46 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: josepino en empresa ID: 1
2026-01-18 04:27:46 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:27:46 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [josepino]
2026-01-18 04:27:46 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-18 04:27:46 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 1
2026-01-18 04:27:46 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:27:46 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:27:46 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:27:46 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:27:46 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:27:46 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:27:46 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:27:46 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:27:46 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:27:46 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:27:46 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: false (Empresa ID: 1)
2026-01-18 04:27:46 [http-nio-8080-exec-10] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-16 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-18 04:27:46 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 44, Tenant anterior: 1
2026-01-18 04:27:46 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 44, Request: /favicon.ico, Empresa ID anterior: 1
2026-01-18 04:27:46 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:27:46 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=536E0AC3F94367072D7E6CE8DDD9F962], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:27:46 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AccessDeniedHandlerImpl - Forwarding to /acceso-denegado with status code 403
2026-01-18 04:27:46 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /acceso-denegado?fecha=2026-01-16
2026-01-18 04:27:46 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /acceso-denegado?fecha=2026-01-16
2026-01-18 04:27:46 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /acceso-denegado, Empresa ID: null
2026-01-18 04:27:46 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì Interceptando acceso-denegado - EMPRESA: null
2026-01-18 04:27:46 [http-nio-8080-exec-1] WARN  j.s.s.controladores.InicioController - ‚õî GET /acceso-denigado - Mostrando p√°gina de acceso denegado
2026-01-18 04:28:02 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing POST /superadmin/empresas/crear
2026-01-18 04:28:02 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=536E0AC3F94367072D7E6CE8DDD9F962], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:28:02 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured POST /superadmin/empresas/crear
2026-01-18 04:28:02 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/empresas/crear
2026-01-18 04:28:02 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/empresas/crear, Empresa ID: null
2026-01-18 04:28:02 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/empresas/crear
2026-01-18 04:28:02 [http-nio-8080-exec-2] INFO  j.s.s.c.SuperAdminController - üì® [CONTROLLER] Recibiendo solicitud para crear nueva empresa
2026-01-18 04:28:02 [http-nio-8080-exec-2] DEBUG j.s.s.c.SuperAdminController - üìã Datos recibidos: Nombre=BombayCore, Subdominio=bombaycore, Email=bombay@gmail.com, Plan=BASICO
2026-01-18 04:28:02 [http-nio-8080-exec-2] DEBUG j.s.s.c.SuperAdminController - ‚öôÔ∏è Configuraci√≥n: crearUsuarios=true, crearDatosIniciales=true
2026-01-18 04:28:02 [http-nio-8080-exec-2] INFO  j.s.s.c.SuperAdminController - üîÑ Delegando creaci√≥n al SuperAdminService...
2026-01-18 04:28:02 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - üöÄ [SUPERADMIN] Iniciando creaci√≥n de nueva empresa cliente
2026-01-18 04:28:02 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - üìã Datos recibidos - Nombre: BombayCore, Subdominio: bombaycore, Email: bombay@gmail.com
2026-01-18 04:28:02 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.SuperAdminService - üîç Validando subdominio: bombaycore
2026-01-18 04:28:02 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id 
    from
        empresa e1_0 
    where
        e1_0.subdominio=? 
    limit
        ?
2026-01-18 04:28:02 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [bombaycore]
2026-01-18 04:28:02 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [1]
2026-01-18 04:28:02 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - ‚úÖ Subdominio disponible
2026-01-18 04:28:02 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.SuperAdminService - üèóÔ∏è Creando empresa desde DTO
2026-01-18 04:28:02 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.SuperAdminService - üíæ Guardando empresa en BD
2026-01-18 04:28:02 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        empresa
        (email_contacto, estado, fecha_creacion, nombre, plan, subdominio, telefono) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-18 04:28:02 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [bombay@gmail.com]
2026-01-18 04:28:02 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BOOLEAN) <- [true]
2026-01-18 04:28:02 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:DATE) <- [2026-01-18]
2026-01-18 04:28:02 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [BombayCore]
2026-01-18 04:28:02 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2026-01-18 04:28:02 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [bombaycore]
2026-01-18 04:28:02 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [311]
2026-01-18 04:28:02 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - ‚úÖ Empresa creada: BombayCore (ID: 2)
2026-01-18 04:28:02 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - üë§ Creando usuario administrador...
2026-01-18 04:28:03 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.SuperAdminService - üíæ Guardando usuario admin en BD
2026-01-18 04:28:03 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        usuario
        (activo, contrasenna, empresa_id, nombre_usuario, rol, sucursal_id) 
    values
        (?, ?, ?, ?, ?, ?)
2026-01-18 04:28:03 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-18 04:28:03 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [$2a$10$RABHSqKkzWE2Ca6k8xzQDeU6UPAj8fafd/0DNZ.fZQ1QsiIwKjX1e]
2026-01-18 04:28:03 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-18 04:28:03 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [admin]
2026-01-18 04:28:03 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [ADMIN]
2026-01-18 04:28:03 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:BIGINT) <- [null]
2026-01-18 04:28:03 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - üë§ Usuario creado - Username: admin, Empresa: BombayCore
2026-01-18 04:28:03 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - ‚úÖ Usuario admin creado para empresa BombayCore
2026-01-18 04:28:03 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - üì¶ Creando datos iniciales...
2026-01-18 04:28:03 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.SuperAdminService - üíæ Guardando cliente en BD
2026-01-18 04:28:03 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        cliente
        (activo, correo, empresa_id, identificacion, nombre, telefono) 
    values
        (?, ?, ?, ?, ?, ?)
2026-01-18 04:28:03 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-18 04:28:03 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [null]
2026-01-18 04:28:03 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-18 04:28:03 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [CF9999999999999]
2026-01-18 04:28:03 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [Consumidor Final]
2026-01-18 04:28:03 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2026-01-18 04:28:03 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - üë§ Cliente 'Consumidor Final' creado para empresa BombayCore
2026-01-18 04:28:03 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - ‚úÖ Datos iniciales creados para empresa BombayCore
2026-01-18 04:28:03 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.fecha=? 
        and e1_0.id=? 
    limit
        ?
2026-01-18 04:28:03 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-17]
2026-01-18 04:28:03 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-18 04:28:03 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:INTEGER) <- [1]
2026-01-18 04:28:03 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        u1_0.nombre_usuario=? 
        and e1_0.id=?
2026-01-18 04:28:03 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:28:03 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-18 04:28:03 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        cierre_inventario_diario
        (cantidad_facturas, empresa_id, estado, fecha, observaciones, total_ventas, usuario_id) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-18 04:28:03 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:INTEGER) <- [0]
2026-01-18 04:28:03 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-18 04:28:03 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [COMPLETADO]
2026-01-18 04:28:03 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DATE) <- [2026-01-17]
2026-01-18 04:28:03 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [Cierre inicial generado autom√°ticamente]
2026-01-18 04:28:03 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DOUBLE) <- [0.0]
2026-01-18 04:28:03 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:BIGINT) <- [5]
2026-01-18 04:28:03 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - üìÖ Cierre diario inicial creado para fecha 2026-01-17 - Empresa: BombayCore
2026-01-18 04:28:03 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.SuperAdminService - üìã Asignando plan: BASICO
2026-01-18 04:28:03 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.SuperAdminService - üí∞ Plan 'BASICO' procesado para empresa BombayCore
2026-01-18 04:28:03 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - üí∞ Plan 'BASICO' asignado a empresa BombayCore
2026-01-18 04:28:03 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - üéâ Creaci√≥n de empresa cliente completada exitosamente
2026-01-18 04:28:03 [http-nio-8080-exec-2] INFO  j.s.s.c.SuperAdminController - ‚úÖ Empresa creada exitosamente - ID: 2, Nombre: BombayCore
2026-01-18 04:28:03 [http-nio-8080-exec-2] INFO  j.s.s.c.SuperAdminController - üìä Datos empresa creada: Subdominio=bombaycore, Email=bombay@gmail.com
2026-01-18 04:28:03 [http-nio-8080-exec-2] INFO  j.s.s.c.SuperAdminController - üéØ Redirigiendo a p√°gina de √©xito
2026-01-18 04:28:03 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 36, Request: /superadmin/empresas/crear, Empresa ID anterior: null
2026-01-18 04:28:03 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/empresas
2026-01-18 04:28:03 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=536E0AC3F94367072D7E6CE8DDD9F962], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:28:03 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/empresas
2026-01-18 04:28:03 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/empresas
2026-01-18 04:28:03 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/empresas, Empresa ID: null
2026-01-18 04:28:03 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/empresas
2026-01-18 04:28:03 [http-nio-8080-exec-3] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@1211321520 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2] read-only
2026-01-18 04:28:03 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0
2026-01-18 04:28:03 [http-nio-8080-exec-3] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@1211321520 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2]
2026-01-18 04:28:03 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 37, Request: /superadmin/empresas, Empresa ID anterior: null
2026-01-18 04:28:03 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-18 04:28:03 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=536E0AC3F94367072D7E6CE8DDD9F962], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:28:03 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-18 04:28:03 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-18 04:28:03 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: localhost
2026-01-18 04:28:03 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: localhost
2026-01-18 04:28:03 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:28:03 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-18 04:28:03 [http-nio-8080-exec-4] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@1376572619 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2] read-only
2026-01-18 04:28:03 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:28:03 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-18 04:28:03 [http-nio-8080-exec-4] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@1376572619 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2]
2026-01-18 04:28:03 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 38
2026-01-18 04:28:03 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚ö†Ô∏è Usando empresa por defecto (localhost): 1 - Sistema por Defecto
2026-01-18 04:28:03 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: josepino
2026-01-18 04:28:03 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: josepino en empresa ID: 1
2026-01-18 04:28:03 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:28:03 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [josepino]
2026-01-18 04:28:03 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-18 04:28:03 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 1
2026-01-18 04:28:03 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:28:03 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:28:03 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:28:03 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:28:03 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:28:03 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:28:03 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:28:03 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:28:03 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:28:03 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:28:03 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: false (Empresa ID: 1)
2026-01-18 04:28:03 [http-nio-8080-exec-4] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-16 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-18 04:28:03 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 38, Tenant anterior: 1
2026-01-18 04:28:03 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 38, Request: /favicon.ico, Empresa ID anterior: 1
2026-01-18 04:28:03 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:28:03 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=536E0AC3F94367072D7E6CE8DDD9F962], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:28:03 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AccessDeniedHandlerImpl - Forwarding to /acceso-denegado with status code 403
2026-01-18 04:28:03 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /acceso-denegado?fecha=2026-01-16
2026-01-18 04:28:03 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /acceso-denegado?fecha=2026-01-16
2026-01-18 04:28:03 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /acceso-denegado, Empresa ID: null
2026-01-18 04:28:03 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì Interceptando acceso-denegado - EMPRESA: null
2026-01-18 04:28:03 [http-nio-8080-exec-5] WARN  j.s.s.controladores.InicioController - ‚õî GET /acceso-denigado - Mostrando p√°gina de acceso denegado
2026-01-18 04:28:06 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /
2026-01-18 04:28:06 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /
2026-01-18 04:28:06 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /, M√©todo: GET
2026-01-18 04:28:06 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: bombaycore.localhost
2026-01-18 04:28:06 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: bombaycore
2026-01-18 04:28:06 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:28:06 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [bombaycore]
2026-01-18 04:28:06 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 40
2026-01-18 04:28:06 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: bombaycore)
2026-01-18 04:28:06 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-18 04:28:06 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /, Empresa ID: 2
2026-01-18 04:28:06 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:28:06 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:28:06 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:28:06 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:28:06 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-18 04:28:06 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:28:06 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:28:06 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:28:06 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:28:06 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-18 04:28:06 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: false (Empresa ID: 2)
2026-01-18 04:28:06 [http-nio-8080-exec-6] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-16 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-18 04:28:06 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 40, Tenant anterior: 2
2026-01-18 04:28:06 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 40, Request: /, Empresa ID anterior: 2
2026-01-18 04:28:06 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:28:06 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-18 04:28:06 [http-nio-8080-exec-7] DEBUG o.s.s.w.s.HttpSessionRequestCache - Saved request http://bombaycore.localhost:8080/cierres/obligatorio?fecha=2026-01-16&continue to session
2026-01-18 04:28:06 [http-nio-8080-exec-7] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to http://bombaycore.localhost:8080/login
2026-01-18 04:28:06 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login
2026-01-18 04:28:06 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login
2026-01-18 04:28:06 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-18 04:28:06 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üåê Server Name: bombaycore.localhost
2026-01-18 04:28:06 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: bombaycore
2026-01-18 04:28:06 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:28:06 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [bombaycore]
2026-01-18 04:28:06 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 42
2026-01-18 04:28:06 [http-nio-8080-exec-8] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: bombaycore)
2026-01-18 04:28:06 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-18 04:28:06 [http-nio-8080-exec-8] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-18 04:28:06 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 42, Tenant anterior: 2
2026-01-18 04:28:06 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 42, Request: /login, Empresa ID anterior: 2
2026-01-18 04:28:06 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-18 04:28:06 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-18 04:28:06 [http-nio-8080-exec-9] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to http://bombaycore.localhost:8080/login
2026-01-18 04:28:06 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login
2026-01-18 04:28:06 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login
2026-01-18 04:28:06 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-18 04:28:06 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: bombaycore.localhost
2026-01-18 04:28:06 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: bombaycore
2026-01-18 04:28:06 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:28:06 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [bombaycore]
2026-01-18 04:28:06 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 44
2026-01-18 04:28:06 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: bombaycore)
2026-01-18 04:28:06 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-18 04:28:06 [http-nio-8080-exec-10] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-18 04:28:06 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 44, Tenant anterior: 2
2026-01-18 04:28:06 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 44, Request: /login, Empresa ID anterior: 2
2026-01-18 04:28:12 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-18 04:28:12 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: admin para la empresa ID: null
2026-01-18 04:28:12 [http-nio-8080-exec-1] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: bombaycore
2026-01-18 04:28:12 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:28:12 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [bombaycore]
2026-01-18 04:28:12 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: bombaycore | Empresa ID: 2 | Empresa Nombre: BombayCore
2026-01-18 04:28:12 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:28:12 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:28:12 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-18 04:28:12 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:28:12 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-18 04:28:12 [http-nio-8080-exec-1] INFO  j.s.s.servicios.UsuarioServicio - üîê Encontrado usuario: admin
2026-01-18 04:28:12 [http-nio-8080-exec-1] INFO  j.s.s.servicios.UsuarioServicio - üîê Rol: ADMIN
2026-01-18 04:28:12 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - üîê Activo: true
2026-01-18 04:28:12 [http-nio-8080-exec-1] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Authenticated user
2026-01-18 04:28:12 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.s.ChangeSessionIdAuthenticationStrategy - Changed session id from E25D4E1A853B775F4047CA1AC45536A9
2026-01-18 04:28:12 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.CsrfAuthenticationStrategy - Replaced CSRF Token
2026-01-18 04:28:12 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Stored SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=E25D4E1A853B775F4047CA1AC45536A9], Granted Authorities=[ROLE_ADMIN]]] to HttpSession [org.apache.catalina.session.StandardSessionFacade@373ff35d]
2026-01-18 04:28:12 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.UsernamePasswordAuthenticationFilter - Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=E25D4E1A853B775F4047CA1AC45536A9], Granted Authorities=[ROLE_ADMIN]]
2026-01-18 04:28:12 [http-nio-8080-exec-1] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /principal
2026-01-18 04:28:12 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-18 04:28:12 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=E25D4E1A853B775F4047CA1AC45536A9], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:28:12 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-18 04:28:12 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-18 04:28:12 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üåê Server Name: bombaycore.localhost
2026-01-18 04:28:12 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: bombaycore
2026-01-18 04:28:12 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:28:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [bombaycore]
2026-01-18 04:28:12 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 36
2026-01-18 04:28:12 [http-nio-8080-exec-2] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: bombaycore)
2026-01-18 04:28:12 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-18 04:28:12 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-18 04:28:12 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:28:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:28:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-18 04:28:12 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:28:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-18 04:28:12 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-18 04:28:12 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-18 04:28:12 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:28:12 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:28:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:28:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:28:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-18 04:28:12 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:28:12 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:28:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:28:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:28:12 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-18 04:28:12 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: false (Empresa ID: 2)
2026-01-18 04:28:12 [http-nio-8080-exec-2] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-16 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-18 04:28:12 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 36, Tenant anterior: 2
2026-01-18 04:28:12 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 36, Request: /principal, Empresa ID anterior: 2
2026-01-18 04:28:12 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:28:12 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=E25D4E1A853B775F4047CA1AC45536A9], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:28:12 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:28:12 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/obligatorio, M√©todo: GET
2026-01-18 04:28:12 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: bombaycore.localhost
2026-01-18 04:28:12 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: bombaycore
2026-01-18 04:28:12 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:28:12 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [bombaycore]
2026-01-18 04:28:12 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 37
2026-01-18 04:28:12 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: bombaycore)
2026-01-18 04:28:12 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-18 04:28:12 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-18 04:28:12 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:28:12 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:28:12 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-18 04:28:12 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:28:12 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-18 04:28:12 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-18 04:28:12 [http-nio-8080-exec-3] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚è∞ GET /cierres/obligatorio - Verificando cierre obligatorio
2026-01-18 04:28:12 [http-nio-8080-exec-3] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Hora actual: 4:00, Fecha: 2026-01-18
2026-01-18 04:28:12 [http-nio-8080-exec-3] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Fecha proporcionada: 2026-01-16
2026-01-18 04:28:12 [http-nio-8080-exec-3] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚ö†Ô∏è Cierre obligatorio requerido para fecha: 2026-01-16
2026-01-18 04:28:12 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 37, Tenant anterior: 2
2026-01-18 04:28:12 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 37, Request: /cierres/obligatorio, Empresa ID anterior: 2
2026-01-18 04:28:12 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-18 04:28:12 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=E25D4E1A853B775F4047CA1AC45536A9], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:28:12 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-18 04:28:12 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-18 04:28:12 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: bombaycore.localhost
2026-01-18 04:28:12 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: bombaycore
2026-01-18 04:28:12 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:28:12 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [bombaycore]
2026-01-18 04:28:12 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 38
2026-01-18 04:28:12 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: bombaycore)
2026-01-18 04:28:12 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-18 04:28:12 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-18 04:28:12 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:28:12 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:28:12 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-18 04:28:12 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:28:12 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-18 04:28:12 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-18 04:28:12 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 2
2026-01-18 04:28:12 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:28:12 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:28:12 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:28:12 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:28:12 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-18 04:28:12 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:28:12 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:28:12 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:28:12 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:28:12 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-18 04:28:12 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: false (Empresa ID: 2)
2026-01-18 04:28:12 [http-nio-8080-exec-4] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-16 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-18 04:28:12 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 38, Tenant anterior: 2
2026-01-18 04:28:12 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 38, Request: /favicon.ico, Empresa ID anterior: 2
2026-01-18 04:28:12 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:28:12 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=E25D4E1A853B775F4047CA1AC45536A9], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:28:12 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:28:12 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/obligatorio, M√©todo: GET
2026-01-18 04:28:12 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: bombaycore.localhost
2026-01-18 04:28:12 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: bombaycore
2026-01-18 04:28:12 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:28:12 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [bombaycore]
2026-01-18 04:28:12 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 39
2026-01-18 04:28:12 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: bombaycore)
2026-01-18 04:28:12 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-18 04:28:12 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-18 04:28:12 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:28:12 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:28:12 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-18 04:28:12 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:28:12 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-18 04:28:12 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-18 04:28:12 [http-nio-8080-exec-5] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚è∞ GET /cierres/obligatorio - Verificando cierre obligatorio
2026-01-18 04:28:12 [http-nio-8080-exec-5] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Hora actual: 4:00, Fecha: 2026-01-18
2026-01-18 04:28:12 [http-nio-8080-exec-5] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Fecha proporcionada: 2026-01-16
2026-01-18 04:28:12 [http-nio-8080-exec-5] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚ö†Ô∏è Cierre obligatorio requerido para fecha: 2026-01-16
2026-01-18 04:28:12 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 39, Tenant anterior: 2
2026-01-18 04:28:12 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 39, Request: /cierres/obligatorio, Empresa ID anterior: 2
2026-01-18 04:30:10 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/login
2026-01-18 04:30:10 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/login
2026-01-18 04:30:10 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/login
2026-01-18 04:30:10 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/login, Empresa ID: null
2026-01-18 04:30:10 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/login
2026-01-18 04:30:10 [http-nio-8080-exec-8] INFO  j.s.s.c.SuperAdminController - üîì Mostrando p√°gina de login para SUPER_ADMIN
2026-01-18 04:30:10 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=536E0AC3F94367072D7E6CE8DDD9F962], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:30:10 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 42, Request: /superadmin/login, Empresa ID anterior: null
2026-01-18 04:30:10 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-18 04:30:10 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=536E0AC3F94367072D7E6CE8DDD9F962], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:30:10 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-18 04:30:10 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-18 04:30:10 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: localhost
2026-01-18 04:30:10 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: localhost
2026-01-18 04:30:10 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:30:10 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-18 04:30:10 [http-nio-8080-exec-9] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@1364211235 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2] read-only
2026-01-18 04:30:10 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:30:10 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-18 04:30:10 [http-nio-8080-exec-9] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@1364211235 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2]
2026-01-18 04:30:10 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 43
2026-01-18 04:30:10 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚ö†Ô∏è Usando empresa por defecto (localhost): 1 - Sistema por Defecto
2026-01-18 04:30:10 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: josepino
2026-01-18 04:30:10 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: josepino en empresa ID: 1
2026-01-18 04:30:10 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:30:10 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [josepino]
2026-01-18 04:30:10 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-18 04:30:10 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 1
2026-01-18 04:30:10 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:30:10 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:30:10 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:30:10 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:30:10 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:30:10 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:30:10 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:30:10 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:30:10 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:30:10 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:30:10 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: false (Empresa ID: 1)
2026-01-18 04:30:10 [http-nio-8080-exec-9] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-16 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-18 04:30:10 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 43, Tenant anterior: 1
2026-01-18 04:30:10 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /favicon.ico, Empresa ID anterior: 1
2026-01-18 04:30:10 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:30:10 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=536E0AC3F94367072D7E6CE8DDD9F962], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:30:10 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AccessDeniedHandlerImpl - Forwarding to /acceso-denegado with status code 403
2026-01-18 04:30:10 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /acceso-denegado?fecha=2026-01-16
2026-01-18 04:30:10 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /acceso-denegado?fecha=2026-01-16
2026-01-18 04:30:10 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /acceso-denegado, Empresa ID: null
2026-01-18 04:30:10 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì Interceptando acceso-denegado - EMPRESA: null
2026-01-18 04:30:10 [http-nio-8080-exec-10] WARN  j.s.s.controladores.InicioController - ‚õî GET /acceso-denigado - Mostrando p√°gina de acceso denegado
2026-01-18 04:30:16 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing POST /superadmin/login
2026-01-18 04:30:16 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: josepino para la empresa ID: null
2026-01-18 04:30:16 [http-nio-8080-exec-1] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: josepino | Subdominio: localhost
2026-01-18 04:30:16 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=?
2026-01-18 04:30:16 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [josepino]
2026-01-18 04:30:16 [http-nio-8080-exec-1] INFO  j.s.s.servicios.UsuarioServicio - ‚úÖ SUPER_ADMIN cargado: josepino - Rol: SUPER_ADMIN
2026-01-18 04:30:16 [http-nio-8080-exec-1] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Authenticated user
2026-01-18 04:30:16 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.s.ChangeSessionIdAuthenticationStrategy - Changed session id from E86F546F47CA5FCC48B3E324F45AF3D2
2026-01-18 04:30:16 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.CsrfAuthenticationStrategy - Replaced CSRF Token
2026-01-18 04:30:16 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Stored SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=E86F546F47CA5FCC48B3E324F45AF3D2], Granted Authorities=[ROLE_SUPER_ADMIN]]] to HttpSession [org.apache.catalina.session.StandardSessionFacade@c1e5efd]
2026-01-18 04:30:16 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.UsernamePasswordAuthenticationFilter - Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=E86F546F47CA5FCC48B3E324F45AF3D2], Granted Authorities=[ROLE_SUPER_ADMIN]]
2026-01-18 04:30:16 [http-nio-8080-exec-1] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /superadmin/dashboard
2026-01-18 04:30:16 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/dashboard
2026-01-18 04:30:16 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=E86F546F47CA5FCC48B3E324F45AF3D2], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:30:16 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/dashboard
2026-01-18 04:30:16 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/dashboard
2026-01-18 04:30:16 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/dashboard, Empresa ID: null
2026-01-18 04:30:16 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/dashboard
2026-01-18 04:30:16 [http-nio-8080-exec-2] INFO  j.s.s.c.SuperAdminController - üìä Accediendo al dashboard SUPER_ADMIN
2026-01-18 04:30:16 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 36, Request: /superadmin/dashboard, Empresa ID anterior: null
2026-01-18 04:30:16 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/empresas
2026-01-18 04:30:16 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=E86F546F47CA5FCC48B3E324F45AF3D2], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:30:16 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/empresas
2026-01-18 04:30:16 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/empresas
2026-01-18 04:30:16 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/empresas, Empresa ID: null
2026-01-18 04:30:16 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/empresas
2026-01-18 04:30:16 [http-nio-8080-exec-3] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@1526553525 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2] read-only
2026-01-18 04:30:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0
2026-01-18 04:30:16 [http-nio-8080-exec-3] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@1526553525 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2]
2026-01-18 04:30:16 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 37, Request: /superadmin/empresas, Empresa ID anterior: null
2026-01-18 04:30:16 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-18 04:30:16 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=E86F546F47CA5FCC48B3E324F45AF3D2], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:30:16 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-18 04:30:16 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-18 04:30:16 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: localhost
2026-01-18 04:30:16 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: localhost
2026-01-18 04:30:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:30:16 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-18 04:30:16 [http-nio-8080-exec-4] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@1763495033 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2] read-only
2026-01-18 04:30:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:30:16 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-18 04:30:16 [http-nio-8080-exec-4] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@1763495033 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2]
2026-01-18 04:30:16 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 38
2026-01-18 04:30:16 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚ö†Ô∏è Usando empresa por defecto (localhost): 1 - Sistema por Defecto
2026-01-18 04:30:16 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: josepino
2026-01-18 04:30:16 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: josepino en empresa ID: 1
2026-01-18 04:30:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:30:16 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [josepino]
2026-01-18 04:30:16 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-18 04:30:16 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 1
2026-01-18 04:30:16 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:30:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:30:16 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:30:16 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:30:16 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:30:16 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:30:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:30:16 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:30:16 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:30:16 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:30:16 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: false (Empresa ID: 1)
2026-01-18 04:30:16 [http-nio-8080-exec-4] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-16 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-18 04:30:16 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 38, Tenant anterior: 1
2026-01-18 04:30:16 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 38, Request: /favicon.ico, Empresa ID anterior: 1
2026-01-18 04:30:16 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:30:16 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=E86F546F47CA5FCC48B3E324F45AF3D2], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:30:16 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AccessDeniedHandlerImpl - Forwarding to /acceso-denegado with status code 403
2026-01-18 04:30:16 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /acceso-denegado?fecha=2026-01-16
2026-01-18 04:30:16 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /acceso-denegado?fecha=2026-01-16
2026-01-18 04:30:16 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /acceso-denegado, Empresa ID: null
2026-01-18 04:30:16 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì Interceptando acceso-denegado - EMPRESA: null
2026-01-18 04:30:16 [http-nio-8080-exec-5] WARN  j.s.s.controladores.InicioController - ‚õî GET /acceso-denigado - Mostrando p√°gina de acceso denegado
2026-01-18 04:30:17 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /
2026-01-18 04:30:17 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /
2026-01-18 04:30:17 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /, M√©todo: GET
2026-01-18 04:30:17 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: bombaycore.localhost
2026-01-18 04:30:17 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: bombaycore
2026-01-18 04:30:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:30:17 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [bombaycore]
2026-01-18 04:30:17 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 40
2026-01-18 04:30:17 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: bombaycore)
2026-01-18 04:30:17 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=E25D4E1A853B775F4047CA1AC45536A9], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:30:17 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-18 04:30:17 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-18 04:30:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:30:17 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:30:17 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-18 04:30:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:30:17 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-18 04:30:17 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-18 04:30:17 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /, Empresa ID: 2
2026-01-18 04:30:17 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:30:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:30:17 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:30:17 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:30:17 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-18 04:30:17 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:30:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:30:17 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:30:17 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:30:17 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-18 04:30:17 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: true (Empresa ID: 2)
2026-01-18 04:30:17 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-16 cerrado correctamente
2026-01-18 04:30:17 [http-nio-8080-exec-6] INFO  j.s.s.controladores.InicioController - üîÄ GET / - Redirigiendo a /login
2026-01-18 04:30:17 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 40, Tenant anterior: 2
2026-01-18 04:30:17 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 40, Request: /, Empresa ID anterior: 2
2026-01-18 04:30:17 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login
2026-01-18 04:30:17 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login
2026-01-18 04:30:17 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-18 04:30:17 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: bombaycore.localhost
2026-01-18 04:30:17 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: bombaycore
2026-01-18 04:30:17 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:30:17 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [bombaycore]
2026-01-18 04:30:17 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 41
2026-01-18 04:30:17 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: bombaycore)
2026-01-18 04:30:17 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=E25D4E1A853B775F4047CA1AC45536A9], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:30:17 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-18 04:30:17 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-18 04:30:17 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:30:17 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:30:17 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-18 04:30:17 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:30:17 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-18 04:30:17 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-18 04:30:17 [http-nio-8080-exec-7] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-18 04:30:17 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 41, Tenant anterior: 2
2026-01-18 04:30:17 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 41, Request: /login, Empresa ID anterior: 2
2026-01-18 04:30:17 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-18 04:30:17 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=E25D4E1A853B775F4047CA1AC45536A9], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:30:17 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-18 04:30:17 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-18 04:30:17 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üåê Server Name: bombaycore.localhost
2026-01-18 04:30:17 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: bombaycore
2026-01-18 04:30:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:30:17 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [bombaycore]
2026-01-18 04:30:17 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 42
2026-01-18 04:30:17 [http-nio-8080-exec-8] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: bombaycore)
2026-01-18 04:30:17 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-18 04:30:17 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-18 04:30:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:30:17 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:30:17 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-18 04:30:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:30:17 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-18 04:30:17 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-18 04:30:17 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 2
2026-01-18 04:30:17 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:30:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:30:17 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:30:17 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:30:17 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-18 04:30:17 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:30:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:30:17 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:30:17 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:30:17 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-18 04:30:17 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: true (Empresa ID: 2)
2026-01-18 04:30:17 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-16 cerrado correctamente
2026-01-18 04:30:17 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 42, Tenant anterior: 2
2026-01-18 04:30:17 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 42, Request: /favicon.ico, Empresa ID anterior: 2
2026-01-18 04:30:17 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /error
2026-01-18 04:30:17 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /error
2026-01-18 04:30:17 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=E25D4E1A853B775F4047CA1AC45536A9], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:30:23 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-18 04:30:23 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: admin para la empresa ID: null
2026-01-18 04:30:23 [http-nio-8080-exec-9] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: bombaycore
2026-01-18 04:30:23 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:30:23 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [bombaycore]
2026-01-18 04:30:23 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: bombaycore | Empresa ID: 2 | Empresa Nombre: BombayCore
2026-01-18 04:30:23 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:30:23 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:30:23 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-18 04:30:23 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:30:23 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-18 04:30:23 [http-nio-8080-exec-9] INFO  j.s.s.servicios.UsuarioServicio - üîê Encontrado usuario: admin
2026-01-18 04:30:23 [http-nio-8080-exec-9] INFO  j.s.s.servicios.UsuarioServicio - üîê Rol: ADMIN
2026-01-18 04:30:23 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - üîê Activo: true
2026-01-18 04:30:23 [http-nio-8080-exec-9] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Authenticated user
2026-01-18 04:30:23 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.s.ChangeSessionIdAuthenticationStrategy - Changed session id from FEC36A48C97B4FE4D220FE714DB724E9
2026-01-18 04:30:23 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.CsrfAuthenticationStrategy - Replaced CSRF Token
2026-01-18 04:30:23 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Stored SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=FEC36A48C97B4FE4D220FE714DB724E9], Granted Authorities=[ROLE_ADMIN]]] to HttpSession [org.apache.catalina.session.StandardSessionFacade@373ff35d]
2026-01-18 04:30:23 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.UsernamePasswordAuthenticationFilter - Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=FEC36A48C97B4FE4D220FE714DB724E9], Granted Authorities=[ROLE_ADMIN]]
2026-01-18 04:30:23 [http-nio-8080-exec-9] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /principal
2026-01-18 04:30:23 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-18 04:30:23 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=FEC36A48C97B4FE4D220FE714DB724E9], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:30:23 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-18 04:30:23 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-18 04:30:23 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: bombaycore.localhost
2026-01-18 04:30:23 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: bombaycore
2026-01-18 04:30:23 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:30:23 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [bombaycore]
2026-01-18 04:30:23 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 44
2026-01-18 04:30:23 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: bombaycore)
2026-01-18 04:30:23 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-18 04:30:23 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-18 04:30:23 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:30:23 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:30:23 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-18 04:30:23 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:30:23 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-18 04:30:23 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-18 04:30:23 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-18 04:30:23 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:30:23 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:30:23 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:30:23 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:30:23 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-18 04:30:23 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:30:23 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:30:23 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:30:23 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:30:23 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-18 04:30:23 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: true (Empresa ID: 2)
2026-01-18 04:30:23 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-16 cerrado correctamente
2026-01-18 04:30:23 [http-nio-8080-exec-10] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-18
2026-01-18 04:30:23 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-18 04:30:23 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:30:23 [http-nio-8080-exec-10] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-18
2026-01-18 04:30:23 [http-nio-8080-exec-10] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-18 04:30:23 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 44, Tenant anterior: 2
2026-01-18 04:30:23 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 44, Request: /principal, Empresa ID anterior: 2
2026-01-18 04:30:58 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/empresas/nueva
2026-01-18 04:30:58 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=E86F546F47CA5FCC48B3E324F45AF3D2], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:30:58 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/empresas/nueva
2026-01-18 04:30:58 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/empresas/nueva
2026-01-18 04:30:58 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/empresas/nueva, Empresa ID: null
2026-01-18 04:30:58 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/empresas/nueva
2026-01-18 04:30:58 [http-nio-8080-exec-1] INFO  j.s.s.c.SuperAdminController - üìÑ [CONTROLLER] Mostrando formulario para crear nueva empresa
2026-01-18 04:30:58 [http-nio-8080-exec-1] DEBUG j.s.s.c.SuperAdminController - üîß Preparando modelo con nuevo EmpresaClienteDTO
2026-01-18 04:30:58 [http-nio-8080-exec-1] INFO  j.s.s.c.SuperAdminController - ‚úÖ Formulario listo para mostrar
2026-01-18 04:30:58 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 35, Request: /superadmin/empresas/nueva, Empresa ID anterior: null
2026-01-18 04:30:58 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-18 04:30:58 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=E86F546F47CA5FCC48B3E324F45AF3D2], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:30:58 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-18 04:30:58 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-18 04:30:58 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üåê Server Name: localhost
2026-01-18 04:30:58 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: localhost
2026-01-18 04:30:58 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:30:58 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-18 04:30:58 [http-nio-8080-exec-2] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@1067056922 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2] read-only
2026-01-18 04:30:58 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:30:58 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-18 04:30:58 [http-nio-8080-exec-2] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@1067056922 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2]
2026-01-18 04:30:58 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 36
2026-01-18 04:30:58 [http-nio-8080-exec-2] INFO  j.s.s.context.TenantFilter - ‚ö†Ô∏è Usando empresa por defecto (localhost): 1 - Sistema por Defecto
2026-01-18 04:30:58 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: josepino
2026-01-18 04:30:58 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: josepino en empresa ID: 1
2026-01-18 04:30:58 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:30:58 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [josepino]
2026-01-18 04:30:58 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-18 04:30:58 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 1
2026-01-18 04:30:58 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:30:58 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:30:58 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:30:58 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:30:58 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:30:58 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:30:58 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:30:58 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:30:58 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:30:58 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:30:58 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: false (Empresa ID: 1)
2026-01-18 04:30:58 [http-nio-8080-exec-2] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-16 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-18 04:30:58 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 36, Tenant anterior: 1
2026-01-18 04:30:58 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 36, Request: /favicon.ico, Empresa ID anterior: 1
2026-01-18 04:30:58 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:30:58 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=E86F546F47CA5FCC48B3E324F45AF3D2], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:30:58 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AccessDeniedHandlerImpl - Forwarding to /acceso-denegado with status code 403
2026-01-18 04:30:58 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /acceso-denegado?fecha=2026-01-16
2026-01-18 04:30:58 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /acceso-denegado?fecha=2026-01-16
2026-01-18 04:30:58 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /acceso-denegado, Empresa ID: null
2026-01-18 04:30:58 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì Interceptando acceso-denegado - EMPRESA: null
2026-01-18 04:30:58 [http-nio-8080-exec-3] WARN  j.s.s.controladores.InicioController - ‚õî GET /acceso-denigado - Mostrando p√°gina de acceso denegado
2026-01-18 04:31:17 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing POST /superadmin/empresas/crear
2026-01-18 04:31:17 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=E86F546F47CA5FCC48B3E324F45AF3D2], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:31:17 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured POST /superadmin/empresas/crear
2026-01-18 04:31:17 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/empresas/crear
2026-01-18 04:31:17 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/empresas/crear, Empresa ID: null
2026-01-18 04:31:17 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/empresas/crear
2026-01-18 04:31:17 [http-nio-8080-exec-4] INFO  j.s.s.c.SuperAdminController - üì® [CONTROLLER] Recibiendo solicitud para crear nueva empresa
2026-01-18 04:31:17 [http-nio-8080-exec-4] DEBUG j.s.s.c.SuperAdminController - üìã Datos recibidos: Nombre=rest, Subdominio=rest, Email=jjkhskj@gmail.com, Plan=BASICO
2026-01-18 04:31:17 [http-nio-8080-exec-4] DEBUG j.s.s.c.SuperAdminController - ‚öôÔ∏è Configuraci√≥n: crearUsuarios=true, crearDatosIniciales=true
2026-01-18 04:31:17 [http-nio-8080-exec-4] INFO  j.s.s.c.SuperAdminController - üîÑ Delegando creaci√≥n al SuperAdminService...
2026-01-18 04:31:17 [http-nio-8080-exec-4] INFO  j.s.s.servicios.SuperAdminService - üöÄ [SUPERADMIN] Iniciando creaci√≥n de nueva empresa cliente
2026-01-18 04:31:17 [http-nio-8080-exec-4] INFO  j.s.s.servicios.SuperAdminService - üìã Datos recibidos - Nombre: rest, Subdominio: rest, Email: jjkhskj@gmail.com
2026-01-18 04:31:17 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.SuperAdminService - üîç Validando subdominio: rest
2026-01-18 04:31:17 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id 
    from
        empresa e1_0 
    where
        e1_0.subdominio=? 
    limit
        ?
2026-01-18 04:31:17 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [rest]
2026-01-18 04:31:17 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [1]
2026-01-18 04:31:17 [http-nio-8080-exec-4] INFO  j.s.s.servicios.SuperAdminService - ‚úÖ Subdominio disponible
2026-01-18 04:31:17 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.SuperAdminService - üèóÔ∏è Creando empresa desde DTO
2026-01-18 04:31:17 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.SuperAdminService - üíæ Guardando empresa en BD
2026-01-18 04:31:17 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        empresa
        (email_contacto, estado, fecha_creacion, nombre, plan, subdominio, telefono) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-18 04:31:17 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jjkhskj@gmail.com]
2026-01-18 04:31:17 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BOOLEAN) <- [true]
2026-01-18 04:31:17 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:DATE) <- [2026-01-18]
2026-01-18 04:31:17 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [rest]
2026-01-18 04:31:17 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2026-01-18 04:31:17 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [rest]
2026-01-18 04:31:17 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [4564]
2026-01-18 04:31:17 [http-nio-8080-exec-4] INFO  j.s.s.servicios.SuperAdminService - ‚úÖ Empresa creada: rest (ID: 3)
2026-01-18 04:31:17 [http-nio-8080-exec-4] INFO  j.s.s.servicios.SuperAdminService - üë§ Creando usuario administrador...
2026-01-18 04:31:17 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.SuperAdminService - üíæ Guardando usuario admin en BD
2026-01-18 04:31:17 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        usuario
        (activo, contrasenna, empresa_id, nombre_usuario, rol, sucursal_id) 
    values
        (?, ?, ?, ?, ?, ?)
2026-01-18 04:31:17 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-18 04:31:17 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [$2a$10$7RU3c/bq7POcpGvxN8Q3TOKnLI/myF0uHtilWYYDlWgFjGhqnnGf2]
2026-01-18 04:31:17 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:31:17 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [admin]
2026-01-18 04:31:17 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [ADMIN]
2026-01-18 04:31:17 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:BIGINT) <- [null]
2026-01-18 04:31:17 [http-nio-8080-exec-4] INFO  j.s.s.servicios.SuperAdminService - üë§ Usuario creado - Username: admin, Empresa: rest
2026-01-18 04:31:17 [http-nio-8080-exec-4] INFO  j.s.s.servicios.SuperAdminService - ‚úÖ Usuario admin creado para empresa rest
2026-01-18 04:31:17 [http-nio-8080-exec-4] INFO  j.s.s.servicios.SuperAdminService - üì¶ Creando datos iniciales...
2026-01-18 04:31:17 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.SuperAdminService - üíæ Guardando cliente en BD
2026-01-18 04:31:17 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        cliente
        (activo, correo, empresa_id, identificacion, nombre, telefono) 
    values
        (?, ?, ?, ?, ?, ?)
2026-01-18 04:31:17 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-18 04:31:17 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [null]
2026-01-18 04:31:17 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:31:17 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [CF9999999999999]
2026-01-18 04:31:17 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [Consumidor Final]
2026-01-18 04:31:17 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2026-01-18 04:31:17 [http-nio-8080-exec-4] INFO  j.s.s.servicios.SuperAdminService - üë§ Cliente 'Consumidor Final' creado para empresa rest
2026-01-18 04:31:17 [http-nio-8080-exec-4] INFO  j.s.s.servicios.SuperAdminService - ‚úÖ Datos iniciales creados para empresa rest
2026-01-18 04:31:17 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.fecha=? 
        and e1_0.id=? 
    limit
        ?
2026-01-18 04:31:17 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-17]
2026-01-18 04:31:17 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:31:17 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:INTEGER) <- [1]
2026-01-18 04:31:17 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        u1_0.nombre_usuario=? 
        and e1_0.id=?
2026-01-18 04:31:17 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:31:17 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:31:17 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        cierre_inventario_diario
        (cantidad_facturas, empresa_id, estado, fecha, observaciones, total_ventas, usuario_id) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-18 04:31:17 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:INTEGER) <- [0]
2026-01-18 04:31:17 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:31:17 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [COMPLETADO]
2026-01-18 04:31:17 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DATE) <- [2026-01-17]
2026-01-18 04:31:17 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [Cierre inicial generado autom√°ticamente]
2026-01-18 04:31:17 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DOUBLE) <- [0.0]
2026-01-18 04:31:17 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:BIGINT) <- [6]
2026-01-18 04:31:17 [http-nio-8080-exec-4] INFO  j.s.s.servicios.SuperAdminService - üìÖ Cierre diario inicial creado para fecha 2026-01-17 - Empresa: rest
2026-01-18 04:31:17 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.SuperAdminService - üìã Asignando plan: BASICO
2026-01-18 04:31:17 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.SuperAdminService - üí∞ Plan 'BASICO' procesado para empresa rest
2026-01-18 04:31:17 [http-nio-8080-exec-4] INFO  j.s.s.servicios.SuperAdminService - üí∞ Plan 'BASICO' asignado a empresa rest
2026-01-18 04:31:17 [http-nio-8080-exec-4] INFO  j.s.s.servicios.SuperAdminService - üéâ Creaci√≥n de empresa cliente completada exitosamente
2026-01-18 04:31:17 [http-nio-8080-exec-4] INFO  j.s.s.c.SuperAdminController - ‚úÖ Empresa creada exitosamente - ID: 3, Nombre: rest
2026-01-18 04:31:17 [http-nio-8080-exec-4] INFO  j.s.s.c.SuperAdminController - üìä Datos empresa creada: Subdominio=rest, Email=jjkhskj@gmail.com
2026-01-18 04:31:17 [http-nio-8080-exec-4] INFO  j.s.s.c.SuperAdminController - üéØ Redirigiendo a p√°gina de √©xito
2026-01-18 04:31:17 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 38, Request: /superadmin/empresas/crear, Empresa ID anterior: null
2026-01-18 04:31:17 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/empresas
2026-01-18 04:31:17 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=E86F546F47CA5FCC48B3E324F45AF3D2], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:31:17 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/empresas
2026-01-18 04:31:17 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/empresas
2026-01-18 04:31:17 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/empresas, Empresa ID: null
2026-01-18 04:31:17 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/empresas
2026-01-18 04:31:17 [http-nio-8080-exec-5] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@1797243531 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2] read-only
2026-01-18 04:31:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0
2026-01-18 04:31:17 [http-nio-8080-exec-5] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@1797243531 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2]
2026-01-18 04:31:17 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 39, Request: /superadmin/empresas, Empresa ID anterior: null
2026-01-18 04:31:17 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-18 04:31:17 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=E86F546F47CA5FCC48B3E324F45AF3D2], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:31:17 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-18 04:31:17 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-18 04:31:17 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: localhost
2026-01-18 04:31:17 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: localhost
2026-01-18 04:31:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:31:17 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-18 04:31:17 [http-nio-8080-exec-6] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@2088376150 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2] read-only
2026-01-18 04:31:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:31:17 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-18 04:31:17 [http-nio-8080-exec-6] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@2088376150 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2]
2026-01-18 04:31:17 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 40
2026-01-18 04:31:17 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚ö†Ô∏è Usando empresa por defecto (localhost): 1 - Sistema por Defecto
2026-01-18 04:31:17 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: josepino
2026-01-18 04:31:17 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: josepino en empresa ID: 1
2026-01-18 04:31:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:31:17 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [josepino]
2026-01-18 04:31:17 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-18 04:31:17 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 1
2026-01-18 04:31:17 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:31:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:31:17 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:31:17 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:31:17 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:31:17 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:31:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:31:17 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:31:17 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:31:17 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:31:17 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: false (Empresa ID: 1)
2026-01-18 04:31:17 [http-nio-8080-exec-6] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-16 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-18 04:31:17 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 40, Tenant anterior: 1
2026-01-18 04:31:17 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 40, Request: /favicon.ico, Empresa ID anterior: 1
2026-01-18 04:31:17 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:31:17 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=E86F546F47CA5FCC48B3E324F45AF3D2], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:31:17 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AccessDeniedHandlerImpl - Forwarding to /acceso-denegado with status code 403
2026-01-18 04:31:17 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /acceso-denegado?fecha=2026-01-16
2026-01-18 04:31:17 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /acceso-denegado?fecha=2026-01-16
2026-01-18 04:31:17 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /acceso-denegado, Empresa ID: null
2026-01-18 04:31:17 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì Interceptando acceso-denegado - EMPRESA: null
2026-01-18 04:31:17 [http-nio-8080-exec-7] WARN  j.s.s.controladores.InicioController - ‚õî GET /acceso-denigado - Mostrando p√°gina de acceso denegado
2026-01-18 04:31:39 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /
2026-01-18 04:31:39 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /
2026-01-18 04:31:39 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /, M√©todo: GET
2026-01-18 04:31:39 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: rest.localhost
2026-01-18 04:31:39 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: rest
2026-01-18 04:31:39 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:31:39 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [rest]
2026-01-18 04:31:39 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 43
2026-01-18 04:31:39 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: rest)
2026-01-18 04:31:39 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-18 04:31:39 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /, Empresa ID: 3
2026-01-18 04:31:39 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:31:39 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:31:39 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:31:39 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:31:39 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:31:39 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:31:39 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:31:39 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:31:39 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:31:39 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:31:39 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: false (Empresa ID: 3)
2026-01-18 04:31:39 [http-nio-8080-exec-9] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-16 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-18 04:31:39 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 43, Tenant anterior: 3
2026-01-18 04:31:39 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /, Empresa ID anterior: 3
2026-01-18 04:31:39 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:31:39 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-18 04:31:39 [http-nio-8080-exec-10] DEBUG o.s.s.w.s.HttpSessionRequestCache - Saved request http://rest.localhost:8080/cierres/obligatorio?fecha=2026-01-16&continue to session
2026-01-18 04:31:39 [http-nio-8080-exec-10] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to http://rest.localhost:8080/login
2026-01-18 04:31:39 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login
2026-01-18 04:31:39 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login
2026-01-18 04:31:39 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-18 04:31:39 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üåê Server Name: rest.localhost
2026-01-18 04:31:39 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: rest
2026-01-18 04:31:39 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:31:39 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [rest]
2026-01-18 04:31:39 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 35
2026-01-18 04:31:39 [http-nio-8080-exec-1] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: rest)
2026-01-18 04:31:39 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-18 04:31:39 [http-nio-8080-exec-1] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-18 04:31:39 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 35, Tenant anterior: 3
2026-01-18 04:31:39 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 35, Request: /login, Empresa ID anterior: 3
2026-01-18 04:31:39 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-18 04:31:39 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-18 04:31:39 [http-nio-8080-exec-2] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to http://rest.localhost:8080/login
2026-01-18 04:31:39 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login
2026-01-18 04:31:39 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login
2026-01-18 04:31:39 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-18 04:31:39 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: rest.localhost
2026-01-18 04:31:39 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: rest
2026-01-18 04:31:39 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:31:39 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [rest]
2026-01-18 04:31:39 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 37
2026-01-18 04:31:39 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: rest)
2026-01-18 04:31:39 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-18 04:31:39 [http-nio-8080-exec-3] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-18 04:31:39 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 37, Tenant anterior: 3
2026-01-18 04:31:39 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 37, Request: /login, Empresa ID anterior: 3
2026-01-18 04:31:49 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-18 04:31:49 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: admin para la empresa ID: null
2026-01-18 04:31:49 [http-nio-8080-exec-4] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: rest
2026-01-18 04:31:49 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:31:49 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [rest]
2026-01-18 04:31:49 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: rest | Empresa ID: 3 | Empresa Nombre: rest
2026-01-18 04:31:49 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:31:49 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:31:49 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:31:49 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:31:49 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:31:49 [http-nio-8080-exec-4] INFO  j.s.s.servicios.UsuarioServicio - üîê Encontrado usuario: admin
2026-01-18 04:31:49 [http-nio-8080-exec-4] INFO  j.s.s.servicios.UsuarioServicio - üîê Rol: ADMIN
2026-01-18 04:31:49 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - üîê Activo: true
2026-01-18 04:31:49 [http-nio-8080-exec-4] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Authenticated user
2026-01-18 04:31:49 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.s.ChangeSessionIdAuthenticationStrategy - Changed session id from 8F9047DFCE04EF1A68C4F291D86FDC0B
2026-01-18 04:31:49 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.CsrfAuthenticationStrategy - Replaced CSRF Token
2026-01-18 04:31:49 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Stored SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=8F9047DFCE04EF1A68C4F291D86FDC0B], Granted Authorities=[ROLE_ADMIN]]] to HttpSession [org.apache.catalina.session.StandardSessionFacade@16e4ebba]
2026-01-18 04:31:49 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.UsernamePasswordAuthenticationFilter - Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=8F9047DFCE04EF1A68C4F291D86FDC0B], Granted Authorities=[ROLE_ADMIN]]
2026-01-18 04:31:49 [http-nio-8080-exec-4] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /principal
2026-01-18 04:31:49 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-18 04:31:49 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=8F9047DFCE04EF1A68C4F291D86FDC0B], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:31:49 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-18 04:31:49 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-18 04:31:49 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: rest.localhost
2026-01-18 04:31:49 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: rest
2026-01-18 04:31:49 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:31:49 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [rest]
2026-01-18 04:31:49 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 39
2026-01-18 04:31:49 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: rest)
2026-01-18 04:31:49 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-18 04:31:49 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-18 04:31:49 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:31:49 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:31:49 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:31:49 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:31:49 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:31:49 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-18 04:31:49 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 3
2026-01-18 04:31:49 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:31:49 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:31:49 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:31:49 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:31:49 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:31:49 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:31:49 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:31:49 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:31:49 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:31:49 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:31:49 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: false (Empresa ID: 3)
2026-01-18 04:31:49 [http-nio-8080-exec-5] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-16 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-18 04:31:49 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 39, Tenant anterior: 3
2026-01-18 04:31:49 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 39, Request: /principal, Empresa ID anterior: 3
2026-01-18 04:31:49 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:31:49 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=8F9047DFCE04EF1A68C4F291D86FDC0B], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:31:49 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:31:49 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/obligatorio, M√©todo: GET
2026-01-18 04:31:49 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: rest.localhost
2026-01-18 04:31:49 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: rest
2026-01-18 04:31:49 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:31:49 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [rest]
2026-01-18 04:31:49 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 40
2026-01-18 04:31:49 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: rest)
2026-01-18 04:31:49 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-18 04:31:49 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-18 04:31:49 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:31:49 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:31:49 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:31:49 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:31:49 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:31:49 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-18 04:31:49 [http-nio-8080-exec-6] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚è∞ GET /cierres/obligatorio - Verificando cierre obligatorio
2026-01-18 04:31:49 [http-nio-8080-exec-6] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Hora actual: 4:00, Fecha: 2026-01-18
2026-01-18 04:31:49 [http-nio-8080-exec-6] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Fecha proporcionada: 2026-01-16
2026-01-18 04:31:49 [http-nio-8080-exec-6] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚ö†Ô∏è Cierre obligatorio requerido para fecha: 2026-01-16
2026-01-18 04:31:49 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 40, Tenant anterior: 3
2026-01-18 04:31:49 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 40, Request: /cierres/obligatorio, Empresa ID anterior: 3
2026-01-18 04:31:49 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-18 04:31:49 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=8F9047DFCE04EF1A68C4F291D86FDC0B], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:31:49 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-18 04:31:49 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-18 04:31:49 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: rest.localhost
2026-01-18 04:31:49 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: rest
2026-01-18 04:31:49 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:31:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [rest]
2026-01-18 04:31:49 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 41
2026-01-18 04:31:49 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: rest)
2026-01-18 04:31:49 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-18 04:31:49 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-18 04:31:49 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:31:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:31:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:31:49 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:31:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:31:49 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-18 04:31:49 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 3
2026-01-18 04:31:49 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:31:49 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:31:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:31:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:31:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:31:49 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:31:49 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:31:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:31:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:31:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:31:49 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: false (Empresa ID: 3)
2026-01-18 04:31:49 [http-nio-8080-exec-7] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-16 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-18 04:31:49 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 41, Tenant anterior: 3
2026-01-18 04:31:49 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 41, Request: /favicon.ico, Empresa ID anterior: 3
2026-01-18 04:31:49 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:31:49 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=8F9047DFCE04EF1A68C4F291D86FDC0B], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:31:49 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:31:49 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/obligatorio, M√©todo: GET
2026-01-18 04:31:49 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üåê Server Name: rest.localhost
2026-01-18 04:31:49 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: rest
2026-01-18 04:31:49 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:31:49 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [rest]
2026-01-18 04:31:49 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 42
2026-01-18 04:31:49 [http-nio-8080-exec-8] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: rest)
2026-01-18 04:31:49 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-18 04:31:49 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-18 04:31:49 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:31:49 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:31:49 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:31:49 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:31:49 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:31:49 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-18 04:31:49 [http-nio-8080-exec-8] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚è∞ GET /cierres/obligatorio - Verificando cierre obligatorio
2026-01-18 04:31:49 [http-nio-8080-exec-8] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Hora actual: 4:00, Fecha: 2026-01-18
2026-01-18 04:31:49 [http-nio-8080-exec-8] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Fecha proporcionada: 2026-01-16
2026-01-18 04:31:49 [http-nio-8080-exec-8] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚ö†Ô∏è Cierre obligatorio requerido para fecha: 2026-01-16
2026-01-18 04:31:49 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 42, Tenant anterior: 3
2026-01-18 04:31:49 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 42, Request: /cierres/obligatorio, Empresa ID anterior: 3
2026-01-18 04:32:19 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:32:19 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=8F9047DFCE04EF1A68C4F291D86FDC0B], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:32:19 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:32:19 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/obligatorio, M√©todo: GET
2026-01-18 04:32:19 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: rest.localhost
2026-01-18 04:32:19 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: rest
2026-01-18 04:32:19 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:32:19 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [rest]
2026-01-18 04:32:19 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 44
2026-01-18 04:32:19 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: rest)
2026-01-18 04:32:19 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-18 04:32:19 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-18 04:32:19 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:32:19 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:32:19 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:32:19 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:32:19 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:32:19 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-18 04:32:19 [http-nio-8080-exec-10] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚è∞ GET /cierres/obligatorio - Verificando cierre obligatorio
2026-01-18 04:32:19 [http-nio-8080-exec-10] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Hora actual: 4:00, Fecha: 2026-01-18
2026-01-18 04:32:19 [http-nio-8080-exec-10] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Fecha proporcionada: 2026-01-16
2026-01-18 04:32:19 [http-nio-8080-exec-10] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚ö†Ô∏è Cierre obligatorio requerido para fecha: 2026-01-16
2026-01-18 04:32:19 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 44, Tenant anterior: 3
2026-01-18 04:32:19 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 44, Request: /cierres/obligatorio, Empresa ID anterior: 3
2026-01-18 04:32:19 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-18 04:32:19 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=8F9047DFCE04EF1A68C4F291D86FDC0B], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:32:19 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-18 04:32:19 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-18 04:32:19 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üåê Server Name: rest.localhost
2026-01-18 04:32:19 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: rest
2026-01-18 04:32:19 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:32:19 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [rest]
2026-01-18 04:32:19 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 35
2026-01-18 04:32:19 [http-nio-8080-exec-1] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: rest)
2026-01-18 04:32:19 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-18 04:32:19 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-18 04:32:19 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:32:19 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:32:19 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:32:19 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:32:19 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:32:19 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-18 04:32:19 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 3
2026-01-18 04:32:19 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:32:19 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:32:19 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:32:19 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:32:19 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:32:19 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:32:19 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:32:19 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:32:19 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:32:19 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:32:19 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: true (Empresa ID: 3)
2026-01-18 04:32:19 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-16 cerrado correctamente
2026-01-18 04:32:19 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 35, Tenant anterior: 3
2026-01-18 04:32:19 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 35, Request: /favicon.ico, Empresa ID anterior: 3
2026-01-18 04:32:19 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /error
2026-01-18 04:32:19 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /error
2026-01-18 04:32:19 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=8F9047DFCE04EF1A68C4F291D86FDC0B], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:32:19 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:32:19 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=8F9047DFCE04EF1A68C4F291D86FDC0B], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:32:19 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:32:19 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/obligatorio, M√©todo: GET
2026-01-18 04:32:19 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üåê Server Name: rest.localhost
2026-01-18 04:32:19 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: rest
2026-01-18 04:32:19 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:32:19 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [rest]
2026-01-18 04:32:19 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 36
2026-01-18 04:32:19 [http-nio-8080-exec-2] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: rest)
2026-01-18 04:32:19 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-18 04:32:19 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-18 04:32:19 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:32:19 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:32:19 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:32:19 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:32:19 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:32:19 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-18 04:32:19 [http-nio-8080-exec-2] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚è∞ GET /cierres/obligatorio - Verificando cierre obligatorio
2026-01-18 04:32:19 [http-nio-8080-exec-2] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Hora actual: 4:00, Fecha: 2026-01-18
2026-01-18 04:32:19 [http-nio-8080-exec-2] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Fecha proporcionada: 2026-01-16
2026-01-18 04:32:19 [http-nio-8080-exec-2] INFO  j.s.s.c.CierreInventarioDiarioControlador - ‚ö†Ô∏è Cierre obligatorio requerido para fecha: 2026-01-16
2026-01-18 04:32:20 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 36, Tenant anterior: 3
2026-01-18 04:32:20 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 36, Request: /cierres/obligatorio, Empresa ID anterior: 3
2026-01-18 04:32:24 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /
2026-01-18 04:32:24 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /
2026-01-18 04:32:24 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /, M√©todo: GET
2026-01-18 04:32:24 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: rest.localhost
2026-01-18 04:32:24 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: rest
2026-01-18 04:32:24 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:32:24 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [rest]
2026-01-18 04:32:24 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 37
2026-01-18 04:32:24 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: rest)
2026-01-18 04:32:24 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=8F9047DFCE04EF1A68C4F291D86FDC0B], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:32:24 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-18 04:32:24 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-18 04:32:24 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:32:24 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:32:24 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:32:24 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:32:24 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:32:24 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-18 04:32:24 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /, Empresa ID: 3
2026-01-18 04:32:24 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:32:24 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:32:24 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:32:24 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:32:24 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:32:24 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:32:24 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:32:24 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:32:24 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:32:24 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:32:24 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: true (Empresa ID: 3)
2026-01-18 04:32:24 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-16 cerrado correctamente
2026-01-18 04:32:24 [http-nio-8080-exec-3] INFO  j.s.s.controladores.InicioController - üîÄ GET / - Redirigiendo a /login
2026-01-18 04:32:24 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 37, Tenant anterior: 3
2026-01-18 04:32:24 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 37, Request: /, Empresa ID anterior: 3
2026-01-18 04:32:24 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login
2026-01-18 04:32:24 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login
2026-01-18 04:32:24 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-18 04:32:24 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: rest.localhost
2026-01-18 04:32:24 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: rest
2026-01-18 04:32:24 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:32:24 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [rest]
2026-01-18 04:32:24 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 38
2026-01-18 04:32:24 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: rest)
2026-01-18 04:32:24 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=8F9047DFCE04EF1A68C4F291D86FDC0B], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:32:24 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-18 04:32:24 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-18 04:32:24 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:32:24 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:32:24 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:32:24 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:32:24 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:32:24 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-18 04:32:24 [http-nio-8080-exec-4] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-18 04:32:24 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 38, Tenant anterior: 3
2026-01-18 04:32:24 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 38, Request: /login, Empresa ID anterior: 3
2026-01-18 04:32:29 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-18 04:32:29 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: admin para la empresa ID: null
2026-01-18 04:32:29 [http-nio-8080-exec-5] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: rest
2026-01-18 04:32:29 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:32:29 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [rest]
2026-01-18 04:32:29 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: rest | Empresa ID: 3 | Empresa Nombre: rest
2026-01-18 04:32:29 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:32:29 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:32:29 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:32:29 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:32:29 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:32:29 [http-nio-8080-exec-5] INFO  j.s.s.servicios.UsuarioServicio - üîê Encontrado usuario: admin
2026-01-18 04:32:29 [http-nio-8080-exec-5] INFO  j.s.s.servicios.UsuarioServicio - üîê Rol: ADMIN
2026-01-18 04:32:29 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - üîê Activo: true
2026-01-18 04:32:29 [http-nio-8080-exec-5] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Authenticated user
2026-01-18 04:32:29 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.s.ChangeSessionIdAuthenticationStrategy - Changed session id from DB115E5A9566854444631DDAA3411084
2026-01-18 04:32:29 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.CsrfAuthenticationStrategy - Replaced CSRF Token
2026-01-18 04:32:29 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Stored SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=DB115E5A9566854444631DDAA3411084], Granted Authorities=[ROLE_ADMIN]]] to HttpSession [org.apache.catalina.session.StandardSessionFacade@16e4ebba]
2026-01-18 04:32:29 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.UsernamePasswordAuthenticationFilter - Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=DB115E5A9566854444631DDAA3411084], Granted Authorities=[ROLE_ADMIN]]
2026-01-18 04:32:29 [http-nio-8080-exec-5] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /principal
2026-01-18 04:32:29 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-18 04:32:29 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=DB115E5A9566854444631DDAA3411084], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:32:29 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-18 04:32:29 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-18 04:32:29 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: rest.localhost
2026-01-18 04:32:29 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: rest
2026-01-18 04:32:29 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:32:29 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [rest]
2026-01-18 04:32:29 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 40
2026-01-18 04:32:29 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: rest)
2026-01-18 04:32:29 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-18 04:32:29 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-18 04:32:29 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:32:29 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:32:29 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:32:29 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:32:29 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:32:29 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-18 04:32:29 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 3
2026-01-18 04:32:29 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:32:29 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:32:29 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:32:29 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:32:29 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:32:29 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:32:29 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:32:29 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:32:29 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:32:29 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:32:29 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: true (Empresa ID: 3)
2026-01-18 04:32:29 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-16 cerrado correctamente
2026-01-18 04:32:29 [http-nio-8080-exec-6] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-18
2026-01-18 04:32:29 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-18 04:32:29 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:32:29 [http-nio-8080-exec-6] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-18
2026-01-18 04:32:29 [http-nio-8080-exec-6] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-18 04:32:29 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 40, Tenant anterior: 3
2026-01-18 04:32:29 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 40, Request: /principal, Empresa ID anterior: 3
2026-01-18 04:32:53 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /facturas/facturar
2026-01-18 04:32:53 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=DB115E5A9566854444631DDAA3411084], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:32:53 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /facturas/facturar
2026-01-18 04:32:53 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /facturas/facturar, M√©todo: GET
2026-01-18 04:32:53 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: rest.localhost
2026-01-18 04:32:53 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: rest
2026-01-18 04:32:53 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:32:53 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [rest]
2026-01-18 04:32:53 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 41
2026-01-18 04:32:53 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: rest)
2026-01-18 04:32:53 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-18 04:32:53 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-18 04:32:53 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:32:53 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:32:53 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:32:53 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:32:53 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:32:53 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-18 04:32:53 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /facturas/facturar, Empresa ID: 3
2026-01-18 04:32:53 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:32:53 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:32:53 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:32:53 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:32:53 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:32:53 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:32:53 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:32:53 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:32:53 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:32:53 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:32:53 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: true (Empresa ID: 3)
2026-01-18 04:32:53 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-16 cerrado correctamente
2026-01-18 04:32:53 [http-nio-8080-exec-7] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador.mostrarPuntoVenta(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador]
2026-01-18 04:32:53 [http-nio-8080-exec-7] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Failed to authorize ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador.mostrarPuntoVenta(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador] with authorization manager org.springframework.security.authorization.method.PreAuthorizeAuthorizationManager@6b8804bb and result ExpressionAuthorizationDecision [granted=false, expressionAttribute=hasRole('CAJERO')]
2026-01-18 04:32:53 [http-nio-8080-exec-7] ERROR j.s.s.context.TenantFilter - ‚ùå Error en TenantFilter: Request processing failed: org.springframework.security.authorization.AuthorizationDeniedException: Access Denied
jakarta.servlet.ServletException: Request processing failed: org.springframework.security.authorization.AuthorizationDeniedException: Access Denied
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1022)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at jpd.sistemafacinv.sistemadefacturacioneinventario.context.TenantFilter.doFilter(TenantFilter.java:123)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at jpd.sistemafacinv.sistemadefacturacioneinventario.context.TenantContextCleanupFilter.doFilter(TenantContextCleanupFilter.java:45)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:365)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:101)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:125)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:119)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:235)
	at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:229)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.csrf.CsrfFilter.doFilterInternal(CsrfFilter.java:117)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.ServletRequestPathFilter.doFilter(ServletRequestPathFilter.java:52)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebSecurityConfiguration.java:319)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$4(HandlerMappingIntrospector.java:267)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:240)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:362)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:278)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:88)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:113)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:83)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:72)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:399)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1774)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:973)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:491)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:840)
Caused by: org.springframework.security.authorization.AuthorizationDeniedException: Access Denied
	at org.springframework.security.authorization.method.ThrowingMethodAuthorizationDeniedHandler.handleDeniedInvocation(ThrowingMethodAuthorizationDeniedHandler.java:38)
	at org.springframework.security.authorization.method.PreAuthorizeAuthorizationManager.handleDeniedInvocation(PreAuthorizeAuthorizationManager.java:108)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.handle(AuthorizationManagerBeforeMethodInterceptor.java:287)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.attemptAuthorization(AuthorizationManagerBeforeMethodInterceptor.java:260)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.invoke(AuthorizationManagerBeforeMethodInterceptor.java:196)
	at org.springframework.security.config.annotation.method.configuration.DeferringMethodInterceptor.invoke(DeferringMethodInterceptor.java:44)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728)
	at jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador$$SpringCGLIB$$0.mostrarPuntoVenta(<generated>)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	... 99 common frames omitted
2026-01-18 04:32:53 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 41, Tenant anterior: 3
2026-01-18 04:32:53 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 41, Request: /facturas/facturar, Empresa ID anterior: 3
2026-01-18 04:32:53 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AccessDeniedHandlerImpl - Forwarding to /acceso-denegado with status code 403
2026-01-18 04:32:53 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /acceso-denegado
2026-01-18 04:32:53 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /acceso-denegado
2026-01-18 04:32:53 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /acceso-denegado, Empresa ID: null
2026-01-18 04:32:53 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì Interceptando acceso-denegado - EMPRESA: null
2026-01-18 04:32:53 [http-nio-8080-exec-7] WARN  j.s.s.controladores.InicioController - ‚õî GET /acceso-denigado - Mostrando p√°gina de acceso denegado
2026-01-18 04:32:55 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-18 04:32:55 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=DB115E5A9566854444631DDAA3411084], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:32:55 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-18 04:32:55 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-18 04:32:55 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üåê Server Name: rest.localhost
2026-01-18 04:32:55 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: rest
2026-01-18 04:32:55 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:32:55 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [rest]
2026-01-18 04:32:55 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 42
2026-01-18 04:32:55 [http-nio-8080-exec-8] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: rest)
2026-01-18 04:32:55 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-18 04:32:55 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-18 04:32:55 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:32:55 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:32:55 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:32:55 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:32:55 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:32:55 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-18 04:32:55 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 3
2026-01-18 04:32:55 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:32:55 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:32:55 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:32:55 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:32:55 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:32:55 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:32:55 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:32:55 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:32:55 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:32:55 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:32:55 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: true (Empresa ID: 3)
2026-01-18 04:32:55 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-16 cerrado correctamente
2026-01-18 04:32:55 [http-nio-8080-exec-8] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-18
2026-01-18 04:32:55 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-18 04:32:55 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:32:55 [http-nio-8080-exec-8] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-18
2026-01-18 04:32:55 [http-nio-8080-exec-8] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-18 04:32:55 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 42, Tenant anterior: 3
2026-01-18 04:32:55 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 42, Request: /principal, Empresa ID anterior: 3
2026-01-18 04:32:59 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios
2026-01-18 04:32:59 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=DB115E5A9566854444631DDAA3411084], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:32:59 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios
2026-01-18 04:32:59 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios, M√©todo: GET
2026-01-18 04:32:59 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: rest.localhost
2026-01-18 04:32:59 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: rest
2026-01-18 04:32:59 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:32:59 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [rest]
2026-01-18 04:32:59 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 43
2026-01-18 04:32:59 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: rest)
2026-01-18 04:32:59 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-18 04:32:59 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-18 04:32:59 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:32:59 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:32:59 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:32:59 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:32:59 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:32:59 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-18 04:32:59 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios, Empresa ID: 3
2026-01-18 04:32:59 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:32:59 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:32:59 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:32:59 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:32:59 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:32:59 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:32:59 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:32:59 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:32:59 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:32:59 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:32:59 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: true (Empresa ID: 3)
2026-01-18 04:32:59 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-16 cerrado correctamente
2026-01-18 04:32:59 [http-nio-8080-exec-9] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-18 04:32:59 [http-nio-8080-exec-9] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-18 04:32:59 [http-nio-8080-exec-9] INFO  j.s.s.c.UsuarioControlador - üìã GET /admin/usuarios - Listando usuarios
2026-01-18 04:32:59 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Listando usuarios para empresa ID: 3
2026-01-18 04:32:59 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-18 04:32:59 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:32:59 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:32:59 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:32:59 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 43, Tenant anterior: 3
2026-01-18 04:32:59 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /admin/usuarios, Empresa ID anterior: 3
2026-01-18 04:33:03 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios/nuevo
2026-01-18 04:33:03 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=DB115E5A9566854444631DDAA3411084], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:33:03 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios/nuevo
2026-01-18 04:33:03 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios/nuevo, M√©todo: GET
2026-01-18 04:33:03 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: rest.localhost
2026-01-18 04:33:03 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: rest
2026-01-18 04:33:03 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:33:03 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [rest]
2026-01-18 04:33:03 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 44
2026-01-18 04:33:03 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: rest)
2026-01-18 04:33:03 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-18 04:33:03 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-18 04:33:03 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:33:03 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:33:03 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:33:03 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:33:03 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:33:03 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-18 04:33:03 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios/nuevo, Empresa ID: 3
2026-01-18 04:33:03 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:33:03 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:33:03 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:33:03 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:33:03 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:33:03 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:33:03 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:33:03 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:33:03 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:33:03 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:33:03 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: true (Empresa ID: 3)
2026-01-18 04:33:03 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-16 cerrado correctamente
2026-01-18 04:33:03 [http-nio-8080-exec-10] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.mostrarFormularioCrear(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-18 04:33:03 [http-nio-8080-exec-10] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.mostrarFormularioCrear(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-18 04:33:03 [http-nio-8080-exec-10] INFO  j.s.s.c.UsuarioControlador - üìù GET /admin/usuarios/nuevo - Mostrando formulario crear usuario
2026-01-18 04:33:03 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 44, Tenant anterior: 3
2026-01-18 04:33:03 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 44, Request: /admin/usuarios/nuevo, Empresa ID anterior: 3
2026-01-18 04:33:18 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing POST /admin/usuarios/guardar
2026-01-18 04:33:18 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=DB115E5A9566854444631DDAA3411084], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:33:18 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured POST /admin/usuarios/guardar
2026-01-18 04:33:18 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios/guardar, M√©todo: POST
2026-01-18 04:33:18 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üåê Server Name: rest.localhost
2026-01-18 04:33:18 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: rest
2026-01-18 04:33:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:33:18 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [rest]
2026-01-18 04:33:18 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 35
2026-01-18 04:33:18 [http-nio-8080-exec-1] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: rest)
2026-01-18 04:33:18 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-18 04:33:18 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-18 04:33:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:33:18 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:33:18 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:33:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:33:18 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:33:18 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-18 04:33:18 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios/guardar, Empresa ID: 3
2026-01-18 04:33:18 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:33:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:33:18 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:33:18 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:33:18 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:33:18 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:33:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:33:18 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:33:18 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:33:18 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:33:18 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: true (Empresa ID: 3)
2026-01-18 04:33:18 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-16 cerrado correctamente
2026-01-18 04:33:18 [http-nio-8080-exec-1] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.guardarUsuario(jpd.sistemafacinv.sistemadefacturacioneinventario.modelos.Usuario,java.lang.String,org.springframework.web.servlet.mvc.support.RedirectAttributes); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-18 04:33:18 [http-nio-8080-exec-1] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.guardarUsuario(jpd.sistemafacinv.sistemadefacturacioneinventario.modelos.Usuario,java.lang.String,org.springframework.web.servlet.mvc.support.RedirectAttributes); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-18 04:33:18 [http-nio-8080-exec-1] INFO  j.s.s.c.UsuarioControlador - üíæ POST /admin/usuarios/guardar - Creando usuario: cajero
2026-01-18 04:33:18 [http-nio-8080-exec-1] DEBUG j.s.s.c.UsuarioControlador - Datos usuario - Rol: CAJERO, Activo: true
2026-01-18 04:33:18 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Creando usuario: cajero para empresa ID: 3
2026-01-18 04:33:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        u1_0.nombre_usuario=? 
        and e1_0.id=? 
    limit
        ?
2026-01-18 04:33:18 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [cajero]
2026-01-18 04:33:18 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:33:18 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:INTEGER) <- [1]
2026-01-18 04:33:18 [http-nio-8080-exec-1] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@202647221 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2] read-only
2026-01-18 04:33:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:33:18 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:33:18 [http-nio-8080-exec-1] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@202647221 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2]
2026-01-18 04:33:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        usuario
        (activo, contrasenna, empresa_id, nombre_usuario, rol, sucursal_id) 
    values
        (?, ?, ?, ?, ?, ?)
2026-01-18 04:33:18 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-18 04:33:18 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [$2a$10$4bhEzzoyFNTYrzKL4MErhuaX3EU7FeemGiXFLEAMrtAedxYw8XM2u]
2026-01-18 04:33:18 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:33:18 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [cajero]
2026-01-18 04:33:18 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [CAJERO]
2026-01-18 04:33:18 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:BIGINT) <- [null]
2026-01-18 04:33:18 [http-nio-8080-exec-1] INFO  j.s.s.servicios.UsuarioServicio - Usuario creado exitosamente: cajero con ID: 7
2026-01-18 04:33:18 [http-nio-8080-exec-1] INFO  j.s.s.c.UsuarioControlador - ‚úÖ Usuario creado exitosamente: cajero (ID: 7)
2026-01-18 04:33:18 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 35, Tenant anterior: 3
2026-01-18 04:33:18 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 35, Request: /admin/usuarios/guardar, Empresa ID anterior: 3
2026-01-18 04:33:18 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios
2026-01-18 04:33:18 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=DB115E5A9566854444631DDAA3411084], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:33:18 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios
2026-01-18 04:33:18 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios, M√©todo: GET
2026-01-18 04:33:18 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üåê Server Name: rest.localhost
2026-01-18 04:33:18 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: rest
2026-01-18 04:33:18 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:33:18 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [rest]
2026-01-18 04:33:18 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 36
2026-01-18 04:33:18 [http-nio-8080-exec-2] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: rest)
2026-01-18 04:33:18 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-18 04:33:18 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-18 04:33:18 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:33:18 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:33:18 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:33:18 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:33:18 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:33:18 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-18 04:33:18 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios, Empresa ID: 3
2026-01-18 04:33:18 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:33:18 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:33:18 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:33:18 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:33:18 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:33:18 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:33:18 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:33:18 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:33:18 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:33:18 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:33:18 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: true (Empresa ID: 3)
2026-01-18 04:33:18 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-16 cerrado correctamente
2026-01-18 04:33:18 [http-nio-8080-exec-2] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-18 04:33:18 [http-nio-8080-exec-2] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-18 04:33:18 [http-nio-8080-exec-2] INFO  j.s.s.c.UsuarioControlador - üìã GET /admin/usuarios - Listando usuarios
2026-01-18 04:33:18 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - Listando usuarios para empresa ID: 3
2026-01-18 04:33:18 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-18 04:33:18 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:33:18 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:33:18 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:33:18 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 36, Tenant anterior: 3
2026-01-18 04:33:18 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 36, Request: /admin/usuarios, Empresa ID anterior: 3
2026-01-18 04:33:21 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-18 04:33:21 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=DB115E5A9566854444631DDAA3411084], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:33:21 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-18 04:33:21 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-18 04:33:21 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: rest.localhost
2026-01-18 04:33:21 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: rest
2026-01-18 04:33:21 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:33:21 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [rest]
2026-01-18 04:33:21 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 37
2026-01-18 04:33:21 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: rest)
2026-01-18 04:33:21 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-18 04:33:21 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-18 04:33:21 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:33:21 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-18 04:33:21 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:33:21 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:33:21 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:33:21 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-18 04:33:21 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 3
2026-01-18 04:33:21 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:33:21 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:33:21 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:33:21 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:33:21 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:33:21 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:33:21 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:33:21 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:33:21 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:33:21 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:33:21 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: true (Empresa ID: 3)
2026-01-18 04:33:21 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-16 cerrado correctamente
2026-01-18 04:33:21 [http-nio-8080-exec-3] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-18
2026-01-18 04:33:21 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-18 04:33:21 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:33:21 [http-nio-8080-exec-3] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-18
2026-01-18 04:33:21 [http-nio-8080-exec-3] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-18 04:33:21 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 37, Tenant anterior: 3
2026-01-18 04:33:21 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 37, Request: /principal, Empresa ID anterior: 3
2026-01-18 04:33:23 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing POST /logout
2026-01-18 04:33:23 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=DB115E5A9566854444631DDAA3411084], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:33:23 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.logout.LogoutFilter - Logging out [UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=DB115E5A9566854444631DDAA3411084], Granted Authorities=[ROLE_ADMIN]]]
2026-01-18 04:33:23 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.l.SecurityContextLogoutHandler - Invalidated session 5CCCF912D14EBF00BC3F1214B4802746
2026-01-18 04:33:23 [http-nio-8080-exec-4] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /login?logout
2026-01-18 04:33:23 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login?logout
2026-01-18 04:33:23 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login?logout
2026-01-18 04:33:23 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-18 04:33:23 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: rest.localhost
2026-01-18 04:33:23 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: rest
2026-01-18 04:33:23 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:33:23 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [rest]
2026-01-18 04:33:23 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 39
2026-01-18 04:33:23 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: rest)
2026-01-18 04:33:23 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-18 04:33:23 [http-nio-8080-exec-5] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-18 04:33:23 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 39, Tenant anterior: 3
2026-01-18 04:33:23 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 39, Request: /login, Empresa ID anterior: 3
2026-01-18 04:33:29 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-18 04:33:29 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: cajero para la empresa ID: null
2026-01-18 04:33:29 [http-nio-8080-exec-6] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: cajero | Subdominio: rest
2026-01-18 04:33:29 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:33:29 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [rest]
2026-01-18 04:33:29 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: cajero | Subdominio: rest | Empresa ID: 3 | Empresa Nombre: rest
2026-01-18 04:33:29 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:33:29 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [cajero]
2026-01-18 04:33:29 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:33:29 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:33:29 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:33:29 [http-nio-8080-exec-6] INFO  j.s.s.servicios.UsuarioServicio - üîê Encontrado usuario: cajero
2026-01-18 04:33:29 [http-nio-8080-exec-6] INFO  j.s.s.servicios.UsuarioServicio - üîê Rol: CAJERO
2026-01-18 04:33:29 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - üîê Activo: true
2026-01-18 04:33:29 [http-nio-8080-exec-6] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Authenticated user
2026-01-18 04:33:29 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.s.ChangeSessionIdAuthenticationStrategy - Changed session id from CD7012F06CC45125F102D648DAD87485
2026-01-18 04:33:29 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.CsrfAuthenticationStrategy - Replaced CSRF Token
2026-01-18 04:33:29 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Stored SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=cajero, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=CD7012F06CC45125F102D648DAD87485], Granted Authorities=[ROLE_CAJERO]]] to HttpSession [org.apache.catalina.session.StandardSessionFacade@3e8259bc]
2026-01-18 04:33:29 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.UsernamePasswordAuthenticationFilter - Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=cajero, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=CD7012F06CC45125F102D648DAD87485], Granted Authorities=[ROLE_CAJERO]]
2026-01-18 04:33:29 [http-nio-8080-exec-6] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /principal
2026-01-18 04:33:29 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-18 04:33:29 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=cajero, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=CD7012F06CC45125F102D648DAD87485], Granted Authorities=[ROLE_CAJERO]]]
2026-01-18 04:33:29 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-18 04:33:29 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-18 04:33:29 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: rest.localhost
2026-01-18 04:33:29 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: rest
2026-01-18 04:33:29 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:33:29 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [rest]
2026-01-18 04:33:29 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 41
2026-01-18 04:33:29 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: rest)
2026-01-18 04:33:29 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: cajero
2026-01-18 04:33:29 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: cajero en empresa ID: 3
2026-01-18 04:33:29 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:33:29 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [cajero]
2026-01-18 04:33:29 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:33:29 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:33:29 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:33:29 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario cajero validado para empresa 3
2026-01-18 04:33:29 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 3
2026-01-18 04:33:29 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:33:29 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:33:29 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:33:29 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:33:29 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:33:29 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:33:29 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:33:29 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:33:29 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:33:29 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:33:29 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: true (Empresa ID: 3)
2026-01-18 04:33:29 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-16 cerrado correctamente
2026-01-18 04:33:29 [http-nio-8080-exec-7] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-18
2026-01-18 04:33:29 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-18 04:33:29 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:33:29 [http-nio-8080-exec-7] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-18
2026-01-18 04:33:29 [http-nio-8080-exec-7] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-18 04:33:29 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 41, Tenant anterior: 3
2026-01-18 04:33:29 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 41, Request: /principal, Empresa ID anterior: 3
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /facturas/facturar
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=cajero, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=CD7012F06CC45125F102D648DAD87485], Granted Authorities=[ROLE_CAJERO]]]
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /facturas/facturar
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /facturas/facturar, M√©todo: GET
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üåê Server Name: rest.localhost
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: rest
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:33:31 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [rest]
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 42
2026-01-18 04:33:31 [http-nio-8080-exec-8] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: rest)
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: cajero
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: cajero en empresa ID: 3
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:33:31 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [cajero]
2026-01-18 04:33:31 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:33:31 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario cajero validado para empresa 3
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /facturas/facturar, Empresa ID: 3
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:33:31 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:33:31 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:33:31 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:33:31 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:33:31 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:33:31 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: true (Empresa ID: 3)
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-16 cerrado correctamente
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador.mostrarPuntoVenta(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador]
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador.mostrarPuntoVenta(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador]
2026-01-18 04:33:31 [http-nio-8080-exec-8] INFO  j.s.s.c.FacturaControlador - üí∞ GET /facturas/facturar - Mostrando punto de venta (CAJERO)
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-18 04:33:31 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.ClienteServicio - Listando clientes para empresa ID: 3
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        c1_0.id,
        c1_0.activo,
        c1_0.correo,
        c1_0.empresa_id,
        c1_0.identificacion,
        c1_0.nombre,
        c1_0.telefono 
    from
        cliente c1_0 
    left join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    where
        e1_0.id=?
2026-01-18 04:33:31 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:33:31 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.ClienteServicio - Encontrados 1 clientes para empresa ID: 3
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.ProductoServicio - Listando productos para empresa ID: 3
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        p1_0.receta_id,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta 
    from
        producto p1_0 
    left join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        e1_0.id=?
2026-01-18 04:33:31 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.ProductoServicio - Encontrados 0 productos para empresa ID: 3
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.ClienteServicio - Listando clientes para empresa ID: 3
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        c1_0.id,
        c1_0.activo,
        c1_0.correo,
        c1_0.empresa_id,
        c1_0.identificacion,
        c1_0.nombre,
        c1_0.telefono 
    from
        cliente c1_0 
    left join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    where
        e1_0.id=?
2026-01-18 04:33:31 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:33:31 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.ClienteServicio - Encontrados 1 clientes para empresa ID: 3
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.ProductoServicio - Listando productos para empresa ID: 3
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        p1_0.receta_id,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta 
    from
        producto p1_0 
    left join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        e1_0.id=?
2026-01-18 04:33:31 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.ProductoServicio - Encontrados 0 productos para empresa ID: 3
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG j.s.s.c.FacturaControlador - Punto de venta cargado - Clientes: 1, Productos: 0
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 42, Tenant anterior: 3
2026-01-18 04:33:31 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 42, Request: /facturas/facturar, Empresa ID anterior: 3
2026-01-18 04:33:37 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-18 04:33:37 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=cajero, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=CD7012F06CC45125F102D648DAD87485], Granted Authorities=[ROLE_CAJERO]]]
2026-01-18 04:33:37 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-18 04:33:37 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-18 04:33:37 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: rest.localhost
2026-01-18 04:33:37 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: rest
2026-01-18 04:33:37 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:33:37 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [rest]
2026-01-18 04:33:37 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 43
2026-01-18 04:33:37 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: rest)
2026-01-18 04:33:37 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: cajero
2026-01-18 04:33:37 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: cajero en empresa ID: 3
2026-01-18 04:33:37 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:33:37 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [cajero]
2026-01-18 04:33:37 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-18 04:33:37 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:33:37 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-18 04:33:37 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario cajero validado para empresa 3
2026-01-18 04:33:37 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 3
2026-01-18 04:33:37 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:33:37 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:33:37 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:33:37 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:33:37 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:33:37 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:33:37 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:33:37 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:33:37 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:33:37 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-18 04:33:37 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: true (Empresa ID: 3)
2026-01-18 04:33:37 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-16 cerrado correctamente
2026-01-18 04:33:37 [http-nio-8080-exec-9] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-18
2026-01-18 04:33:37 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-18 04:33:37 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:33:37 [http-nio-8080-exec-9] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-18
2026-01-18 04:33:37 [http-nio-8080-exec-9] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-18 04:33:37 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 43, Tenant anterior: 3
2026-01-18 04:33:37 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /principal, Empresa ID anterior: 3
2026-01-18 04:33:48 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing POST /logout
2026-01-18 04:33:48 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=cajero, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=CD7012F06CC45125F102D648DAD87485], Granted Authorities=[ROLE_CAJERO]]]
2026-01-18 04:33:48 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.logout.LogoutFilter - Logging out [UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=cajero, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=CD7012F06CC45125F102D648DAD87485], Granted Authorities=[ROLE_CAJERO]]]
2026-01-18 04:33:48 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.l.SecurityContextLogoutHandler - Invalidated session 6B56EA264A0AF9A24F7449CC569C67B9
2026-01-18 04:33:48 [http-nio-8080-exec-10] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /login?logout
2026-01-18 04:33:48 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login?logout
2026-01-18 04:33:48 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login?logout
2026-01-18 04:33:48 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-18 04:33:48 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üåê Server Name: rest.localhost
2026-01-18 04:33:48 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: rest
2026-01-18 04:33:48 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:33:48 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [rest]
2026-01-18 04:33:48 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 35
2026-01-18 04:33:48 [http-nio-8080-exec-1] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: rest)
2026-01-18 04:33:48 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-18 04:33:48 [http-nio-8080-exec-1] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-18 04:33:48 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 35, Tenant anterior: 3
2026-01-18 04:33:48 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 35, Request: /login, Empresa ID anterior: 3
2026-01-18 04:33:54 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /logout
2026-01-18 04:33:54 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=E86F546F47CA5FCC48B3E324F45AF3D2], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:33:54 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.logout.LogoutFilter - Logging out [UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=E86F546F47CA5FCC48B3E324F45AF3D2], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:33:54 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.l.SecurityContextLogoutHandler - Invalidated session 5ABA87CB1763FE5C70F16A946621254A
2026-01-18 04:33:54 [http-nio-8080-exec-2] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /login?logout
2026-01-18 04:33:54 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login?logout
2026-01-18 04:33:54 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login?logout
2026-01-18 04:33:54 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-18 04:33:54 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: localhost
2026-01-18 04:33:54 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: localhost
2026-01-18 04:33:54 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:33:54 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-18 04:33:54 [http-nio-8080-exec-3] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@588154227 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2] read-only
2026-01-18 04:33:54 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:33:54 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-18 04:33:54 [http-nio-8080-exec-3] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@588154227 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2]
2026-01-18 04:33:54 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 37
2026-01-18 04:33:54 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚ö†Ô∏è Usando empresa por defecto (localhost): 1 - Sistema por Defecto
2026-01-18 04:33:54 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-18 04:33:54 [http-nio-8080-exec-3] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-18 04:33:54 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 37, Tenant anterior: 1
2026-01-18 04:33:54 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 37, Request: /login, Empresa ID anterior: 1
2026-01-18 04:33:54 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-18 04:33:54 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-18 04:33:54 [http-nio-8080-exec-4] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to http://localhost:8080/login
2026-01-18 04:33:54 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login
2026-01-18 04:33:54 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login
2026-01-18 04:33:54 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-18 04:33:54 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: localhost
2026-01-18 04:33:54 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: localhost
2026-01-18 04:33:54 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:33:54 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-18 04:33:54 [http-nio-8080-exec-5] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@1513555746 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2] read-only
2026-01-18 04:33:54 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:33:54 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-18 04:33:54 [http-nio-8080-exec-5] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@1513555746 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2]
2026-01-18 04:33:54 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 39
2026-01-18 04:33:54 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚ö†Ô∏è Usando empresa por defecto (localhost): 1 - Sistema por Defecto
2026-01-18 04:33:54 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-18 04:33:54 [http-nio-8080-exec-5] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-18 04:33:54 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 39, Tenant anterior: 1
2026-01-18 04:33:54 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 39, Request: /login, Empresa ID anterior: 1
2026-01-18 04:33:58 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/login
2026-01-18 04:33:58 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/login
2026-01-18 04:33:58 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/login
2026-01-18 04:33:58 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/login, Empresa ID: null
2026-01-18 04:33:58 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/login
2026-01-18 04:33:58 [http-nio-8080-exec-6] INFO  j.s.s.c.SuperAdminController - üîì Mostrando p√°gina de login para SUPER_ADMIN
2026-01-18 04:33:58 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-18 04:33:58 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 40, Request: /superadmin/login, Empresa ID anterior: null
2026-01-18 04:33:58 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-18 04:33:58 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-18 04:33:58 [http-nio-8080-exec-7] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to http://localhost:8080/login
2026-01-18 04:33:58 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login
2026-01-18 04:33:58 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login
2026-01-18 04:33:58 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-18 04:33:58 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üåê Server Name: localhost
2026-01-18 04:33:58 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: localhost
2026-01-18 04:33:58 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:33:58 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-18 04:33:58 [http-nio-8080-exec-8] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@311580405 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2] read-only
2026-01-18 04:33:58 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:33:58 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-18 04:33:58 [http-nio-8080-exec-8] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@311580405 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2]
2026-01-18 04:33:58 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 42
2026-01-18 04:33:58 [http-nio-8080-exec-8] INFO  j.s.s.context.TenantFilter - ‚ö†Ô∏è Usando empresa por defecto (localhost): 1 - Sistema por Defecto
2026-01-18 04:33:58 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-18 04:33:58 [http-nio-8080-exec-8] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-18 04:33:58 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 42, Tenant anterior: 1
2026-01-18 04:33:58 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 42, Request: /login, Empresa ID anterior: 1
2026-01-18 04:34:07 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing POST /superadmin/login
2026-01-18 04:34:07 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: josepino para la empresa ID: null
2026-01-18 04:34:07 [http-nio-8080-exec-9] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: josepino | Subdominio: localhost
2026-01-18 04:34:07 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=?
2026-01-18 04:34:07 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [josepino]
2026-01-18 04:34:07 [http-nio-8080-exec-9] INFO  j.s.s.servicios.UsuarioServicio - ‚úÖ SUPER_ADMIN cargado: josepino - Rol: SUPER_ADMIN
2026-01-18 04:34:07 [http-nio-8080-exec-9] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Authenticated user
2026-01-18 04:34:07 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.s.ChangeSessionIdAuthenticationStrategy - Changed session id from 08E087A98C996FED5459F800C90A3F7D
2026-01-18 04:34:07 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.CsrfAuthenticationStrategy - Replaced CSRF Token
2026-01-18 04:34:07 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Stored SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=08E087A98C996FED5459F800C90A3F7D], Granted Authorities=[ROLE_SUPER_ADMIN]]] to HttpSession [org.apache.catalina.session.StandardSessionFacade@7a37e4e4]
2026-01-18 04:34:07 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.UsernamePasswordAuthenticationFilter - Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=08E087A98C996FED5459F800C90A3F7D], Granted Authorities=[ROLE_SUPER_ADMIN]]
2026-01-18 04:34:07 [http-nio-8080-exec-9] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /superadmin/dashboard
2026-01-18 04:34:07 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/dashboard
2026-01-18 04:34:07 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=08E087A98C996FED5459F800C90A3F7D], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:34:07 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/dashboard
2026-01-18 04:34:07 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/dashboard
2026-01-18 04:34:07 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/dashboard, Empresa ID: null
2026-01-18 04:34:07 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/dashboard
2026-01-18 04:34:07 [http-nio-8080-exec-10] INFO  j.s.s.c.SuperAdminController - üìä Accediendo al dashboard SUPER_ADMIN
2026-01-18 04:34:07 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 44, Request: /superadmin/dashboard, Empresa ID anterior: null
2026-01-18 04:34:07 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/empresas
2026-01-18 04:34:07 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=08E087A98C996FED5459F800C90A3F7D], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:34:07 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/empresas
2026-01-18 04:34:07 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/empresas
2026-01-18 04:34:07 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/empresas, Empresa ID: null
2026-01-18 04:34:07 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/empresas
2026-01-18 04:34:07 [http-nio-8080-exec-1] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@706069253 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2] read-only
2026-01-18 04:34:07 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0
2026-01-18 04:34:07 [http-nio-8080-exec-1] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@706069253 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2]
2026-01-18 04:34:07 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 35, Request: /superadmin/empresas, Empresa ID anterior: null
2026-01-18 04:34:07 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-18 04:34:07 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=08E087A98C996FED5459F800C90A3F7D], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:34:07 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-18 04:34:07 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-18 04:34:07 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üåê Server Name: localhost
2026-01-18 04:34:07 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: localhost
2026-01-18 04:34:07 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:34:07 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-18 04:34:07 [http-nio-8080-exec-2] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@375801616 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2] read-only
2026-01-18 04:34:07 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:34:07 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-18 04:34:07 [http-nio-8080-exec-2] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@375801616 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2]
2026-01-18 04:34:07 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 36
2026-01-18 04:34:07 [http-nio-8080-exec-2] INFO  j.s.s.context.TenantFilter - ‚ö†Ô∏è Usando empresa por defecto (localhost): 1 - Sistema por Defecto
2026-01-18 04:34:07 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: josepino
2026-01-18 04:34:07 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: josepino en empresa ID: 1
2026-01-18 04:34:07 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:34:07 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [josepino]
2026-01-18 04:34:07 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-18 04:34:07 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 1
2026-01-18 04:34:07 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:34:07 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:34:07 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:34:07 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:34:07 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:34:07 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:34:07 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:34:07 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:34:07 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:34:07 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:34:07 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: false (Empresa ID: 1)
2026-01-18 04:34:07 [http-nio-8080-exec-2] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-16 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-18 04:34:07 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 36, Tenant anterior: 1
2026-01-18 04:34:07 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 36, Request: /favicon.ico, Empresa ID anterior: 1
2026-01-18 04:34:07 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:34:07 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=08E087A98C996FED5459F800C90A3F7D], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:34:07 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AccessDeniedHandlerImpl - Forwarding to /acceso-denegado with status code 403
2026-01-18 04:34:07 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /acceso-denegado?fecha=2026-01-16
2026-01-18 04:34:07 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /acceso-denegado?fecha=2026-01-16
2026-01-18 04:34:07 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /acceso-denegado, Empresa ID: null
2026-01-18 04:34:07 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì Interceptando acceso-denegado - EMPRESA: null
2026-01-18 04:34:07 [http-nio-8080-exec-3] WARN  j.s.s.controladores.InicioController - ‚õî GET /acceso-denigado - Mostrando p√°gina de acceso denegado
2026-01-18 04:34:18 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/empresas/nueva
2026-01-18 04:34:18 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=08E087A98C996FED5459F800C90A3F7D], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:34:18 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/empresas/nueva
2026-01-18 04:34:18 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/empresas/nueva
2026-01-18 04:34:18 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/empresas/nueva, Empresa ID: null
2026-01-18 04:34:18 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/empresas/nueva
2026-01-18 04:34:18 [http-nio-8080-exec-4] INFO  j.s.s.c.SuperAdminController - üìÑ [CONTROLLER] Mostrando formulario para crear nueva empresa
2026-01-18 04:34:18 [http-nio-8080-exec-4] DEBUG j.s.s.c.SuperAdminController - üîß Preparando modelo con nuevo EmpresaClienteDTO
2026-01-18 04:34:18 [http-nio-8080-exec-4] INFO  j.s.s.c.SuperAdminController - ‚úÖ Formulario listo para mostrar
2026-01-18 04:34:18 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 38, Request: /superadmin/empresas/nueva, Empresa ID anterior: null
2026-01-18 04:34:18 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-18 04:34:18 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=08E087A98C996FED5459F800C90A3F7D], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:34:18 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-18 04:34:18 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-18 04:34:18 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: localhost
2026-01-18 04:34:18 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: localhost
2026-01-18 04:34:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:34:18 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-18 04:34:18 [http-nio-8080-exec-5] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@2068790307 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2] read-only
2026-01-18 04:34:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:34:18 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-18 04:34:18 [http-nio-8080-exec-5] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@2068790307 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2]
2026-01-18 04:34:18 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 39
2026-01-18 04:34:18 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚ö†Ô∏è Usando empresa por defecto (localhost): 1 - Sistema por Defecto
2026-01-18 04:34:18 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: josepino
2026-01-18 04:34:18 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: josepino en empresa ID: 1
2026-01-18 04:34:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:34:18 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [josepino]
2026-01-18 04:34:18 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-18 04:34:18 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 1
2026-01-18 04:34:18 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:34:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:34:18 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:34:18 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:34:18 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:34:18 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:34:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:34:18 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:34:18 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:34:18 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:34:18 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: false (Empresa ID: 1)
2026-01-18 04:34:18 [http-nio-8080-exec-5] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-16 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-18 04:34:18 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 39, Tenant anterior: 1
2026-01-18 04:34:18 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 39, Request: /favicon.ico, Empresa ID anterior: 1
2026-01-18 04:34:18 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:34:18 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=08E087A98C996FED5459F800C90A3F7D], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:34:18 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.AccessDeniedHandlerImpl - Forwarding to /acceso-denegado with status code 403
2026-01-18 04:34:18 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /acceso-denegado?fecha=2026-01-16
2026-01-18 04:34:18 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /acceso-denegado?fecha=2026-01-16
2026-01-18 04:34:18 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /acceso-denegado, Empresa ID: null
2026-01-18 04:34:18 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì Interceptando acceso-denegado - EMPRESA: null
2026-01-18 04:34:18 [http-nio-8080-exec-6] WARN  j.s.s.controladores.InicioController - ‚õî GET /acceso-denigado - Mostrando p√°gina de acceso denegado
2026-01-18 04:34:28 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/dashboard
2026-01-18 04:34:28 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=08E087A98C996FED5459F800C90A3F7D], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:34:28 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/dashboard
2026-01-18 04:34:28 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/dashboard
2026-01-18 04:34:28 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/dashboard, Empresa ID: null
2026-01-18 04:34:28 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/dashboard
2026-01-18 04:34:28 [http-nio-8080-exec-7] INFO  j.s.s.c.SuperAdminController - üìä Accediendo al dashboard SUPER_ADMIN
2026-01-18 04:34:28 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 41, Request: /superadmin/dashboard, Empresa ID anterior: null
2026-01-18 04:34:28 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/empresas
2026-01-18 04:34:28 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=08E087A98C996FED5459F800C90A3F7D], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:34:28 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/empresas
2026-01-18 04:34:28 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/empresas
2026-01-18 04:34:28 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/empresas, Empresa ID: null
2026-01-18 04:34:28 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/empresas
2026-01-18 04:34:28 [http-nio-8080-exec-8] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@103040654 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2] read-only
2026-01-18 04:34:28 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0
2026-01-18 04:34:28 [http-nio-8080-exec-8] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@103040654 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2]
2026-01-18 04:34:28 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 42, Request: /superadmin/empresas, Empresa ID anterior: null
2026-01-18 04:34:28 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-18 04:34:28 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=08E087A98C996FED5459F800C90A3F7D], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:34:28 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-18 04:34:28 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-18 04:34:28 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: localhost
2026-01-18 04:34:28 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: localhost
2026-01-18 04:34:28 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-18 04:34:28 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-18 04:34:28 [http-nio-8080-exec-9] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@868810723 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2] read-only
2026-01-18 04:34:28 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-18 04:34:28 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-18 04:34:28 [http-nio-8080-exec-9] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@868810723 wrapping com.mysql.cj.jdbc.ConnectionImpl@6bc25ac2]
2026-01-18 04:34:28 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 43
2026-01-18 04:34:28 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚ö†Ô∏è Usando empresa por defecto (localhost): 1 - Sistema por Defecto
2026-01-18 04:34:28 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: josepino
2026-01-18 04:34:28 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: josepino en empresa ID: 1
2026-01-18 04:34:28 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-18 04:34:28 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [josepino]
2026-01-18 04:34:28 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-18 04:34:28 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 1
2026-01-18 04:34:28 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-18, Hora: 4:00
2026-01-18 04:34:28 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:34:28 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-18]
2026-01-18 04:34:28 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:34:28 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:34:28 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚è≥ Antes de las 5:00 AM ‚Üí Validar ANTEAYER: 2026-01-16
2026-01-18 04:34:28 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-18 04:34:28 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-16]
2026-01-18 04:34:28 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-18 04:34:28 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-18 04:34:28 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-16 cerrado?: false (Empresa ID: 1)
2026-01-18 04:34:28 [http-nio-8080-exec-9] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-16 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-18 04:34:28 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 43, Tenant anterior: 1
2026-01-18 04:34:28 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /favicon.ico, Empresa ID anterior: 1
2026-01-18 04:34:28 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-16
2026-01-18 04:34:28 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=08E087A98C996FED5459F800C90A3F7D], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-18 04:34:28 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AccessDeniedHandlerImpl - Forwarding to /acceso-denegado with status code 403
2026-01-18 04:34:28 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /acceso-denegado?fecha=2026-01-16
2026-01-18 04:34:28 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /acceso-denegado?fecha=2026-01-16
2026-01-18 04:34:28 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /acceso-denegado, Empresa ID: null
2026-01-18 04:34:28 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì Interceptando acceso-denegado - EMPRESA: null
2026-01-18 04:34:28 [http-nio-8080-exec-10] WARN  j.s.s.controladores.InicioController - ‚õî GET /acceso-denigado - Mostrando p√°gina de acceso denegado
2026-01-18 04:34:56 [SpringApplicationShutdownHook] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2026-01-18 04:34:56 [tomcat-shutdown] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2026-01-18 04:34:56 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2026-01-18 04:34:56 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2026-01-18 04:34:56 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
