2026-01-26 13:04:15 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /
2026-01-26 13:04:15 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /
2026-01-26 13:04:15 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /, M√©todo: GET
2026-01-26 13:04:15 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-26 13:04:15 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-26 13:04:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:04:15 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-26 13:04:15 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 43
2026-01-26 13:04:15 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-26 13:04:15 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-26 13:04:15 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /, Empresa ID: 1
2026-01-26 13:04:15 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:04:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:04:15 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:04:15 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:04:15 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-26 13:04:15 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:04:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:04:15 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:04:15 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:04:15 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-26 13:04:15 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 1)
2026-01-26 13:04:15 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:04:15 [http-nio-8080-exec-3] INFO  j.s.s.controladores.InicioController - üîÄ GET / - Redirigiendo a /login
2026-01-26 13:04:15 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 43, Tenant anterior: 1
2026-01-26 13:04:15 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /, Empresa ID anterior: 1
2026-01-26 13:04:15 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login
2026-01-26 13:04:15 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login
2026-01-26 13:04:15 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-26 13:04:15 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-26 13:04:15 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-26 13:04:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:04:15 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-26 13:04:15 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 44
2026-01-26 13:04:15 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-26 13:04:15 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-26 13:04:15 [http-nio-8080-exec-4] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-26 13:04:15 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 44, Tenant anterior: 1
2026-01-26 13:04:15 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 44, Request: /login, Empresa ID anterior: 1
2026-01-26 13:04:19 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-26 13:04:19 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: admin para la empresa ID: null
2026-01-26 13:04:19 [http-nio-8080-exec-5] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: defecto
2026-01-26 13:04:19 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:04:19 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-26 13:04:19 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: defecto | Empresa ID: 1 | Empresa Nombre: Sistema por Defecto
2026-01-26 13:04:19 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:04:19 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:04:19 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:04:19 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:04:19 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:19 [http-nio-8080-exec-5] INFO  j.s.s.servicios.UsuarioServicio - üîê Encontrado usuario: admin
2026-01-26 13:04:19 [http-nio-8080-exec-5] INFO  j.s.s.servicios.UsuarioServicio - üîê Rol: ADMIN
2026-01-26 13:04:19 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - üîê Activo: true
2026-01-26 13:04:19 [http-nio-8080-exec-5] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Authenticated user
2026-01-26 13:04:19 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.s.ChangeSessionIdAuthenticationStrategy - Changed session id from A73707BC269A6EC8A786CB2EB73F1787
2026-01-26 13:04:19 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.CsrfAuthenticationStrategy - Replaced CSRF Token
2026-01-26 13:04:19 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Stored SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A73707BC269A6EC8A786CB2EB73F1787], Granted Authorities=[ROLE_ADMIN]]] to HttpSession [org.apache.catalina.session.StandardSessionFacade@460eb912]
2026-01-26 13:04:19 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.UsernamePasswordAuthenticationFilter - Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A73707BC269A6EC8A786CB2EB73F1787], Granted Authorities=[ROLE_ADMIN]]
2026-01-26 13:04:19 [http-nio-8080-exec-5] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /principal
2026-01-26 13:04:19 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-26 13:04:19 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A73707BC269A6EC8A786CB2EB73F1787], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:04:19 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-26 13:04:19 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-26 13:04:19 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-26 13:04:19 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-26 13:04:19 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:04:19 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-26 13:04:19 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 46
2026-01-26 13:04:19 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-26 13:04:19 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:04:19 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-26 13:04:19 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:04:19 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:04:19 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:04:19 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:04:19 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:19 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-26 13:04:19 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 1
2026-01-26 13:04:19 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:04:19 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:04:19 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:04:19 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:04:19 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-26 13:04:19 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:04:19 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:04:19 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:04:19 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:04:19 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-26 13:04:19 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 1)
2026-01-26 13:04:19 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:04:19 [http-nio-8080-exec-6] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-26
2026-01-26 13:04:19 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-26 13:04:19 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:04:19 [http-nio-8080-exec-6] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-26
2026-01-26 13:04:19 [http-nio-8080-exec-6] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-26 13:04:19 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 46, Tenant anterior: 1
2026-01-26 13:04:19 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 46, Request: /principal, Empresa ID anterior: 1
2026-01-26 13:04:26 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres
2026-01-26 13:04:26 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A73707BC269A6EC8A786CB2EB73F1787], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:04:26 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres
2026-01-26 13:04:26 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres, M√©todo: GET
2026-01-26 13:04:26 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-26 13:04:26 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-26 13:04:26 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:04:26 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-26 13:04:26 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 47
2026-01-26 13:04:26 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-26 13:04:26 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:04:26 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-26 13:04:26 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:04:26 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:04:26 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:04:26 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:04:26 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:26 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-26 13:04:26 [http-nio-8080-exec-7] INFO  j.s.s.c.CierreInventarioDiarioControlador - üìã GET /cierres - Listando cierres diarios
2026-01-26 13:04:26 [http-nio-8080-exec-7] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo todos los cierres para empresa ID: 1
2026-01-26 13:04:26 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        e1_0.id=?
2026-01-26 13:04:26 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:26 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:04:26 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:26 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-26 13:04:26 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:26 [http-nio-8080-exec-7] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 5 cierres para empresa ID: 1
2026-01-26 13:04:26 [http-nio-8080-exec-7] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Encontrados 5 cierres
2026-01-26 13:04:26 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 47, Tenant anterior: 1
2026-01-26 13:04:26 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 47, Request: /cierres, Empresa ID anterior: 1
2026-01-26 13:04:38 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/detalleCierre/5
2026-01-26 13:04:38 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A73707BC269A6EC8A786CB2EB73F1787], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:04:38 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/detalleCierre/5
2026-01-26 13:04:38 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/detalleCierre/5, M√©todo: GET
2026-01-26 13:04:38 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-26 13:04:38 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-26 13:04:38 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:04:38 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-26 13:04:38 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 48
2026-01-26 13:04:38 [http-nio-8080-exec-8] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-26 13:04:38 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:04:38 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-26 13:04:38 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:04:38 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:04:38 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:04:38 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:04:38 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:38 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-26 13:04:38 [http-nio-8080-exec-8] INFO  j.s.s.c.CierreInventarioDiarioControlador - üìä GET /cierres/detalleCierre/5 - Viendo detalles completos de cierre
2026-01-26 13:04:38 [http-nio-8080-exec-8] DEBUG j.s.s.s.CierreInventarioDiarioService - Buscando cierre ID: 5 para empresa ID: 1
2026-01-26 13:04:38 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.id=? 
        and e1_0.id=?
2026-01-26 13:04:38 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-26 13:04:38 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:04:38 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:04:38 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:38 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-26 13:04:38 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:38 [http-nio-8080-exec-8] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo detalles para cierre ID: 5
2026-01-26 13:04:38 [http-nio-8080-exec-8] DEBUG j.s.s.s.CierreInventarioDiarioService - Buscando cierre ID: 5 para empresa ID: 1
2026-01-26 13:04:38 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.id=? 
        and e1_0.id=?
2026-01-26 13:04:38 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-26 13:04:38 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:04:38 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:04:38 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:38 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-26 13:04:38 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:38 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        dcid1_0.ingrediente_id,
        dcid1_0.producto_id,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    where
        dcid1_0.cierre_id=?
2026-01-26 13:04:38 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-26 13:04:38 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        s1_0.nombre,
        s1_0.telefono 
    from
        cierre_inventario_diario cid1_0 
    join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=cid1_0.usuario_id 
    left join
        empresa e2_0 
            on e2_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    where
        cid1_0.id=?
2026-01-26 13:04:38 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-26 13:04:38 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-26 13:04:38 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-26 13:04:38 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-26 13:04:38 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:38 [http-nio-8080-exec-8] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 2 detalles para cierre ID: 5
2026-01-26 13:04:38 [http-nio-8080-exec-8] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Cierre ID: 5 - Diferencia: 0.0, Valor diferencia: 0.0, Valor merma: 0.0, Valor desperdicio: 0.0
2026-01-26 13:04:38 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 48, Tenant anterior: 1
2026-01-26 13:04:38 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 48, Request: /cierres/detalleCierre/5, Empresa ID anterior: 1
2026-01-26 13:04:39 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres
2026-01-26 13:04:39 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A73707BC269A6EC8A786CB2EB73F1787], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:04:39 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres
2026-01-26 13:04:39 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres, M√©todo: GET
2026-01-26 13:04:39 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-26 13:04:39 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-26 13:04:39 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:04:39 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-26 13:04:39 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 49
2026-01-26 13:04:39 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-26 13:04:39 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:04:39 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-26 13:04:39 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:04:39 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:04:39 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:04:39 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:04:39 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:39 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-26 13:04:39 [http-nio-8080-exec-9] INFO  j.s.s.c.CierreInventarioDiarioControlador - üìã GET /cierres - Listando cierres diarios
2026-01-26 13:04:39 [http-nio-8080-exec-9] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo todos los cierres para empresa ID: 1
2026-01-26 13:04:39 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        e1_0.id=?
2026-01-26 13:04:39 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:39 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:04:39 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:39 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-26 13:04:39 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:39 [http-nio-8080-exec-9] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 5 cierres para empresa ID: 1
2026-01-26 13:04:39 [http-nio-8080-exec-9] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Encontrados 5 cierres
2026-01-26 13:04:39 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 49, Tenant anterior: 1
2026-01-26 13:04:39 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 49, Request: /cierres, Empresa ID anterior: 1
2026-01-26 13:04:40 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/detalleCierre/4
2026-01-26 13:04:40 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A73707BC269A6EC8A786CB2EB73F1787], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:04:40 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/detalleCierre/4
2026-01-26 13:04:40 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/detalleCierre/4, M√©todo: GET
2026-01-26 13:04:40 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-26 13:04:40 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-26 13:04:40 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:04:40 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-26 13:04:40 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 50
2026-01-26 13:04:40 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-26 13:04:40 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:04:40 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-26 13:04:40 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:04:40 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:04:40 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:04:40 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:04:40 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:40 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-26 13:04:40 [http-nio-8080-exec-10] INFO  j.s.s.c.CierreInventarioDiarioControlador - üìä GET /cierres/detalleCierre/4 - Viendo detalles completos de cierre
2026-01-26 13:04:40 [http-nio-8080-exec-10] DEBUG j.s.s.s.CierreInventarioDiarioService - Buscando cierre ID: 4 para empresa ID: 1
2026-01-26 13:04:40 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.id=? 
        and e1_0.id=?
2026-01-26 13:04:40 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [4]
2026-01-26 13:04:40 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:04:40 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:04:40 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:40 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-26 13:04:40 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:40 [http-nio-8080-exec-10] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo detalles para cierre ID: 4
2026-01-26 13:04:40 [http-nio-8080-exec-10] DEBUG j.s.s.s.CierreInventarioDiarioService - Buscando cierre ID: 4 para empresa ID: 1
2026-01-26 13:04:40 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.id=? 
        and e1_0.id=?
2026-01-26 13:04:40 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [4]
2026-01-26 13:04:40 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:04:40 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:04:40 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:40 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-26 13:04:40 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:40 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        dcid1_0.ingrediente_id,
        dcid1_0.producto_id,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    where
        dcid1_0.cierre_id=?
2026-01-26 13:04:40 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [4]
2026-01-26 13:04:40 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        s1_0.nombre,
        s1_0.telefono 
    from
        cierre_inventario_diario cid1_0 
    join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=cid1_0.usuario_id 
    left join
        empresa e2_0 
            on e2_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    where
        cid1_0.id=?
2026-01-26 13:04:40 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [4]
2026-01-26 13:04:40 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-26 13:04:40 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-26 13:04:40 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-26 13:04:40 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:40 [http-nio-8080-exec-10] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 2 detalles para cierre ID: 4
2026-01-26 13:04:40 [http-nio-8080-exec-10] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Cierre ID: 4 - Diferencia: 0.0, Valor diferencia: 0.0, Valor merma: 0.0, Valor desperdicio: 0.0
2026-01-26 13:04:40 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 50, Tenant anterior: 1
2026-01-26 13:04:40 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 50, Request: /cierres/detalleCierre/4, Empresa ID anterior: 1
2026-01-26 13:04:42 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres
2026-01-26 13:04:42 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A73707BC269A6EC8A786CB2EB73F1787], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:04:42 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres
2026-01-26 13:04:42 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres, M√©todo: GET
2026-01-26 13:04:42 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-26 13:04:42 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-26 13:04:42 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:04:42 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-26 13:04:42 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 41
2026-01-26 13:04:42 [http-nio-8080-exec-1] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-26 13:04:42 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:04:42 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-26 13:04:42 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:04:42 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:04:42 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:04:42 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:04:42 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:42 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-26 13:04:42 [http-nio-8080-exec-1] INFO  j.s.s.c.CierreInventarioDiarioControlador - üìã GET /cierres - Listando cierres diarios
2026-01-26 13:04:42 [http-nio-8080-exec-1] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo todos los cierres para empresa ID: 1
2026-01-26 13:04:42 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        e1_0.id=?
2026-01-26 13:04:42 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:42 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:04:42 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:42 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-26 13:04:42 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:42 [http-nio-8080-exec-1] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 5 cierres para empresa ID: 1
2026-01-26 13:04:42 [http-nio-8080-exec-1] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Encontrados 5 cierres
2026-01-26 13:04:42 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 41, Tenant anterior: 1
2026-01-26 13:04:42 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 41, Request: /cierres, Empresa ID anterior: 1
2026-01-26 13:04:49 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/detalle/1
2026-01-26 13:04:49 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A73707BC269A6EC8A786CB2EB73F1787], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:04:49 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/detalle/1
2026-01-26 13:04:49 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/detalle/1, M√©todo: GET
2026-01-26 13:04:49 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-26 13:04:49 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-26 13:04:49 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:04:49 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-26 13:04:49 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 42
2026-01-26 13:04:49 [http-nio-8080-exec-2] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-26 13:04:49 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:04:49 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-26 13:04:49 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:04:49 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:04:49 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:04:49 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:04:49 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:49 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-26 13:04:49 [http-nio-8080-exec-2] INFO  j.s.s.c.CierreInventarioDiarioControlador - üëÅÔ∏è GET /cierres/detalle/1 - Viendo detalles de cierre
2026-01-26 13:04:49 [http-nio-8080-exec-2] DEBUG j.s.s.s.CierreInventarioDiarioService - Buscando cierre ID: 1 para empresa ID: 1
2026-01-26 13:04:49 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.id=? 
        and e1_0.id=?
2026-01-26 13:04:49 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:49 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:04:49 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:04:49 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:49 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-26 13:04:49 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:49 [http-nio-8080-exec-2] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo detalles para cierre ID: 1
2026-01-26 13:04:49 [http-nio-8080-exec-2] DEBUG j.s.s.s.CierreInventarioDiarioService - Buscando cierre ID: 1 para empresa ID: 1
2026-01-26 13:04:49 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.id=? 
        and e1_0.id=?
2026-01-26 13:04:49 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:49 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:04:49 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:04:49 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:49 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-26 13:04:49 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:49 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        dcid1_0.ingrediente_id,
        dcid1_0.producto_id,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    where
        dcid1_0.cierre_id=?
2026-01-26 13:04:49 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:49 [http-nio-8080-exec-2] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 0 detalles para cierre ID: 1
2026-01-26 13:04:49 [http-nio-8080-exec-2] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Cierre ID: 1, Estado: COMPLETADO, Detalles: 0, Diferencia total: 0.0
2026-01-26 13:04:49 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 42, Tenant anterior: 1
2026-01-26 13:04:49 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 42, Request: /cierres/detalle/1, Empresa ID anterior: 1
2026-01-26 13:04:50 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres
2026-01-26 13:04:50 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A73707BC269A6EC8A786CB2EB73F1787], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:04:50 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres
2026-01-26 13:04:50 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres, M√©todo: GET
2026-01-26 13:04:50 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-26 13:04:50 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-26 13:04:50 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:04:50 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-26 13:04:50 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 43
2026-01-26 13:04:50 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-26 13:04:50 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:04:50 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-26 13:04:50 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:04:50 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:04:50 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:04:50 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:04:50 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:50 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-26 13:04:50 [http-nio-8080-exec-3] INFO  j.s.s.c.CierreInventarioDiarioControlador - üìã GET /cierres - Listando cierres diarios
2026-01-26 13:04:50 [http-nio-8080-exec-3] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo todos los cierres para empresa ID: 1
2026-01-26 13:04:50 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        e1_0.id=?
2026-01-26 13:04:50 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:50 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:04:50 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:50 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-26 13:04:50 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:50 [http-nio-8080-exec-3] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 5 cierres para empresa ID: 1
2026-01-26 13:04:50 [http-nio-8080-exec-3] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Encontrados 5 cierres
2026-01-26 13:04:50 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 43, Tenant anterior: 1
2026-01-26 13:04:50 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /cierres, Empresa ID anterior: 1
2026-01-26 13:04:52 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/detalleCierre/5
2026-01-26 13:04:52 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A73707BC269A6EC8A786CB2EB73F1787], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:04:52 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/detalleCierre/5
2026-01-26 13:04:52 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/detalleCierre/5, M√©todo: GET
2026-01-26 13:04:52 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-26 13:04:52 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-26 13:04:52 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:04:52 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-26 13:04:52 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 44
2026-01-26 13:04:52 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-26 13:04:52 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:04:52 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-26 13:04:52 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:04:52 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:04:52 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:04:52 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:04:52 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:52 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-26 13:04:52 [http-nio-8080-exec-4] INFO  j.s.s.c.CierreInventarioDiarioControlador - üìä GET /cierres/detalleCierre/5 - Viendo detalles completos de cierre
2026-01-26 13:04:52 [http-nio-8080-exec-4] DEBUG j.s.s.s.CierreInventarioDiarioService - Buscando cierre ID: 5 para empresa ID: 1
2026-01-26 13:04:52 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.id=? 
        and e1_0.id=?
2026-01-26 13:04:52 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-26 13:04:52 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:04:52 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:04:52 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:52 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-26 13:04:52 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:52 [http-nio-8080-exec-4] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo detalles para cierre ID: 5
2026-01-26 13:04:52 [http-nio-8080-exec-4] DEBUG j.s.s.s.CierreInventarioDiarioService - Buscando cierre ID: 5 para empresa ID: 1
2026-01-26 13:04:52 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.id=? 
        and e1_0.id=?
2026-01-26 13:04:52 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-26 13:04:52 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:04:52 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:04:52 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:52 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-26 13:04:52 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:52 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        dcid1_0.ingrediente_id,
        dcid1_0.producto_id,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    where
        dcid1_0.cierre_id=?
2026-01-26 13:04:52 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-26 13:04:52 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        s1_0.nombre,
        s1_0.telefono 
    from
        cierre_inventario_diario cid1_0 
    join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=cid1_0.usuario_id 
    left join
        empresa e2_0 
            on e2_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    where
        cid1_0.id=?
2026-01-26 13:04:52 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-26 13:04:52 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-26 13:04:52 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-26 13:04:52 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-26 13:04:52 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:52 [http-nio-8080-exec-4] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 2 detalles para cierre ID: 5
2026-01-26 13:04:52 [http-nio-8080-exec-4] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Cierre ID: 5 - Diferencia: 0.0, Valor diferencia: 0.0, Valor merma: 0.0, Valor desperdicio: 0.0
2026-01-26 13:04:52 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 44, Tenant anterior: 1
2026-01-26 13:04:52 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 44, Request: /cierres/detalleCierre/5, Empresa ID anterior: 1
2026-01-26 13:04:53 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres
2026-01-26 13:04:53 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A73707BC269A6EC8A786CB2EB73F1787], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:04:53 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres
2026-01-26 13:04:53 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres, M√©todo: GET
2026-01-26 13:04:53 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-26 13:04:53 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-26 13:04:53 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:04:53 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-26 13:04:53 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 45
2026-01-26 13:04:53 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-26 13:04:53 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:04:53 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-26 13:04:53 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:04:53 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:04:53 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:04:53 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:04:53 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:53 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-26 13:04:53 [http-nio-8080-exec-5] INFO  j.s.s.c.CierreInventarioDiarioControlador - üìã GET /cierres - Listando cierres diarios
2026-01-26 13:04:53 [http-nio-8080-exec-5] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo todos los cierres para empresa ID: 1
2026-01-26 13:04:53 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        e1_0.id=?
2026-01-26 13:04:53 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:53 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:04:53 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:53 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-26 13:04:53 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:53 [http-nio-8080-exec-5] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 5 cierres para empresa ID: 1
2026-01-26 13:04:53 [http-nio-8080-exec-5] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Encontrados 5 cierres
2026-01-26 13:04:53 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 45, Tenant anterior: 1
2026-01-26 13:04:53 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 45, Request: /cierres, Empresa ID anterior: 1
2026-01-26 13:04:54 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/detalle/5
2026-01-26 13:04:54 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A73707BC269A6EC8A786CB2EB73F1787], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:04:54 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/detalle/5
2026-01-26 13:04:54 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/detalle/5, M√©todo: GET
2026-01-26 13:04:54 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-26 13:04:54 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-26 13:04:54 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:04:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-26 13:04:54 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 46
2026-01-26 13:04:54 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-26 13:04:54 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:04:54 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-26 13:04:54 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:04:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:04:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:04:54 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:04:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:54 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-26 13:04:54 [http-nio-8080-exec-6] INFO  j.s.s.c.CierreInventarioDiarioControlador - üëÅÔ∏è GET /cierres/detalle/5 - Viendo detalles de cierre
2026-01-26 13:04:54 [http-nio-8080-exec-6] DEBUG j.s.s.s.CierreInventarioDiarioService - Buscando cierre ID: 5 para empresa ID: 1
2026-01-26 13:04:54 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.id=? 
        and e1_0.id=?
2026-01-26 13:04:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-26 13:04:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:04:54 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:04:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:54 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-26 13:04:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:54 [http-nio-8080-exec-6] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo detalles para cierre ID: 5
2026-01-26 13:04:54 [http-nio-8080-exec-6] DEBUG j.s.s.s.CierreInventarioDiarioService - Buscando cierre ID: 5 para empresa ID: 1
2026-01-26 13:04:54 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.id=? 
        and e1_0.id=?
2026-01-26 13:04:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-26 13:04:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:04:54 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:04:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:54 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-26 13:04:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:54 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        dcid1_0.ingrediente_id,
        dcid1_0.producto_id,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    where
        dcid1_0.cierre_id=?
2026-01-26 13:04:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-26 13:04:54 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id,
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        s1_0.nombre,
        s1_0.telefono 
    from
        cierre_inventario_diario cid1_0 
    join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    join
        usuario u1_0 
            on u1_0.id=cid1_0.usuario_id 
    left join
        empresa e2_0 
            on e2_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    where
        cid1_0.id=?
2026-01-26 13:04:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-26 13:04:54 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-26 13:04:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-26 13:04:54 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-26 13:04:54 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:54 [http-nio-8080-exec-6] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 2 detalles para cierre ID: 5
2026-01-26 13:04:54 [http-nio-8080-exec-6] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Cierre ID: 5, Estado: COMPLETADO, Detalles: 2, Diferencia total: 0.0
2026-01-26 13:04:54 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 46, Tenant anterior: 1
2026-01-26 13:04:54 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 46, Request: /cierres/detalle/5, Empresa ID anterior: 1
2026-01-26 13:04:55 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres
2026-01-26 13:04:55 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A73707BC269A6EC8A786CB2EB73F1787], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:04:55 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres
2026-01-26 13:04:55 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres, M√©todo: GET
2026-01-26 13:04:55 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-26 13:04:55 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-26 13:04:55 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:04:55 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-26 13:04:55 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 47
2026-01-26 13:04:55 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-26 13:04:55 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:04:55 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-26 13:04:55 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:04:55 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:04:55 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:04:55 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:04:55 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:55 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-26 13:04:55 [http-nio-8080-exec-7] INFO  j.s.s.c.CierreInventarioDiarioControlador - üìã GET /cierres - Listando cierres diarios
2026-01-26 13:04:55 [http-nio-8080-exec-7] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo todos los cierres para empresa ID: 1
2026-01-26 13:04:55 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        e1_0.id=?
2026-01-26 13:04:55 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:55 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:04:55 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:55 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-26 13:04:55 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:55 [http-nio-8080-exec-7] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 5 cierres para empresa ID: 1
2026-01-26 13:04:55 [http-nio-8080-exec-7] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Encontrados 5 cierres
2026-01-26 13:04:55 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 47, Tenant anterior: 1
2026-01-26 13:04:55 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 47, Request: /cierres, Empresa ID anterior: 1
2026-01-26 13:04:58 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-26 13:04:58 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A73707BC269A6EC8A786CB2EB73F1787], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:04:58 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-26 13:04:58 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-26 13:04:58 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-26 13:04:58 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-26 13:04:58 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:04:58 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-26 13:04:58 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 48
2026-01-26 13:04:58 [http-nio-8080-exec-8] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-26 13:04:58 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:04:58 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-26 13:04:58 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:04:58 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:04:58 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:04:58 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:04:58 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:04:58 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-26 13:04:58 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 1
2026-01-26 13:04:58 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:04:58 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:04:58 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:04:58 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:04:58 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-26 13:04:58 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:04:58 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:04:58 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:04:58 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:04:58 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-26 13:04:58 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 1)
2026-01-26 13:04:58 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:04:58 [http-nio-8080-exec-8] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-26
2026-01-26 13:04:58 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-26 13:04:58 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:04:58 [http-nio-8080-exec-8] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-26
2026-01-26 13:04:58 [http-nio-8080-exec-8] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-26 13:04:58 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 48, Tenant anterior: 1
2026-01-26 13:04:58 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 48, Request: /principal, Empresa ID anterior: 1
2026-01-26 13:05:05 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /facturas
2026-01-26 13:05:05 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A73707BC269A6EC8A786CB2EB73F1787], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:05:05 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /facturas
2026-01-26 13:05:05 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /facturas, M√©todo: GET
2026-01-26 13:05:05 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-26 13:05:05 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-26 13:05:05 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:05:05 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-26 13:05:05 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 49
2026-01-26 13:05:05 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-26 13:05:05 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:05:05 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-26 13:05:05 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:05:05 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:05:05 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:05:05 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:05:05 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:05:05 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-26 13:05:05 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /facturas, Empresa ID: 1
2026-01-26 13:05:05 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:05:05 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:05:05 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:05:05 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:05:05 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-26 13:05:05 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:05:05 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:05:05 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:05:05 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:05:05 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-26 13:05:05 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 1)
2026-01-26 13:05:05 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:05:05 [http-nio-8080-exec-9] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador.listarFacturas(int,int,java.lang.String,java.time.LocalDate,java.time.LocalDate,org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador]
2026-01-26 13:05:05 [http-nio-8080-exec-9] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador.listarFacturas(int,int,java.lang.String,java.time.LocalDate,java.time.LocalDate,org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador]
2026-01-26 13:05:05 [http-nio-8080-exec-9] INFO  j.s.s.c.FacturaControlador - Listando facturas - P√°gina: 0, Tama√±o: 10
2026-01-26 13:05:05 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.FacturaServicio - Obteniendo facturas paginadas para empresa ID: 1
2026-01-26 13:05:05 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        f1_0.id,
        f1_0.cliente_id,
        f1_0.empresa_id,
        f1_0.estado,
        f1_0.fecha,
        f1_0.forma_pago,
        f1_0.iva,
        f1_0.numero_factura,
        f1_0.subtotal,
        f1_0.total 
    from
        factura f1_0 
    where
        f1_0.empresa_id=? 
        and (
            ? is null 
            or f1_0.estado=?
        ) 
        and (
            ? is null 
            or f1_0.fecha>=?
        ) 
        and (
            ? is null 
            or f1_0.fecha<=?
        ) 
    order by
        f1_0.fecha desc,
        f1_0.fecha desc 
    limit
        ?
2026-01-26 13:05:05 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:05:05 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [null]
2026-01-26 13:05:05 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2026-01-26 13:05:05 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DATE) <- [null]
2026-01-26 13:05:05 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:DATE) <- [null]
2026-01-26 13:05:05 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DATE) <- [null]
2026-01-26 13:05:05 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:DATE) <- [null]
2026-01-26 13:05:05 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:INTEGER) <- [10]
2026-01-26 13:05:05 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        c1_0.id,
        c1_0.activo,
        c1_0.correo,
        c1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        c1_0.identificacion,
        c1_0.nombre,
        c1_0.telefono 
    from
        cliente c1_0 
    join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    where
        c1_0.id=?
2026-01-26 13:05:05 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:05:05 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 49, Tenant anterior: 1
2026-01-26 13:05:05 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 49, Request: /facturas, Empresa ID anterior: 1
2026-01-26 13:05:08 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /facturas?pagina=0&tamanio=10&fechaInicio=2026-01-26&fechaFin=2026-01-26
2026-01-26 13:05:08 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A73707BC269A6EC8A786CB2EB73F1787], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:05:08 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /facturas?pagina=0&tamanio=10&fechaInicio=2026-01-26&fechaFin=2026-01-26
2026-01-26 13:05:08 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /facturas, M√©todo: GET
2026-01-26 13:05:08 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-26 13:05:08 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-26 13:05:08 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:05:08 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-26 13:05:08 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 50
2026-01-26 13:05:08 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-26 13:05:08 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:05:08 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-26 13:05:08 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:05:08 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:05:08 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:05:08 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:05:08 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:05:08 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-26 13:05:08 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /facturas, Empresa ID: 1
2026-01-26 13:05:08 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:05:08 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:05:08 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:05:08 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:05:08 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-26 13:05:08 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:05:08 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:05:08 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:05:08 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:05:08 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-26 13:05:08 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 1)
2026-01-26 13:05:08 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:05:08 [http-nio-8080-exec-10] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador.listarFacturas(int,int,java.lang.String,java.time.LocalDate,java.time.LocalDate,org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador]
2026-01-26 13:05:08 [http-nio-8080-exec-10] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador.listarFacturas(int,int,java.lang.String,java.time.LocalDate,java.time.LocalDate,org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador]
2026-01-26 13:05:08 [http-nio-8080-exec-10] INFO  j.s.s.c.FacturaControlador - Listando facturas - P√°gina: 0, Tama√±o: 10
2026-01-26 13:05:08 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.FacturaServicio - Obteniendo facturas paginadas para empresa ID: 1
2026-01-26 13:05:08 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        f1_0.id,
        f1_0.cliente_id,
        f1_0.empresa_id,
        f1_0.estado,
        f1_0.fecha,
        f1_0.forma_pago,
        f1_0.iva,
        f1_0.numero_factura,
        f1_0.subtotal,
        f1_0.total 
    from
        factura f1_0 
    where
        f1_0.empresa_id=? 
        and (
            ? is null 
            or f1_0.estado=?
        ) 
        and (
            ? is null 
            or f1_0.fecha>=?
        ) 
        and (
            ? is null 
            or f1_0.fecha<=?
        ) 
    order by
        f1_0.fecha desc,
        f1_0.fecha desc 
    limit
        ?
2026-01-26 13:05:08 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:05:08 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [null]
2026-01-26 13:05:08 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2026-01-26 13:05:08 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DATE) <- [2026-01-26]
2026-01-26 13:05:08 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:DATE) <- [2026-01-26]
2026-01-26 13:05:08 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DATE) <- [2026-01-26]
2026-01-26 13:05:08 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:DATE) <- [2026-01-26]
2026-01-26 13:05:08 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:INTEGER) <- [10]
2026-01-26 13:05:08 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 50, Tenant anterior: 1
2026-01-26 13:05:08 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 50, Request: /facturas, Empresa ID anterior: 1
2026-01-26 13:05:17 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /facturas?pagina=0&tamanio=10&fechaInicio=2026-01-18&fechaFin=2026-01-26
2026-01-26 13:05:17 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A73707BC269A6EC8A786CB2EB73F1787], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:05:17 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /facturas?pagina=0&tamanio=10&fechaInicio=2026-01-18&fechaFin=2026-01-26
2026-01-26 13:05:17 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /facturas, M√©todo: GET
2026-01-26 13:05:17 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-26 13:05:17 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-26 13:05:17 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:05:17 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-26 13:05:17 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 41
2026-01-26 13:05:17 [http-nio-8080-exec-1] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-26 13:05:17 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:05:17 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-26 13:05:17 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:05:17 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:05:17 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:05:17 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:05:17 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:05:17 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-26 13:05:17 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /facturas, Empresa ID: 1
2026-01-26 13:05:17 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:05:17 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:05:17 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:05:17 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:05:17 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-26 13:05:17 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:05:17 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:05:17 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:05:17 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:05:17 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-26 13:05:17 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 1)
2026-01-26 13:05:17 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:05:17 [http-nio-8080-exec-1] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador.listarFacturas(int,int,java.lang.String,java.time.LocalDate,java.time.LocalDate,org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador]
2026-01-26 13:05:17 [http-nio-8080-exec-1] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador.listarFacturas(int,int,java.lang.String,java.time.LocalDate,java.time.LocalDate,org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador]
2026-01-26 13:05:17 [http-nio-8080-exec-1] INFO  j.s.s.c.FacturaControlador - Listando facturas - P√°gina: 0, Tama√±o: 10
2026-01-26 13:05:17 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.FacturaServicio - Obteniendo facturas paginadas para empresa ID: 1
2026-01-26 13:05:17 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        f1_0.id,
        f1_0.cliente_id,
        f1_0.empresa_id,
        f1_0.estado,
        f1_0.fecha,
        f1_0.forma_pago,
        f1_0.iva,
        f1_0.numero_factura,
        f1_0.subtotal,
        f1_0.total 
    from
        factura f1_0 
    where
        f1_0.empresa_id=? 
        and (
            ? is null 
            or f1_0.estado=?
        ) 
        and (
            ? is null 
            or f1_0.fecha>=?
        ) 
        and (
            ? is null 
            or f1_0.fecha<=?
        ) 
    order by
        f1_0.fecha desc,
        f1_0.fecha desc 
    limit
        ?
2026-01-26 13:05:17 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:05:17 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [null]
2026-01-26 13:05:17 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2026-01-26 13:05:17 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DATE) <- [2026-01-18]
2026-01-26 13:05:17 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:DATE) <- [2026-01-18]
2026-01-26 13:05:17 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DATE) <- [2026-01-26]
2026-01-26 13:05:17 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:DATE) <- [2026-01-26]
2026-01-26 13:05:17 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:INTEGER) <- [10]
2026-01-26 13:05:17 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        c1_0.id,
        c1_0.activo,
        c1_0.correo,
        c1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        c1_0.identificacion,
        c1_0.nombre,
        c1_0.telefono 
    from
        cliente c1_0 
    join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    where
        c1_0.id=?
2026-01-26 13:05:17 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:05:17 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 41, Tenant anterior: 1
2026-01-26 13:05:17 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 41, Request: /facturas, Empresa ID anterior: 1
2026-01-26 13:05:22 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /facturas/detalle/1
2026-01-26 13:05:22 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A73707BC269A6EC8A786CB2EB73F1787], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:05:22 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured GET /facturas/detalle/1
2026-01-26 13:05:22 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /facturas/detalle/1, M√©todo: GET
2026-01-26 13:05:22 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-26 13:05:22 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-26 13:05:22 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:05:22 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-26 13:05:22 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 42
2026-01-26 13:05:22 [http-nio-8080-exec-2] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-26 13:05:22 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:05:22 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-26 13:05:22 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:05:22 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:05:22 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:05:22 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:05:22 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:05:22 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-26 13:05:22 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /facturas/detalle/1, Empresa ID: 1
2026-01-26 13:05:22 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:05:22 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:05:22 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:05:22 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:05:22 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-26 13:05:22 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:05:22 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:05:22 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:05:22 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:05:22 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-26 13:05:22 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 1)
2026-01-26 13:05:22 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:05:22 [http-nio-8080-exec-2] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador.verDetalleFactura(java.lang.Long,org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador]
2026-01-26 13:05:22 [http-nio-8080-exec-2] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador.verDetalleFactura(java.lang.Long,org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador]
2026-01-26 13:05:22 [http-nio-8080-exec-2] INFO  j.s.s.c.FacturaControlador - üëÅÔ∏è GET /facturas/detalle/1 - Viendo detalle de factura
2026-01-26 13:05:22 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.FacturaServicio - Buscando factura ID: 1 para empresa ID: 1
2026-01-26 13:05:22 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        f1_0.id,
        f1_0.cliente_id,
        f1_0.empresa_id,
        f1_0.estado,
        fd1_0.factura_id,
        fd1_0.id,
        fd1_0.cantidad,
        fd1_0.precio_unitario,
        fd1_0.producto_id,
        fd1_0.subtotal,
        f1_0.fecha,
        f1_0.forma_pago,
        f1_0.iva,
        f1_0.numero_factura,
        f1_0.subtotal,
        f1_0.total 
    from
        factura f1_0 
    left join
        factura_detalle fd1_0 
            on f1_0.id=fd1_0.factura_id 
    where
        f1_0.id=? 
        and f1_0.empresa_id=?
2026-01-26 13:05:22 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:INTEGER) <- [1]
2026-01-26 13:05:22 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:05:22 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        c1_0.id,
        c1_0.activo,
        c1_0.correo,
        c1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        c1_0.identificacion,
        c1_0.nombre,
        c1_0.telefono 
    from
        cliente c1_0 
    join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    where
        c1_0.id=?
2026-01-26 13:05:22 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:05:22 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        r1_0.nombre,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta 
    from
        producto p1_0 
    join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    left join
        receta r1_0 
            on r1_0.id=p1_0.receta_id 
    left join
        empresa e2_0 
            on e2_0.id=r1_0.empresa_id 
    where
        p1_0.id=?
2026-01-26 13:05:22 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-26 13:05:22 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 42, Tenant anterior: 1
2026-01-26 13:05:22 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 42, Request: /facturas/detalle/1, Empresa ID anterior: 1
2026-01-26 13:05:25 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /facturas
2026-01-26 13:05:25 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A73707BC269A6EC8A786CB2EB73F1787], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:05:25 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /facturas
2026-01-26 13:05:25 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /facturas, M√©todo: GET
2026-01-26 13:05:25 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-26 13:05:25 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-26 13:05:25 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:05:25 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-26 13:05:25 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 43
2026-01-26 13:05:25 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-26 13:05:25 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:05:25 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-26 13:05:25 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:05:25 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:05:25 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:05:25 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:05:25 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:05:25 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-26 13:05:25 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /facturas, Empresa ID: 1
2026-01-26 13:05:25 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:05:25 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:05:25 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:05:25 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:05:25 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-26 13:05:25 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:05:25 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:05:25 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:05:25 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:05:25 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-26 13:05:25 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 1)
2026-01-26 13:05:25 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:05:25 [http-nio-8080-exec-3] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador.listarFacturas(int,int,java.lang.String,java.time.LocalDate,java.time.LocalDate,org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador]
2026-01-26 13:05:25 [http-nio-8080-exec-3] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador.listarFacturas(int,int,java.lang.String,java.time.LocalDate,java.time.LocalDate,org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador]
2026-01-26 13:05:25 [http-nio-8080-exec-3] INFO  j.s.s.c.FacturaControlador - Listando facturas - P√°gina: 0, Tama√±o: 10
2026-01-26 13:05:25 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.FacturaServicio - Obteniendo facturas paginadas para empresa ID: 1
2026-01-26 13:05:25 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        f1_0.id,
        f1_0.cliente_id,
        f1_0.empresa_id,
        f1_0.estado,
        f1_0.fecha,
        f1_0.forma_pago,
        f1_0.iva,
        f1_0.numero_factura,
        f1_0.subtotal,
        f1_0.total 
    from
        factura f1_0 
    where
        f1_0.empresa_id=? 
        and (
            ? is null 
            or f1_0.estado=?
        ) 
        and (
            ? is null 
            or f1_0.fecha>=?
        ) 
        and (
            ? is null 
            or f1_0.fecha<=?
        ) 
    order by
        f1_0.fecha desc,
        f1_0.fecha desc 
    limit
        ?
2026-01-26 13:05:25 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:05:25 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [null]
2026-01-26 13:05:25 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2026-01-26 13:05:25 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DATE) <- [null]
2026-01-26 13:05:25 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:DATE) <- [null]
2026-01-26 13:05:25 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DATE) <- [null]
2026-01-26 13:05:25 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:DATE) <- [null]
2026-01-26 13:05:25 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:INTEGER) <- [10]
2026-01-26 13:05:25 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        c1_0.id,
        c1_0.activo,
        c1_0.correo,
        c1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        c1_0.identificacion,
        c1_0.nombre,
        c1_0.telefono 
    from
        cliente c1_0 
    join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    where
        c1_0.id=?
2026-01-26 13:05:25 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:05:25 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 43, Tenant anterior: 1
2026-01-26 13:05:25 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /facturas, Empresa ID anterior: 1
2026-01-26 13:05:30 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /facturas
2026-01-26 13:05:30 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A73707BC269A6EC8A786CB2EB73F1787], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:05:30 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /facturas
2026-01-26 13:05:30 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /facturas, M√©todo: GET
2026-01-26 13:05:30 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-26 13:05:30 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-26 13:05:30 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:05:30 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-26 13:05:30 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 44
2026-01-26 13:05:30 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-26 13:05:30 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:05:30 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-26 13:05:30 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:05:30 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:05:30 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:05:30 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:05:30 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:05:30 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-26 13:05:30 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /facturas, Empresa ID: 1
2026-01-26 13:05:30 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:05:30 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:05:30 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:05:30 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:05:30 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-26 13:05:30 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:05:30 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:05:30 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:05:30 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:05:30 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-26 13:05:30 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 1)
2026-01-26 13:05:30 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:05:30 [http-nio-8080-exec-4] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador.listarFacturas(int,int,java.lang.String,java.time.LocalDate,java.time.LocalDate,org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador]
2026-01-26 13:05:30 [http-nio-8080-exec-4] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador.listarFacturas(int,int,java.lang.String,java.time.LocalDate,java.time.LocalDate,org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador]
2026-01-26 13:05:30 [http-nio-8080-exec-4] INFO  j.s.s.c.FacturaControlador - Listando facturas - P√°gina: 0, Tama√±o: 10
2026-01-26 13:05:30 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.FacturaServicio - Obteniendo facturas paginadas para empresa ID: 1
2026-01-26 13:05:30 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        f1_0.id,
        f1_0.cliente_id,
        f1_0.empresa_id,
        f1_0.estado,
        f1_0.fecha,
        f1_0.forma_pago,
        f1_0.iva,
        f1_0.numero_factura,
        f1_0.subtotal,
        f1_0.total 
    from
        factura f1_0 
    where
        f1_0.empresa_id=? 
        and (
            ? is null 
            or f1_0.estado=?
        ) 
        and (
            ? is null 
            or f1_0.fecha>=?
        ) 
        and (
            ? is null 
            or f1_0.fecha<=?
        ) 
    order by
        f1_0.fecha desc,
        f1_0.fecha desc 
    limit
        ?
2026-01-26 13:05:30 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:05:30 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [null]
2026-01-26 13:05:30 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2026-01-26 13:05:30 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DATE) <- [null]
2026-01-26 13:05:30 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:DATE) <- [null]
2026-01-26 13:05:30 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DATE) <- [null]
2026-01-26 13:05:30 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:DATE) <- [null]
2026-01-26 13:05:30 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:INTEGER) <- [10]
2026-01-26 13:05:30 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        c1_0.id,
        c1_0.activo,
        c1_0.correo,
        c1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        c1_0.identificacion,
        c1_0.nombre,
        c1_0.telefono 
    from
        cliente c1_0 
    join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    where
        c1_0.id=?
2026-01-26 13:05:30 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:05:30 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 44, Tenant anterior: 1
2026-01-26 13:05:30 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 44, Request: /facturas, Empresa ID anterior: 1
2026-01-26 13:05:33 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /facturas?pagina=0&tamanio=10&fechaInicio=2026-01-26&fechaFin=2026-01-26
2026-01-26 13:05:33 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A73707BC269A6EC8A786CB2EB73F1787], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:05:33 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /facturas?pagina=0&tamanio=10&fechaInicio=2026-01-26&fechaFin=2026-01-26
2026-01-26 13:05:33 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /facturas, M√©todo: GET
2026-01-26 13:05:33 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-26 13:05:33 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-26 13:05:33 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:05:33 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-26 13:05:33 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 45
2026-01-26 13:05:33 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-26 13:05:33 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:05:33 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-26 13:05:33 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:05:33 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:05:33 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:05:33 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:05:33 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:05:33 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-26 13:05:33 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /facturas, Empresa ID: 1
2026-01-26 13:05:33 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:05:33 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:05:33 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:05:33 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:05:33 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-26 13:05:33 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:05:33 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:05:33 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:05:33 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:05:33 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-26 13:05:33 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 1)
2026-01-26 13:05:33 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:05:33 [http-nio-8080-exec-5] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador.listarFacturas(int,int,java.lang.String,java.time.LocalDate,java.time.LocalDate,org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador]
2026-01-26 13:05:33 [http-nio-8080-exec-5] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador.listarFacturas(int,int,java.lang.String,java.time.LocalDate,java.time.LocalDate,org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador]
2026-01-26 13:05:33 [http-nio-8080-exec-5] INFO  j.s.s.c.FacturaControlador - Listando facturas - P√°gina: 0, Tama√±o: 10
2026-01-26 13:05:33 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.FacturaServicio - Obteniendo facturas paginadas para empresa ID: 1
2026-01-26 13:05:33 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        f1_0.id,
        f1_0.cliente_id,
        f1_0.empresa_id,
        f1_0.estado,
        f1_0.fecha,
        f1_0.forma_pago,
        f1_0.iva,
        f1_0.numero_factura,
        f1_0.subtotal,
        f1_0.total 
    from
        factura f1_0 
    where
        f1_0.empresa_id=? 
        and (
            ? is null 
            or f1_0.estado=?
        ) 
        and (
            ? is null 
            or f1_0.fecha>=?
        ) 
        and (
            ? is null 
            or f1_0.fecha<=?
        ) 
    order by
        f1_0.fecha desc,
        f1_0.fecha desc 
    limit
        ?
2026-01-26 13:05:33 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:05:33 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [null]
2026-01-26 13:05:33 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [null]
2026-01-26 13:05:33 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DATE) <- [2026-01-26]
2026-01-26 13:05:33 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:DATE) <- [2026-01-26]
2026-01-26 13:05:33 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DATE) <- [2026-01-26]
2026-01-26 13:05:33 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:DATE) <- [2026-01-26]
2026-01-26 13:05:33 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:INTEGER) <- [10]
2026-01-26 13:05:33 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 45, Tenant anterior: 1
2026-01-26 13:05:33 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 45, Request: /facturas, Empresa ID anterior: 1
2026-01-26 13:05:38 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-26 13:05:38 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A73707BC269A6EC8A786CB2EB73F1787], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:05:38 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-26 13:05:38 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-26 13:05:38 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-26 13:05:38 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-26 13:05:38 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:05:38 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-26 13:05:38 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 46
2026-01-26 13:05:38 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-26 13:05:38 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:05:38 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-26 13:05:38 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:05:38 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:05:38 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:05:38 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:05:38 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:05:38 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-26 13:05:38 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 1
2026-01-26 13:05:38 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:05:38 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:05:38 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:05:38 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:05:38 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-26 13:05:38 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:05:38 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:05:38 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:05:38 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:05:38 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-26 13:05:38 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 1)
2026-01-26 13:05:38 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:05:38 [http-nio-8080-exec-6] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-26
2026-01-26 13:05:38 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-26 13:05:38 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:05:38 [http-nio-8080-exec-6] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-26
2026-01-26 13:05:38 [http-nio-8080-exec-6] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-26 13:05:38 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 46, Tenant anterior: 1
2026-01-26 13:05:38 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 46, Request: /principal, Empresa ID anterior: 1
2026-01-26 13:05:41 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios
2026-01-26 13:05:41 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A73707BC269A6EC8A786CB2EB73F1787], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:05:41 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios
2026-01-26 13:05:41 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios, M√©todo: GET
2026-01-26 13:05:41 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-26 13:05:41 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-26 13:05:41 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:05:41 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-26 13:05:41 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 47
2026-01-26 13:05:41 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-26 13:05:41 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:05:41 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-26 13:05:41 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:05:41 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:05:41 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:05:41 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:05:41 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:05:41 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-26 13:05:41 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios, Empresa ID: 1
2026-01-26 13:05:41 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:05:41 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:05:41 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:05:41 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:05:41 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-26 13:05:41 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:05:41 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:05:41 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:05:41 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:05:41 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-26 13:05:41 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 1)
2026-01-26 13:05:41 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:05:41 [http-nio-8080-exec-7] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-26 13:05:41 [http-nio-8080-exec-7] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-26 13:05:41 [http-nio-8080-exec-7] INFO  j.s.s.c.UsuarioControlador - üìã GET /admin/usuarios - Listando usuarios
2026-01-26 13:05:41 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Listando usuarios para empresa ID: 1
2026-01-26 13:05:41 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-26 13:05:41 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:05:41 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:05:41 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:05:41 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 47, Tenant anterior: 1
2026-01-26 13:05:41 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 47, Request: /admin/usuarios, Empresa ID anterior: 1
2026-01-26 13:05:42 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-26 13:05:42 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A73707BC269A6EC8A786CB2EB73F1787], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:05:42 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-26 13:05:42 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-26 13:05:42 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-26 13:05:42 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-26 13:05:42 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:05:42 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-26 13:05:42 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 48
2026-01-26 13:05:42 [http-nio-8080-exec-8] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-26 13:05:42 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:05:42 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-26 13:05:42 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:05:42 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:05:42 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:05:42 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:05:42 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:05:42 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-26 13:05:42 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 1
2026-01-26 13:05:42 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:05:42 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:05:42 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:05:42 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:05:42 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-26 13:05:42 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:05:42 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:05:42 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:05:42 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:05:42 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-26 13:05:42 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 1)
2026-01-26 13:05:42 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:05:42 [http-nio-8080-exec-8] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-26
2026-01-26 13:05:42 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-26 13:05:42 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:05:42 [http-nio-8080-exec-8] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-26
2026-01-26 13:05:42 [http-nio-8080-exec-8] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-26 13:05:42 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 48, Tenant anterior: 1
2026-01-26 13:05:42 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 48, Request: /principal, Empresa ID anterior: 1
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /reportes/consumo
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A73707BC269A6EC8A786CB2EB73F1787], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /reportes/consumo
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /reportes/consumo, M√©todo: GET
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:05:44 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 49
2026-01-26 13:05:44 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:05:44 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:05:44 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:05:44 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /reportes/consumo, Empresa ID: 1
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:05:44 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:05:44 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:05:44 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:05:44 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:05:44 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:05:44 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 1)
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:05:44 [http-nio-8080-exec-9] INFO  j.s.s.c.ReporteConsumoController - üìä GET /reportes/consumo - Generando reporte. Fechas inicio: null, fin: null
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG j.s.s.c.ReporteConsumoController - Fechas para reporte: 2026-01-19 a 2026-01-26
2026-01-26 13:05:44 [http-nio-8080-exec-9] INFO  j.s.s.s.ReporteConsumoServicio - Generando reporte de consumo desde 2026-01-19 hasta 2026-01-26
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.ingrediente_id,
        dcid1_0.stock_real 
    from
        detalle_cierre_inventario_diario dcid1_0 
    join
        cierre_inventario_diario c1_0 
            on c1_0.id=dcid1_0.cierre_id 
    where
        c1_0.estado='COMPLETADO' 
        and c1_0.fecha=(
            select
                max(cid1_0.fecha) 
            from
                cierre_inventario_diario cid1_0 
            where
                cid1_0.estado='COMPLETADO' 
                and cid1_0.fecha<?
        ) 
        and dcid1_0.ingrediente_id is not null
2026-01-26 13:05:44 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-19]
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG j.s.s.s.ReporteConsumoServicio - Stocks iniciales encontrados: 0 registros
2026-01-26 13:05:44 [http-nio-8080-exec-9] INFO  j.s.s.s.ReporteConsumoServicio - üìä Stocks iniciales encontrados: 0
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.ingrediente_id,
        dcid1_0.stock_real 
    from
        detalle_cierre_inventario_diario dcid1_0 
    join
        cierre_inventario_diario c1_0 
            on c1_0.id=dcid1_0.cierre_id 
    where
        c1_0.estado='COMPLETADO' 
        and c1_0.fecha=(
            select
                max(cid1_0.fecha) 
            from
                cierre_inventario_diario cid1_0 
            where
                cid1_0.estado='COMPLETADO' 
                and cid1_0.fecha<=?
        ) 
        and dcid1_0.ingrediente_id is not null
2026-01-26 13:05:44 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG j.s.s.s.ReporteConsumoServicio - Stocks finales encontrados: 2 registros
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@2007910521 wrapping com.mysql.cj.jdbc.ConnectionImpl@7827e241] read-only
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:05:44 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@2007910521 wrapping com.mysql.cj.jdbc.ConnectionImpl@7827e241]
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        p1_0.receta_id,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta 
    from
        producto p1_0 
    where
        not(p1_0.tiene_receta)
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG j.s.s.s.ReporteConsumoServicio - Total ingredientes: 2, Productos sin receta: 0
2026-01-26 13:05:44 [http-nio-8080-exec-9] INFO  j.s.s.s.ReporteConsumoServicio - Procesando 2 ingredientes
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        coalesce(sum(fdp1_0.cantidad), 0) 
    from
        factura_detalle_proveedor fdp1_0 
    join
        factura_proveedor fp1_0 
            on fp1_0.id=fdp1_0.factura_proveedor_id 
    where
        fdp1_0.ingrediente_id=? 
        and fp1_0.fecha between ? and ?
2026-01-26 13:05:44 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:05:44 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:DATE) <- [2026-01-19]
2026-01-26 13:05:44 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:DATE) <- [2026-01-26]
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        coalesce(sum((i1_0.cantidad_ingrediente*fd1_0.cantidad)), 0) 
    from
        factura_detalle fd1_0 
    join
        producto p1_0 
            on p1_0.id=fd1_0.producto_id 
    join
        receta r1_0 
            on r1_0.id=p1_0.receta_id 
    join
        receta_detalle i1_0 
            on r1_0.id=i1_0.receta_id 
    join
        factura f1_0 
            on f1_0.id=fd1_0.factura_id 
    where
        i1_0.ingrediente_id=? 
        and f1_0.fecha between ? and ? 
        and f1_0.estado='PAGADA'
2026-01-26 13:05:44 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:05:44 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:DATE) <- [2026-01-19]
2026-01-26 13:05:44 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:DATE) <- [2026-01-26]
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        coalesce(sum(fdp1_0.cantidad), 0) 
    from
        factura_detalle_proveedor fdp1_0 
    join
        factura_proveedor fp1_0 
            on fp1_0.id=fdp1_0.factura_proveedor_id 
    where
        fdp1_0.ingrediente_id=? 
        and fp1_0.fecha between ? and ?
2026-01-26 13:05:44 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-26 13:05:44 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:DATE) <- [2026-01-19]
2026-01-26 13:05:44 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:DATE) <- [2026-01-26]
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        coalesce(sum((i1_0.cantidad_ingrediente*fd1_0.cantidad)), 0) 
    from
        factura_detalle fd1_0 
    join
        producto p1_0 
            on p1_0.id=fd1_0.producto_id 
    join
        receta r1_0 
            on r1_0.id=p1_0.receta_id 
    join
        receta_detalle i1_0 
            on r1_0.id=i1_0.receta_id 
    join
        factura f1_0 
            on f1_0.id=fd1_0.factura_id 
    where
        i1_0.ingrediente_id=? 
        and f1_0.fecha between ? and ? 
        and f1_0.estado='PAGADA'
2026-01-26 13:05:44 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-26 13:05:44 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:DATE) <- [2026-01-19]
2026-01-26 13:05:44 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:DATE) <- [2026-01-26]
2026-01-26 13:05:44 [http-nio-8080-exec-9] INFO  j.s.s.s.ReporteConsumoServicio - Procesando 0 productos sin receta
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG j.s.s.s.ReporteConsumoServicio - Porcentaje de diferencia calculado: 0.0%
2026-01-26 13:05:44 [http-nio-8080-exec-9] INFO  j.s.s.s.ReporteConsumoServicio - Reporte generado exitosamente. Total items: 2, Diferencia total: 0.0, Porcentaje: 0.0%
2026-01-26 13:05:44 [http-nio-8080-exec-9] INFO  j.s.s.c.ReporteConsumoController - ‚úÖ Reporte generado exitosamente. Items: 2
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG j.s.s.c.ReporteConsumoController - Reporte a√±adido al modelo. Total diferencia: 0.0
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 49, Tenant anterior: 1
2026-01-26 13:05:44 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 49, Request: /reportes/consumo, Empresa ID anterior: 1
2026-01-26 13:06:20 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-26 13:06:20 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A73707BC269A6EC8A786CB2EB73F1787], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:06:20 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-26 13:06:20 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-26 13:06:20 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: defecto.localhost
2026-01-26 13:06:20 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: defecto
2026-01-26 13:06:20 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:06:20 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [defecto]
2026-01-26 13:06:20 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 50
2026-01-26 13:06:20 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 1 (Subdominio: defecto)
2026-01-26 13:06:20 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:06:20 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 1
2026-01-26 13:06:20 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:06:20 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:06:20 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-26 13:06:20 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:06:20 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-26 13:06:20 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 1
2026-01-26 13:06:20 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 1
2026-01-26 13:06:20 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:06:20 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:06:20 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:06:20 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:06:20 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-26 13:06:20 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:06:20 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:06:20 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:06:20 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:06:20 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-26 13:06:20 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 1)
2026-01-26 13:06:20 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:06:20 [http-nio-8080-exec-10] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-26
2026-01-26 13:06:20 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-26 13:06:20 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:06:20 [http-nio-8080-exec-10] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-26
2026-01-26 13:06:20 [http-nio-8080-exec-10] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-26 13:06:20 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 50, Tenant anterior: 1
2026-01-26 13:06:20 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 50, Request: /principal, Empresa ID anterior: 1
2026-01-26 13:08:24 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/empresas/nueva
2026-01-26 13:08:24 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-26 13:08:24 [http-nio-8080-exec-2] DEBUG o.s.s.w.s.HttpSessionRequestCache - Saved request http://localhost:8080/superadmin/empresas/nueva?continue to session
2026-01-26 13:08:24 [http-nio-8080-exec-2] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to http://localhost:8080/superadmin/login
2026-01-26 13:08:24 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/login
2026-01-26 13:08:24 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/login
2026-01-26 13:08:24 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/login
2026-01-26 13:08:24 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/login, Empresa ID: null
2026-01-26 13:08:24 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/login
2026-01-26 13:08:24 [http-nio-8080-exec-3] INFO  j.s.s.c.SuperAdminController - üîì Mostrando p√°gina de login para SUPER_ADMIN
2026-01-26 13:08:24 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-26 13:08:24 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /superadmin/login, Empresa ID anterior: null
2026-01-26 13:08:29 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing POST /superadmin/login
2026-01-26 13:08:29 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: josepino para la empresa ID: null
2026-01-26 13:08:29 [http-nio-8080-exec-4] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: josepino | Subdominio: localhost
2026-01-26 13:08:29 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=?
2026-01-26 13:08:29 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [josepino]
2026-01-26 13:08:29 [http-nio-8080-exec-4] INFO  j.s.s.servicios.UsuarioServicio - ‚úÖ SUPER_ADMIN cargado: josepino - Rol: SUPER_ADMIN
2026-01-26 13:08:29 [http-nio-8080-exec-4] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Authenticated user
2026-01-26 13:08:29 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.s.ChangeSessionIdAuthenticationStrategy - Changed session id from 9C3A54E8B2278F6F8149F90CC1E4FF9C
2026-01-26 13:08:29 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.CsrfAuthenticationStrategy - Replaced CSRF Token
2026-01-26 13:08:29 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Stored SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=9C3A54E8B2278F6F8149F90CC1E4FF9C], Granted Authorities=[ROLE_SUPER_ADMIN]]] to HttpSession [org.apache.catalina.session.StandardSessionFacade@69c18758]
2026-01-26 13:08:29 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.UsernamePasswordAuthenticationFilter - Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=9C3A54E8B2278F6F8149F90CC1E4FF9C], Granted Authorities=[ROLE_SUPER_ADMIN]]
2026-01-26 13:08:29 [http-nio-8080-exec-4] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /superadmin/dashboard
2026-01-26 13:08:29 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/dashboard
2026-01-26 13:08:29 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=9C3A54E8B2278F6F8149F90CC1E4FF9C], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-26 13:08:29 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/dashboard
2026-01-26 13:08:29 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/dashboard
2026-01-26 13:08:29 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/dashboard, Empresa ID: null
2026-01-26 13:08:29 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/dashboard
2026-01-26 13:08:29 [http-nio-8080-exec-5] INFO  j.s.s.c.SuperAdminController - üìä Accediendo al dashboard SUPER_ADMIN
2026-01-26 13:08:29 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 45, Request: /superadmin/dashboard, Empresa ID anterior: null
2026-01-26 13:08:29 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/empresas
2026-01-26 13:08:29 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=9C3A54E8B2278F6F8149F90CC1E4FF9C], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-26 13:08:29 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/empresas
2026-01-26 13:08:29 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/empresas
2026-01-26 13:08:29 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/empresas, Empresa ID: null
2026-01-26 13:08:29 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/empresas
2026-01-26 13:08:29 [http-nio-8080-exec-6] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@1543536169 wrapping com.mysql.cj.jdbc.ConnectionImpl@7827e241] read-only
2026-01-26 13:08:29 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0
2026-01-26 13:08:29 [http-nio-8080-exec-6] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@1543536169 wrapping com.mysql.cj.jdbc.ConnectionImpl@7827e241]
2026-01-26 13:08:29 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 46, Request: /superadmin/empresas, Empresa ID anterior: null
2026-01-26 13:08:31 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/empresas/nueva
2026-01-26 13:08:31 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=9C3A54E8B2278F6F8149F90CC1E4FF9C], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-26 13:08:31 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/empresas/nueva
2026-01-26 13:08:31 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/empresas/nueva
2026-01-26 13:08:31 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/empresas/nueva, Empresa ID: null
2026-01-26 13:08:31 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/empresas/nueva
2026-01-26 13:08:31 [http-nio-8080-exec-7] INFO  j.s.s.c.SuperAdminController - üìÑ [CONTROLLER] Mostrando formulario para crear nueva empresa
2026-01-26 13:08:31 [http-nio-8080-exec-7] DEBUG j.s.s.c.SuperAdminController - üîß Preparando modelo con nuevo EmpresaClienteDTO
2026-01-26 13:08:31 [http-nio-8080-exec-7] INFO  j.s.s.c.SuperAdminController - ‚úÖ Formulario listo para mostrar
2026-01-26 13:08:31 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 47, Request: /superadmin/empresas/nueva, Empresa ID anterior: null
2026-01-26 13:08:50 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing POST /superadmin/empresas/crear
2026-01-26 13:08:50 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=9C3A54E8B2278F6F8149F90CC1E4FF9C], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-26 13:08:50 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured POST /superadmin/empresas/crear
2026-01-26 13:08:50 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/empresas/crear
2026-01-26 13:08:50 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/empresas/crear, Empresa ID: null
2026-01-26 13:08:50 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/empresas/crear
2026-01-26 13:08:50 [http-nio-8080-exec-8] INFO  j.s.s.c.SuperAdminController - üì® [CONTROLLER] Recibiendo solicitud para crear nueva empresa
2026-01-26 13:08:50 [http-nio-8080-exec-8] DEBUG j.s.s.c.SuperAdminController - üìã Datos recibidos: Nombre=Empresa de Moraima, Subdominio=empanadas, Email=josepino@gmail.com, Plan=BASICO
2026-01-26 13:08:50 [http-nio-8080-exec-8] DEBUG j.s.s.c.SuperAdminController - ‚öôÔ∏è Configuraci√≥n: crearUsuarios=true, crearDatosIniciales=true
2026-01-26 13:08:50 [http-nio-8080-exec-8] INFO  j.s.s.c.SuperAdminController - üîÑ Delegando creaci√≥n al SuperAdminService...
2026-01-26 13:08:50 [http-nio-8080-exec-8] INFO  j.s.s.servicios.SuperAdminService - üöÄ [SUPERADMIN] Iniciando creaci√≥n de nueva empresa cliente
2026-01-26 13:08:50 [http-nio-8080-exec-8] INFO  j.s.s.servicios.SuperAdminService - üìã Datos recibidos - Nombre: Empresa de Moraima, Subdominio: empanadas, Email: josepino@gmail.com
2026-01-26 13:08:50 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.SuperAdminService - üîç Validando subdominio: empanadas
2026-01-26 13:08:50 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id 
    from
        empresa e1_0 
    where
        e1_0.subdominio=? 
    limit
        ?
2026-01-26 13:08:51 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [empanadas]
2026-01-26 13:08:51 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [1]
2026-01-26 13:08:51 [http-nio-8080-exec-8] INFO  j.s.s.servicios.SuperAdminService - ‚úÖ Subdominio disponible
2026-01-26 13:08:51 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.SuperAdminService - üèóÔ∏è Creando empresa desde DTO
2026-01-26 13:08:51 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.SuperAdminService - üíæ Guardando empresa en BD
2026-01-26 13:08:51 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        empresa
        (email_contacto, estado, fecha_creacion, nombre, plan, subdominio, telefono) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-26 13:08:51 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [josepino@gmail.com]
2026-01-26 13:08:51 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BOOLEAN) <- [true]
2026-01-26 13:08:51 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:DATE) <- [2026-01-26]
2026-01-26 13:08:51 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [Empresa de Moraima]
2026-01-26 13:08:51 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2026-01-26 13:08:51 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [empanadas]
2026-01-26 13:08:51 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [3115470418]
2026-01-26 13:08:51 [http-nio-8080-exec-8] INFO  j.s.s.servicios.SuperAdminService - ‚úÖ Empresa creada: Empresa de Moraima (ID: 2)
2026-01-26 13:08:51 [http-nio-8080-exec-8] INFO  j.s.s.servicios.SuperAdminService - üë§ Creando usuario administrador...
2026-01-26 13:08:51 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.SuperAdminService - üíæ Guardando usuario admin en BD
2026-01-26 13:08:51 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        usuario
        (activo, contrasenna, empresa_id, nombre_usuario, rol, sucursal_id) 
    values
        (?, ?, ?, ?, ?, ?)
2026-01-26 13:08:51 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-26 13:08:51 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [$2a$10$JfBtGFWdM8Uws4ewn11vLOMTliUjUnL.jQs7RVFTacooJ2dy1PTYG]
2026-01-26 13:08:51 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-26 13:08:51 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [admin]
2026-01-26 13:08:51 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [ADMIN]
2026-01-26 13:08:51 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:BIGINT) <- [null]
2026-01-26 13:08:51 [http-nio-8080-exec-8] INFO  j.s.s.servicios.SuperAdminService - üë§ Usuario creado - Username: admin, Empresa: Empresa de Moraima
2026-01-26 13:08:51 [http-nio-8080-exec-8] INFO  j.s.s.servicios.SuperAdminService - ‚úÖ Usuario admin creado para empresa Empresa de Moraima
2026-01-26 13:08:51 [http-nio-8080-exec-8] INFO  j.s.s.servicios.SuperAdminService - üì¶ Creando datos iniciales...
2026-01-26 13:08:51 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.SuperAdminService - üíæ Guardando cliente en BD
2026-01-26 13:08:51 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        cliente
        (activo, correo, empresa_id, identificacion, nombre, telefono) 
    values
        (?, ?, ?, ?, ?, ?)
2026-01-26 13:08:51 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-26 13:08:51 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [null]
2026-01-26 13:08:51 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-26 13:08:51 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [CF9999999999999]
2026-01-26 13:08:51 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [Consumidor Final]
2026-01-26 13:08:51 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2026-01-26 13:08:51 [http-nio-8080-exec-8] INFO  j.s.s.servicios.SuperAdminService - üë§ Cliente 'Consumidor Final' creado para empresa Empresa de Moraima
2026-01-26 13:08:51 [http-nio-8080-exec-8] INFO  j.s.s.servicios.SuperAdminService - ‚úÖ Datos iniciales creados para empresa Empresa de Moraima
2026-01-26 13:08:51 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.fecha=? 
        and e1_0.id=? 
    limit
        ?
2026-01-26 13:08:51 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:08:51 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-26 13:08:51 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:INTEGER) <- [1]
2026-01-26 13:08:51 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        u1_0.nombre_usuario=? 
        and e1_0.id=?
2026-01-26 13:08:51 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:08:51 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-26 13:08:51 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        cierre_inventario_diario
        (cantidad_facturas, empresa_id, estado, fecha, observaciones, total_ventas, usuario_id) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-26 13:08:51 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:INTEGER) <- [0]
2026-01-26 13:08:51 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-26 13:08:51 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [COMPLETADO]
2026-01-26 13:08:51 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DATE) <- [2026-01-25]
2026-01-26 13:08:51 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [Cierre inicial generado autom√°ticamente]
2026-01-26 13:08:51 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DOUBLE) <- [0.0]
2026-01-26 13:08:51 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:BIGINT) <- [5]
2026-01-26 13:08:51 [http-nio-8080-exec-8] INFO  j.s.s.servicios.SuperAdminService - üìÖ Cierre diario inicial creado para fecha 2026-01-25 - Empresa: Empresa de Moraima
2026-01-26 13:08:51 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.SuperAdminService - üìã Asignando plan: BASICO
2026-01-26 13:08:51 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.SuperAdminService - üí∞ Plan 'BASICO' procesado para empresa Empresa de Moraima
2026-01-26 13:08:51 [http-nio-8080-exec-8] INFO  j.s.s.servicios.SuperAdminService - üí∞ Plan 'BASICO' asignado a empresa Empresa de Moraima
2026-01-26 13:08:51 [http-nio-8080-exec-8] INFO  j.s.s.servicios.SuperAdminService - üéâ Creaci√≥n de empresa cliente completada exitosamente
2026-01-26 13:08:51 [http-nio-8080-exec-8] INFO  j.s.s.c.SuperAdminController - ‚úÖ Empresa creada exitosamente - ID: 2, Nombre: Empresa de Moraima
2026-01-26 13:08:51 [http-nio-8080-exec-8] INFO  j.s.s.c.SuperAdminController - üìä Datos empresa creada: Subdominio=empanadas, Email=josepino@gmail.com
2026-01-26 13:08:51 [http-nio-8080-exec-8] INFO  j.s.s.c.SuperAdminController - üéØ Redirigiendo a p√°gina de √©xito
2026-01-26 13:08:51 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 48, Request: /superadmin/empresas/crear, Empresa ID anterior: null
2026-01-26 13:08:51 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/empresas
2026-01-26 13:08:51 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=9C3A54E8B2278F6F8149F90CC1E4FF9C], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-26 13:08:51 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/empresas
2026-01-26 13:08:51 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/empresas
2026-01-26 13:08:51 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/empresas, Empresa ID: null
2026-01-26 13:08:51 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/empresas
2026-01-26 13:08:51 [http-nio-8080-exec-9] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@177002382 wrapping com.mysql.cj.jdbc.ConnectionImpl@7827e241] read-only
2026-01-26 13:08:51 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0
2026-01-26 13:08:51 [http-nio-8080-exec-9] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@177002382 wrapping com.mysql.cj.jdbc.ConnectionImpl@7827e241]
2026-01-26 13:08:51 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 49, Request: /superadmin/empresas, Empresa ID anterior: null
2026-01-26 13:08:57 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /
2026-01-26 13:08:57 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /
2026-01-26 13:08:57 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /, M√©todo: GET
2026-01-26 13:08:57 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: empanadas.localhost
2026-01-26 13:08:57 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: empanadas
2026-01-26 13:08:57 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:08:57 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [empanadas]
2026-01-26 13:08:57 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 50
2026-01-26 13:08:57 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: empanadas)
2026-01-26 13:08:57 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-26 13:08:57 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /, Empresa ID: 2
2026-01-26 13:08:57 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:08:57 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:08:57 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:08:57 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:08:57 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-26 13:08:57 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:08:57 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:08:57 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:08:57 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:08:57 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-26 13:08:57 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 2)
2026-01-26 13:08:57 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:08:57 [http-nio-8080-exec-10] INFO  j.s.s.controladores.InicioController - üîÄ GET / - Redirigiendo a /login
2026-01-26 13:08:57 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 50, Tenant anterior: 2
2026-01-26 13:08:57 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 50, Request: /, Empresa ID anterior: 2
2026-01-26 13:08:57 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login
2026-01-26 13:08:57 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login
2026-01-26 13:08:57 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-26 13:08:57 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üåê Server Name: empanadas.localhost
2026-01-26 13:08:57 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: empanadas
2026-01-26 13:08:57 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:08:57 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [empanadas]
2026-01-26 13:08:57 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 41
2026-01-26 13:08:57 [http-nio-8080-exec-1] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: empanadas)
2026-01-26 13:08:57 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-26 13:08:57 [http-nio-8080-exec-1] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-26 13:08:57 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 41, Tenant anterior: 2
2026-01-26 13:08:57 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 41, Request: /login, Empresa ID anterior: 2
2026-01-26 13:08:57 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-26 13:08:57 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-26 13:08:57 [http-nio-8080-exec-2] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to http://empanadas.localhost:8080/login
2026-01-26 13:08:57 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login
2026-01-26 13:08:57 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login
2026-01-26 13:08:57 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-26 13:08:57 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: empanadas.localhost
2026-01-26 13:08:57 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: empanadas
2026-01-26 13:08:57 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:08:57 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [empanadas]
2026-01-26 13:08:57 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 43
2026-01-26 13:08:57 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: empanadas)
2026-01-26 13:08:57 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-26 13:08:57 [http-nio-8080-exec-3] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-26 13:08:57 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 43, Tenant anterior: 2
2026-01-26 13:08:57 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /login, Empresa ID anterior: 2
2026-01-26 13:09:02 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-26 13:09:02 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: admin para la empresa ID: null
2026-01-26 13:09:02 [http-nio-8080-exec-4] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: empanadas
2026-01-26 13:09:02 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:09:02 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [empanadas]
2026-01-26 13:09:02 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: empanadas | Empresa ID: 2 | Empresa Nombre: Empresa de Moraima
2026-01-26 13:09:02 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:09:02 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:09:02 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-26 13:09:02 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:09:02 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-26 13:09:02 [http-nio-8080-exec-4] INFO  j.s.s.servicios.UsuarioServicio - üîê Encontrado usuario: admin
2026-01-26 13:09:02 [http-nio-8080-exec-4] INFO  j.s.s.servicios.UsuarioServicio - üîê Rol: ADMIN
2026-01-26 13:09:02 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - üîê Activo: true
2026-01-26 13:09:02 [http-nio-8080-exec-4] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Authenticated user
2026-01-26 13:09:02 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.s.ChangeSessionIdAuthenticationStrategy - Changed session id from 02FE63F3D9750664D2325EA510A01FAE
2026-01-26 13:09:02 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.CsrfAuthenticationStrategy - Replaced CSRF Token
2026-01-26 13:09:02 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Stored SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=02FE63F3D9750664D2325EA510A01FAE], Granted Authorities=[ROLE_ADMIN]]] to HttpSession [org.apache.catalina.session.StandardSessionFacade@70500e62]
2026-01-26 13:09:02 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.UsernamePasswordAuthenticationFilter - Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=02FE63F3D9750664D2325EA510A01FAE], Granted Authorities=[ROLE_ADMIN]]
2026-01-26 13:09:02 [http-nio-8080-exec-4] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /principal
2026-01-26 13:09:02 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-26 13:09:02 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=02FE63F3D9750664D2325EA510A01FAE], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:09:02 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-26 13:09:02 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-26 13:09:02 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: empanadas.localhost
2026-01-26 13:09:02 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: empanadas
2026-01-26 13:09:02 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:09:02 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [empanadas]
2026-01-26 13:09:02 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 45
2026-01-26 13:09:02 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: empanadas)
2026-01-26 13:09:02 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:09:02 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-26 13:09:02 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:09:02 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:09:02 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-26 13:09:02 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:09:02 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-26 13:09:02 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-26 13:09:02 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-26 13:09:02 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:09:02 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:09:02 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:09:02 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:09:02 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-26 13:09:02 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:09:02 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:09:02 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:09:02 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:09:02 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-26 13:09:02 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 2)
2026-01-26 13:09:02 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:09:02 [http-nio-8080-exec-5] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-26
2026-01-26 13:09:02 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-26 13:09:02 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:09:02 [http-nio-8080-exec-5] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-26
2026-01-26 13:09:02 [http-nio-8080-exec-5] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-26 13:09:02 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 45, Tenant anterior: 2
2026-01-26 13:09:02 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 45, Request: /principal, Empresa ID anterior: 2
2026-01-26 13:09:02 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-26 13:09:02 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=02FE63F3D9750664D2325EA510A01FAE], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:09:02 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-26 13:09:02 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-26 13:09:02 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: empanadas.localhost
2026-01-26 13:09:02 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: empanadas
2026-01-26 13:09:02 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:09:02 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [empanadas]
2026-01-26 13:09:02 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 46
2026-01-26 13:09:02 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: empanadas)
2026-01-26 13:09:02 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:09:02 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-26 13:09:02 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:09:02 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:09:02 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-26 13:09:02 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:09:02 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-26 13:09:02 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-26 13:09:02 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 2
2026-01-26 13:09:02 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:09:02 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:09:02 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:09:02 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:09:02 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-26 13:09:02 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:09:02 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:09:02 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:09:02 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:09:02 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-26 13:09:02 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 2)
2026-01-26 13:09:02 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:09:02 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 46, Tenant anterior: 2
2026-01-26 13:09:02 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 46, Request: /favicon.ico, Empresa ID anterior: 2
2026-01-26 13:09:02 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /error
2026-01-26 13:09:02 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /error
2026-01-26 13:09:02 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=02FE63F3D9750664D2325EA510A01FAE], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:09:07 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres
2026-01-26 13:09:07 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=02FE63F3D9750664D2325EA510A01FAE], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:09:07 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres
2026-01-26 13:09:07 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres, M√©todo: GET
2026-01-26 13:09:07 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: empanadas.localhost
2026-01-26 13:09:07 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: empanadas
2026-01-26 13:09:07 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:09:07 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [empanadas]
2026-01-26 13:09:07 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 47
2026-01-26 13:09:07 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: empanadas)
2026-01-26 13:09:07 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:09:07 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-26 13:09:07 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:09:07 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:09:07 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-26 13:09:07 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:09:07 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-26 13:09:07 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-26 13:09:07 [http-nio-8080-exec-7] INFO  j.s.s.c.CierreInventarioDiarioControlador - üìã GET /cierres - Listando cierres diarios
2026-01-26 13:09:07 [http-nio-8080-exec-7] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo todos los cierres para empresa ID: 2
2026-01-26 13:09:07 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        e1_0.id=?
2026-01-26 13:09:07 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-26 13:09:07 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:09:07 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-26 13:09:07 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-26 13:09:07 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-26 13:09:07 [http-nio-8080-exec-7] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 1 cierres para empresa ID: 2
2026-01-26 13:09:07 [http-nio-8080-exec-7] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Encontrados 1 cierres
2026-01-26 13:09:07 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 47, Tenant anterior: 2
2026-01-26 13:09:07 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 47, Request: /cierres, Empresa ID anterior: 2
2026-01-26 13:09:12 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/detalle/6
2026-01-26 13:09:12 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=02FE63F3D9750664D2325EA510A01FAE], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:09:12 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/detalle/6
2026-01-26 13:09:12 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/detalle/6, M√©todo: GET
2026-01-26 13:09:12 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üåê Server Name: empanadas.localhost
2026-01-26 13:09:12 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: empanadas
2026-01-26 13:09:12 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:09:12 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [empanadas]
2026-01-26 13:09:12 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 48
2026-01-26 13:09:12 [http-nio-8080-exec-8] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: empanadas)
2026-01-26 13:09:12 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:09:12 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-26 13:09:12 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:09:12 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:09:12 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-26 13:09:12 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:09:12 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-26 13:09:12 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-26 13:09:12 [http-nio-8080-exec-8] INFO  j.s.s.c.CierreInventarioDiarioControlador - üëÅÔ∏è GET /cierres/detalle/6 - Viendo detalles de cierre
2026-01-26 13:09:12 [http-nio-8080-exec-8] DEBUG j.s.s.s.CierreInventarioDiarioService - Buscando cierre ID: 6 para empresa ID: 2
2026-01-26 13:09:12 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.id=? 
        and e1_0.id=?
2026-01-26 13:09:12 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [6]
2026-01-26 13:09:12 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-26 13:09:12 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:09:12 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-26 13:09:12 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-26 13:09:12 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-26 13:09:12 [http-nio-8080-exec-8] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo detalles para cierre ID: 6
2026-01-26 13:09:12 [http-nio-8080-exec-8] DEBUG j.s.s.s.CierreInventarioDiarioService - Buscando cierre ID: 6 para empresa ID: 2
2026-01-26 13:09:12 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.id=? 
        and e1_0.id=?
2026-01-26 13:09:12 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [6]
2026-01-26 13:09:12 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-26 13:09:12 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:09:12 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-26 13:09:12 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-26 13:09:12 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-26 13:09:12 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        dcid1_0.ingrediente_id,
        dcid1_0.producto_id,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    where
        dcid1_0.cierre_id=?
2026-01-26 13:09:12 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [6]
2026-01-26 13:09:12 [http-nio-8080-exec-8] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 0 detalles para cierre ID: 6
2026-01-26 13:09:12 [http-nio-8080-exec-8] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Cierre ID: 6, Estado: COMPLETADO, Detalles: 0, Diferencia total: 0.0
2026-01-26 13:09:12 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 48, Tenant anterior: 2
2026-01-26 13:09:12 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 48, Request: /cierres/detalle/6, Empresa ID anterior: 2
2026-01-26 13:09:13 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres
2026-01-26 13:09:13 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=02FE63F3D9750664D2325EA510A01FAE], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:09:13 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres
2026-01-26 13:09:13 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres, M√©todo: GET
2026-01-26 13:09:13 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: empanadas.localhost
2026-01-26 13:09:13 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: empanadas
2026-01-26 13:09:13 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:09:13 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [empanadas]
2026-01-26 13:09:13 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 49
2026-01-26 13:09:13 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: empanadas)
2026-01-26 13:09:13 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:09:13 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-26 13:09:13 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:09:13 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:09:13 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-26 13:09:13 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:09:13 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-26 13:09:13 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-26 13:09:13 [http-nio-8080-exec-9] INFO  j.s.s.c.CierreInventarioDiarioControlador - üìã GET /cierres - Listando cierres diarios
2026-01-26 13:09:13 [http-nio-8080-exec-9] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo todos los cierres para empresa ID: 2
2026-01-26 13:09:13 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        e1_0.id=?
2026-01-26 13:09:13 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-26 13:09:13 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:09:13 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-26 13:09:13 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-26 13:09:13 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [5]
2026-01-26 13:09:13 [http-nio-8080-exec-9] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 1 cierres para empresa ID: 2
2026-01-26 13:09:13 [http-nio-8080-exec-9] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Encontrados 1 cierres
2026-01-26 13:09:13 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 49, Tenant anterior: 2
2026-01-26 13:09:13 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 49, Request: /cierres, Empresa ID anterior: 2
2026-01-26 13:09:15 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-26 13:09:15 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=02FE63F3D9750664D2325EA510A01FAE], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:09:15 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-26 13:09:15 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-26 13:09:15 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: empanadas.localhost
2026-01-26 13:09:15 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: empanadas
2026-01-26 13:09:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:09:15 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [empanadas]
2026-01-26 13:09:15 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 50
2026-01-26 13:09:15 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: empanadas)
2026-01-26 13:09:15 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:09:15 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-26 13:09:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:09:15 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:09:15 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-26 13:09:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:09:15 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-26 13:09:15 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-26 13:09:15 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-26 13:09:15 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:09:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:09:15 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:09:15 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:09:15 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-26 13:09:15 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:09:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:09:15 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:09:15 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:09:15 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-26 13:09:15 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 2)
2026-01-26 13:09:15 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:09:15 [http-nio-8080-exec-10] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-26
2026-01-26 13:09:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-26 13:09:15 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:09:15 [http-nio-8080-exec-10] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-26
2026-01-26 13:09:15 [http-nio-8080-exec-10] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-26 13:09:15 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 50, Tenant anterior: 2
2026-01-26 13:09:15 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 50, Request: /principal, Empresa ID anterior: 2
2026-01-26 13:09:24 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing POST /logout
2026-01-26 13:09:24 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=02FE63F3D9750664D2325EA510A01FAE], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:09:24 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.logout.LogoutFilter - Logging out [UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=02FE63F3D9750664D2325EA510A01FAE], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:09:24 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.l.SecurityContextLogoutHandler - Invalidated session 41757F7A1703E51E2DE0DC06FF374DDD
2026-01-26 13:09:24 [http-nio-8080-exec-1] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /login?logout
2026-01-26 13:09:24 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login?logout
2026-01-26 13:09:24 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login?logout
2026-01-26 13:09:24 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-26 13:09:24 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üåê Server Name: empanadas.localhost
2026-01-26 13:09:24 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: empanadas
2026-01-26 13:09:24 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:09:24 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [empanadas]
2026-01-26 13:09:24 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 42
2026-01-26 13:09:24 [http-nio-8080-exec-2] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: empanadas)
2026-01-26 13:09:24 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-26 13:09:24 [http-nio-8080-exec-2] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-26 13:09:24 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 42, Tenant anterior: 2
2026-01-26 13:09:24 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 42, Request: /login, Empresa ID anterior: 2
2026-01-26 13:09:26 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/empresas/nueva
2026-01-26 13:09:26 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=9C3A54E8B2278F6F8149F90CC1E4FF9C], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-26 13:09:26 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/empresas/nueva
2026-01-26 13:09:26 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/empresas/nueva
2026-01-26 13:09:26 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/empresas/nueva, Empresa ID: null
2026-01-26 13:09:26 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/empresas/nueva
2026-01-26 13:09:26 [http-nio-8080-exec-3] INFO  j.s.s.c.SuperAdminController - üìÑ [CONTROLLER] Mostrando formulario para crear nueva empresa
2026-01-26 13:09:26 [http-nio-8080-exec-3] DEBUG j.s.s.c.SuperAdminController - üîß Preparando modelo con nuevo EmpresaClienteDTO
2026-01-26 13:09:26 [http-nio-8080-exec-3] INFO  j.s.s.c.SuperAdminController - ‚úÖ Formulario listo para mostrar
2026-01-26 13:09:26 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /superadmin/empresas/nueva, Empresa ID anterior: null
2026-01-26 13:09:29 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/dashboard
2026-01-26 13:09:29 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=9C3A54E8B2278F6F8149F90CC1E4FF9C], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-26 13:09:29 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/dashboard
2026-01-26 13:09:29 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/dashboard
2026-01-26 13:09:29 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/dashboard, Empresa ID: null
2026-01-26 13:09:29 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/dashboard
2026-01-26 13:09:29 [http-nio-8080-exec-4] INFO  j.s.s.c.SuperAdminController - üìä Accediendo al dashboard SUPER_ADMIN
2026-01-26 13:09:29 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 44, Request: /superadmin/dashboard, Empresa ID anterior: null
2026-01-26 13:09:29 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/empresas
2026-01-26 13:09:29 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=9C3A54E8B2278F6F8149F90CC1E4FF9C], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-26 13:09:29 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/empresas
2026-01-26 13:09:29 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/empresas
2026-01-26 13:09:29 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/empresas, Empresa ID: null
2026-01-26 13:09:29 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/empresas
2026-01-26 13:09:29 [http-nio-8080-exec-5] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@242730330 wrapping com.mysql.cj.jdbc.ConnectionImpl@7827e241] read-only
2026-01-26 13:09:29 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0
2026-01-26 13:09:29 [http-nio-8080-exec-5] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@242730330 wrapping com.mysql.cj.jdbc.ConnectionImpl@7827e241]
2026-01-26 13:09:29 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 45, Request: /superadmin/empresas, Empresa ID anterior: null
2026-01-26 13:09:33 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/empresas/nueva
2026-01-26 13:09:33 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=9C3A54E8B2278F6F8149F90CC1E4FF9C], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-26 13:09:33 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/empresas/nueva
2026-01-26 13:09:33 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/empresas/nueva
2026-01-26 13:09:33 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/empresas/nueva, Empresa ID: null
2026-01-26 13:09:33 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/empresas/nueva
2026-01-26 13:09:33 [http-nio-8080-exec-6] INFO  j.s.s.c.SuperAdminController - üìÑ [CONTROLLER] Mostrando formulario para crear nueva empresa
2026-01-26 13:09:33 [http-nio-8080-exec-6] DEBUG j.s.s.c.SuperAdminController - üîß Preparando modelo con nuevo EmpresaClienteDTO
2026-01-26 13:09:33 [http-nio-8080-exec-6] INFO  j.s.s.c.SuperAdminController - ‚úÖ Formulario listo para mostrar
2026-01-26 13:09:33 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 46, Request: /superadmin/empresas/nueva, Empresa ID anterior: null
2026-01-26 13:09:49 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing POST /superadmin/empresas/crear
2026-01-26 13:09:49 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=9C3A54E8B2278F6F8149F90CC1E4FF9C], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-26 13:09:49 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured POST /superadmin/empresas/crear
2026-01-26 13:09:49 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/empresas/crear
2026-01-26 13:09:49 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/empresas/crear, Empresa ID: null
2026-01-26 13:09:49 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/empresas/crear
2026-01-26 13:09:49 [http-nio-8080-exec-7] INFO  j.s.s.c.SuperAdminController - üì® [CONTROLLER] Recibiendo solicitud para crear nueva empresa
2026-01-26 13:09:49 [http-nio-8080-exec-7] DEBUG j.s.s.c.SuperAdminController - üìã Datos recibidos: Nombre=Empresa Kristoff, Subdominio=kristoff, Email=bombay@gmail.com, Plan=BASICO
2026-01-26 13:09:49 [http-nio-8080-exec-7] DEBUG j.s.s.c.SuperAdminController - ‚öôÔ∏è Configuraci√≥n: crearUsuarios=true, crearDatosIniciales=true
2026-01-26 13:09:49 [http-nio-8080-exec-7] INFO  j.s.s.c.SuperAdminController - üîÑ Delegando creaci√≥n al SuperAdminService...
2026-01-26 13:09:49 [http-nio-8080-exec-7] INFO  j.s.s.servicios.SuperAdminService - üöÄ [SUPERADMIN] Iniciando creaci√≥n de nueva empresa cliente
2026-01-26 13:09:49 [http-nio-8080-exec-7] INFO  j.s.s.servicios.SuperAdminService - üìã Datos recibidos - Nombre: Empresa Kristoff, Subdominio: kristoff, Email: bombay@gmail.com
2026-01-26 13:09:49 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.SuperAdminService - üîç Validando subdominio: kristoff
2026-01-26 13:09:49 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id 
    from
        empresa e1_0 
    where
        e1_0.subdominio=? 
    limit
        ?
2026-01-26 13:09:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:09:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [1]
2026-01-26 13:09:49 [http-nio-8080-exec-7] INFO  j.s.s.servicios.SuperAdminService - ‚úÖ Subdominio disponible
2026-01-26 13:09:49 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.SuperAdminService - üèóÔ∏è Creando empresa desde DTO
2026-01-26 13:09:49 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.SuperAdminService - üíæ Guardando empresa en BD
2026-01-26 13:09:49 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        empresa
        (email_contacto, estado, fecha_creacion, nombre, plan, subdominio, telefono) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-26 13:09:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [bombay@gmail.com]
2026-01-26 13:09:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BOOLEAN) <- [true]
2026-01-26 13:09:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:DATE) <- [2026-01-26]
2026-01-26 13:09:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [Empresa Kristoff]
2026-01-26 13:09:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2026-01-26 13:09:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [kristoff]
2026-01-26 13:09:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [3115470418]
2026-01-26 13:09:49 [http-nio-8080-exec-7] INFO  j.s.s.servicios.SuperAdminService - ‚úÖ Empresa creada: Empresa Kristoff (ID: 3)
2026-01-26 13:09:49 [http-nio-8080-exec-7] INFO  j.s.s.servicios.SuperAdminService - üë§ Creando usuario administrador...
2026-01-26 13:09:49 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.SuperAdminService - üíæ Guardando usuario admin en BD
2026-01-26 13:09:49 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        usuario
        (activo, contrasenna, empresa_id, nombre_usuario, rol, sucursal_id) 
    values
        (?, ?, ?, ?, ?, ?)
2026-01-26 13:09:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-26 13:09:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [$2a$10$k4GuJ77Sq1C1yUshTvQc8eRQOeYHulzoH/bgYcU7.ZtDG9aCHKcs2]
2026-01-26 13:09:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:09:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [admin]
2026-01-26 13:09:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [ADMIN]
2026-01-26 13:09:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:BIGINT) <- [null]
2026-01-26 13:09:49 [http-nio-8080-exec-7] INFO  j.s.s.servicios.SuperAdminService - üë§ Usuario creado - Username: admin, Empresa: Empresa Kristoff
2026-01-26 13:09:49 [http-nio-8080-exec-7] INFO  j.s.s.servicios.SuperAdminService - ‚úÖ Usuario admin creado para empresa Empresa Kristoff
2026-01-26 13:09:49 [http-nio-8080-exec-7] INFO  j.s.s.servicios.SuperAdminService - üì¶ Creando datos iniciales...
2026-01-26 13:09:49 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.SuperAdminService - üíæ Guardando cliente en BD
2026-01-26 13:09:49 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        cliente
        (activo, correo, empresa_id, identificacion, nombre, telefono) 
    values
        (?, ?, ?, ?, ?, ?)
2026-01-26 13:09:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-26 13:09:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [null]
2026-01-26 13:09:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:09:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [CF9999999999999]
2026-01-26 13:09:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [Consumidor Final]
2026-01-26 13:09:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2026-01-26 13:09:49 [http-nio-8080-exec-7] INFO  j.s.s.servicios.SuperAdminService - üë§ Cliente 'Consumidor Final' creado para empresa Empresa Kristoff
2026-01-26 13:09:49 [http-nio-8080-exec-7] INFO  j.s.s.servicios.SuperAdminService - ‚úÖ Datos iniciales creados para empresa Empresa Kristoff
2026-01-26 13:09:49 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.fecha=? 
        and e1_0.id=? 
    limit
        ?
2026-01-26 13:09:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:09:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:09:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:INTEGER) <- [1]
2026-01-26 13:09:49 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        u1_0.nombre_usuario=? 
        and e1_0.id=?
2026-01-26 13:09:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:09:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:09:49 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        cierre_inventario_diario
        (cantidad_facturas, empresa_id, estado, fecha, observaciones, total_ventas, usuario_id) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-26 13:09:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:INTEGER) <- [0]
2026-01-26 13:09:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:09:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [COMPLETADO]
2026-01-26 13:09:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DATE) <- [2026-01-25]
2026-01-26 13:09:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [Cierre inicial generado autom√°ticamente]
2026-01-26 13:09:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DOUBLE) <- [0.0]
2026-01-26 13:09:49 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:BIGINT) <- [6]
2026-01-26 13:09:49 [http-nio-8080-exec-7] INFO  j.s.s.servicios.SuperAdminService - üìÖ Cierre diario inicial creado para fecha 2026-01-25 - Empresa: Empresa Kristoff
2026-01-26 13:09:49 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.SuperAdminService - üìã Asignando plan: BASICO
2026-01-26 13:09:49 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.SuperAdminService - üí∞ Plan 'BASICO' procesado para empresa Empresa Kristoff
2026-01-26 13:09:49 [http-nio-8080-exec-7] INFO  j.s.s.servicios.SuperAdminService - üí∞ Plan 'BASICO' asignado a empresa Empresa Kristoff
2026-01-26 13:09:49 [http-nio-8080-exec-7] INFO  j.s.s.servicios.SuperAdminService - üéâ Creaci√≥n de empresa cliente completada exitosamente
2026-01-26 13:09:49 [http-nio-8080-exec-7] INFO  j.s.s.c.SuperAdminController - ‚úÖ Empresa creada exitosamente - ID: 3, Nombre: Empresa Kristoff
2026-01-26 13:09:49 [http-nio-8080-exec-7] INFO  j.s.s.c.SuperAdminController - üìä Datos empresa creada: Subdominio=kristoff, Email=bombay@gmail.com
2026-01-26 13:09:49 [http-nio-8080-exec-7] INFO  j.s.s.c.SuperAdminController - üéØ Redirigiendo a p√°gina de √©xito
2026-01-26 13:09:49 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 47, Request: /superadmin/empresas/crear, Empresa ID anterior: null
2026-01-26 13:09:50 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/empresas
2026-01-26 13:09:50 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=9C3A54E8B2278F6F8149F90CC1E4FF9C], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-26 13:09:50 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/empresas
2026-01-26 13:09:50 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/empresas
2026-01-26 13:09:50 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/empresas, Empresa ID: null
2026-01-26 13:09:50 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/empresas
2026-01-26 13:09:50 [http-nio-8080-exec-8] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@1720730083 wrapping com.mysql.cj.jdbc.ConnectionImpl@7827e241] read-only
2026-01-26 13:09:50 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0
2026-01-26 13:09:50 [http-nio-8080-exec-8] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@1720730083 wrapping com.mysql.cj.jdbc.ConnectionImpl@7827e241]
2026-01-26 13:09:50 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 48, Request: /superadmin/empresas, Empresa ID anterior: null
2026-01-26 13:09:56 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /
2026-01-26 13:09:56 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /
2026-01-26 13:09:56 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /, M√©todo: GET
2026-01-26 13:09:56 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:09:56 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:09:56 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:09:56 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:09:56 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 49
2026-01-26 13:09:56 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:09:56 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-26 13:09:56 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /, Empresa ID: 3
2026-01-26 13:09:56 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:09:56 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:09:56 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:09:56 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:09:56 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:09:56 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:09:56 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:09:56 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:09:56 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:09:56 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:09:56 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:09:56 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:09:56 [http-nio-8080-exec-9] INFO  j.s.s.controladores.InicioController - üîÄ GET / - Redirigiendo a /login
2026-01-26 13:09:56 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 49, Tenant anterior: 3
2026-01-26 13:09:56 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 49, Request: /, Empresa ID anterior: 3
2026-01-26 13:09:56 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login
2026-01-26 13:09:56 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login
2026-01-26 13:09:56 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-26 13:09:56 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:09:56 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:09:56 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:09:56 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:09:56 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 50
2026-01-26 13:09:56 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:09:56 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-26 13:09:56 [http-nio-8080-exec-10] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-26 13:09:56 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 50, Tenant anterior: 3
2026-01-26 13:09:56 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 50, Request: /login, Empresa ID anterior: 3
2026-01-26 13:09:57 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-26 13:09:57 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-26 13:09:57 [http-nio-8080-exec-1] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to http://kristoff.localhost:8080/login
2026-01-26 13:09:57 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login
2026-01-26 13:09:57 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login
2026-01-26 13:09:57 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-26 13:09:57 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:09:57 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:09:57 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:09:57 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:09:57 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 42
2026-01-26 13:09:57 [http-nio-8080-exec-2] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:09:57 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-26 13:09:57 [http-nio-8080-exec-2] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-26 13:09:57 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 42, Tenant anterior: 3
2026-01-26 13:09:57 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 42, Request: /login, Empresa ID anterior: 3
2026-01-26 13:10:14 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-26 13:10:14 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: admin para la empresa ID: null
2026-01-26 13:10:14 [http-nio-8080-exec-3] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: kristoff
2026-01-26 13:10:14 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:10:14 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:10:14 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: kristoff | Empresa ID: 3 | Empresa Nombre: Empresa Kristoff
2026-01-26 13:10:14 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:10:14 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:10:14 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:10:14 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:10:14 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:10:14 [http-nio-8080-exec-3] INFO  j.s.s.servicios.UsuarioServicio - üîê Encontrado usuario: admin
2026-01-26 13:10:14 [http-nio-8080-exec-3] INFO  j.s.s.servicios.UsuarioServicio - üîê Rol: ADMIN
2026-01-26 13:10:14 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - üîê Activo: true
2026-01-26 13:10:14 [http-nio-8080-exec-3] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Authenticated user
2026-01-26 13:10:14 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.s.ChangeSessionIdAuthenticationStrategy - Changed session id from 4C94B07E87897BD10F6282AF5F9DADBB
2026-01-26 13:10:14 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.CsrfAuthenticationStrategy - Replaced CSRF Token
2026-01-26 13:10:14 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Stored SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=4C94B07E87897BD10F6282AF5F9DADBB], Granted Authorities=[ROLE_ADMIN]]] to HttpSession [org.apache.catalina.session.StandardSessionFacade@7a0fedfe]
2026-01-26 13:10:14 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.UsernamePasswordAuthenticationFilter - Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=4C94B07E87897BD10F6282AF5F9DADBB], Granted Authorities=[ROLE_ADMIN]]
2026-01-26 13:10:14 [http-nio-8080-exec-3] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /principal
2026-01-26 13:10:14 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-26 13:10:14 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=4C94B07E87897BD10F6282AF5F9DADBB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:10:14 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-26 13:10:14 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-26 13:10:14 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:10:14 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:10:14 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:10:14 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:10:14 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 44
2026-01-26 13:10:14 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:10:14 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:10:14 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-26 13:10:14 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:10:14 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:10:14 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:10:14 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:10:14 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:10:14 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-26 13:10:14 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 3
2026-01-26 13:10:14 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:10:14 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:10:14 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:10:14 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:10:14 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:10:14 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:10:14 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:10:14 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:10:14 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:10:14 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:10:14 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:10:14 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:10:14 [http-nio-8080-exec-4] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-26
2026-01-26 13:10:14 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-26 13:10:14 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:10:14 [http-nio-8080-exec-4] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-26
2026-01-26 13:10:14 [http-nio-8080-exec-4] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-26 13:10:14 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 44, Tenant anterior: 3
2026-01-26 13:10:14 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 44, Request: /principal, Empresa ID anterior: 3
2026-01-26 13:10:14 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-26 13:10:14 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=4C94B07E87897BD10F6282AF5F9DADBB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:10:14 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-26 13:10:14 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-26 13:10:14 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:10:14 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:10:14 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:10:14 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:10:14 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 45
2026-01-26 13:10:14 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:10:14 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:10:14 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-26 13:10:14 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:10:14 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:10:14 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:10:14 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:10:14 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:10:14 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-26 13:10:14 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 3
2026-01-26 13:10:14 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:10:14 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:10:14 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:10:14 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:10:14 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:10:14 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:10:14 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:10:14 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:10:14 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:10:14 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:10:14 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:10:14 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:10:14 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 45, Tenant anterior: 3
2026-01-26 13:10:14 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 45, Request: /favicon.ico, Empresa ID anterior: 3
2026-01-26 13:10:14 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /error
2026-01-26 13:10:14 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /error
2026-01-26 13:10:14 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=4C94B07E87897BD10F6282AF5F9DADBB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:10:18 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios
2026-01-26 13:10:18 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=4C94B07E87897BD10F6282AF5F9DADBB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:10:18 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios
2026-01-26 13:10:18 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios, M√©todo: GET
2026-01-26 13:10:18 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:10:18 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:10:18 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:10:18 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:10:18 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 46
2026-01-26 13:10:18 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:10:18 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:10:18 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-26 13:10:18 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:10:18 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:10:18 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:10:18 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:10:18 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:10:18 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-26 13:10:18 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios, Empresa ID: 3
2026-01-26 13:10:18 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:10:18 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:10:18 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:10:18 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:10:18 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:10:18 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:10:18 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:10:18 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:10:18 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:10:18 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:10:18 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:10:18 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:10:18 [http-nio-8080-exec-6] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-26 13:10:18 [http-nio-8080-exec-6] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-26 13:10:18 [http-nio-8080-exec-6] INFO  j.s.s.c.UsuarioControlador - üìã GET /admin/usuarios - Listando usuarios
2026-01-26 13:10:18 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Listando usuarios para empresa ID: 3
2026-01-26 13:10:18 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-26 13:10:18 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:10:18 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:10:18 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:10:18 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 46, Tenant anterior: 3
2026-01-26 13:10:18 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 46, Request: /admin/usuarios, Empresa ID anterior: 3
2026-01-26 13:10:20 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios/editar/6
2026-01-26 13:10:20 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=4C94B07E87897BD10F6282AF5F9DADBB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:10:20 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios/editar/6
2026-01-26 13:10:20 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios/editar/6, M√©todo: GET
2026-01-26 13:10:20 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:10:20 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:10:20 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:10:20 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:10:20 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 47
2026-01-26 13:10:20 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:10:20 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:10:20 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-26 13:10:20 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:10:20 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:10:20 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:10:20 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:10:20 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:10:20 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-26 13:10:20 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios/editar/6, Empresa ID: 3
2026-01-26 13:10:20 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:10:20 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:10:20 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:10:20 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:10:20 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:10:20 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:10:20 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:10:20 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:10:20 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:10:20 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:10:20 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:10:20 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:10:20 [http-nio-8080-exec-7] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.mostrarFormularioEditar(java.lang.Long,org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-26 13:10:20 [http-nio-8080-exec-7] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.mostrarFormularioEditar(java.lang.Long,org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-26 13:10:20 [http-nio-8080-exec-7] INFO  j.s.s.c.UsuarioControlador - ‚úèÔ∏è GET /admin/usuarios/editar/6 - Editando usuario
2026-01-26 13:10:20 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Obteniendo usuario ID: 6 para empresa ID: 3
2026-01-26 13:10:20 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        u1_0.id=? 
        and e1_0.id=?
2026-01-26 13:10:20 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [6]
2026-01-26 13:10:20 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:10:20 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:10:20 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:10:20 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 47, Tenant anterior: 3
2026-01-26 13:10:20 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 47, Request: /admin/usuarios/editar/6, Empresa ID anterior: 3
2026-01-26 13:10:29 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios
2026-01-26 13:10:29 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=4C94B07E87897BD10F6282AF5F9DADBB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:10:29 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios
2026-01-26 13:10:29 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios, M√©todo: GET
2026-01-26 13:10:29 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:10:29 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:10:29 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:10:29 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:10:29 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 49
2026-01-26 13:10:29 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:10:29 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:10:29 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-26 13:10:29 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:10:29 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:10:29 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:10:29 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:10:29 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:10:29 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-26 13:10:29 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios, Empresa ID: 3
2026-01-26 13:10:29 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:10:29 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:10:29 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:10:29 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:10:29 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:10:29 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:10:29 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:10:29 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:10:29 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:10:29 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:10:29 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:10:29 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:10:29 [http-nio-8080-exec-9] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-26 13:10:29 [http-nio-8080-exec-9] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-26 13:10:29 [http-nio-8080-exec-9] INFO  j.s.s.c.UsuarioControlador - üìã GET /admin/usuarios - Listando usuarios
2026-01-26 13:10:29 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Listando usuarios para empresa ID: 3
2026-01-26 13:10:29 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-26 13:10:29 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:10:29 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:10:29 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:10:29 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 49, Tenant anterior: 3
2026-01-26 13:10:29 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 49, Request: /admin/usuarios, Empresa ID anterior: 3
2026-01-26 13:10:31 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios/editar/6
2026-01-26 13:10:31 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=4C94B07E87897BD10F6282AF5F9DADBB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:10:31 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios/editar/6
2026-01-26 13:10:31 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios/editar/6, M√©todo: GET
2026-01-26 13:10:31 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:10:31 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:10:31 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:10:31 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:10:31 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 50
2026-01-26 13:10:31 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:10:31 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:10:31 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-26 13:10:31 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:10:31 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:10:31 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:10:31 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:10:31 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:10:31 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-26 13:10:31 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios/editar/6, Empresa ID: 3
2026-01-26 13:10:31 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:10:31 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:10:31 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:10:31 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:10:31 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:10:31 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:10:31 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:10:31 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:10:31 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:10:31 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:10:31 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:10:31 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:10:31 [http-nio-8080-exec-10] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.mostrarFormularioEditar(java.lang.Long,org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-26 13:10:31 [http-nio-8080-exec-10] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.mostrarFormularioEditar(java.lang.Long,org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-26 13:10:31 [http-nio-8080-exec-10] INFO  j.s.s.c.UsuarioControlador - ‚úèÔ∏è GET /admin/usuarios/editar/6 - Editando usuario
2026-01-26 13:10:31 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Obteniendo usuario ID: 6 para empresa ID: 3
2026-01-26 13:10:31 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        u1_0.id=? 
        and e1_0.id=?
2026-01-26 13:10:31 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [6]
2026-01-26 13:10:31 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:10:31 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:10:31 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:10:31 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 50, Tenant anterior: 3
2026-01-26 13:10:31 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 50, Request: /admin/usuarios/editar/6, Empresa ID anterior: 3
2026-01-26 13:11:10 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios
2026-01-26 13:11:10 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=4C94B07E87897BD10F6282AF5F9DADBB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:11:10 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios
2026-01-26 13:11:10 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios, M√©todo: GET
2026-01-26 13:11:10 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:11:10 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:11:10 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:11:10 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:11:10 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 42
2026-01-26 13:11:10 [http-nio-8080-exec-2] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:11:10 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:11:10 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-26 13:11:10 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:11:10 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:11:10 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:11:10 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:11:10 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:11:10 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-26 13:11:10 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios, Empresa ID: 3
2026-01-26 13:11:10 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:11:10 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:11:10 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:11:10 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:11:10 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:11:10 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:11:10 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:11:10 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:11:10 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:11:10 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:11:10 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:11:10 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:11:10 [http-nio-8080-exec-2] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-26 13:11:10 [http-nio-8080-exec-2] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-26 13:11:10 [http-nio-8080-exec-2] INFO  j.s.s.c.UsuarioControlador - üìã GET /admin/usuarios - Listando usuarios
2026-01-26 13:11:10 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - Listando usuarios para empresa ID: 3
2026-01-26 13:11:10 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-26 13:11:10 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:11:10 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:11:10 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:11:10 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 42, Tenant anterior: 3
2026-01-26 13:11:10 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 42, Request: /admin/usuarios, Empresa ID anterior: 3
2026-01-26 13:11:12 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios/editar/6
2026-01-26 13:11:12 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=4C94B07E87897BD10F6282AF5F9DADBB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:11:12 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios/editar/6
2026-01-26 13:11:12 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios/editar/6, M√©todo: GET
2026-01-26 13:11:12 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:11:12 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:11:12 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:11:12 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:11:12 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 43
2026-01-26 13:11:12 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:11:12 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:11:12 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-26 13:11:12 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:11:12 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:11:12 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:11:12 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:11:12 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:11:12 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-26 13:11:12 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios/editar/6, Empresa ID: 3
2026-01-26 13:11:12 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:11:12 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:11:12 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:11:12 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:11:12 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:11:12 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:11:12 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:11:12 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:11:12 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:11:12 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:11:12 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:11:12 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:11:12 [http-nio-8080-exec-3] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.mostrarFormularioEditar(java.lang.Long,org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-26 13:11:12 [http-nio-8080-exec-3] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.mostrarFormularioEditar(java.lang.Long,org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-26 13:11:12 [http-nio-8080-exec-3] INFO  j.s.s.c.UsuarioControlador - ‚úèÔ∏è GET /admin/usuarios/editar/6 - Editando usuario
2026-01-26 13:11:12 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Obteniendo usuario ID: 6 para empresa ID: 3
2026-01-26 13:11:12 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        u1_0.id=? 
        and e1_0.id=?
2026-01-26 13:11:12 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [6]
2026-01-26 13:11:12 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:11:12 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:11:12 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:11:12 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 43, Tenant anterior: 3
2026-01-26 13:11:12 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /admin/usuarios/editar/6, Empresa ID anterior: 3
2026-01-26 13:11:23 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing POST /admin/usuarios/actualizar/6
2026-01-26 13:11:23 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=4C94B07E87897BD10F6282AF5F9DADBB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:11:23 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured POST /admin/usuarios/actualizar/6
2026-01-26 13:11:23 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios/actualizar/6, M√©todo: POST
2026-01-26 13:11:23 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:11:23 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:11:24 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:11:24 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:11:24 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 44
2026-01-26 13:11:24 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:11:24 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:11:24 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-26 13:11:24 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:11:24 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:11:24 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:11:24 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:11:24 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:11:24 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-26 13:11:24 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios/actualizar/6, Empresa ID: 3
2026-01-26 13:11:24 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:11:24 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:11:24 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:11:24 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:11:24 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:11:24 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:11:24 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:11:24 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:11:24 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:11:24 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:11:24 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:11:24 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:11:24 [http-nio-8080-exec-4] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.actualizarUsuario(java.lang.Long,jpd.sistemafacinv.sistemadefacturacioneinventario.modelos.Usuario,java.lang.String,java.lang.String,org.springframework.web.servlet.mvc.support.RedirectAttributes); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-26 13:11:24 [http-nio-8080-exec-4] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.actualizarUsuario(java.lang.Long,jpd.sistemafacinv.sistemadefacturacioneinventario.modelos.Usuario,java.lang.String,java.lang.String,org.springframework.web.servlet.mvc.support.RedirectAttributes); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-26 13:11:24 [http-nio-8080-exec-4] INFO  j.s.s.c.UsuarioControlador - üîÑ POST /admin/usuarios/actualizar/6 - Actualizando usuario
2026-01-26 13:11:24 [http-nio-8080-exec-4] DEBUG j.s.s.c.UsuarioControlador - Usuario autenticado: admin, Roles: [ROLE_ADMIN]
2026-01-26 13:11:24 [http-nio-8080-exec-4] DEBUG j.s.s.c.UsuarioControlador - Contrase√±a no cambiada para usuario ID: 6
2026-01-26 13:11:24 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Obteniendo usuario ID: 6 para empresa ID: 3
2026-01-26 13:11:24 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        u1_0.id=? 
        and e1_0.id=?
2026-01-26 13:11:24 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [6]
2026-01-26 13:11:24 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:11:24 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:11:24 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:11:24 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Actualizando usuario ID: 6 en empresa ID: 3
2026-01-26 13:11:24 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        u1_0.id=? 
        and e1_0.id=?
2026-01-26 13:11:24 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [6]
2026-01-26 13:11:24 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:11:24 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:11:24 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:11:24 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-26 13:11:24 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [6]
2026-01-26 13:11:24 [http-nio-8080-exec-4] INFO  j.s.s.servicios.UsuarioServicio - Usuario actualizado exitosamente: admin (ID: 6)
2026-01-26 13:11:24 [http-nio-8080-exec-4] INFO  j.s.s.c.UsuarioControlador - ‚úÖ Usuario actualizado exitosamente ID: 6 - Nuevo rol: ADMIN
2026-01-26 13:11:24 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 44, Tenant anterior: 3
2026-01-26 13:11:24 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 44, Request: /admin/usuarios/actualizar/6, Empresa ID anterior: 3
2026-01-26 13:11:24 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios
2026-01-26 13:11:24 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=4C94B07E87897BD10F6282AF5F9DADBB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:11:24 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios
2026-01-26 13:11:24 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios, M√©todo: GET
2026-01-26 13:11:24 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:11:24 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:11:24 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:11:24 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:11:24 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 45
2026-01-26 13:11:24 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:11:24 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:11:24 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-26 13:11:24 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:11:24 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:11:24 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:11:24 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:11:24 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:11:24 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-26 13:11:24 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios, Empresa ID: 3
2026-01-26 13:11:24 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:11:24 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:11:24 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:11:24 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:11:24 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:11:24 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:11:24 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:11:24 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:11:24 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:11:24 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:11:24 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:11:24 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:11:24 [http-nio-8080-exec-5] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-26 13:11:24 [http-nio-8080-exec-5] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-26 13:11:24 [http-nio-8080-exec-5] INFO  j.s.s.c.UsuarioControlador - üìã GET /admin/usuarios - Listando usuarios
2026-01-26 13:11:24 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Listando usuarios para empresa ID: 3
2026-01-26 13:11:24 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-26 13:11:24 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:11:24 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:11:24 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:11:24 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 45, Tenant anterior: 3
2026-01-26 13:11:24 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 45, Request: /admin/usuarios, Empresa ID anterior: 3
2026-01-26 13:11:28 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-26 13:11:28 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=4C94B07E87897BD10F6282AF5F9DADBB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:11:28 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-26 13:11:28 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-26 13:11:28 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:11:28 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:11:28 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:11:28 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:11:28 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 46
2026-01-26 13:11:28 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:11:28 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:11:28 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-26 13:11:28 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:11:28 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:11:28 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:11:28 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:11:28 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:11:28 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-26 13:11:28 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 3
2026-01-26 13:11:28 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:11:28 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:11:28 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:11:28 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:11:28 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:11:28 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:11:28 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:11:28 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:11:28 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:11:28 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:11:28 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:11:28 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:11:28 [http-nio-8080-exec-6] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-26
2026-01-26 13:11:28 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-26 13:11:28 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:11:28 [http-nio-8080-exec-6] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-26
2026-01-26 13:11:28 [http-nio-8080-exec-6] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-26 13:11:28 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 46, Tenant anterior: 3
2026-01-26 13:11:28 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 46, Request: /principal, Empresa ID anterior: 3
2026-01-26 13:11:29 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing POST /logout
2026-01-26 13:11:29 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=4C94B07E87897BD10F6282AF5F9DADBB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:11:29 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.logout.LogoutFilter - Logging out [UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=4C94B07E87897BD10F6282AF5F9DADBB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:11:29 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.l.SecurityContextLogoutHandler - Invalidated session AFA4B312212C170BE8E6ABBEDB5EC4EF
2026-01-26 13:11:29 [http-nio-8080-exec-7] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /login?logout
2026-01-26 13:11:29 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login?logout
2026-01-26 13:11:29 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login?logout
2026-01-26 13:11:29 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-26 13:11:29 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:11:29 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:11:29 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:11:29 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:11:29 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 48
2026-01-26 13:11:29 [http-nio-8080-exec-8] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:11:29 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-26 13:11:29 [http-nio-8080-exec-8] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-26 13:11:29 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 48, Tenant anterior: 3
2026-01-26 13:11:29 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 48, Request: /login, Empresa ID anterior: 3
2026-01-26 13:11:32 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-26 13:11:32 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: admin para la empresa ID: null
2026-01-26 13:11:32 [http-nio-8080-exec-9] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: kristoff
2026-01-26 13:11:32 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:11:32 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:11:32 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: kristoff | Empresa ID: 3 | Empresa Nombre: Empresa Kristoff
2026-01-26 13:11:32 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:11:32 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:11:32 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:11:32 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:11:32 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:11:32 [http-nio-8080-exec-9] INFO  j.s.s.servicios.UsuarioServicio - üîê Encontrado usuario: admin
2026-01-26 13:11:32 [http-nio-8080-exec-9] INFO  j.s.s.servicios.UsuarioServicio - üîê Rol: ADMIN
2026-01-26 13:11:32 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - üîê Activo: true
2026-01-26 13:11:32 [http-nio-8080-exec-9] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Failed to authenticate since password does not match stored value
2026-01-26 13:11:32 [http-nio-8080-exec-9] DEBUG o.s.s.authentication.ProviderManager - Authentication failed with provider DaoAuthenticationProvider since Bad credentials
2026-01-26 13:11:32 [http-nio-8080-exec-9] DEBUG o.s.s.authentication.ProviderManager - Denying authentication since all attempted providers failed
2026-01-26 13:11:32 [http-nio-8080-exec-9] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /login?error
2026-01-26 13:11:32 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login?error
2026-01-26 13:11:32 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login?error
2026-01-26 13:11:32 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-26 13:11:32 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:11:32 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:11:32 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:11:32 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:11:32 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 50
2026-01-26 13:11:32 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:11:32 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-26 13:11:32 [http-nio-8080-exec-10] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-26 13:11:32 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 50, Tenant anterior: 3
2026-01-26 13:11:32 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 50, Request: /login, Empresa ID anterior: 3
2026-01-26 13:11:37 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-26 13:11:37 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: admin para la empresa ID: null
2026-01-26 13:11:37 [http-nio-8080-exec-1] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: kristoff
2026-01-26 13:11:37 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:11:37 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:11:37 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: kristoff | Empresa ID: 3 | Empresa Nombre: Empresa Kristoff
2026-01-26 13:11:37 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:11:37 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:11:37 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:11:37 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:11:37 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:11:37 [http-nio-8080-exec-1] INFO  j.s.s.servicios.UsuarioServicio - üîê Encontrado usuario: admin
2026-01-26 13:11:37 [http-nio-8080-exec-1] INFO  j.s.s.servicios.UsuarioServicio - üîê Rol: ADMIN
2026-01-26 13:11:37 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - üîê Activo: true
2026-01-26 13:11:37 [http-nio-8080-exec-1] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Authenticated user
2026-01-26 13:11:37 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.s.ChangeSessionIdAuthenticationStrategy - Changed session id from D79C75E2189FF2CBC21660A61A84D9D6
2026-01-26 13:11:37 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.CsrfAuthenticationStrategy - Replaced CSRF Token
2026-01-26 13:11:37 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Stored SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D79C75E2189FF2CBC21660A61A84D9D6], Granted Authorities=[ROLE_ADMIN]]] to HttpSession [org.apache.catalina.session.StandardSessionFacade@a214df8]
2026-01-26 13:11:37 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.UsernamePasswordAuthenticationFilter - Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D79C75E2189FF2CBC21660A61A84D9D6], Granted Authorities=[ROLE_ADMIN]]
2026-01-26 13:11:37 [http-nio-8080-exec-1] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /principal
2026-01-26 13:11:37 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-26 13:11:37 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D79C75E2189FF2CBC21660A61A84D9D6], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:11:37 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-26 13:11:37 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-26 13:11:37 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:11:37 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:11:37 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:11:37 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:11:37 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 42
2026-01-26 13:11:37 [http-nio-8080-exec-2] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:11:37 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:11:37 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-26 13:11:37 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:11:37 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:11:37 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:11:37 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:11:37 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:11:37 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-26 13:11:37 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 3
2026-01-26 13:11:37 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:11:37 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:11:37 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:11:37 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:11:37 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:11:37 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:11:37 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:11:37 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:11:37 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:11:37 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:11:37 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:11:37 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:11:37 [http-nio-8080-exec-2] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-26
2026-01-26 13:11:37 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-26 13:11:37 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:11:37 [http-nio-8080-exec-2] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-26
2026-01-26 13:11:37 [http-nio-8080-exec-2] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-26 13:11:37 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 42, Tenant anterior: 3
2026-01-26 13:11:37 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 42, Request: /principal, Empresa ID anterior: 3
2026-01-26 13:11:44 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios
2026-01-26 13:11:44 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D79C75E2189FF2CBC21660A61A84D9D6], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:11:44 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios
2026-01-26 13:11:44 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios, M√©todo: GET
2026-01-26 13:11:44 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:11:44 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:11:44 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:11:44 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:11:44 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 43
2026-01-26 13:11:44 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:11:44 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:11:44 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-26 13:11:44 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:11:44 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:11:44 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:11:44 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:11:44 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:11:44 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-26 13:11:44 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios, Empresa ID: 3
2026-01-26 13:11:44 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:11:44 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:11:44 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:11:44 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:11:44 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:11:44 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:11:44 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:11:44 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:11:44 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:11:44 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:11:44 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:11:44 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:11:44 [http-nio-8080-exec-3] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-26 13:11:44 [http-nio-8080-exec-3] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-26 13:11:44 [http-nio-8080-exec-3] INFO  j.s.s.c.UsuarioControlador - üìã GET /admin/usuarios - Listando usuarios
2026-01-26 13:11:44 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Listando usuarios para empresa ID: 3
2026-01-26 13:11:44 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-26 13:11:44 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:11:44 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:11:44 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:11:44 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 43, Tenant anterior: 3
2026-01-26 13:11:44 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /admin/usuarios, Empresa ID anterior: 3
2026-01-26 13:11:46 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios/editar/6
2026-01-26 13:11:46 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D79C75E2189FF2CBC21660A61A84D9D6], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:11:46 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios/editar/6
2026-01-26 13:11:46 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios/editar/6, M√©todo: GET
2026-01-26 13:11:46 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:11:46 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:11:46 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:11:46 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:11:46 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 44
2026-01-26 13:11:46 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:11:46 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:11:46 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-26 13:11:46 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:11:46 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:11:46 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:11:46 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:11:46 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:11:46 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-26 13:11:46 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios/editar/6, Empresa ID: 3
2026-01-26 13:11:46 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:11:46 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:11:46 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:11:46 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:11:46 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:11:46 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:11:46 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:11:46 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:11:46 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:11:46 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:11:46 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:11:46 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:11:46 [http-nio-8080-exec-4] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.mostrarFormularioEditar(java.lang.Long,org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-26 13:11:46 [http-nio-8080-exec-4] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.mostrarFormularioEditar(java.lang.Long,org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-26 13:11:46 [http-nio-8080-exec-4] INFO  j.s.s.c.UsuarioControlador - ‚úèÔ∏è GET /admin/usuarios/editar/6 - Editando usuario
2026-01-26 13:11:46 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Obteniendo usuario ID: 6 para empresa ID: 3
2026-01-26 13:11:46 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        u1_0.id=? 
        and e1_0.id=?
2026-01-26 13:11:46 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [6]
2026-01-26 13:11:46 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:11:46 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:11:46 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:11:46 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 44, Tenant anterior: 3
2026-01-26 13:11:46 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 44, Request: /admin/usuarios/editar/6, Empresa ID anterior: 3
2026-01-26 13:11:52 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing POST /admin/usuarios/actualizar/6
2026-01-26 13:11:52 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D79C75E2189FF2CBC21660A61A84D9D6], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:11:52 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured POST /admin/usuarios/actualizar/6
2026-01-26 13:11:52 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios/actualizar/6, M√©todo: POST
2026-01-26 13:11:52 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:11:52 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:11:52 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:11:52 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:11:52 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 45
2026-01-26 13:11:52 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:11:52 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:11:52 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-26 13:11:52 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:11:52 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:11:52 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:11:52 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:11:52 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:11:52 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-26 13:11:52 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios/actualizar/6, Empresa ID: 3
2026-01-26 13:11:52 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:11:52 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:11:52 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:11:52 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:11:52 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:11:52 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:11:52 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:11:52 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:11:52 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:11:52 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:11:52 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:11:52 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:11:52 [http-nio-8080-exec-5] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.actualizarUsuario(java.lang.Long,jpd.sistemafacinv.sistemadefacturacioneinventario.modelos.Usuario,java.lang.String,java.lang.String,org.springframework.web.servlet.mvc.support.RedirectAttributes); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-26 13:11:52 [http-nio-8080-exec-5] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.actualizarUsuario(java.lang.Long,jpd.sistemafacinv.sistemadefacturacioneinventario.modelos.Usuario,java.lang.String,java.lang.String,org.springframework.web.servlet.mvc.support.RedirectAttributes); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-26 13:11:52 [http-nio-8080-exec-5] INFO  j.s.s.c.UsuarioControlador - üîÑ POST /admin/usuarios/actualizar/6 - Actualizando usuario
2026-01-26 13:11:52 [http-nio-8080-exec-5] DEBUG j.s.s.c.UsuarioControlador - Usuario autenticado: admin, Roles: [ROLE_ADMIN]
2026-01-26 13:11:52 [http-nio-8080-exec-5] DEBUG j.s.s.c.UsuarioControlador - Contrase√±a no cambiada para usuario ID: 6
2026-01-26 13:11:52 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Obteniendo usuario ID: 6 para empresa ID: 3
2026-01-26 13:11:52 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        u1_0.id=? 
        and e1_0.id=?
2026-01-26 13:11:52 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [6]
2026-01-26 13:11:52 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:11:52 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:11:52 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:11:52 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Actualizando usuario ID: 6 en empresa ID: 3
2026-01-26 13:11:52 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        u1_0.id=? 
        and e1_0.id=?
2026-01-26 13:11:52 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [6]
2026-01-26 13:11:52 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:11:52 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:11:52 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:11:52 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-26 13:11:52 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [6]
2026-01-26 13:11:52 [http-nio-8080-exec-5] INFO  j.s.s.servicios.UsuarioServicio - Usuario actualizado exitosamente: admin (ID: 6)
2026-01-26 13:11:52 [http-nio-8080-exec-5] INFO  j.s.s.c.UsuarioControlador - ‚úÖ Usuario actualizado exitosamente ID: 6 - Nuevo rol: ADMIN
2026-01-26 13:11:52 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 45, Tenant anterior: 3
2026-01-26 13:11:52 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 45, Request: /admin/usuarios/actualizar/6, Empresa ID anterior: 3
2026-01-26 13:11:52 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios
2026-01-26 13:11:52 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D79C75E2189FF2CBC21660A61A84D9D6], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:11:52 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios
2026-01-26 13:11:52 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios, M√©todo: GET
2026-01-26 13:11:52 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:11:52 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:11:52 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:11:52 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:11:52 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 46
2026-01-26 13:11:52 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:11:52 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:11:52 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-26 13:11:52 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:11:52 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:11:52 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:11:52 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:11:52 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:11:52 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-26 13:11:52 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios, Empresa ID: 3
2026-01-26 13:11:52 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:11:52 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:11:52 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:11:52 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:11:52 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:11:52 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:11:52 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:11:52 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:11:52 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:11:52 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:11:52 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:11:52 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:11:52 [http-nio-8080-exec-6] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-26 13:11:52 [http-nio-8080-exec-6] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-26 13:11:52 [http-nio-8080-exec-6] INFO  j.s.s.c.UsuarioControlador - üìã GET /admin/usuarios - Listando usuarios
2026-01-26 13:11:52 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Listando usuarios para empresa ID: 3
2026-01-26 13:11:52 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-26 13:11:52 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:11:52 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:11:52 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:11:52 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 46, Tenant anterior: 3
2026-01-26 13:11:52 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 46, Request: /admin/usuarios, Empresa ID anterior: 3
2026-01-26 13:11:56 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-26 13:11:56 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D79C75E2189FF2CBC21660A61A84D9D6], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:11:56 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-26 13:11:56 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-26 13:11:56 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:11:56 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:11:56 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:11:56 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:11:56 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 47
2026-01-26 13:11:56 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:11:56 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:11:56 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-26 13:11:56 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:11:56 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:11:56 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:11:56 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:11:56 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:11:56 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-26 13:11:56 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 3
2026-01-26 13:11:56 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:11:56 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:11:56 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:11:56 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:11:56 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:11:56 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:11:56 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:11:56 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:11:56 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:11:56 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:11:56 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:11:56 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:11:56 [http-nio-8080-exec-7] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-26
2026-01-26 13:11:56 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-26 13:11:56 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:11:56 [http-nio-8080-exec-7] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-26
2026-01-26 13:11:56 [http-nio-8080-exec-7] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-26 13:11:56 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 47, Tenant anterior: 3
2026-01-26 13:11:56 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 47, Request: /principal, Empresa ID anterior: 3
2026-01-26 13:11:57 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing POST /logout
2026-01-26 13:11:57 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D79C75E2189FF2CBC21660A61A84D9D6], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:11:57 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.logout.LogoutFilter - Logging out [UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D79C75E2189FF2CBC21660A61A84D9D6], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:11:57 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.l.SecurityContextLogoutHandler - Invalidated session 43D9E9E8ED555FF4B5DEE847E4BE540C
2026-01-26 13:11:57 [http-nio-8080-exec-8] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /login?logout
2026-01-26 13:11:57 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login?logout
2026-01-26 13:11:57 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login?logout
2026-01-26 13:11:57 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-26 13:11:57 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:11:57 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:11:57 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:11:57 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:11:57 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 49
2026-01-26 13:11:57 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:11:57 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-26 13:11:57 [http-nio-8080-exec-9] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-26 13:11:57 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 49, Tenant anterior: 3
2026-01-26 13:11:57 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 49, Request: /login, Empresa ID anterior: 3
2026-01-26 13:12:00 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-26 13:12:00 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: admin para la empresa ID: null
2026-01-26 13:12:00 [http-nio-8080-exec-10] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: kristoff
2026-01-26 13:12:00 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:12:00 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:12:00 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: kristoff | Empresa ID: 3 | Empresa Nombre: Empresa Kristoff
2026-01-26 13:12:00 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:12:00 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:12:00 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:12:00 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:12:00 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:12:00 [http-nio-8080-exec-10] INFO  j.s.s.servicios.UsuarioServicio - üîê Encontrado usuario: admin
2026-01-26 13:12:00 [http-nio-8080-exec-10] INFO  j.s.s.servicios.UsuarioServicio - üîê Rol: ADMIN
2026-01-26 13:12:00 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - üîê Activo: true
2026-01-26 13:12:00 [http-nio-8080-exec-10] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Failed to authenticate since password does not match stored value
2026-01-26 13:12:00 [http-nio-8080-exec-10] DEBUG o.s.s.authentication.ProviderManager - Authentication failed with provider DaoAuthenticationProvider since Bad credentials
2026-01-26 13:12:00 [http-nio-8080-exec-10] DEBUG o.s.s.authentication.ProviderManager - Denying authentication since all attempted providers failed
2026-01-26 13:12:00 [http-nio-8080-exec-10] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /login?error
2026-01-26 13:12:00 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login?error
2026-01-26 13:12:00 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login?error
2026-01-26 13:12:00 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-26 13:12:00 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:12:00 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:12:00 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:12:00 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:12:00 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 41
2026-01-26 13:12:00 [http-nio-8080-exec-1] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:12:00 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-26 13:12:00 [http-nio-8080-exec-1] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-26 13:12:01 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 41, Tenant anterior: 3
2026-01-26 13:12:01 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 41, Request: /login, Empresa ID anterior: 3
2026-01-26 13:12:06 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-26 13:12:06 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: admin para la empresa ID: null
2026-01-26 13:12:06 [http-nio-8080-exec-2] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: kristoff
2026-01-26 13:12:06 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:12:06 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:12:06 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: kristoff | Empresa ID: 3 | Empresa Nombre: Empresa Kristoff
2026-01-26 13:12:06 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:12:06 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:12:06 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:12:06 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:12:06 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:12:06 [http-nio-8080-exec-2] INFO  j.s.s.servicios.UsuarioServicio - üîê Encontrado usuario: admin
2026-01-26 13:12:06 [http-nio-8080-exec-2] INFO  j.s.s.servicios.UsuarioServicio - üîê Rol: ADMIN
2026-01-26 13:12:06 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - üîê Activo: true
2026-01-26 13:12:06 [http-nio-8080-exec-2] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Authenticated user
2026-01-26 13:12:06 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.s.ChangeSessionIdAuthenticationStrategy - Changed session id from D858A6F8299896C3AB98DBA2EB32C412
2026-01-26 13:12:06 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.CsrfAuthenticationStrategy - Replaced CSRF Token
2026-01-26 13:12:06 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Stored SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D858A6F8299896C3AB98DBA2EB32C412], Granted Authorities=[ROLE_ADMIN]]] to HttpSession [org.apache.catalina.session.StandardSessionFacade@149b0625]
2026-01-26 13:12:06 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.UsernamePasswordAuthenticationFilter - Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D858A6F8299896C3AB98DBA2EB32C412], Granted Authorities=[ROLE_ADMIN]]
2026-01-26 13:12:06 [http-nio-8080-exec-2] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /principal
2026-01-26 13:12:06 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-26 13:12:06 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D858A6F8299896C3AB98DBA2EB32C412], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:12:06 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-26 13:12:06 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-26 13:12:06 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:12:06 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:12:06 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:12:06 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:12:06 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 43
2026-01-26 13:12:06 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:12:06 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:12:06 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-26 13:12:06 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:12:06 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:12:06 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:12:06 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:12:06 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:12:06 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-26 13:12:06 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 3
2026-01-26 13:12:06 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:12:06 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:12:06 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:12:06 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:12:06 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:12:06 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:12:06 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:12:06 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:12:06 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:12:06 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:12:06 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:12:06 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:12:06 [http-nio-8080-exec-3] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-26
2026-01-26 13:12:06 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-26 13:12:06 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:12:06 [http-nio-8080-exec-3] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-26
2026-01-26 13:12:06 [http-nio-8080-exec-3] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-26 13:12:06 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 43, Tenant anterior: 3
2026-01-26 13:12:06 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /principal, Empresa ID anterior: 3
2026-01-26 13:12:19 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios
2026-01-26 13:12:19 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D858A6F8299896C3AB98DBA2EB32C412], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:12:19 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios
2026-01-26 13:12:19 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios, M√©todo: GET
2026-01-26 13:12:19 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:12:19 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:12:19 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:12:19 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:12:19 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 44
2026-01-26 13:12:19 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:12:19 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:12:19 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-26 13:12:19 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:12:19 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:12:19 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:12:19 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:12:19 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:12:19 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-26 13:12:19 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios, Empresa ID: 3
2026-01-26 13:12:19 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:12:19 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:12:19 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:12:19 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:12:19 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:12:19 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:12:19 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:12:19 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:12:19 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:12:19 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:12:19 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:12:19 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:12:19 [http-nio-8080-exec-4] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-26 13:12:19 [http-nio-8080-exec-4] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-26 13:12:19 [http-nio-8080-exec-4] INFO  j.s.s.c.UsuarioControlador - üìã GET /admin/usuarios - Listando usuarios
2026-01-26 13:12:19 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Listando usuarios para empresa ID: 3
2026-01-26 13:12:19 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-26 13:12:19 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:12:19 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:12:19 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:12:19 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 44, Tenant anterior: 3
2026-01-26 13:12:19 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 44, Request: /admin/usuarios, Empresa ID anterior: 3
2026-01-26 13:12:20 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios/nuevo
2026-01-26 13:12:20 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D858A6F8299896C3AB98DBA2EB32C412], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:12:20 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios/nuevo
2026-01-26 13:12:20 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios/nuevo, M√©todo: GET
2026-01-26 13:12:20 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:12:20 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:12:20 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:12:20 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:12:20 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 45
2026-01-26 13:12:20 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:12:20 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:12:20 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-26 13:12:20 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:12:20 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:12:20 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:12:20 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:12:20 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:12:20 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-26 13:12:20 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios/nuevo, Empresa ID: 3
2026-01-26 13:12:20 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:12:20 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:12:20 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:12:20 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:12:20 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:12:20 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:12:20 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:12:20 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:12:20 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:12:20 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:12:20 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:12:20 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:12:20 [http-nio-8080-exec-5] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.mostrarFormularioCrear(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-26 13:12:20 [http-nio-8080-exec-5] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.mostrarFormularioCrear(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-26 13:12:20 [http-nio-8080-exec-5] INFO  j.s.s.c.UsuarioControlador - üìù GET /admin/usuarios/nuevo - Mostrando formulario crear usuario
2026-01-26 13:12:20 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 45, Tenant anterior: 3
2026-01-26 13:12:20 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 45, Request: /admin/usuarios/nuevo, Empresa ID anterior: 3
2026-01-26 13:12:35 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing POST /admin/usuarios/guardar
2026-01-26 13:12:35 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D858A6F8299896C3AB98DBA2EB32C412], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:12:35 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured POST /admin/usuarios/guardar
2026-01-26 13:12:35 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios/guardar, M√©todo: POST
2026-01-26 13:12:35 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:12:35 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:12:35 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:12:35 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:12:35 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 46
2026-01-26 13:12:35 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:12:35 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:12:35 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-26 13:12:35 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:12:35 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:12:35 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:12:35 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:12:35 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:12:35 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-26 13:12:35 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios/guardar, Empresa ID: 3
2026-01-26 13:12:35 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:12:35 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:12:35 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:12:35 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:12:35 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:12:35 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:12:35 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:12:35 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:12:35 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:12:35 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:12:35 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:12:35 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:12:35 [http-nio-8080-exec-6] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.guardarUsuario(jpd.sistemafacinv.sistemadefacturacioneinventario.modelos.Usuario,java.lang.String,org.springframework.web.servlet.mvc.support.RedirectAttributes); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-26 13:12:35 [http-nio-8080-exec-6] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.guardarUsuario(jpd.sistemafacinv.sistemadefacturacioneinventario.modelos.Usuario,java.lang.String,org.springframework.web.servlet.mvc.support.RedirectAttributes); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-26 13:12:35 [http-nio-8080-exec-6] INFO  j.s.s.c.UsuarioControlador - üíæ POST /admin/usuarios/guardar - Creando usuario: adminKristoff
2026-01-26 13:12:35 [http-nio-8080-exec-6] DEBUG j.s.s.c.UsuarioControlador - Datos usuario - Rol: ADMIN, Activo: true
2026-01-26 13:12:35 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Creando usuario: adminKristoff para empresa ID: 3
2026-01-26 13:12:35 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        u1_0.nombre_usuario=? 
        and e1_0.id=? 
    limit
        ?
2026-01-26 13:12:35 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [adminKristoff]
2026-01-26 13:12:35 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:12:35 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:INTEGER) <- [1]
2026-01-26 13:12:35 [http-nio-8080-exec-6] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@325225196 wrapping com.mysql.cj.jdbc.ConnectionImpl@7827e241] read-only
2026-01-26 13:12:35 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:12:35 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:12:35 [http-nio-8080-exec-6] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@325225196 wrapping com.mysql.cj.jdbc.ConnectionImpl@7827e241]
2026-01-26 13:12:35 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        usuario
        (activo, contrasenna, empresa_id, nombre_usuario, rol, sucursal_id) 
    values
        (?, ?, ?, ?, ?, ?)
2026-01-26 13:12:35 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-26 13:12:35 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [$2a$10$LU8rSblM7motYoz/hv9EVOJBAXMcsa5yWq0f1jpvh2dC/BvtFu4Xy]
2026-01-26 13:12:35 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:12:35 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [adminKristoff]
2026-01-26 13:12:35 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [ADMIN]
2026-01-26 13:12:35 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:BIGINT) <- [null]
2026-01-26 13:12:35 [http-nio-8080-exec-6] INFO  j.s.s.servicios.UsuarioServicio - Usuario creado exitosamente: adminKristoff con ID: 7
2026-01-26 13:12:35 [http-nio-8080-exec-6] INFO  j.s.s.c.UsuarioControlador - ‚úÖ Usuario creado exitosamente: adminKristoff (ID: 7)
2026-01-26 13:12:35 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 46, Tenant anterior: 3
2026-01-26 13:12:35 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 46, Request: /admin/usuarios/guardar, Empresa ID anterior: 3
2026-01-26 13:12:35 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios
2026-01-26 13:12:35 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D858A6F8299896C3AB98DBA2EB32C412], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:12:35 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios
2026-01-26 13:12:35 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios, M√©todo: GET
2026-01-26 13:12:35 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:12:35 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:12:35 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:12:35 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:12:35 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 47
2026-01-26 13:12:35 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:12:35 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:12:35 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-26 13:12:35 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:12:35 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:12:35 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:12:35 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:12:35 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:12:35 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-26 13:12:35 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios, Empresa ID: 3
2026-01-26 13:12:35 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:12:35 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:12:35 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:12:35 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:12:35 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:12:35 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:12:35 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:12:35 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:12:35 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:12:35 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:12:35 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:12:35 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:12:35 [http-nio-8080-exec-7] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-26 13:12:35 [http-nio-8080-exec-7] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-26 13:12:35 [http-nio-8080-exec-7] INFO  j.s.s.c.UsuarioControlador - üìã GET /admin/usuarios - Listando usuarios
2026-01-26 13:12:35 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Listando usuarios para empresa ID: 3
2026-01-26 13:12:35 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-26 13:12:35 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:12:35 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:12:35 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:12:35 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 47, Tenant anterior: 3
2026-01-26 13:12:35 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 47, Request: /admin/usuarios, Empresa ID anterior: 3
2026-01-26 13:12:38 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-26 13:12:38 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D858A6F8299896C3AB98DBA2EB32C412], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:12:38 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-26 13:12:38 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-26 13:12:38 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:12:38 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:12:38 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:12:38 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:12:38 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 48
2026-01-26 13:12:38 [http-nio-8080-exec-8] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:12:38 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-26 13:12:38 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 3
2026-01-26 13:12:38 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:12:38 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-26 13:12:38 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:12:38 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:12:38 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:12:38 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 3
2026-01-26 13:12:38 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 3
2026-01-26 13:12:38 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:12:38 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:12:38 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:12:38 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:12:38 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:12:38 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:12:38 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:12:38 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:12:38 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:12:38 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:12:38 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:12:38 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:12:38 [http-nio-8080-exec-8] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-26
2026-01-26 13:12:38 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-26 13:12:38 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:12:38 [http-nio-8080-exec-8] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-26
2026-01-26 13:12:38 [http-nio-8080-exec-8] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-26 13:12:38 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 48, Tenant anterior: 3
2026-01-26 13:12:38 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 48, Request: /principal, Empresa ID anterior: 3
2026-01-26 13:12:39 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing POST /logout
2026-01-26 13:12:39 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D858A6F8299896C3AB98DBA2EB32C412], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:12:39 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.logout.LogoutFilter - Logging out [UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D858A6F8299896C3AB98DBA2EB32C412], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:12:39 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.l.SecurityContextLogoutHandler - Invalidated session 576CC38A3710ED3B06E786094F491324
2026-01-26 13:12:39 [http-nio-8080-exec-9] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /login?logout
2026-01-26 13:12:39 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login?logout
2026-01-26 13:12:39 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login?logout
2026-01-26 13:12:39 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-26 13:12:39 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:12:39 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:12:39 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:12:39 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:12:39 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 50
2026-01-26 13:12:39 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:12:39 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-26 13:12:39 [http-nio-8080-exec-10] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-26 13:12:39 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 50, Tenant anterior: 3
2026-01-26 13:12:39 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 50, Request: /login, Empresa ID anterior: 3
2026-01-26 13:12:49 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-26 13:12:49 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: adminkristoff para la empresa ID: null
2026-01-26 13:12:49 [http-nio-8080-exec-1] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: adminkristoff | Subdominio: kristoff
2026-01-26 13:12:49 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:12:49 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:12:49 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: adminkristoff | Subdominio: kristoff | Empresa ID: 3 | Empresa Nombre: Empresa Kristoff
2026-01-26 13:12:49 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:12:49 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [adminkristoff]
2026-01-26 13:12:49 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:12:49 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:12:49 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:12:49 [http-nio-8080-exec-1] INFO  j.s.s.servicios.UsuarioServicio - üîê Encontrado usuario: adminKristoff
2026-01-26 13:12:49 [http-nio-8080-exec-1] INFO  j.s.s.servicios.UsuarioServicio - üîê Rol: ADMIN
2026-01-26 13:12:49 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - üîê Activo: true
2026-01-26 13:12:49 [http-nio-8080-exec-1] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Authenticated user
2026-01-26 13:12:49 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.s.ChangeSessionIdAuthenticationStrategy - Changed session id from A9ACDFE969CD434B6DB7BD36AD15ECAB
2026-01-26 13:12:49 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.CsrfAuthenticationStrategy - Replaced CSRF Token
2026-01-26 13:12:49 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Stored SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]] to HttpSession [org.apache.catalina.session.StandardSessionFacade@824b6ea]
2026-01-26 13:12:49 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.UsernamePasswordAuthenticationFilter - Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]
2026-01-26 13:12:49 [http-nio-8080-exec-1] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /principal
2026-01-26 13:12:49 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-26 13:12:49 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:12:49 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-26 13:12:49 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-26 13:12:49 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:12:49 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:12:49 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:12:49 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:12:49 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 42
2026-01-26 13:12:49 [http-nio-8080-exec-2] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:12:49 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: adminKristoff
2026-01-26 13:12:49 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: adminKristoff en empresa ID: 3
2026-01-26 13:12:49 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:12:49 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [adminKristoff]
2026-01-26 13:12:49 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:12:49 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:12:49 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:12:49 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario adminKristoff validado para empresa 3
2026-01-26 13:12:49 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 3
2026-01-26 13:12:49 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:12:49 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:12:49 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:12:49 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:12:49 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:12:49 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:12:49 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:12:49 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:12:49 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:12:49 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:12:49 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:12:49 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:12:49 [http-nio-8080-exec-2] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-26
2026-01-26 13:12:49 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-26 13:12:49 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:12:49 [http-nio-8080-exec-2] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-26
2026-01-26 13:12:49 [http-nio-8080-exec-2] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-26 13:12:49 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 42, Tenant anterior: 3
2026-01-26 13:12:49 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 42, Request: /principal, Empresa ID anterior: 3
2026-01-26 13:13:00 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres
2026-01-26 13:13:00 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:13:00 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres
2026-01-26 13:13:00 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres, M√©todo: GET
2026-01-26 13:13:00 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:13:00 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:13:00 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:13:00 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:13:00 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 43
2026-01-26 13:13:00 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:13:00 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: adminKristoff
2026-01-26 13:13:00 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: adminKristoff en empresa ID: 3
2026-01-26 13:13:00 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:13:00 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [adminKristoff]
2026-01-26 13:13:00 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:13:00 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:13:00 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:13:00 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario adminKristoff validado para empresa 3
2026-01-26 13:13:00 [http-nio-8080-exec-3] INFO  j.s.s.c.CierreInventarioDiarioControlador - üìã GET /cierres - Listando cierres diarios
2026-01-26 13:13:00 [http-nio-8080-exec-3] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo todos los cierres para empresa ID: 3
2026-01-26 13:13:00 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        e1_0.id=?
2026-01-26 13:13:00 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:13:00 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:13:00 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:13:00 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-26 13:13:00 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [6]
2026-01-26 13:13:00 [http-nio-8080-exec-3] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 1 cierres para empresa ID: 3
2026-01-26 13:13:00 [http-nio-8080-exec-3] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Encontrados 1 cierres
2026-01-26 13:13:00 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 43, Tenant anterior: 3
2026-01-26 13:13:00 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /cierres, Empresa ID anterior: 3
2026-01-26 13:13:21 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/detalle/7
2026-01-26 13:13:21 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:13:21 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres/detalle/7
2026-01-26 13:13:21 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres/detalle/7, M√©todo: GET
2026-01-26 13:13:21 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:13:21 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:13:21 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:13:21 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:13:21 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 44
2026-01-26 13:13:21 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:13:21 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: adminKristoff
2026-01-26 13:13:21 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: adminKristoff en empresa ID: 3
2026-01-26 13:13:21 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:13:21 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [adminKristoff]
2026-01-26 13:13:21 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:13:21 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:13:21 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:13:21 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario adminKristoff validado para empresa 3
2026-01-26 13:13:21 [http-nio-8080-exec-4] INFO  j.s.s.c.CierreInventarioDiarioControlador - üëÅÔ∏è GET /cierres/detalle/7 - Viendo detalles de cierre
2026-01-26 13:13:21 [http-nio-8080-exec-4] DEBUG j.s.s.s.CierreInventarioDiarioService - Buscando cierre ID: 7 para empresa ID: 3
2026-01-26 13:13:21 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.id=? 
        and e1_0.id=?
2026-01-26 13:13:21 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [7]
2026-01-26 13:13:21 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:13:21 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:13:21 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:13:21 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-26 13:13:21 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [6]
2026-01-26 13:13:21 [http-nio-8080-exec-4] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo detalles para cierre ID: 7
2026-01-26 13:13:21 [http-nio-8080-exec-4] DEBUG j.s.s.s.CierreInventarioDiarioService - Buscando cierre ID: 7 para empresa ID: 3
2026-01-26 13:13:21 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.id=? 
        and e1_0.id=?
2026-01-26 13:13:21 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [7]
2026-01-26 13:13:21 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:13:21 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:13:21 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:13:21 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-26 13:13:21 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [6]
2026-01-26 13:13:21 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        dcid1_0.id,
        dcid1_0.cierre_id,
        dcid1_0.costo_unitario,
        dcid1_0.diferencia,
        dcid1_0.ingrediente_id,
        dcid1_0.producto_id,
        dcid1_0.stock_desperdicio,
        dcid1_0.stock_merma,
        dcid1_0.stock_real,
        dcid1_0.stock_teorico,
        dcid1_0.valor_diferencia 
    from
        detalle_cierre_inventario_diario dcid1_0 
    where
        dcid1_0.cierre_id=?
2026-01-26 13:13:21 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [7]
2026-01-26 13:13:21 [http-nio-8080-exec-4] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 0 detalles para cierre ID: 7
2026-01-26 13:13:21 [http-nio-8080-exec-4] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Cierre ID: 7, Estado: COMPLETADO, Detalles: 0, Diferencia total: 0.0
2026-01-26 13:13:21 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 44, Tenant anterior: 3
2026-01-26 13:13:21 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 44, Request: /cierres/detalle/7, Empresa ID anterior: 3
2026-01-26 13:13:25 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres
2026-01-26 13:13:25 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:13:25 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /cierres
2026-01-26 13:13:25 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /cierres, M√©todo: GET
2026-01-26 13:13:25 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:13:25 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:13:25 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:13:25 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:13:25 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 45
2026-01-26 13:13:25 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:13:25 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: adminKristoff
2026-01-26 13:13:25 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: adminKristoff en empresa ID: 3
2026-01-26 13:13:25 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:13:25 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [adminKristoff]
2026-01-26 13:13:25 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:13:25 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:13:25 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:13:25 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario adminKristoff validado para empresa 3
2026-01-26 13:13:25 [http-nio-8080-exec-5] INFO  j.s.s.c.CierreInventarioDiarioControlador - üìã GET /cierres - Listando cierres diarios
2026-01-26 13:13:25 [http-nio-8080-exec-5] DEBUG j.s.s.s.CierreInventarioDiarioService - Obteniendo todos los cierres para empresa ID: 3
2026-01-26 13:13:25 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        e1_0.id=?
2026-01-26 13:13:25 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:13:25 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:13:25 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:13:25 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-26 13:13:25 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [6]
2026-01-26 13:13:25 [http-nio-8080-exec-5] DEBUG j.s.s.s.CierreInventarioDiarioService - Encontrados 1 cierres para empresa ID: 3
2026-01-26 13:13:25 [http-nio-8080-exec-5] DEBUG j.s.s.c.CierreInventarioDiarioControlador - Encontrados 1 cierres
2026-01-26 13:13:25 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 45, Tenant anterior: 3
2026-01-26 13:13:25 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 45, Request: /cierres, Empresa ID anterior: 3
2026-01-26 13:13:35 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-26 13:13:35 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:13:35 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-26 13:13:35 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-26 13:13:35 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:13:35 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:13:35 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:13:35 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:13:35 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 46
2026-01-26 13:13:35 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:13:35 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: adminKristoff
2026-01-26 13:13:35 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: adminKristoff en empresa ID: 3
2026-01-26 13:13:35 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:13:35 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [adminKristoff]
2026-01-26 13:13:35 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:13:35 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:13:35 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:13:35 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario adminKristoff validado para empresa 3
2026-01-26 13:13:35 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 3
2026-01-26 13:13:35 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:13:35 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:13:35 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:13:35 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:13:35 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:13:35 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:13:35 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:13:35 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:13:35 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:13:35 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:13:35 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:13:35 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:13:35 [http-nio-8080-exec-6] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-26
2026-01-26 13:13:35 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-26 13:13:35 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:13:35 [http-nio-8080-exec-6] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-26
2026-01-26 13:13:35 [http-nio-8080-exec-6] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-26 13:13:35 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 46, Tenant anterior: 3
2026-01-26 13:13:35 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 46, Request: /principal, Empresa ID anterior: 3
2026-01-26 13:13:38 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /ingredientes
2026-01-26 13:13:38 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:13:38 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /ingredientes
2026-01-26 13:13:38 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /ingredientes, M√©todo: GET
2026-01-26 13:13:38 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:13:38 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:13:38 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:13:38 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:13:38 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 47
2026-01-26 13:13:38 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:13:38 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: adminKristoff
2026-01-26 13:13:38 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: adminKristoff en empresa ID: 3
2026-01-26 13:13:38 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:13:38 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [adminKristoff]
2026-01-26 13:13:38 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:13:38 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:13:38 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:13:38 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario adminKristoff validado para empresa 3
2026-01-26 13:13:38 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /ingredientes, Empresa ID: 3
2026-01-26 13:13:38 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:13:38 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:13:38 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:13:38 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:13:38 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:13:38 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:13:38 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:13:38 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:13:38 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:13:38 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:13:38 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:13:38 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:13:38 [http-nio-8080-exec-7] INFO  j.s.s.c.IngredienteControlador - üìã GET /ingredientes - Listando ingredientes
2026-01-26 13:13:38 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.IngredienteServicio - Listando ingredientes para empresa ID: 3
2026-01-26 13:13:38 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    left join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        e1_0.id=?
2026-01-26 13:13:38 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:13:38 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.IngredienteServicio - Encontrados 0 ingredientes para empresa ID: 3
2026-01-26 13:13:38 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 47, Tenant anterior: 3
2026-01-26 13:13:38 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 47, Request: /ingredientes, Empresa ID anterior: 3
2026-01-26 13:13:40 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /ingredientes/nuevo
2026-01-26 13:13:40 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:13:40 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /ingredientes/nuevo
2026-01-26 13:13:40 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /ingredientes/nuevo, M√©todo: GET
2026-01-26 13:13:40 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:13:40 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:13:40 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:13:40 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:13:40 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 48
2026-01-26 13:13:40 [http-nio-8080-exec-8] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:13:40 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: adminKristoff
2026-01-26 13:13:40 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: adminKristoff en empresa ID: 3
2026-01-26 13:13:40 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:13:40 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [adminKristoff]
2026-01-26 13:13:40 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:13:40 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:13:40 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:13:40 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario adminKristoff validado para empresa 3
2026-01-26 13:13:40 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /ingredientes/nuevo, Empresa ID: 3
2026-01-26 13:13:40 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:13:40 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:13:40 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:13:40 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:13:40 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:13:40 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:13:40 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:13:40 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:13:40 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:13:40 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:13:40 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:13:40 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:13:40 [http-nio-8080-exec-8] INFO  j.s.s.c.IngredienteControlador - üìù GET /ingredientes/nuevo - Mostrando formulario nuevo ingrediente
2026-01-26 13:13:40 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 48, Tenant anterior: 3
2026-01-26 13:13:40 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 48, Request: /ingredientes/nuevo, Empresa ID anterior: 3
2026-01-26 13:13:51 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing POST /ingredientes/guardar
2026-01-26 13:13:51 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:13:51 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured POST /ingredientes/guardar
2026-01-26 13:13:51 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /ingredientes/guardar, M√©todo: POST
2026-01-26 13:13:51 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:13:51 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:13:51 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:13:51 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:13:51 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 49
2026-01-26 13:13:51 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:13:51 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: adminKristoff
2026-01-26 13:13:51 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: adminKristoff en empresa ID: 3
2026-01-26 13:13:51 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:13:51 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [adminKristoff]
2026-01-26 13:13:51 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:13:51 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:13:51 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:13:51 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario adminKristoff validado para empresa 3
2026-01-26 13:13:51 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /ingredientes/guardar, Empresa ID: 3
2026-01-26 13:13:51 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:13:51 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:13:51 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:13:51 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:13:51 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:13:51 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:13:51 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:13:51 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:13:51 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:13:51 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:13:51 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:13:51 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:13:51 [http-nio-8080-exec-9] INFO  j.s.s.c.IngredienteControlador - üíæ POST /ingredientes/guardar - Guardando ingrediente: papas
2026-01-26 13:13:51 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.IngredienteServicio - Creando ingrediente 'papas' para empresa ID: 3
2026-01-26 13:13:51 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        ingrediente
        (activo, empresa_id, nombre, precio, stock_actual, stock_minimo, unidad_medida) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-26 13:13:51 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-26 13:13:51 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:13:51 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [papas]
2026-01-26 13:13:51 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DOUBLE) <- [3000.0]
2026-01-26 13:13:51 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:DOUBLE) <- [0.0]
2026-01-26 13:13:51 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DOUBLE) <- [0.0]
2026-01-26 13:13:51 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [Kg]
2026-01-26 13:13:51 [http-nio-8080-exec-9] INFO  j.s.s.servicios.IngredienteServicio - Ingrediente creado exitosamente: 'papas' (ID: 3) para empresa ID: 3
2026-01-26 13:13:51 [http-nio-8080-exec-9] INFO  j.s.s.c.IngredienteControlador - ‚úÖ Ingrediente guardado exitosamente: papas (ID: 3)
2026-01-26 13:13:51 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 49, Tenant anterior: 3
2026-01-26 13:13:51 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 49, Request: /ingredientes/guardar, Empresa ID anterior: 3
2026-01-26 13:13:51 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /ingredientes
2026-01-26 13:13:51 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:13:51 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /ingredientes
2026-01-26 13:13:51 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /ingredientes, M√©todo: GET
2026-01-26 13:13:51 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:13:51 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:13:51 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:13:51 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:13:51 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 50
2026-01-26 13:13:51 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:13:51 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: adminKristoff
2026-01-26 13:13:51 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: adminKristoff en empresa ID: 3
2026-01-26 13:13:51 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:13:51 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [adminKristoff]
2026-01-26 13:13:51 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:13:51 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:13:51 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:13:51 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario adminKristoff validado para empresa 3
2026-01-26 13:13:51 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /ingredientes, Empresa ID: 3
2026-01-26 13:13:51 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:13:51 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:13:51 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:13:51 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:13:51 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:13:51 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:13:51 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:13:51 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:13:51 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:13:51 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:13:51 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:13:51 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:13:51 [http-nio-8080-exec-10] INFO  j.s.s.c.IngredienteControlador - üìã GET /ingredientes - Listando ingredientes
2026-01-26 13:13:51 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.IngredienteServicio - Listando ingredientes para empresa ID: 3
2026-01-26 13:13:51 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    left join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        e1_0.id=?
2026-01-26 13:13:51 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:13:51 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:13:51 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:13:51 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.IngredienteServicio - Encontrados 1 ingredientes para empresa ID: 3
2026-01-26 13:13:51 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 50, Tenant anterior: 3
2026-01-26 13:13:51 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 50, Request: /ingredientes, Empresa ID anterior: 3
2026-01-26 13:13:56 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /ingredientes/nuevo
2026-01-26 13:13:56 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:13:56 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /ingredientes/nuevo
2026-01-26 13:13:56 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /ingredientes/nuevo, M√©todo: GET
2026-01-26 13:13:56 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:13:56 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:13:56 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:13:56 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:13:56 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 41
2026-01-26 13:13:56 [http-nio-8080-exec-1] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:13:56 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: adminKristoff
2026-01-26 13:13:56 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: adminKristoff en empresa ID: 3
2026-01-26 13:13:56 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:13:56 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [adminKristoff]
2026-01-26 13:13:56 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:13:56 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:13:56 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:13:56 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario adminKristoff validado para empresa 3
2026-01-26 13:13:56 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /ingredientes/nuevo, Empresa ID: 3
2026-01-26 13:13:56 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:13:56 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:13:56 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:13:56 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:13:56 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:13:56 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:13:56 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:13:56 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:13:56 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:13:56 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:13:56 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:13:56 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:13:56 [http-nio-8080-exec-1] INFO  j.s.s.c.IngredienteControlador - üìù GET /ingredientes/nuevo - Mostrando formulario nuevo ingrediente
2026-01-26 13:13:56 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 41, Tenant anterior: 3
2026-01-26 13:13:56 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 41, Request: /ingredientes/nuevo, Empresa ID anterior: 3
2026-01-26 13:14:06 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing POST /ingredientes/guardar
2026-01-26 13:14:06 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:14:06 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured POST /ingredientes/guardar
2026-01-26 13:14:06 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /ingredientes/guardar, M√©todo: POST
2026-01-26 13:14:06 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:14:06 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:14:06 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:14:06 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:14:06 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 42
2026-01-26 13:14:06 [http-nio-8080-exec-2] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:14:06 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: adminKristoff
2026-01-26 13:14:06 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: adminKristoff en empresa ID: 3
2026-01-26 13:14:06 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:14:06 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [adminKristoff]
2026-01-26 13:14:06 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:14:06 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:14:06 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:14:06 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario adminKristoff validado para empresa 3
2026-01-26 13:14:06 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /ingredientes/guardar, Empresa ID: 3
2026-01-26 13:14:06 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:14:06 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:14:06 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:14:06 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:14:06 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:14:06 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:14:06 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:14:06 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:14:06 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:14:06 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:14:06 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:14:06 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:14:06 [http-nio-8080-exec-2] INFO  j.s.s.c.IngredienteControlador - üíæ POST /ingredientes/guardar - Guardando ingrediente: Mayonesa
2026-01-26 13:14:06 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.IngredienteServicio - Creando ingrediente 'Mayonesa' para empresa ID: 3
2026-01-26 13:14:06 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        ingrediente
        (activo, empresa_id, nombre, precio, stock_actual, stock_minimo, unidad_medida) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-26 13:14:06 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-26 13:14:06 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:14:06 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [Mayonesa]
2026-01-26 13:14:06 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DOUBLE) <- [15000.0]
2026-01-26 13:14:06 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:DOUBLE) <- [0.0]
2026-01-26 13:14:06 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DOUBLE) <- [0.0]
2026-01-26 13:14:06 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [Kg]
2026-01-26 13:14:06 [http-nio-8080-exec-2] INFO  j.s.s.servicios.IngredienteServicio - Ingrediente creado exitosamente: 'Mayonesa' (ID: 4) para empresa ID: 3
2026-01-26 13:14:06 [http-nio-8080-exec-2] INFO  j.s.s.c.IngredienteControlador - ‚úÖ Ingrediente guardado exitosamente: Mayonesa (ID: 4)
2026-01-26 13:14:06 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 42, Tenant anterior: 3
2026-01-26 13:14:06 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 42, Request: /ingredientes/guardar, Empresa ID anterior: 3
2026-01-26 13:14:06 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /ingredientes
2026-01-26 13:14:06 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:14:06 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /ingredientes
2026-01-26 13:14:06 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /ingredientes, M√©todo: GET
2026-01-26 13:14:06 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:14:06 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:14:06 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:14:06 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:14:06 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 43
2026-01-26 13:14:06 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:14:06 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: adminKristoff
2026-01-26 13:14:06 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: adminKristoff en empresa ID: 3
2026-01-26 13:14:06 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:14:06 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [adminKristoff]
2026-01-26 13:14:06 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:14:06 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:14:06 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:14:06 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario adminKristoff validado para empresa 3
2026-01-26 13:14:06 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /ingredientes, Empresa ID: 3
2026-01-26 13:14:06 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:14:06 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:14:06 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:14:06 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:14:06 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:14:06 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:14:06 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:14:06 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:14:06 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:14:06 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:14:06 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:14:06 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:14:06 [http-nio-8080-exec-3] INFO  j.s.s.c.IngredienteControlador - üìã GET /ingredientes - Listando ingredientes
2026-01-26 13:14:06 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.IngredienteServicio - Listando ingredientes para empresa ID: 3
2026-01-26 13:14:06 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    left join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        e1_0.id=?
2026-01-26 13:14:06 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:14:06 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:14:06 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:14:06 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.IngredienteServicio - Encontrados 2 ingredientes para empresa ID: 3
2026-01-26 13:14:06 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 43, Tenant anterior: 3
2026-01-26 13:14:06 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /ingredientes, Empresa ID anterior: 3
2026-01-26 13:14:08 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-26 13:14:08 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:14:08 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-26 13:14:08 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-26 13:14:08 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:14:08 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:14:08 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:14:08 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:14:08 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 44
2026-01-26 13:14:08 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:14:08 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: adminKristoff
2026-01-26 13:14:08 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: adminKristoff en empresa ID: 3
2026-01-26 13:14:08 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:14:08 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [adminKristoff]
2026-01-26 13:14:08 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:14:08 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:14:08 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:14:08 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario adminKristoff validado para empresa 3
2026-01-26 13:14:08 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 3
2026-01-26 13:14:08 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:14:08 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:14:08 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:14:08 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:14:08 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:14:08 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:14:08 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:14:08 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:14:08 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:14:08 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:14:08 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:14:08 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:14:08 [http-nio-8080-exec-4] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-26
2026-01-26 13:14:08 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-26 13:14:08 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:14:08 [http-nio-8080-exec-4] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-26
2026-01-26 13:14:08 [http-nio-8080-exec-4] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-26 13:14:08 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 44, Tenant anterior: 3
2026-01-26 13:14:08 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 44, Request: /principal, Empresa ID anterior: 3
2026-01-26 13:14:10 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /recetas
2026-01-26 13:14:10 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:14:10 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /recetas
2026-01-26 13:14:10 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /recetas, M√©todo: GET
2026-01-26 13:14:10 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:14:10 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:14:10 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:14:10 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:14:10 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 45
2026-01-26 13:14:10 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:14:10 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: adminKristoff
2026-01-26 13:14:10 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: adminKristoff en empresa ID: 3
2026-01-26 13:14:10 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:14:10 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [adminKristoff]
2026-01-26 13:14:10 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:14:10 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:14:10 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:14:10 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario adminKristoff validado para empresa 3
2026-01-26 13:14:10 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /recetas, Empresa ID: 3
2026-01-26 13:14:10 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:14:10 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:14:10 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:14:10 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:14:10 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:14:10 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:14:10 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:14:10 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:14:10 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:14:10 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:14:10 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:14:10 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:14:10 [http-nio-8080-exec-5] INFO  j.s.s.c.RecetaControlador - üìã GET /recetas - Listando recetas
2026-01-26 13:14:10 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.RecetaServicio - Listando recetas para empresa ID: 3
2026-01-26 13:14:10 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        distinct r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        i1_0.receta_id,
        i1_0.id,
        i1_0.cantidad_ingrediente,
        i1_0.ingrediente_id,
        r1_0.nombre 
    from
        receta r1_0 
    left join
        receta_detalle i1_0 
            on r1_0.id=i1_0.receta_id 
    where
        r1_0.empresa_id=?
2026-01-26 13:14:10 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:14:10 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.RecetaServicio - Encontradas 0 recetas para empresa ID: 3
2026-01-26 13:14:10 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 45, Tenant anterior: 3
2026-01-26 13:14:10 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 45, Request: /recetas, Empresa ID anterior: 3
2026-01-26 13:14:11 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /recetas/nuevo
2026-01-26 13:14:11 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:14:11 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /recetas/nuevo
2026-01-26 13:14:11 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /recetas/nuevo, M√©todo: GET
2026-01-26 13:14:11 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:14:11 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:14:11 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:14:11 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:14:11 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 46
2026-01-26 13:14:11 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:14:11 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: adminKristoff
2026-01-26 13:14:11 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: adminKristoff en empresa ID: 3
2026-01-26 13:14:11 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:14:11 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [adminKristoff]
2026-01-26 13:14:11 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:14:11 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:14:11 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:14:11 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario adminKristoff validado para empresa 3
2026-01-26 13:14:11 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /recetas/nuevo, Empresa ID: 3
2026-01-26 13:14:11 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:14:11 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:14:11 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:14:11 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:14:11 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:14:11 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:14:11 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:14:11 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:14:11 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:14:11 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:14:11 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:14:11 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:14:11 [http-nio-8080-exec-6] INFO  j.s.s.c.RecetaControlador - üìù GET /recetas/nuevo - Mostrando formulario nueva receta
2026-01-26 13:14:11 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.IngredienteServicio - Listando ingredientes para empresa ID: 3
2026-01-26 13:14:11 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    left join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        e1_0.id=?
2026-01-26 13:14:11 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:14:11 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:14:11 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:14:11 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.IngredienteServicio - Encontrados 2 ingredientes para empresa ID: 3
2026-01-26 13:14:11 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 46, Tenant anterior: 3
2026-01-26 13:14:11 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 46, Request: /recetas/nuevo, Empresa ID anterior: 3
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing POST /recetas/guardar
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured POST /recetas/guardar
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /recetas/guardar, M√©todo: POST
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:14:28 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 47
2026-01-26 13:14:28 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: adminKristoff
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: adminKristoff en empresa ID: 3
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:14:28 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [adminKristoff]
2026-01-26 13:14:28 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:14:28 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario adminKristoff validado para empresa 3
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /recetas/guardar, Empresa ID: 3
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:14:28 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:14:28 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:14:28 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:14:28 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:14:28 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:14:28 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:14:28 [http-nio-8080-exec-7] INFO  j.s.s.c.RecetaControlador - üíæ POST /recetas/guardar - Guardando receta. ID: null, Nombre: papa con mayonesa
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG j.s.s.c.RecetaControlador - Ingredientes recibidos: 2, Cantidades: 2
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG j.s.s.c.RecetaControlador - Creando nueva receta: papa con mayonesa
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.IngredienteServicio - Buscando ingrediente ID: 4 para empresa ID: 3
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    left join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=? 
        and e1_0.id=?
2026-01-26 13:14:28 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [4]
2026-01-26 13:14:28 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:14:28 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.IngredienteServicio - Ingrediente encontrado: 'Mayonesa' (ID: 4)
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.IngredienteServicio - Buscando ingrediente ID: 3 para empresa ID: 3
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    left join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=? 
        and e1_0.id=?
2026-01-26 13:14:28 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:14:28 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:14:28 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.IngredienteServicio - Ingrediente encontrado: 'papas' (ID: 3)
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.RecetaServicio - Creando receta 'papa con mayonesa' para empresa ID: 3
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.RecetaServicio - Calculando costo para receta: 'papa con mayonesa' (ID: null)
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.RecetaServicio - Costo calculado para receta 'papa con mayonesa': 6000.0
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        receta
        (costo_receta, descripcion, empresa_id, nombre) 
    values
        (?, ?, ?, ?)
2026-01-26 13:14:28 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DOUBLE) <- [6000.0]
2026-01-26 13:14:28 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- []
2026-01-26 13:14:28 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:14:28 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [papa con mayonesa]
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        receta_detalle
        (cantidad_ingrediente, ingrediente_id, receta_id) 
    values
        (?, ?, ?)
2026-01-26 13:14:28 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DOUBLE) <- [0.2]
2026-01-26 13:14:28 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [4]
2026-01-26 13:14:28 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        receta_detalle
        (cantidad_ingrediente, ingrediente_id, receta_id) 
    values
        (?, ?, ?)
2026-01-26 13:14:28 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DOUBLE) <- [1.0]
2026-01-26 13:14:28 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:14:28 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:14:28 [http-nio-8080-exec-7] INFO  j.s.s.servicios.RecetaServicio - Receta creada exitosamente: 'papa con mayonesa' (ID: 3) para empresa ID: 3
2026-01-26 13:14:28 [http-nio-8080-exec-7] INFO  j.s.s.c.RecetaControlador - ‚úÖ Receta creada exitosamente: papa con mayonesa (ID: 3) con 2 ingredientes
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 47, Tenant anterior: 3
2026-01-26 13:14:28 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 47, Request: /recetas/guardar, Empresa ID anterior: 3
2026-01-26 13:14:28 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /recetas
2026-01-26 13:14:28 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:14:28 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /recetas
2026-01-26 13:14:28 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /recetas, M√©todo: GET
2026-01-26 13:14:28 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:14:28 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:14:28 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:14:28 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:14:28 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 48
2026-01-26 13:14:28 [http-nio-8080-exec-8] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:14:28 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: adminKristoff
2026-01-26 13:14:28 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: adminKristoff en empresa ID: 3
2026-01-26 13:14:28 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:14:28 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [adminKristoff]
2026-01-26 13:14:28 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:14:28 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:14:28 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:14:28 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario adminKristoff validado para empresa 3
2026-01-26 13:14:28 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /recetas, Empresa ID: 3
2026-01-26 13:14:28 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:14:28 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:14:28 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:14:28 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:14:28 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:14:28 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:14:28 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:14:28 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:14:28 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:14:28 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:14:28 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:14:28 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:14:28 [http-nio-8080-exec-8] INFO  j.s.s.c.RecetaControlador - üìã GET /recetas - Listando recetas
2026-01-26 13:14:28 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.RecetaServicio - Listando recetas para empresa ID: 3
2026-01-26 13:14:28 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        distinct r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        i1_0.receta_id,
        i1_0.id,
        i1_0.cantidad_ingrediente,
        i1_0.ingrediente_id,
        r1_0.nombre 
    from
        receta r1_0 
    left join
        receta_detalle i1_0 
            on r1_0.id=i1_0.receta_id 
    where
        r1_0.empresa_id=?
2026-01-26 13:14:28 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:14:28 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:14:28 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:14:28 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-26 13:14:28 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:14:28 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-26 13:14:28 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [4]
2026-01-26 13:14:28 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.RecetaServicio - Encontradas 1 recetas para empresa ID: 3
2026-01-26 13:14:28 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 48, Tenant anterior: 3
2026-01-26 13:14:28 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 48, Request: /recetas, Empresa ID anterior: 3
2026-01-26 13:14:33 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-26 13:14:33 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:14:33 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-26 13:14:33 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-26 13:14:33 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:14:33 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:14:33 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:14:33 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:14:33 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 50
2026-01-26 13:14:33 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:14:33 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: adminKristoff
2026-01-26 13:14:33 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: adminKristoff en empresa ID: 3
2026-01-26 13:14:33 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:14:33 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [adminKristoff]
2026-01-26 13:14:33 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:14:33 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:14:33 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:14:33 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario adminKristoff validado para empresa 3
2026-01-26 13:14:33 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 3
2026-01-26 13:14:33 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:14:33 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:14:33 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:14:33 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:14:33 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:14:33 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:14:33 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:14:33 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:14:33 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:14:33 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:14:33 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:14:33 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:14:33 [http-nio-8080-exec-10] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-26
2026-01-26 13:14:33 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-26 13:14:33 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:14:33 [http-nio-8080-exec-10] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-26
2026-01-26 13:14:33 [http-nio-8080-exec-10] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-26 13:14:33 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 50, Tenant anterior: 3
2026-01-26 13:14:33 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 50, Request: /principal, Empresa ID anterior: 3
2026-01-26 13:14:35 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /productos
2026-01-26 13:14:35 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:14:35 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /productos
2026-01-26 13:14:35 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /productos, M√©todo: GET
2026-01-26 13:14:35 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:14:35 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:14:35 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:14:35 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:14:35 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 41
2026-01-26 13:14:35 [http-nio-8080-exec-1] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:14:35 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: adminKristoff
2026-01-26 13:14:35 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: adminKristoff en empresa ID: 3
2026-01-26 13:14:35 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:14:35 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [adminKristoff]
2026-01-26 13:14:35 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:14:35 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:14:35 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:14:35 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario adminKristoff validado para empresa 3
2026-01-26 13:14:35 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /productos, Empresa ID: 3
2026-01-26 13:14:35 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:14:35 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:14:35 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:14:35 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:14:35 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:14:35 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:14:35 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:14:35 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:14:35 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:14:35 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:14:35 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:14:35 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:14:35 [http-nio-8080-exec-1] INFO  j.s.s.c.ProductoControlador - üìã GET /productos - Listando productos
2026-01-26 13:14:35 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.ProductoServicio - Listando productos para empresa ID: 3
2026-01-26 13:14:35 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        p1_0.receta_id,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta 
    from
        producto p1_0 
    left join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        e1_0.id=?
2026-01-26 13:14:35 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:14:35 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.ProductoServicio - Encontrados 0 productos para empresa ID: 3
2026-01-26 13:14:35 [http-nio-8080-exec-1] DEBUG j.s.s.c.ProductoControlador - Encontrados 0 productos
2026-01-26 13:14:35 [http-nio-8080-exec-1] DEBUG j.s.s.c.ProductoControlador - Stock posible calculado para 0 productos con receta
2026-01-26 13:14:35 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 41, Tenant anterior: 3
2026-01-26 13:14:35 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 41, Request: /productos, Empresa ID anterior: 3
2026-01-26 13:14:36 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /productos/nuevo
2026-01-26 13:14:36 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:14:36 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured GET /productos/nuevo
2026-01-26 13:14:36 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /productos/nuevo, M√©todo: GET
2026-01-26 13:14:36 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:14:36 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:14:36 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:14:36 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:14:36 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 42
2026-01-26 13:14:36 [http-nio-8080-exec-2] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:14:36 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: adminKristoff
2026-01-26 13:14:36 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: adminKristoff en empresa ID: 3
2026-01-26 13:14:36 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:14:36 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [adminKristoff]
2026-01-26 13:14:36 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:14:36 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:14:36 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:14:36 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario adminKristoff validado para empresa 3
2026-01-26 13:14:36 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /productos/nuevo, Empresa ID: 3
2026-01-26 13:14:36 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:14:36 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:14:36 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:14:36 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:14:36 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:14:36 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:14:36 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:14:36 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:14:36 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:14:36 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:14:36 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:14:36 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:14:36 [http-nio-8080-exec-2] INFO  j.s.s.c.ProductoControlador - üìù GET /productos/nuevo - Mostrando formulario nuevo producto
2026-01-26 13:14:36 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.RecetaServicio - Listando recetas para empresa ID: 3
2026-01-26 13:14:36 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        distinct r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        i1_0.receta_id,
        i1_0.id,
        i1_0.cantidad_ingrediente,
        i1_0.ingrediente_id,
        r1_0.nombre 
    from
        receta r1_0 
    left join
        receta_detalle i1_0 
            on r1_0.id=i1_0.receta_id 
    where
        r1_0.empresa_id=?
2026-01-26 13:14:36 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:14:36 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:14:36 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:14:36 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-26 13:14:36 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:14:36 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-26 13:14:36 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [4]
2026-01-26 13:14:36 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.RecetaServicio - Encontradas 1 recetas para empresa ID: 3
2026-01-26 13:14:36 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 42, Tenant anterior: 3
2026-01-26 13:14:36 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 42, Request: /productos/nuevo, Empresa ID anterior: 3
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing POST /productos/guardar
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured POST /productos/guardar
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /productos/guardar, M√©todo: POST
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:15:00 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 43
2026-01-26 13:15:00 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: adminKristoff
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: adminKristoff en empresa ID: 3
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:15:00 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [adminKristoff]
2026-01-26 13:15:00 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:15:00 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario adminKristoff validado para empresa 3
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /productos/guardar, Empresa ID: 3
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:15:00 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:15:00 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:15:00 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:15:00 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:15:00 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:15:00 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:15:00 [http-nio-8080-exec-3] INFO  j.s.s.c.ProductoControlador - üíæ POST /productos/guardar - Guardando producto. ID: 0, Nombre: Papas con Mayonesa
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG j.s.s.c.ProductoControlador - Par√°metros - Tiene receta: true, Receta ID: 3, Precio: 8000.0, Stock: 100.0
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG j.s.s.c.ProductoControlador - Creando nuevo producto
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG j.s.s.c.ProductoControlador - Asignando receta ID: 3 al producto
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.RecetaServicio - Buscando receta ID: 3 para empresa ID: 3
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        i1_0.receta_id,
        i1_0.id,
        i1_0.cantidad_ingrediente,
        i1_0.ingrediente_id,
        r1_0.nombre 
    from
        receta r1_0 
    left join
        receta_detalle i1_0 
            on r1_0.id=i1_0.receta_id 
    where
        r1_0.id=? 
        and r1_0.empresa_id=?
2026-01-26 13:15:00 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:15:00 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:15:00 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-26 13:15:00 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        i1_0.id=?
2026-01-26 13:15:00 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [4]
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.RecetaServicio - Receta encontrada: 'papa con mayonesa' (ID: 3)
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.ProductoServicio - Creando producto 'Papas con Mayonesa' para empresa ID: 3
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.ProductoServicio - Validando producto: 'Papas con Mayonesa'
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.ProductoServicio - Validaci√≥n de producto exitosa
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.ProductoServicio - Validando producto: 'Papas con Mayonesa'
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.ProductoServicio - Validaci√≥n de producto exitosa
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.ProductoServicio - Producto con receta, validando receta asociada
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        r1_0.nombre 
    from
        receta r1_0 
    left join
        empresa e1_0 
            on e1_0.id=r1_0.empresa_id 
    where
        r1_0.id=? 
        and e1_0.id=?
2026-01-26 13:15:00 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:15:00 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:15:00 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.ProductoServicio - Costo de receta establecido: 6000.0 para producto 'Papas con Mayonesa'
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.ProductoServicio - Precio de venta especificado manualmente: 8000.0
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.ProductoServicio - Precios calculados desde receta para producto 'Papas con Mayonesa'
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        producto
        (activo, empresa_id, nombre, precio_compra, precio_venta, receta_id, stock, tiene_receta, unidad_medida_venta) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?)
2026-01-26 13:15:00 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-26 13:15:00 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:15:00 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [Papas con Mayonesa]
2026-01-26 13:15:00 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DOUBLE) <- [6000.0]
2026-01-26 13:15:00 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:DOUBLE) <- [8000.0]
2026-01-26 13:15:00 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:BIGINT) <- [3]
2026-01-26 13:15:00 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:DOUBLE) <- [100.0]
2026-01-26 13:15:00 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (8:BOOLEAN) <- [true]
2026-01-26 13:15:00 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (9:VARCHAR) <- [Unid]
2026-01-26 13:15:00 [http-nio-8080-exec-3] INFO  j.s.s.servicios.ProductoServicio - Producto creado exitosamente: 'Papas con Mayonesa' (ID: 3) para empresa ID: 3
2026-01-26 13:15:00 [http-nio-8080-exec-3] INFO  j.s.s.c.ProductoControlador - ‚úÖ Producto creado exitosamente: Papas con Mayonesa (ID: 3)
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 43, Tenant anterior: 3
2026-01-26 13:15:00 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /productos/guardar, Empresa ID anterior: 3
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /productos
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /productos
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /productos, M√©todo: GET
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:15:00 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 44
2026-01-26 13:15:00 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: adminKristoff
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: adminKristoff en empresa ID: 3
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:15:00 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [adminKristoff]
2026-01-26 13:15:00 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:15:00 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario adminKristoff validado para empresa 3
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /productos, Empresa ID: 3
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:15:00 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:15:00 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:15:00 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:15:00 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:15:00 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:15:00 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:15:00 [http-nio-8080-exec-4] INFO  j.s.s.c.ProductoControlador - üìã GET /productos - Listando productos
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.ProductoServicio - Listando productos para empresa ID: 3
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        p1_0.receta_id,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta 
    from
        producto p1_0 
    left join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        e1_0.id=?
2026-01-26 13:15:00 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:15:00 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        r1_0.nombre 
    from
        receta r1_0 
    join
        empresa e1_0 
            on e1_0.id=r1_0.empresa_id 
    where
        r1_0.id=?
2026-01-26 13:15:00 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.ProductoServicio - Encontrados 1 productos para empresa ID: 3
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG j.s.s.c.ProductoControlador - Encontrados 1 productos
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.ProductoServicio - Calculando stock posible para producto ID: 3
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.ProductoServicio - Buscando producto ID: 3 para empresa ID: 3
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        p1_0.receta_id,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta 
    from
        producto p1_0 
    left join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        p1_0.id=? 
        and e1_0.id=?
2026-01-26 13:15:00 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:15:00 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:15:00 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        r1_0.id,
        r1_0.costo_receta,
        r1_0.descripcion,
        r1_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        r1_0.nombre 
    from
        receta r1_0 
    join
        empresa e1_0 
            on e1_0.id=r1_0.empresa_id 
    where
        r1_0.id=?
2026-01-26 13:15:00 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        i1_0.receta_id,
        i1_0.id,
        i1_0.cantidad_ingrediente,
        i1_0.ingrediente_id,
        i2_0.id,
        i2_0.activo,
        i2_0.empresa_id,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        i2_0.nombre,
        i2_0.precio,
        i2_0.stock_actual,
        i2_0.stock_minimo,
        i2_0.unidad_medida 
    from
        receta_detalle i1_0 
    left join
        ingrediente i2_0 
            on i2_0.id=i1_0.ingrediente_id 
    left join
        empresa e1_0 
            on e1_0.id=i2_0.empresa_id 
    where
        i1_0.receta_id=?
2026-01-26 13:15:00 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.ProductoServicio - Calculando stock posible basado en 2 ingredientes
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.ProductoServicio - Stock posible calculado para producto 'Papas con Mayonesa': 0
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG j.s.s.c.ProductoControlador - Stock posible calculado para 1 productos con receta
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 44, Tenant anterior: 3
2026-01-26 13:15:00 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 44, Request: /productos, Empresa ID anterior: 3
2026-01-26 13:15:07 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-26 13:15:07 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:15:07 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-26 13:15:07 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-26 13:15:07 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:15:07 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:15:07 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:15:07 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:15:07 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 45
2026-01-26 13:15:07 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:15:07 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: adminKristoff
2026-01-26 13:15:07 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: adminKristoff en empresa ID: 3
2026-01-26 13:15:07 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:15:07 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [adminKristoff]
2026-01-26 13:15:07 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:15:07 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:15:07 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:15:07 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario adminKristoff validado para empresa 3
2026-01-26 13:15:07 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 3
2026-01-26 13:15:07 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:15:07 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:15:07 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:15:07 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:15:07 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:15:07 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:15:07 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:15:07 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:15:07 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:15:07 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:15:07 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:15:07 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:15:07 [http-nio-8080-exec-5] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-26
2026-01-26 13:15:07 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-26 13:15:07 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:15:07 [http-nio-8080-exec-5] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-26
2026-01-26 13:15:07 [http-nio-8080-exec-5] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-26 13:15:07 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 45, Tenant anterior: 3
2026-01-26 13:15:07 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 45, Request: /principal, Empresa ID anterior: 3
2026-01-26 13:15:21 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /proveedores
2026-01-26 13:15:21 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:15:21 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /proveedores
2026-01-26 13:15:21 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /proveedores, M√©todo: GET
2026-01-26 13:15:21 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:15:21 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:15:21 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:15:21 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:15:21 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 46
2026-01-26 13:15:21 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:15:21 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: adminKristoff
2026-01-26 13:15:21 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: adminKristoff en empresa ID: 3
2026-01-26 13:15:21 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:15:21 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [adminKristoff]
2026-01-26 13:15:21 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:15:21 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:15:21 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:15:21 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario adminKristoff validado para empresa 3
2026-01-26 13:15:21 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /proveedores, Empresa ID: 3
2026-01-26 13:15:21 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:15:21 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:15:21 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:15:21 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:15:21 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:15:21 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:15:21 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:15:21 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:15:21 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:15:21 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:15:21 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:15:21 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:15:21 [http-nio-8080-exec-6] INFO  j.s.s.c.ProveedorControlador - üìã GET /proveedores - Listando proveedores
2026-01-26 13:15:21 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.ProveedorServicio - Listando proveedores para empresa ID: 3
2026-01-26 13:15:21 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.correo,
        p1_0.empresa_id,
        p1_0.identificacion,
        p1_0.nombre,
        p1_0.telefono 
    from
        proveedor p1_0 
    left join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        e1_0.id=?
2026-01-26 13:15:21 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:15:21 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.ProveedorServicio - Encontrados 0 proveedores para empresa ID: 3
2026-01-26 13:15:21 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 46, Tenant anterior: 3
2026-01-26 13:15:21 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 46, Request: /proveedores, Empresa ID anterior: 3
2026-01-26 13:15:22 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /proveedores/nuevo
2026-01-26 13:15:22 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:15:22 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /proveedores/nuevo
2026-01-26 13:15:22 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /proveedores/nuevo, M√©todo: GET
2026-01-26 13:15:22 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:15:22 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:15:22 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:15:22 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:15:22 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 47
2026-01-26 13:15:22 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:15:22 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: adminKristoff
2026-01-26 13:15:22 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: adminKristoff en empresa ID: 3
2026-01-26 13:15:22 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:15:22 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [adminKristoff]
2026-01-26 13:15:22 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:15:22 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:15:22 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:15:22 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario adminKristoff validado para empresa 3
2026-01-26 13:15:22 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /proveedores/nuevo, Empresa ID: 3
2026-01-26 13:15:22 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:15:22 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:15:22 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:15:22 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:15:22 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:15:22 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:15:22 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:15:22 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:15:22 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:15:22 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:15:22 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:15:22 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:15:22 [http-nio-8080-exec-7] INFO  j.s.s.c.ProveedorControlador - üìù GET /proveedores/nuevo - Mostrando formulario nuevo proveedor
2026-01-26 13:15:22 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 47, Tenant anterior: 3
2026-01-26 13:15:22 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 47, Request: /proveedores/nuevo, Empresa ID anterior: 3
2026-01-26 13:15:30 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing POST /proveedores/guardar
2026-01-26 13:15:30 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:15:30 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured POST /proveedores/guardar
2026-01-26 13:15:30 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /proveedores/guardar, M√©todo: POST
2026-01-26 13:15:30 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:15:30 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:15:30 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:15:30 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:15:30 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 48
2026-01-26 13:15:30 [http-nio-8080-exec-8] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:15:30 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: adminKristoff
2026-01-26 13:15:30 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: adminKristoff en empresa ID: 3
2026-01-26 13:15:30 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:15:30 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [adminKristoff]
2026-01-26 13:15:30 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:15:30 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:15:30 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:15:30 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario adminKristoff validado para empresa 3
2026-01-26 13:15:30 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /proveedores/guardar, Empresa ID: 3
2026-01-26 13:15:30 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:15:30 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:15:30 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:15:30 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:15:30 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:15:30 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:15:30 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:15:30 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:15:30 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:15:30 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:15:30 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:15:30 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:15:30 [http-nio-8080-exec-8] INFO  j.s.s.c.ProveedorControlador - üíæ POST /proveedores/guardar - Guardando proveedor: Jose Pino
2026-01-26 13:15:30 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.ProveedorServicio - Guardando proveedor 'Jose Pino' para empresa ID: 3
2026-01-26 13:15:30 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.ProveedorServicio - Validando identificaci√≥n √∫nica: 123 para empresa ID: 3
2026-01-26 13:15:30 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        p1_0.id 
    from
        proveedor p1_0 
    left join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        p1_0.identificacion=? 
        and e1_0.id=? 
    limit
        ?
2026-01-26 13:15:30 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [123]
2026-01-26 13:15:30 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:15:30 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:INTEGER) <- [1]
2026-01-26 13:15:30 [http-nio-8080-exec-8] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@867833827 wrapping com.mysql.cj.jdbc.ConnectionImpl@7827e241] read-only
2026-01-26 13:15:30 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:15:30 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:15:30 [http-nio-8080-exec-8] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@867833827 wrapping com.mysql.cj.jdbc.ConnectionImpl@7827e241]
2026-01-26 13:15:30 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        proveedor
        (activo, correo, empresa_id, identificacion, nombre, telefono) 
    values
        (?, ?, ?, ?, ?, ?)
2026-01-26 13:15:30 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-26 13:15:30 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [jose@gmail.com]
2026-01-26 13:15:30 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:15:30 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [123]
2026-01-26 13:15:30 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [Jose Pino]
2026-01-26 13:15:30 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [113231]
2026-01-26 13:15:30 [http-nio-8080-exec-8] INFO  j.s.s.servicios.ProveedorServicio - Proveedor guardado exitosamente: 'Jose Pino' (ID: 2) para empresa ID: 3
2026-01-26 13:15:30 [http-nio-8080-exec-8] INFO  j.s.s.c.ProveedorControlador - ‚úÖ Proveedor guardado exitosamente: Jose Pino (ID: 2)
2026-01-26 13:15:30 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 48, Tenant anterior: 3
2026-01-26 13:15:30 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 48, Request: /proveedores/guardar, Empresa ID anterior: 3
2026-01-26 13:15:30 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /proveedores
2026-01-26 13:15:30 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:15:30 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /proveedores
2026-01-26 13:15:30 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /proveedores, M√©todo: GET
2026-01-26 13:15:30 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:15:30 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:15:30 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:15:30 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:15:30 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 49
2026-01-26 13:15:30 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:15:30 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: adminKristoff
2026-01-26 13:15:30 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: adminKristoff en empresa ID: 3
2026-01-26 13:15:30 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:15:30 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [adminKristoff]
2026-01-26 13:15:30 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:15:30 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:15:30 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:15:30 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario adminKristoff validado para empresa 3
2026-01-26 13:15:30 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /proveedores, Empresa ID: 3
2026-01-26 13:15:30 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:15:30 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:15:30 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:15:30 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:15:30 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:15:30 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:15:30 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:15:30 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:15:30 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:15:30 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:15:30 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:15:30 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:15:30 [http-nio-8080-exec-9] INFO  j.s.s.c.ProveedorControlador - üìã GET /proveedores - Listando proveedores
2026-01-26 13:15:30 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.ProveedorServicio - Listando proveedores para empresa ID: 3
2026-01-26 13:15:30 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.correo,
        p1_0.empresa_id,
        p1_0.identificacion,
        p1_0.nombre,
        p1_0.telefono 
    from
        proveedor p1_0 
    left join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        e1_0.id=?
2026-01-26 13:15:30 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:15:30 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:15:30 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:15:30 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.ProveedorServicio - Encontrados 1 proveedores para empresa ID: 3
2026-01-26 13:15:30 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 49, Tenant anterior: 3
2026-01-26 13:15:30 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 49, Request: /proveedores, Empresa ID anterior: 3
2026-01-26 13:15:32 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-26 13:15:32 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:15:32 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-26 13:15:32 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-26 13:15:32 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:15:32 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:15:32 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:15:32 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:15:32 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 50
2026-01-26 13:15:32 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:15:32 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: adminKristoff
2026-01-26 13:15:32 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: adminKristoff en empresa ID: 3
2026-01-26 13:15:32 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:15:32 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [adminKristoff]
2026-01-26 13:15:32 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:15:32 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:15:32 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:15:32 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario adminKristoff validado para empresa 3
2026-01-26 13:15:32 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 3
2026-01-26 13:15:32 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:15:32 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:15:32 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:15:32 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:15:32 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:15:32 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:15:32 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:15:32 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:15:32 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:15:32 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:15:32 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:15:32 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:15:32 [http-nio-8080-exec-10] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-26
2026-01-26 13:15:32 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-26 13:15:32 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:15:32 [http-nio-8080-exec-10] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-26
2026-01-26 13:15:32 [http-nio-8080-exec-10] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-26 13:15:32 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 50, Tenant anterior: 3
2026-01-26 13:15:32 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 50, Request: /principal, Empresa ID anterior: 3
2026-01-26 13:15:33 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /compras/nueva
2026-01-26 13:15:33 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:15:33 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /compras/nueva
2026-01-26 13:15:33 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /compras/nueva, M√©todo: GET
2026-01-26 13:15:33 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:15:33 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:15:33 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:15:33 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:15:33 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 41
2026-01-26 13:15:33 [http-nio-8080-exec-1] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:15:33 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: adminKristoff
2026-01-26 13:15:33 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: adminKristoff en empresa ID: 3
2026-01-26 13:15:33 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:15:33 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [adminKristoff]
2026-01-26 13:15:33 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:15:33 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:15:33 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:15:33 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario adminKristoff validado para empresa 3
2026-01-26 13:15:33 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /compras/nueva, Empresa ID: 3
2026-01-26 13:15:33 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:15:33 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:15:33 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:15:33 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:15:33 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:15:33 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:15:33 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:15:33 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:15:33 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:15:33 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:15:33 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:15:33 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:15:33 [http-nio-8080-exec-1] INFO  j.s.s.c.FacturaProveedorControlador - üìù GET /compras/nueva - Mostrando formulario nueva compra
2026-01-26 13:15:33 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.ProveedorServicio - Listando proveedores para empresa ID: 3
2026-01-26 13:15:33 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.correo,
        p1_0.empresa_id,
        p1_0.identificacion,
        p1_0.nombre,
        p1_0.telefono 
    from
        proveedor p1_0 
    left join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        e1_0.id=?
2026-01-26 13:15:33 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:15:33 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:15:33 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:15:33 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.ProveedorServicio - Encontrados 1 proveedores para empresa ID: 3
2026-01-26 13:15:33 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.IngredienteServicio - Listando ingredientes para empresa ID: 3
2026-01-26 13:15:33 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    left join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        e1_0.id=?
2026-01-26 13:15:33 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:15:33 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:15:33 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:15:33 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.IngredienteServicio - Encontrados 2 ingredientes para empresa ID: 3
2026-01-26 13:15:33 [http-nio-8080-exec-1] DEBUG j.s.s.c.FacturaProveedorControlador - Formulario cargado - Proveedores activos: 1, Ingredientes: 2
2026-01-26 13:15:33 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 41, Tenant anterior: 3
2026-01-26 13:15:33 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 41, Request: /compras/nueva, Empresa ID anterior: 3
2026-01-26 13:16:35 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing POST /compras/guardar
2026-01-26 13:16:35 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:16:35 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured POST /compras/guardar
2026-01-26 13:16:35 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /compras/guardar, M√©todo: POST
2026-01-26 13:16:35 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:16:35 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:16:35 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:16:35 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:16:35 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 43
2026-01-26 13:16:35 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:16:35 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: adminKristoff
2026-01-26 13:16:35 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: adminKristoff en empresa ID: 3
2026-01-26 13:16:35 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:16:35 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [adminKristoff]
2026-01-26 13:16:35 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:16:35 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:16:35 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:16:35 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario adminKristoff validado para empresa 3
2026-01-26 13:16:35 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /compras/guardar, Empresa ID: 3
2026-01-26 13:16:35 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:16:35 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:16:35 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:16:35 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:16:35 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:16:35 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:16:35 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:16:35 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:16:35 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:16:35 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:16:35 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:16:35 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:16:35 [http-nio-8080-exec-3] INFO  j.s.s.c.FacturaProveedorControlador - üíæ POST /compras/guardar - Guardando compra a proveedor
2026-01-26 13:16:35 [http-nio-8080-exec-3] DEBUG j.s.s.c.FacturaProveedorControlador - Datos compra - Proveedor ID: 2, N√∫mero factura: null
2026-01-26 13:16:35 [http-nio-8080-exec-3] INFO  j.s.s.s.FacturaProveedorServicio - Creando factura de proveedor para empresa ID: 3
2026-01-26 13:16:35 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:16:35 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:16:35 [http-nio-8080-exec-3] DEBUG j.s.s.s.FacturaProveedorServicio - Empresa asignada: Empresa Kristoff (ID: 3)
2026-01-26 13:16:35 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.correo,
        p1_0.empresa_id,
        p1_0.identificacion,
        p1_0.nombre,
        p1_0.telefono 
    from
        proveedor p1_0 
    left join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        p1_0.id=? 
        and e1_0.id=?
2026-01-26 13:16:35 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-26 13:16:35 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:16:35 [http-nio-8080-exec-3] DEBUG j.s.s.s.FacturaProveedorServicio - Proveedor asignado: Jose Pino (ID: 2)
2026-01-26 13:16:35 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        count(fp1_0.id) 
    from
        factura_proveedor fp1_0 
    left join
        empresa e1_0 
            on e1_0.id=fp1_0.empresa_id 
    where
        e1_0.id=?
2026-01-26 13:16:35 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:16:35 [http-nio-8080-exec-3] DEBUG j.s.s.s.FacturaProveedorServicio - Consecutivo generado: 1 para empresa ID: 3
2026-01-26 13:16:35 [http-nio-8080-exec-3] DEBUG j.s.s.s.FacturaProveedorServicio - N√∫mero de factura generado: FAC-PROV-001-2026
2026-01-26 13:16:35 [http-nio-8080-exec-3] DEBUG j.s.s.s.FacturaProveedorServicio - Procesando 3 detalles de factura
2026-01-26 13:16:35 [http-nio-8080-exec-3] ERROR j.s.s.s.FacturaProveedorServicio - Ingrediente es requerido pero no fue proporcionado en un detalle
2026-01-26 13:16:35 [http-nio-8080-exec-3] ERROR j.s.s.context.TenantFilter - ‚ùå Error en TenantFilter: Request processing failed: java.lang.RuntimeException: Ingrediente es requerido en los detalles
jakarta.servlet.ServletException: Request processing failed: java.lang.RuntimeException: Ingrediente es requerido en los detalles
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1022)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at jpd.sistemafacinv.sistemadefacturacioneinventario.context.TenantFilter.doFilter(TenantFilter.java:123)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at jpd.sistemafacinv.sistemadefacturacioneinventario.context.TenantContextCleanupFilter.doFilter(TenantContextCleanupFilter.java:45)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:365)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:101)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:125)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:119)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:235)
	at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:229)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.csrf.CsrfFilter.doFilterInternal(CsrfFilter.java:134)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.ServletRequestPathFilter.doFilter(ServletRequestPathFilter.java:52)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebSecurityConfiguration.java:319)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$4(HandlerMappingIntrospector.java:267)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:240)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:362)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:278)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:88)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:113)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:83)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:72)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:399)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1774)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:973)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:491)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:840)
Caused by: java.lang.RuntimeException: Ingrediente es requerido en los detalles
	at jpd.sistemafacinv.sistemadefacturacioneinventario.servicios.FacturaProveedorServicio.crearFacturaProveedor(FacturaProveedorServicio.java:95)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728)
	at jpd.sistemafacinv.sistemadefacturacioneinventario.servicios.FacturaProveedorServicio$$SpringCGLIB$$0.crearFacturaProveedor(<generated>)
	at jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaProveedorControlador.guardarCompra(FacturaProveedorControlador.java:85)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	... 99 common frames omitted
2026-01-26 13:16:35 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 43, Tenant anterior: 3
2026-01-26 13:16:35 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /compras/guardar, Empresa ID anterior: 3
2026-01-26 13:16:35 [http-nio-8080-exec-3] ERROR o.a.c.c.C.[.[.[.[dispatcherServlet] - Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Error en TenantFilter] with root cause
java.lang.RuntimeException: Ingrediente es requerido en los detalles
	at jpd.sistemafacinv.sistemadefacturacioneinventario.servicios.FacturaProveedorServicio.crearFacturaProveedor(FacturaProveedorServicio.java:95)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728)
	at jpd.sistemafacinv.sistemadefacturacioneinventario.servicios.FacturaProveedorServicio$$SpringCGLIB$$0.crearFacturaProveedor(<generated>)
	at jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaProveedorControlador.guardarCompra(FacturaProveedorControlador.java:85)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at jpd.sistemafacinv.sistemadefacturacioneinventario.context.TenantFilter.doFilter(TenantFilter.java:123)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at jpd.sistemafacinv.sistemadefacturacioneinventario.context.TenantContextCleanupFilter.doFilter(TenantContextCleanupFilter.java:45)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:365)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:101)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:125)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:119)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:235)
	at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:229)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.csrf.CsrfFilter.doFilterInternal(CsrfFilter.java:134)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.ServletRequestPathFilter.doFilter(ServletRequestPathFilter.java:52)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebSecurityConfiguration.java:319)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$4(HandlerMappingIntrospector.java:267)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:240)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:362)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:278)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:88)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:113)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:83)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:72)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:399)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1774)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:973)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:491)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:840)
2026-01-26 13:16:35 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing POST /error
2026-01-26 13:16:35 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured POST /error
2026-01-26 13:16:35 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:16:41 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /compras/nueva
2026-01-26 13:16:41 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:16:41 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /compras/nueva
2026-01-26 13:16:41 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /compras/nueva, M√©todo: GET
2026-01-26 13:16:41 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:16:41 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:16:41 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:16:41 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:16:41 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 44
2026-01-26 13:16:41 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:16:41 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: adminKristoff
2026-01-26 13:16:41 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: adminKristoff en empresa ID: 3
2026-01-26 13:16:41 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:16:41 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [adminKristoff]
2026-01-26 13:16:41 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:16:41 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:16:41 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:16:41 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario adminKristoff validado para empresa 3
2026-01-26 13:16:41 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /compras/nueva, Empresa ID: 3
2026-01-26 13:16:41 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:16:41 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:16:41 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:16:41 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:16:41 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:16:41 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:16:41 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:16:41 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:16:41 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:16:41 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:16:41 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:16:41 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:16:41 [http-nio-8080-exec-4] INFO  j.s.s.c.FacturaProveedorControlador - üìù GET /compras/nueva - Mostrando formulario nueva compra
2026-01-26 13:16:41 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.ProveedorServicio - Listando proveedores para empresa ID: 3
2026-01-26 13:16:41 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.correo,
        p1_0.empresa_id,
        p1_0.identificacion,
        p1_0.nombre,
        p1_0.telefono 
    from
        proveedor p1_0 
    left join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        e1_0.id=?
2026-01-26 13:16:41 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:16:41 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:16:41 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:16:41 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.ProveedorServicio - Encontrados 1 proveedores para empresa ID: 3
2026-01-26 13:16:41 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.IngredienteServicio - Listando ingredientes para empresa ID: 3
2026-01-26 13:16:41 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        i1_0.id,
        i1_0.activo,
        i1_0.empresa_id,
        i1_0.nombre,
        i1_0.precio,
        i1_0.stock_actual,
        i1_0.stock_minimo,
        i1_0.unidad_medida 
    from
        ingrediente i1_0 
    left join
        empresa e1_0 
            on e1_0.id=i1_0.empresa_id 
    where
        e1_0.id=?
2026-01-26 13:16:41 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:16:41 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:16:41 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:16:41 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.IngredienteServicio - Encontrados 2 ingredientes para empresa ID: 3
2026-01-26 13:16:41 [http-nio-8080-exec-4] DEBUG j.s.s.c.FacturaProveedorControlador - Formulario cargado - Proveedores activos: 1, Ingredientes: 2
2026-01-26 13:16:41 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 44, Tenant anterior: 3
2026-01-26 13:16:41 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 44, Request: /compras/nueva, Empresa ID anterior: 3
2026-01-26 13:16:43 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-26 13:16:43 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:16:43 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-26 13:16:43 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-26 13:16:43 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:16:43 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:16:43 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:16:43 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:16:43 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 45
2026-01-26 13:16:43 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:16:43 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: adminKristoff
2026-01-26 13:16:43 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: adminKristoff en empresa ID: 3
2026-01-26 13:16:43 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:16:43 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [adminKristoff]
2026-01-26 13:16:43 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:16:43 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:16:43 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:16:43 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario adminKristoff validado para empresa 3
2026-01-26 13:16:43 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 3
2026-01-26 13:16:43 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:16:43 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:16:43 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:16:43 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:16:43 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:16:43 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:16:43 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:16:43 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:16:43 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:16:43 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:16:43 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:16:43 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:16:43 [http-nio-8080-exec-5] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-26
2026-01-26 13:16:43 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-26 13:16:43 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:16:43 [http-nio-8080-exec-5] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-26
2026-01-26 13:16:43 [http-nio-8080-exec-5] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-26 13:16:43 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 45, Tenant anterior: 3
2026-01-26 13:16:43 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 45, Request: /principal, Empresa ID anterior: 3
2026-01-26 13:16:44 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /compras
2026-01-26 13:16:44 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:16:44 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /compras
2026-01-26 13:16:44 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /compras, M√©todo: GET
2026-01-26 13:16:44 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:16:44 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:16:44 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:16:44 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:16:44 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 46
2026-01-26 13:16:44 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:16:44 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: adminKristoff
2026-01-26 13:16:44 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: adminKristoff en empresa ID: 3
2026-01-26 13:16:44 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:16:44 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [adminKristoff]
2026-01-26 13:16:44 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:16:44 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:16:44 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:16:44 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario adminKristoff validado para empresa 3
2026-01-26 13:16:44 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /compras, Empresa ID: 3
2026-01-26 13:16:44 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:16:44 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:16:44 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:16:44 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:16:44 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:16:44 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:16:44 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:16:44 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:16:44 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:16:44 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:16:44 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:16:44 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:16:44 [http-nio-8080-exec-6] INFO  j.s.s.c.FacturaProveedorControlador - üìã GET /compras - Listando compras a proveedores
2026-01-26 13:16:44 [http-nio-8080-exec-6] DEBUG j.s.s.s.FacturaProveedorServicio - Listando facturas de proveedor para empresa ID: 3
2026-01-26 13:16:44 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fp1_0.id,
        fp1_0.empresa_id,
        fp1_0.estado,
        fp1_0.fecha,
        fp1_0.iva,
        fp1_0.numero_factura,
        fp1_0.proveedor_id,
        fp1_0.subtotal,
        fp1_0.total 
    from
        factura_proveedor fp1_0 
    left join
        empresa e1_0 
            on e1_0.id=fp1_0.empresa_id 
    where
        e1_0.id=? 
    order by
        fp1_0.fecha desc
2026-01-26 13:16:44 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:16:44 [http-nio-8080-exec-6] DEBUG j.s.s.s.FacturaProveedorServicio - Encontradas 0 facturas de proveedor para empresa ID: 3
2026-01-26 13:16:44 [http-nio-8080-exec-6] DEBUG j.s.s.c.FacturaProveedorControlador - Encontradas 0 compras
2026-01-26 13:16:44 [http-nio-8080-exec-6] DEBUG j.s.s.c.FacturaProveedorControlador - Estad√≠sticas - Pagadas: 0, Anuladas: 0, Total valor: 0.0
2026-01-26 13:16:44 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 46, Tenant anterior: 3
2026-01-26 13:16:44 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 46, Request: /compras, Empresa ID anterior: 3
2026-01-26 13:16:50 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-26 13:16:50 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=adminKristoff, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9ACDFE969CD434B6DB7BD36AD15ECAB], Granted Authorities=[ROLE_ADMIN]]]
2026-01-26 13:16:50 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-26 13:16:50 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-26 13:16:50 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: kristoff.localhost
2026-01-26 13:16:50 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: kristoff
2026-01-26 13:16:50 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-26 13:16:50 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [kristoff]
2026-01-26 13:16:50 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(3) - Hilo: 47
2026-01-26 13:16:50 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 3 (Subdominio: kristoff)
2026-01-26 13:16:50 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: adminKristoff
2026-01-26 13:16:50 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: adminKristoff en empresa ID: 3
2026-01-26 13:16:50 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-26 13:16:50 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [adminKristoff]
2026-01-26 13:16:50 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [3]
2026-01-26 13:16:50 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-26 13:16:50 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [3]
2026-01-26 13:16:50 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario adminKristoff validado para empresa 3
2026-01-26 13:16:50 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 3
2026-01-26 13:16:50 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-26, Hora: 13:00
2026-01-26 13:16:50 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:16:50 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:16:50 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:16:50 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:16:50 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-25
2026-01-26 13:16:50 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-26 13:16:50 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-25]
2026-01-26 13:16:50 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-26 13:16:50 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [3]
2026-01-26 13:16:50 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-25 cerrado?: true (Empresa ID: 3)
2026-01-26 13:16:50 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-25 cerrado correctamente
2026-01-26 13:16:50 [http-nio-8080-exec-7] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-26
2026-01-26 13:16:50 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-26 13:16:50 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-26]
2026-01-26 13:16:50 [http-nio-8080-exec-7] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-26
2026-01-26 13:16:50 [http-nio-8080-exec-7] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-26 13:16:50 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 47, Tenant anterior: 3
2026-01-26 13:16:50 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 47, Request: /principal, Empresa ID anterior: 3
2026-01-26 13:28:31 [SpringApplicationShutdownHook] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2026-01-26 13:28:31 [tomcat-shutdown] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2026-01-26 13:28:31 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2026-01-26 13:28:31 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2026-01-26 13:28:31 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2026-01-22 18:22:14 [restartedMain] INFO  j.s.s.SistemadefacturacioneinventarioApplication - Starting SistemadefacturacioneinventarioApplication using Java 17.0.17 with PID 12347 (/home/josepino/Desktop/SistemaFacturaEInventario/sistemadefacturacioneinventario/target/classes started by josepino in /home/josepino/Desktop/SistemaFacturaEInventario/sistemadefacturacioneinventario)
2026-01-22 18:22:14 [restartedMain] DEBUG j.s.s.SistemadefacturacioneinventarioApplication - Running with Spring Boot v3.5.8, Spring v6.2.14
2026-01-22 18:22:14 [restartedMain] INFO  j.s.s.SistemadefacturacioneinventarioApplication - No active profile set, falling back to 1 default profile: "default"
2026-01-22 18:22:14 [restartedMain] INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2026-01-22 18:22:14 [restartedMain] INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2026-01-22 18:22:15 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-22 18:22:15 [restartedMain] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 63 ms. Found 14 JPA repository interfaces.
2026-01-22 18:22:16 [restartedMain] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2026-01-22 18:22:16 [restartedMain] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2026-01-22 18:22:16 [restartedMain] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.49]
2026-01-22 18:22:16 [restartedMain] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2026-01-22 18:22:16 [restartedMain] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1265 ms
2026-01-22 18:22:16 [restartedMain] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-22 18:22:16 [restartedMain] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.6.36.Final
2026-01-22 18:22:16 [restartedMain] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2026-01-22 18:22:16 [restartedMain] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-22 18:22:16 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2026-01-22 18:22:16 [restartedMain] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@60428719
2026-01-22 18:22:16 [restartedMain] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2026-01-22 18:22:17 [restartedMain] INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 8.0.44
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2026-01-22 18:22:17 [restartedMain] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-22 18:22:17 [restartedMain] DEBUG org.hibernate.SQL - 
    create table cierre_inventario_diario (
        id bigint not null auto_increment,
        cantidad_facturas integer not null,
        estado varchar(255),
        fecha date,
        observaciones varchar(255),
        total_ventas float(53) not null,
        empresa_id bigint not null,
        usuario_id bigint not null,
        primary key (id)
    ) engine=InnoDB
2026-01-22 18:22:17 [restartedMain] DEBUG org.hibernate.SQL - 
    create table cliente (
        id bigint not null auto_increment,
        activo bit not null,
        correo varchar(255),
        identificacion varchar(255),
        nombre varchar(255) not null,
        telefono varchar(255),
        empresa_id bigint not null,
        primary key (id)
    ) engine=InnoDB
2026-01-22 18:22:17 [restartedMain] DEBUG org.hibernate.SQL - 
    create table detalle_cierre_inventario_diario (
        id bigint not null auto_increment,
        costo_unitario float(53) not null,
        diferencia float(53) not null,
        stock_desperdicio float(53) not null,
        stock_merma float(53) not null,
        stock_real float(53) not null,
        stock_teorico float(53) not null,
        valor_diferencia float(53) not null,
        cierre_id bigint not null,
        ingrediente_id bigint,
        producto_id bigint,
        primary key (id)
    ) engine=InnoDB
2026-01-22 18:22:17 [restartedMain] DEBUG org.hibernate.SQL - 
    create table empresa (
        id bigint not null auto_increment,
        email_contacto varchar(255),
        estado bit not null,
        fecha_creacion date,
        nombre varchar(255),
        plan varchar(255),
        subdominio varchar(255),
        telefono varchar(255),
        primary key (id)
    ) engine=InnoDB
2026-01-22 18:22:17 [restartedMain] DEBUG org.hibernate.SQL - 
    create table factura (
        id integer not null auto_increment,
        estado varchar(255),
        fecha date,
        forma_pago varchar(255),
        iva float(53) not null,
        numero_factura varchar(255),
        subtotal float(53) not null,
        total float(53) not null,
        cliente_id bigint,
        empresa_id bigint not null,
        primary key (id)
    ) engine=InnoDB
2026-01-22 18:22:17 [restartedMain] DEBUG org.hibernate.SQL - 
    create table factura_detalle (
        id bigint not null auto_increment,
        cantidad integer not null,
        precio_unitario float(53) not null,
        subtotal float(53) not null,
        factura_id integer not null,
        producto_id bigint not null,
        primary key (id)
    ) engine=InnoDB
2026-01-22 18:22:17 [restartedMain] DEBUG org.hibernate.SQL - 
    create table factura_detalle_proveedor (
        id bigint not null auto_increment,
        cantidad float(53) not null,
        precio_unitario float(53) not null,
        subtotal float(53) not null,
        factura_proveedor_id bigint not null,
        ingrediente_id bigint not null,
        primary key (id)
    ) engine=InnoDB
2026-01-22 18:22:17 [restartedMain] DEBUG org.hibernate.SQL - 
    create table factura_proveedor (
        id bigint not null auto_increment,
        estado varchar(255),
        fecha date,
        iva float(53),
        numero_factura varchar(255),
        subtotal float(53),
        total float(53),
        empresa_id bigint not null,
        proveedor_id bigint not null,
        primary key (id)
    ) engine=InnoDB
2026-01-22 18:22:17 [restartedMain] DEBUG org.hibernate.SQL - 
    create table ingrediente (
        id bigint not null auto_increment,
        activo bit not null,
        nombre varchar(255),
        precio float(53) not null,
        stock_actual float(53) not null,
        stock_minimo float(53) not null,
        unidad_medida varchar(255),
        empresa_id bigint not null,
        primary key (id)
    ) engine=InnoDB
2026-01-22 18:22:17 [restartedMain] DEBUG org.hibernate.SQL - 
    create table producto (
        id bigint not null auto_increment,
        activo bit not null,
        nombre varchar(255),
        precio_compra float(53),
        precio_venta float(53),
        stock float(53),
        tiene_receta bit not null,
        unidad_medida_venta varchar(255),
        empresa_id bigint not null,
        receta_id bigint,
        primary key (id)
    ) engine=InnoDB
2026-01-22 18:22:17 [restartedMain] DEBUG org.hibernate.SQL - 
    create table proveedor (
        id bigint not null auto_increment,
        activo bit,
        correo varchar(255),
        identificacion varchar(255),
        nombre varchar(255),
        telefono varchar(255),
        empresa_id bigint not null,
        primary key (id)
    ) engine=InnoDB
2026-01-22 18:22:17 [restartedMain] DEBUG org.hibernate.SQL - 
    create table receta (
        id bigint not null auto_increment,
        costo_receta float(53) not null,
        descripcion varchar(255),
        nombre varchar(255),
        empresa_id bigint not null,
        primary key (id)
    ) engine=InnoDB
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    create table receta_detalle (
        id integer not null auto_increment,
        cantidad_ingrediente float(53) not null,
        ingrediente_id bigint not null,
        receta_id bigint not null,
        primary key (id)
    ) engine=InnoDB
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    create table sucursal (
        id bigint not null auto_increment,
        direccion varchar(255),
        email varchar(255),
        nombre varchar(255),
        telefono varchar(255),
        empresa_id bigint not null,
        primary key (id)
    ) engine=InnoDB
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    create table usuario (
        id bigint not null auto_increment,
        activo bit not null,
        contrasenna varchar(255) not null,
        nombre_usuario varchar(255),
        rol varchar(255) not null,
        empresa_id bigint,
        sucursal_id bigint,
        primary key (id)
    ) engine=InnoDB
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table cierre_inventario_diario 
       drop index UK3olt7fv3qt8efj1m5p7q3j1ms
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table cierre_inventario_diario 
       add constraint UK3olt7fv3qt8efj1m5p7q3j1ms unique (empresa_id, fecha)
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table cliente 
       drop index UKhadme0meght491lixmp6qg06b
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table cliente 
       add constraint UKhadme0meght491lixmp6qg06b unique (empresa_id, nombre)
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table detalle_cierre_inventario_diario 
       drop index UKk16g51km9nr5iqw2wxck8b358
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table detalle_cierre_inventario_diario 
       add constraint UKk16g51km9nr5iqw2wxck8b358 unique (cierre_id, producto_id)
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table detalle_cierre_inventario_diario 
       drop index UKca6rduw6wqlirrbdd5tvj3u2c
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table detalle_cierre_inventario_diario 
       add constraint UKca6rduw6wqlirrbdd5tvj3u2c unique (cierre_id, ingrediente_id)
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table empresa 
       drop index UK89dtla0x9lfndxn4iha8gm2al
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table empresa 
       add constraint UK89dtla0x9lfndxn4iha8gm2al unique (subdominio)
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table factura 
       drop index UKa9fu6ob19w8pdw35ilspmgje
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table factura 
       add constraint UKa9fu6ob19w8pdw35ilspmgje unique (empresa_id, numero_factura)
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table factura_detalle_proveedor 
       drop index UK646r3o8f5xbf9ikhql9qcr81i
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table factura_detalle_proveedor 
       add constraint UK646r3o8f5xbf9ikhql9qcr81i unique (factura_proveedor_id, ingrediente_id)
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table factura_proveedor 
       drop index UK23y7stifd8wv2cixfjhc0g9kq
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table factura_proveedor 
       add constraint UK23y7stifd8wv2cixfjhc0g9kq unique (empresa_id, numero_factura)
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table ingrediente 
       drop index UKjs70l2p4uno2dclt73ffva7c9
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table ingrediente 
       add constraint UKjs70l2p4uno2dclt73ffva7c9 unique (empresa_id, nombre)
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table producto 
       drop index UKbeimg5dnx60dx87os8deoet9l
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table producto 
       add constraint UKbeimg5dnx60dx87os8deoet9l unique (empresa_id, nombre)
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table proveedor 
       drop index UKe0crun39p1g01db6lw29cqgmg
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table proveedor 
       add constraint UKe0crun39p1g01db6lw29cqgmg unique (empresa_id, nombre)
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table proveedor 
       drop index UKq9ef37e05x58intf9g660ubhs
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table proveedor 
       add constraint UKq9ef37e05x58intf9g660ubhs unique (empresa_id, identificacion)
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table proveedor 
       drop index UK5iq7yn62p2yff2ibnyebm81yk
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table proveedor 
       add constraint UK5iq7yn62p2yff2ibnyebm81yk unique (empresa_id, correo)
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table receta 
       drop index UK143eh9phim5gxih4uhnxf5rjy
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table receta 
       add constraint UK143eh9phim5gxih4uhnxf5rjy unique (empresa_id, nombre)
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table receta_detalle 
       drop index UK5i7rpjy4jshlcxwopit7e7l6v
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table receta_detalle 
       add constraint UK5i7rpjy4jshlcxwopit7e7l6v unique (receta_id, ingrediente_id)
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table sucursal 
       drop index UKifuc748bnikr6k2anqbkfcjof
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table sucursal 
       add constraint UKifuc748bnikr6k2anqbkfcjof unique (empresa_id, nombre)
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table usuario 
       drop index UKl3t4o0bbvqig8iki4a9v5l2au
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table usuario 
       add constraint UKl3t4o0bbvqig8iki4a9v5l2au unique (empresa_id, nombre_usuario)
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table cierre_inventario_diario 
       add constraint FKrxj5xe6of8lbbaygm6wn1yglc 
       foreign key (empresa_id) 
       references empresa (id)
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table cierre_inventario_diario 
       add constraint FK7ydwat6wxaari9ti21t61pf2h 
       foreign key (usuario_id) 
       references usuario (id)
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table cliente 
       add constraint FKkbui05oidjdj4nb0283u4t319 
       foreign key (empresa_id) 
       references empresa (id)
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table detalle_cierre_inventario_diario 
       add constraint FKai0hytaggprm1fpr57qs1r16y 
       foreign key (cierre_id) 
       references cierre_inventario_diario (id)
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table detalle_cierre_inventario_diario 
       add constraint FKnhr66xfhrrt2lf9hcr6osvkwi 
       foreign key (ingrediente_id) 
       references ingrediente (id)
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table detalle_cierre_inventario_diario 
       add constraint FKo04686jk3h9e8lercg1o2p4qx 
       foreign key (producto_id) 
       references producto (id)
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table factura 
       add constraint FK2602efsrpmevi8yxg464stfn5 
       foreign key (cliente_id) 
       references cliente (id)
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table factura 
       add constraint FKtmilsq58fksgb0ubkele0rhec 
       foreign key (empresa_id) 
       references empresa (id)
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table factura_detalle 
       add constraint FK82g5tpb19dn0ed3dh8rjepfeo 
       foreign key (factura_id) 
       references factura (id)
2026-01-22 18:22:18 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table factura_detalle 
       add constraint FK49cxxxb69hbp79ot7q72d1amt 
       foreign key (producto_id) 
       references producto (id)
2026-01-22 18:22:19 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table factura_detalle_proveedor 
       add constraint FKoflc51frkgklo8alhid2j8al7 
       foreign key (factura_proveedor_id) 
       references factura_proveedor (id)
2026-01-22 18:22:19 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table factura_detalle_proveedor 
       add constraint FK3hoqatnjgbbmx6xrh35yqppuf 
       foreign key (ingrediente_id) 
       references ingrediente (id)
2026-01-22 18:22:19 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table factura_proveedor 
       add constraint FKhlrb8uke31inikggh6lkw2dkd 
       foreign key (empresa_id) 
       references empresa (id)
2026-01-22 18:22:19 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table factura_proveedor 
       add constraint FK7f8no9r5msrqi7tdpxtxv5rox 
       foreign key (proveedor_id) 
       references proveedor (id)
2026-01-22 18:22:19 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table ingrediente 
       add constraint FK12fcsy4t6kmmc1kqwdvf6qoyb 
       foreign key (empresa_id) 
       references empresa (id)
2026-01-22 18:22:19 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table producto 
       add constraint FKc2ad8rakag2tc01ww39eqrbv6 
       foreign key (empresa_id) 
       references empresa (id)
2026-01-22 18:22:19 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table producto 
       add constraint FKoug9w3p6qwyhi5ogt6806xkaj 
       foreign key (receta_id) 
       references receta (id)
2026-01-22 18:22:19 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table proveedor 
       add constraint FK8cnkydwgpaydac6bnsv9t3fre 
       foreign key (empresa_id) 
       references empresa (id)
2026-01-22 18:22:19 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table receta 
       add constraint FKdgije9w7wnv4qr14tddx3d1mb 
       foreign key (empresa_id) 
       references empresa (id)
2026-01-22 18:22:19 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table receta_detalle 
       add constraint FKqqxfeku8edppnlksgq3yyetfg 
       foreign key (ingrediente_id) 
       references ingrediente (id)
2026-01-22 18:22:19 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table receta_detalle 
       add constraint FK3ymmbjgelr0kjbhi7880bmmk3 
       foreign key (receta_id) 
       references receta (id)
2026-01-22 18:22:19 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table sucursal 
       add constraint FK3w56rbjykxbp2e79cdq0xsghd 
       foreign key (empresa_id) 
       references empresa (id)
2026-01-22 18:22:19 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table usuario 
       add constraint FK87ckfs30l64gnivnfk7ywp8l6 
       foreign key (empresa_id) 
       references empresa (id)
2026-01-22 18:22:19 [restartedMain] DEBUG org.hibernate.SQL - 
    alter table usuario 
       add constraint FKiaauynefn97k8nl88ss4snyl6 
       foreign key (sucursal_id) 
       references sucursal (id)
2026-01-22 18:22:19 [restartedMain] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-22 18:22:19 [restartedMain] DEBUG o.h.s.internal.StatisticsInitiator - Statistics initialized [enabled=false]
2026-01-22 18:22:20 [restartedMain] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2026-01-22 18:22:20 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - üîê Configurando BCryptPasswordEncoder para encriptaci√≥n de contrase√±as
2026-01-22 18:22:21 [restartedMain] INFO  j.s.s.config.WebConfig - ‚öôÔ∏è Configurando interceptores de Spring MVC
2026-01-22 18:22:21 [restartedMain] DEBUG j.s.s.config.WebConfig - Registrando CierreDiarioInterceptor
2026-01-22 18:22:21 [restartedMain] DEBUG j.s.s.config.WebConfig - CierreDiarioInterceptor configurado. Patrones incluidos: /**
2026-01-22 18:22:21 [restartedMain] DEBUG j.s.s.config.WebConfig - Patrones excluidos: /cierres/**, /login, /css/**, /js/**, /error
2026-01-22 18:22:21 [restartedMain] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name usuarioServicio
2026-01-22 18:22:21 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - üõ°Ô∏è Configurando SecurityFilterChain para SUPERADMIN (Orden 1)
2026-01-22 18:22:21 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - ‚úÖ SecurityFilterChain SUPERADMIN configurado
2026-01-22 18:22:21 [restartedMain] DEBUG o.s.s.web.DefaultSecurityFilterChain - Will secure Or [Mvc [pattern='/superadmin/**']] with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CsrfFilter, LogoutFilter, UsernamePasswordAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-22 18:22:21 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - üõ°Ô∏è Configurando SecurityFilterChain - Iniciando configuraci√≥n de seguridad
2026-01-22 18:22:21 [restartedMain] INFO  j.s.s.config.SpringSecurityConfig - ‚úÖ SecurityFilterChain configurado exitosamente
2026-01-22 18:22:21 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - Configuraci√≥n de seguridad aplicada:
2026-01-22 18:22:21 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - P√°ginas p√∫blicas: /, /login, /acceso-denegado, /css/**, /js/**, /error
2026-01-22 18:22:21 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - Solo ADMIN: /compras/**, /proveedores/**
2026-01-22 18:22:21 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - ADMIN o DEV: /productos/**, /ingredientes/**, /recetas/**, /reportes/**, /cierres/**
2026-01-22 18:22:21 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - Login: /login, Logout: /logout
2026-01-22 18:22:21 [restartedMain] DEBUG j.s.s.config.SpringSecurityConfig - - P√°gina acceso denegado: /acceso-denegado
2026-01-22 18:22:21 [restartedMain] DEBUG o.s.s.web.DefaultSecurityFilterChain - Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, CsrfFilter, LogoutFilter, UsernamePasswordAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, ExceptionTranslationFilter, AuthorizationFilter
2026-01-22 18:22:21 [restartedMain] INFO  o.s.b.d.a.OptionalLiveReloadServer - LiveReload server is running on port 35729
2026-01-22 18:22:21 [restartedMain] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2026-01-22 18:22:21 [restartedMain] INFO  j.s.s.SistemadefacturacioneinventarioApplication - Started SistemadefacturacioneinventarioApplication in 7.235 seconds (process running for 7.663)
2026-01-22 18:22:21 [restartedMain] INFO  j.s.s.config.UsuarioInicial - üîß Iniciando carga de usuarios iniciales
2026-01-22 18:22:21 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        count(*) 
    from
        empresa e1_0
2026-01-22 18:22:21 [restartedMain] WARN  j.s.s.config.UsuarioInicial - ‚ö†Ô∏è No hay empresas en la BD. Los usuarios se crear√°n sin empresa.
2026-01-22 18:22:21 [restartedMain] WARN  j.s.s.config.UsuarioInicial - ‚ö†Ô∏è Ejecuta primero el DataInitializer para crear empresa por defecto.
2026-01-22 18:22:21 [restartedMain] INFO  j.s.s.config.DataInitializer - üöÄ INICIANDO CARGA DE DATOS INICIALES DEL SISTEMA
2026-01-22 18:22:21 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        count(*) 
    from
        empresa e1_0
2026-01-22 18:22:21 [restartedMain] INFO  j.s.s.config.DataInitializer - üìÅ No se encontraron empresas. Creando empresa por defecto...
2026-01-22 18:22:21 [restartedMain] DEBUG org.hibernate.SQL - 
    insert 
    into
        empresa
        (email_contacto, estado, fecha_creacion, nombre, plan, subdominio, telefono) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-22 18:22:21 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [null]
2026-01-22 18:22:21 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BOOLEAN) <- [true]
2026-01-22 18:22:21 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:DATE) <- [null]
2026-01-22 18:22:21 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [Sistema por Defecto]
2026-01-22 18:22:21 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2026-01-22 18:22:21 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [defecto]
2026-01-22 18:22:21 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [null]
2026-01-22 18:22:21 [restartedMain] INFO  j.s.s.config.DataInitializer - üè¢ Empresa por defecto creada exitosamente:
2026-01-22 18:22:21 [restartedMain] INFO  j.s.s.config.DataInitializer -    üìõ Nombre: Sistema por Defecto
2026-01-22 18:22:21 [restartedMain] INFO  j.s.s.config.DataInitializer -    üåê Subdominio: defecto
2026-01-22 18:22:21 [restartedMain] INFO  j.s.s.config.DataInitializer -    üî¢ ID: 1
2026-01-22 18:22:21 [restartedMain] INFO  j.s.s.config.DataInitializer -    üîó Acceso: http://defecto.localhost:8080
2026-01-22 18:22:21 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        c1_0.id 
    from
        cliente c1_0 
    left join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    where
        c1_0.nombre=? 
        and e1_0.id=? 
    limit
        ?
2026-01-22 18:22:21 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [Consumidor Final]
2026-01-22 18:22:21 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-22 18:22:21 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:INTEGER) <- [1]
2026-01-22 18:22:21 [restartedMain] DEBUG org.hibernate.SQL - 
    insert 
    into
        cliente
        (activo, correo, empresa_id, identificacion, nombre, telefono) 
    values
        (?, ?, ?, ?, ?, ?)
2026-01-22 18:22:21 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-22 18:22:21 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [consumidor@final.com]
2026-01-22 18:22:21 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-22 18:22:21 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [CF9999999999999]
2026-01-22 18:22:21 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [Consumidor Final]
2026-01-22 18:22:21 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [N/A]
2026-01-22 18:22:21 [restartedMain] INFO  j.s.s.config.DataInitializer - üë§ Cliente por defecto creado:
2026-01-22 18:22:21 [restartedMain] INFO  j.s.s.config.DataInitializer -    üìõ Nombre: Consumidor Final
2026-01-22 18:22:21 [restartedMain] INFO  j.s.s.config.DataInitializer -    üî¢ ID: CF9999999999999
2026-01-22 18:22:21 [restartedMain] INFO  j.s.s.config.DataInitializer -    üè¢ Para empresa: Sistema por Defecto
2026-01-22 18:22:21 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        count(u1_0.id) 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-22 18:22:21 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-22 18:22:21 [restartedMain] INFO  j.s.s.config.DataInitializer - üë• No hay usuarios para empresa Sistema por Defecto. Creando usuarios por defecto...
2026-01-22 18:22:21 [restartedMain] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 28
2026-01-22 18:22:21 [restartedMain] DEBUG org.hibernate.SQL - 
    insert 
    into
        usuario
        (activo, contrasenna, empresa_id, nombre_usuario, rol, sucursal_id) 
    values
        (?, ?, ?, ?, ?, ?)
2026-01-22 18:22:21 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-22 18:22:21 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [$2a$10$h.J6gzhJuDIH4ly56UIgtOwDEeXcTxxUHFR3wx0hg8phlyH1czsaS]
2026-01-22 18:22:21 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-22 18:22:21 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [admin]
2026-01-22 18:22:21 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [ADMIN]
2026-01-22 18:22:21 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:BIGINT) <- [null]
2026-01-22 18:22:21 [restartedMain] INFO  j.s.s.config.DataInitializer -    üë§ ADMIN: admin/admin123
2026-01-22 18:22:22 [restartedMain] DEBUG org.hibernate.SQL - 
    insert 
    into
        usuario
        (activo, contrasenna, empresa_id, nombre_usuario, rol, sucursal_id) 
    values
        (?, ?, ?, ?, ?, ?)
2026-01-22 18:22:22 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-22 18:22:22 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [$2a$10$CqnN7p9xfgSMQTgLN5ZNse.r7C8AsHTJE2gbbscW9bYh4w5hqkoxi]
2026-01-22 18:22:22 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-22 18:22:22 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [cajero]
2026-01-22 18:22:22 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [CAJERO]
2026-01-22 18:22:22 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:BIGINT) <- [null]
2026-01-22 18:22:22 [restartedMain] INFO  j.s.s.config.DataInitializer -    üë§ CAJERO: cajero/cajero123
2026-01-22 18:22:22 [restartedMain] DEBUG org.hibernate.SQL - 
    insert 
    into
        usuario
        (activo, contrasenna, empresa_id, nombre_usuario, rol, sucursal_id) 
    values
        (?, ?, ?, ?, ?, ?)
2026-01-22 18:22:22 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-22 18:22:22 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [$2a$10$wlZIpTP8ksvNSs3JuH2Gg.pgh1WhsgkysB9S45lh3z/i4GGIdft22]
2026-01-22 18:22:22 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-22 18:22:22 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [dev]
2026-01-22 18:22:22 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [DEV]
2026-01-22 18:22:22 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:BIGINT) <- [null]
2026-01-22 18:22:22 [restartedMain] INFO  j.s.s.config.DataInitializer -    üë§ DEV: dev/dev123
2026-01-22 18:22:22 [restartedMain] INFO  j.s.s.config.DataInitializer - ‚úÖ Usuarios creados exitosamente para empresa Sistema por Defecto
2026-01-22 18:22:22 [restartedMain] WARN  j.s.s.config.DataInitializer - ‚ö†Ô∏è  ¬°IMPORTANTE! Cambia estas contrase√±as en producci√≥n.
2026-01-22 18:22:22 [restartedMain] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 28, Tenant anterior: 1
2026-01-22 18:22:22 [restartedMain] INFO  j.s.s.config.DataInitializer - üëë Verificando existencia de usuario SUPER_ADMIN
2026-01-22 18:22:22 [restartedMain] DEBUG org.hibernate.SQL - 
    select
        u1_0.id 
    from
        usuario u1_0 
    where
        u1_0.rol=? 
    limit
        ?
2026-01-22 18:22:22 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [SUPER_ADMIN]
2026-01-22 18:22:22 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [1]
2026-01-22 18:22:22 [restartedMain] INFO  j.s.s.config.DataInitializer - üëë No existe SUPER_ADMIN. Creando usuario maestro...
2026-01-22 18:22:22 [restartedMain] DEBUG org.hibernate.SQL - 
    insert 
    into
        usuario
        (activo, contrasenna, empresa_id, nombre_usuario, rol, sucursal_id) 
    values
        (?, ?, ?, ?, ?, ?)
2026-01-22 18:22:22 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-22 18:22:22 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [$2a$10$UdjCLU61eBiTpdlj7NBDceESNVwkXm/BrMqdy/ZhIqsZoVL3bY39C]
2026-01-22 18:22:22 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [null]
2026-01-22 18:22:22 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [josepino]
2026-01-22 18:22:22 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [SUPER_ADMIN]
2026-01-22 18:22:22 [restartedMain] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:BIGINT) <- [null]
2026-01-22 18:22:22 [restartedMain] WARN  j.s.s.config.DataInitializer - ‚ö†Ô∏è  USUARIO SUPER_ADMIN CREADO:
2026-01-22 18:22:22 [restartedMain] WARN  j.s.s.config.DataInitializer -    üé≠ Rol: SUPER_ADMIN
2026-01-22 18:22:22 [restartedMain] INFO  j.s.s.config.DataInitializer - ‚úÖ CARGA DE DATOS INICIALES COMPLETADA EXITOSAMENTE
2026-01-22 18:22:56 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2026-01-22 18:22:56 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2026-01-22 18:22:56 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2026-01-22 18:22:56 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/login
2026-01-22 18:22:57 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/login
2026-01-22 18:22:57 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/login
2026-01-22 18:22:57 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/login, Empresa ID: null
2026-01-22 18:22:57 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/login
2026-01-22 18:22:57 [http-nio-8080-exec-1] INFO  j.s.s.c.SuperAdminController - üîì Mostrando p√°gina de login para SUPER_ADMIN
2026-01-22 18:22:57 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-22 18:22:57 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 41, Request: /superadmin/login, Empresa ID anterior: null
2026-01-22 18:22:57 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-22 18:22:57 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-22 18:22:57 [http-nio-8080-exec-2] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to http://localhost:8080/login
2026-01-22 18:22:57 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login
2026-01-22 18:22:57 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login
2026-01-22 18:22:57 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-22 18:22:57 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: localhost
2026-01-22 18:22:57 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: localhost
2026-01-22 18:22:57 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:22:57 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-22 18:22:57 [http-nio-8080-exec-3] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@805505153 wrapping com.mysql.cj.jdbc.ConnectionImpl@60428719] read-only
2026-01-22 18:22:57 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:22:57 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-22 18:22:57 [http-nio-8080-exec-3] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@805505153 wrapping com.mysql.cj.jdbc.ConnectionImpl@60428719]
2026-01-22 18:22:57 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 43
2026-01-22 18:22:57 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚ö†Ô∏è Usando empresa por defecto (localhost): 1 - Sistema por Defecto
2026-01-22 18:22:57 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-22 18:22:57 [http-nio-8080-exec-3] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-22 18:22:57 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 43, Tenant anterior: 1
2026-01-22 18:22:57 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /login, Empresa ID anterior: 1
2026-01-22 18:23:01 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing POST /superadmin/login
2026-01-22 18:23:01 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: josepino para la empresa ID: null
2026-01-22 18:23:01 [http-nio-8080-exec-4] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: josepino | Subdominio: localhost
2026-01-22 18:23:01 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=?
2026-01-22 18:23:01 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [josepino]
2026-01-22 18:23:01 [http-nio-8080-exec-4] INFO  j.s.s.servicios.UsuarioServicio - ‚úÖ SUPER_ADMIN cargado: josepino - Rol: SUPER_ADMIN
2026-01-22 18:23:01 [http-nio-8080-exec-4] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Authenticated user
2026-01-22 18:23:01 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.s.ChangeSessionIdAuthenticationStrategy - Changed session id from 4D918A704B7683F723330423391ACC1D
2026-01-22 18:23:01 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.CsrfAuthenticationStrategy - Replaced CSRF Token
2026-01-22 18:23:01 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Stored SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=4D918A704B7683F723330423391ACC1D], Granted Authorities=[ROLE_SUPER_ADMIN]]] to HttpSession [org.apache.catalina.session.StandardSessionFacade@1cbc348d]
2026-01-22 18:23:01 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.UsernamePasswordAuthenticationFilter - Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=4D918A704B7683F723330423391ACC1D], Granted Authorities=[ROLE_SUPER_ADMIN]]
2026-01-22 18:23:01 [http-nio-8080-exec-4] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /superadmin/dashboard
2026-01-22 18:23:01 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/dashboard
2026-01-22 18:23:01 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=4D918A704B7683F723330423391ACC1D], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-22 18:23:01 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/dashboard
2026-01-22 18:23:01 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/dashboard
2026-01-22 18:23:01 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/dashboard, Empresa ID: null
2026-01-22 18:23:01 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/dashboard
2026-01-22 18:23:01 [http-nio-8080-exec-5] INFO  j.s.s.c.SuperAdminController - üìä Accediendo al dashboard SUPER_ADMIN
2026-01-22 18:23:01 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 45, Request: /superadmin/dashboard, Empresa ID anterior: null
2026-01-22 18:23:01 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/empresas
2026-01-22 18:23:01 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=4D918A704B7683F723330423391ACC1D], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-22 18:23:01 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/empresas
2026-01-22 18:23:01 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/empresas
2026-01-22 18:23:01 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/empresas, Empresa ID: null
2026-01-22 18:23:01 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/empresas
2026-01-22 18:23:01 [http-nio-8080-exec-6] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@1866159286 wrapping com.mysql.cj.jdbc.ConnectionImpl@60428719] read-only
2026-01-22 18:23:01 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0
2026-01-22 18:23:01 [http-nio-8080-exec-6] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@1866159286 wrapping com.mysql.cj.jdbc.ConnectionImpl@60428719]
2026-01-22 18:23:01 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 46, Request: /superadmin/empresas, Empresa ID anterior: null
2026-01-22 18:23:01 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-22 18:23:01 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=4D918A704B7683F723330423391ACC1D], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-22 18:23:01 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-22 18:23:01 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-22 18:23:01 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: localhost
2026-01-22 18:23:01 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: localhost
2026-01-22 18:23:01 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:23:01 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-22 18:23:01 [http-nio-8080-exec-7] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@229288244 wrapping com.mysql.cj.jdbc.ConnectionImpl@60428719] read-only
2026-01-22 18:23:01 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:23:01 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-22 18:23:01 [http-nio-8080-exec-7] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@229288244 wrapping com.mysql.cj.jdbc.ConnectionImpl@60428719]
2026-01-22 18:23:01 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 47
2026-01-22 18:23:01 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚ö†Ô∏è Usando empresa por defecto (localhost): 1 - Sistema por Defecto
2026-01-22 18:23:01 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: josepino
2026-01-22 18:23:01 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: josepino en empresa ID: 1
2026-01-22 18:23:01 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:23:01 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [josepino]
2026-01-22 18:23:01 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-22 18:23:01 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 1
2026-01-22 18:23:01 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:23:01 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:23:01 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:23:01 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:23:01 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-22 18:23:01 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:23:01 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:23:01 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:23:01 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:23:01 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-22 18:23:01 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: false (Empresa ID: 1)
2026-01-22 18:23:01 [http-nio-8080-exec-7] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-21 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-22 18:23:01 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 47, Tenant anterior: 1
2026-01-22 18:23:01 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 47, Request: /favicon.ico, Empresa ID anterior: 1
2026-01-22 18:23:01 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-21
2026-01-22 18:23:01 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=4D918A704B7683F723330423391ACC1D], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-22 18:23:01 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AccessDeniedHandlerImpl - Forwarding to /acceso-denegado with status code 403
2026-01-22 18:23:01 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /acceso-denegado?fecha=2026-01-21
2026-01-22 18:23:01 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /acceso-denegado?fecha=2026-01-21
2026-01-22 18:23:01 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /acceso-denegado, Empresa ID: null
2026-01-22 18:23:01 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì Interceptando acceso-denegado - EMPRESA: null
2026-01-22 18:23:01 [http-nio-8080-exec-8] WARN  j.s.s.controladores.InicioController - ‚õî GET /acceso-denigado - Mostrando p√°gina de acceso denegado
2026-01-22 18:23:06 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/empresas/nueva
2026-01-22 18:23:06 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=4D918A704B7683F723330423391ACC1D], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-22 18:23:06 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/empresas/nueva
2026-01-22 18:23:06 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/empresas/nueva
2026-01-22 18:23:06 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/empresas/nueva, Empresa ID: null
2026-01-22 18:23:06 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/empresas/nueva
2026-01-22 18:23:06 [http-nio-8080-exec-9] INFO  j.s.s.c.SuperAdminController - üìÑ [CONTROLLER] Mostrando formulario para crear nueva empresa
2026-01-22 18:23:06 [http-nio-8080-exec-9] DEBUG j.s.s.c.SuperAdminController - üîß Preparando modelo con nuevo EmpresaClienteDTO
2026-01-22 18:23:06 [http-nio-8080-exec-9] INFO  j.s.s.c.SuperAdminController - ‚úÖ Formulario listo para mostrar
2026-01-22 18:23:06 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 49, Request: /superadmin/empresas/nueva, Empresa ID anterior: null
2026-01-22 18:23:06 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-22 18:23:06 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=4D918A704B7683F723330423391ACC1D], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-22 18:23:06 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-22 18:23:06 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-22 18:23:06 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: localhost
2026-01-22 18:23:06 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: localhost
2026-01-22 18:23:06 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:23:06 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-22 18:23:06 [http-nio-8080-exec-10] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@899039385 wrapping com.mysql.cj.jdbc.ConnectionImpl@60428719] read-only
2026-01-22 18:23:06 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:23:06 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-22 18:23:06 [http-nio-8080-exec-10] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@899039385 wrapping com.mysql.cj.jdbc.ConnectionImpl@60428719]
2026-01-22 18:23:06 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 50
2026-01-22 18:23:06 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚ö†Ô∏è Usando empresa por defecto (localhost): 1 - Sistema por Defecto
2026-01-22 18:23:06 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: josepino
2026-01-22 18:23:06 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: josepino en empresa ID: 1
2026-01-22 18:23:06 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:23:06 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [josepino]
2026-01-22 18:23:06 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-22 18:23:06 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 1
2026-01-22 18:23:06 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:23:06 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:23:06 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:23:06 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:23:06 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-22 18:23:06 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:23:06 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:23:06 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:23:06 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:23:06 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-22 18:23:06 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: false (Empresa ID: 1)
2026-01-22 18:23:06 [http-nio-8080-exec-10] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-21 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-22 18:23:06 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 50, Tenant anterior: 1
2026-01-22 18:23:06 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 50, Request: /favicon.ico, Empresa ID anterior: 1
2026-01-22 18:23:06 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-21
2026-01-22 18:23:06 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=4D918A704B7683F723330423391ACC1D], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-22 18:23:06 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AccessDeniedHandlerImpl - Forwarding to /acceso-denegado with status code 403
2026-01-22 18:23:06 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /acceso-denegado?fecha=2026-01-21
2026-01-22 18:23:06 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /acceso-denegado?fecha=2026-01-21
2026-01-22 18:23:06 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /acceso-denegado, Empresa ID: null
2026-01-22 18:23:06 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì Interceptando acceso-denegado - EMPRESA: null
2026-01-22 18:23:06 [http-nio-8080-exec-1] WARN  j.s.s.controladores.InicioController - ‚õî GET /acceso-denigado - Mostrando p√°gina de acceso denegado
2026-01-22 18:23:16 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing POST /superadmin/empresas/crear
2026-01-22 18:23:16 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=4D918A704B7683F723330423391ACC1D], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-22 18:23:16 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured POST /superadmin/empresas/crear
2026-01-22 18:23:16 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/empresas/crear
2026-01-22 18:23:16 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/empresas/crear, Empresa ID: null
2026-01-22 18:23:16 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/empresas/crear
2026-01-22 18:23:16 [http-nio-8080-exec-2] INFO  j.s.s.c.SuperAdminController - üì® [CONTROLLER] Recibiendo solicitud para crear nueva empresa
2026-01-22 18:23:16 [http-nio-8080-exec-2] DEBUG j.s.s.c.SuperAdminController - üìã Datos recibidos: Nombre=Empresa JOse, Subdominio=jose, Email=josepino@gmail.com, Plan=BASICO
2026-01-22 18:23:16 [http-nio-8080-exec-2] DEBUG j.s.s.c.SuperAdminController - ‚öôÔ∏è Configuraci√≥n: crearUsuarios=true, crearDatosIniciales=true
2026-01-22 18:23:16 [http-nio-8080-exec-2] INFO  j.s.s.c.SuperAdminController - üîÑ Delegando creaci√≥n al SuperAdminService...
2026-01-22 18:23:16 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - üöÄ [SUPERADMIN] Iniciando creaci√≥n de nueva empresa cliente
2026-01-22 18:23:16 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - üìã Datos recibidos - Nombre: Empresa JOse, Subdominio: jose, Email: josepino@gmail.com
2026-01-22 18:23:16 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.SuperAdminService - üîç Validando subdominio: jose
2026-01-22 18:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id 
    from
        empresa e1_0 
    where
        e1_0.subdominio=? 
    limit
        ?
2026-01-22 18:23:16 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:23:16 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:INTEGER) <- [1]
2026-01-22 18:23:16 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - ‚úÖ Subdominio disponible
2026-01-22 18:23:16 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.SuperAdminService - üèóÔ∏è Creando empresa desde DTO
2026-01-22 18:23:16 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.SuperAdminService - üíæ Guardando empresa en BD
2026-01-22 18:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        empresa
        (email_contacto, estado, fecha_creacion, nombre, plan, subdominio, telefono) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-22 18:23:16 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [josepino@gmail.com]
2026-01-22 18:23:16 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BOOLEAN) <- [true]
2026-01-22 18:23:16 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:DATE) <- [2026-01-22]
2026-01-22 18:23:16 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [Empresa JOse]
2026-01-22 18:23:16 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [null]
2026-01-22 18:23:16 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [jose]
2026-01-22 18:23:16 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:VARCHAR) <- [3115470418]
2026-01-22 18:23:16 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - ‚úÖ Empresa creada: Empresa JOse (ID: 2)
2026-01-22 18:23:16 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - üë§ Creando usuario administrador...
2026-01-22 18:23:16 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.SuperAdminService - üíæ Guardando usuario admin en BD
2026-01-22 18:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        usuario
        (activo, contrasenna, empresa_id, nombre_usuario, rol, sucursal_id) 
    values
        (?, ?, ?, ?, ?, ?)
2026-01-22 18:23:16 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-22 18:23:16 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [$2a$10$mYv.mvcpJX/vsAJyFqH50OhwcYn8VnKDeIhrfXJAgsdEnM6cqH3RC]
2026-01-22 18:23:16 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:23:16 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [admin]
2026-01-22 18:23:16 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [ADMIN]
2026-01-22 18:23:16 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:BIGINT) <- [null]
2026-01-22 18:23:16 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - üë§ Usuario creado - Username: admin, Empresa: Empresa JOse
2026-01-22 18:23:16 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - ‚úÖ Usuario admin creado para empresa Empresa JOse
2026-01-22 18:23:16 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - üì¶ Creando datos iniciales...
2026-01-22 18:23:16 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.SuperAdminService - üíæ Guardando cliente en BD
2026-01-22 18:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        cliente
        (activo, correo, empresa_id, identificacion, nombre, telefono) 
    values
        (?, ?, ?, ?, ?, ?)
2026-01-22 18:23:16 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-22 18:23:16 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [null]
2026-01-22 18:23:16 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:23:16 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [CF9999999999999]
2026-01-22 18:23:16 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [Consumidor Final]
2026-01-22 18:23:16 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:VARCHAR) <- [null]
2026-01-22 18:23:16 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - üë§ Cliente 'Consumidor Final' creado para empresa Empresa JOse
2026-01-22 18:23:16 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - ‚úÖ Datos iniciales creados para empresa Empresa JOse
2026-01-22 18:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id 
    from
        cierre_inventario_diario cid1_0 
    left join
        empresa e1_0 
            on e1_0.id=cid1_0.empresa_id 
    where
        cid1_0.fecha=? 
        and e1_0.id=? 
    limit
        ?
2026-01-22 18:23:16 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:23:16 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:23:16 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:INTEGER) <- [1]
2026-01-22 18:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        u1_0.nombre_usuario=? 
        and e1_0.id=?
2026-01-22 18:23:16 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-22 18:23:16 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        cierre_inventario_diario
        (cantidad_facturas, empresa_id, estado, fecha, observaciones, total_ventas, usuario_id) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2026-01-22 18:23:16 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:INTEGER) <- [0]
2026-01-22 18:23:16 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:23:16 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:VARCHAR) <- [COMPLETADO]
2026-01-22 18:23:16 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:DATE) <- [2026-01-21]
2026-01-22 18:23:16 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [Cierre inicial generado autom√°ticamente]
2026-01-22 18:23:16 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:DOUBLE) <- [0.0]
2026-01-22 18:23:16 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (7:BIGINT) <- [5]
2026-01-22 18:23:16 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - üìÖ Cierre diario inicial creado para fecha 2026-01-21 - Empresa: Empresa JOse
2026-01-22 18:23:16 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.SuperAdminService - üìã Asignando plan: BASICO
2026-01-22 18:23:16 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.SuperAdminService - üí∞ Plan 'BASICO' procesado para empresa Empresa JOse
2026-01-22 18:23:16 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - üí∞ Plan 'BASICO' asignado a empresa Empresa JOse
2026-01-22 18:23:16 [http-nio-8080-exec-2] INFO  j.s.s.servicios.SuperAdminService - üéâ Creaci√≥n de empresa cliente completada exitosamente
2026-01-22 18:23:16 [http-nio-8080-exec-2] INFO  j.s.s.c.SuperAdminController - ‚úÖ Empresa creada exitosamente - ID: 2, Nombre: Empresa JOse
2026-01-22 18:23:16 [http-nio-8080-exec-2] INFO  j.s.s.c.SuperAdminController - üìä Datos empresa creada: Subdominio=jose, Email=josepino@gmail.com
2026-01-22 18:23:16 [http-nio-8080-exec-2] INFO  j.s.s.c.SuperAdminController - üéØ Redirigiendo a p√°gina de √©xito
2026-01-22 18:23:16 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 42, Request: /superadmin/empresas/crear, Empresa ID anterior: null
2026-01-22 18:23:16 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /superadmin/empresas
2026-01-22 18:23:16 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=4D918A704B7683F723330423391ACC1D], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-22 18:23:16 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /superadmin/empresas
2026-01-22 18:23:16 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå SKIPPING tenant lookup for SUPER_ADMIN path: /superadmin/empresas
2026-01-22 18:23:16 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /superadmin/empresas, Empresa ID: null
2026-01-22 18:23:16 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì EXCLUYENDO ruta SUPER_ADMIN del interceptor: /superadmin/empresas
2026-01-22 18:23:16 [http-nio-8080-exec-3] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@1859387529 wrapping com.mysql.cj.jdbc.ConnectionImpl@60428719] read-only
2026-01-22 18:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0
2026-01-22 18:23:16 [http-nio-8080-exec-3] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@1859387529 wrapping com.mysql.cj.jdbc.ConnectionImpl@60428719]
2026-01-22 18:23:16 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /superadmin/empresas, Empresa ID anterior: null
2026-01-22 18:23:16 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-22 18:23:16 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=4D918A704B7683F723330423391ACC1D], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-22 18:23:16 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-22 18:23:16 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-22 18:23:16 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: localhost
2026-01-22 18:23:16 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: localhost
2026-01-22 18:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:23:16 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [localhost]
2026-01-22 18:23:16 [http-nio-8080-exec-4] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@919804639 wrapping com.mysql.cj.jdbc.ConnectionImpl@60428719] read-only
2026-01-22 18:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:23:16 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [1]
2026-01-22 18:23:16 [http-nio-8080-exec-4] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@919804639 wrapping com.mysql.cj.jdbc.ConnectionImpl@60428719]
2026-01-22 18:23:16 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(1) - Hilo: 44
2026-01-22 18:23:16 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚ö†Ô∏è Usando empresa por defecto (localhost): 1 - Sistema por Defecto
2026-01-22 18:23:16 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: josepino
2026-01-22 18:23:16 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: josepino en empresa ID: 1
2026-01-22 18:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:23:16 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [josepino]
2026-01-22 18:23:16 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [1]
2026-01-22 18:23:16 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 1
2026-01-22 18:23:16 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:23:16 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:23:16 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:23:16 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-22 18:23:16 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:23:16 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:23:16 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:23:16 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [1]
2026-01-22 18:23:16 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: false (Empresa ID: 1)
2026-01-22 18:23:16 [http-nio-8080-exec-4] WARN  j.s.s.config.CierreDiarioInterceptor - üö´ BLOQUEANDO acceso - D√≠a 2026-01-21 no cerrado. Redirigiendo a /cierres/obligatorio
2026-01-22 18:23:16 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 44, Tenant anterior: 1
2026-01-22 18:23:16 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 44, Request: /favicon.ico, Empresa ID anterior: 1
2026-01-22 18:23:16 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres/obligatorio?fecha=2026-01-21
2026-01-22 18:23:16 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=josepino, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_SUPER_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=4D918A704B7683F723330423391ACC1D], Granted Authorities=[ROLE_SUPER_ADMIN]]]
2026-01-22 18:23:16 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AccessDeniedHandlerImpl - Forwarding to /acceso-denegado with status code 403
2026-01-22 18:23:16 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /acceso-denegado?fecha=2026-01-21
2026-01-22 18:23:16 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /acceso-denegado?fecha=2026-01-21
2026-01-22 18:23:16 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /acceso-denegado, Empresa ID: null
2026-01-22 18:23:16 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì Interceptando acceso-denegado - EMPRESA: null
2026-01-22 18:23:16 [http-nio-8080-exec-5] WARN  j.s.s.controladores.InicioController - ‚õî GET /acceso-denigado - Mostrando p√°gina de acceso denegado
2026-01-22 18:23:18 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /
2026-01-22 18:23:18 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /
2026-01-22 18:23:18 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /, M√©todo: GET
2026-01-22 18:23:18 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:23:18 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:23:18 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:23:18 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:23:18 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 46
2026-01-22 18:23:18 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:23:18 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-22 18:23:18 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /, Empresa ID: 2
2026-01-22 18:23:18 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:23:18 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:23:18 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:23:18 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:23:18 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:23:18 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:23:18 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:23:18 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:23:18 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:23:18 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:23:18 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: true (Empresa ID: 2)
2026-01-22 18:23:18 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-21 cerrado correctamente
2026-01-22 18:23:18 [http-nio-8080-exec-6] INFO  j.s.s.controladores.InicioController - üîÄ GET / - Redirigiendo a /login
2026-01-22 18:23:18 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 46, Tenant anterior: 2
2026-01-22 18:23:18 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 46, Request: /, Empresa ID anterior: 2
2026-01-22 18:23:18 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login
2026-01-22 18:23:18 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login
2026-01-22 18:23:18 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-22 18:23:18 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:23:18 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:23:18 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:23:18 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:23:18 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 47
2026-01-22 18:23:18 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:23:18 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-22 18:23:18 [http-nio-8080-exec-7] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-22 18:23:18 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 47, Tenant anterior: 2
2026-01-22 18:23:18 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 47, Request: /login, Empresa ID anterior: 2
2026-01-22 18:23:19 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-22 18:23:19 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-22 18:23:19 [http-nio-8080-exec-8] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to http://jose.localhost:8080/login
2026-01-22 18:23:19 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login
2026-01-22 18:23:19 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login
2026-01-22 18:23:19 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-22 18:23:19 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:23:19 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:23:19 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:23:19 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:23:19 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 49
2026-01-22 18:23:19 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:23:19 [http-nio-8080-exec-9] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-22 18:23:19 [http-nio-8080-exec-9] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-22 18:23:19 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 49, Tenant anterior: 2
2026-01-22 18:23:19 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 49, Request: /login, Empresa ID anterior: 2
2026-01-22 18:23:23 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-22 18:23:23 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: admin para la empresa ID: null
2026-01-22 18:23:23 [http-nio-8080-exec-10] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: jose
2026-01-22 18:23:23 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:23:23 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:23:23 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: jose | Empresa ID: 2 | Empresa Nombre: Empresa JOse
2026-01-22 18:23:23 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:23:23 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-22 18:23:23 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:23:23 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:23:23 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:23:23 [http-nio-8080-exec-10] INFO  j.s.s.servicios.UsuarioServicio - üîê Encontrado usuario: admin
2026-01-22 18:23:23 [http-nio-8080-exec-10] INFO  j.s.s.servicios.UsuarioServicio - üîê Rol: ADMIN
2026-01-22 18:23:23 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - üîê Activo: true
2026-01-22 18:23:23 [http-nio-8080-exec-10] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Authenticated user
2026-01-22 18:23:23 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.s.ChangeSessionIdAuthenticationStrategy - Changed session id from A9A9A2AA31258C223B49729C3738AED8
2026-01-22 18:23:23 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.CsrfAuthenticationStrategy - Replaced CSRF Token
2026-01-22 18:23:23 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Stored SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9A9A2AA31258C223B49729C3738AED8], Granted Authorities=[ROLE_ADMIN]]] to HttpSession [org.apache.catalina.session.StandardSessionFacade@5f35903a]
2026-01-22 18:23:23 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.UsernamePasswordAuthenticationFilter - Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9A9A2AA31258C223B49729C3738AED8], Granted Authorities=[ROLE_ADMIN]]
2026-01-22 18:23:23 [http-nio-8080-exec-10] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /principal
2026-01-22 18:23:23 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-22 18:23:23 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9A9A2AA31258C223B49729C3738AED8], Granted Authorities=[ROLE_ADMIN]]]
2026-01-22 18:23:23 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-22 18:23:23 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-22 18:23:23 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:23:23 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:23:23 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:23:23 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:23:23 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 41
2026-01-22 18:23:23 [http-nio-8080-exec-1] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:23:23 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-22 18:23:23 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-22 18:23:23 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:23:23 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-22 18:23:23 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:23:23 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:23:23 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:23:24 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-22 18:23:24 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-22 18:23:24 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:23:24 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:23:24 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:23:24 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:23:24 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:23:24 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:23:24 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:23:24 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:23:24 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:23:24 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:23:24 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: true (Empresa ID: 2)
2026-01-22 18:23:24 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-21 cerrado correctamente
2026-01-22 18:23:24 [http-nio-8080-exec-1] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-22
2026-01-22 18:23:24 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-22 18:23:24 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:23:24 [http-nio-8080-exec-1] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-22
2026-01-22 18:23:24 [http-nio-8080-exec-1] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-22 18:23:24 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 41, Tenant anterior: 2
2026-01-22 18:23:24 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 41, Request: /principal, Empresa ID anterior: 2
2026-01-22 18:23:24 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /favicon.ico
2026-01-22 18:23:24 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9A9A2AA31258C223B49729C3738AED8], Granted Authorities=[ROLE_ADMIN]]]
2026-01-22 18:23:24 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured GET /favicon.ico
2026-01-22 18:23:24 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /favicon.ico, M√©todo: GET
2026-01-22 18:23:24 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:23:24 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:23:24 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:23:24 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:23:24 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 42
2026-01-22 18:23:24 [http-nio-8080-exec-2] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:23:24 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-22 18:23:24 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-22 18:23:24 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:23:24 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-22 18:23:24 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:23:24 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:23:24 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:23:24 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-22 18:23:24 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /favicon.ico, Empresa ID: 2
2026-01-22 18:23:24 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:23:24 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:23:24 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:23:24 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:23:24 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:23:24 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:23:24 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:23:24 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:23:24 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:23:24 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:23:24 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: true (Empresa ID: 2)
2026-01-22 18:23:24 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-21 cerrado correctamente
2026-01-22 18:23:24 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 42, Tenant anterior: 2
2026-01-22 18:23:24 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 42, Request: /favicon.ico, Empresa ID anterior: 2
2026-01-22 18:23:24 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /error
2026-01-22 18:23:24 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured GET /error
2026-01-22 18:23:24 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9A9A2AA31258C223B49729C3738AED8], Granted Authorities=[ROLE_ADMIN]]]
2026-01-22 18:23:29 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios
2026-01-22 18:23:29 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9A9A2AA31258C223B49729C3738AED8], Granted Authorities=[ROLE_ADMIN]]]
2026-01-22 18:23:29 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios
2026-01-22 18:23:29 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios, M√©todo: GET
2026-01-22 18:23:29 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:23:29 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:23:29 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:23:29 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:23:29 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 43
2026-01-22 18:23:29 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:23:29 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-22 18:23:29 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-22 18:23:29 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:23:29 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-22 18:23:29 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:23:29 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:23:29 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:23:29 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-22 18:23:29 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios, Empresa ID: 2
2026-01-22 18:23:29 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:23:29 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:23:29 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:23:29 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:23:29 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:23:29 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:23:29 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:23:29 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:23:29 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:23:29 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:23:29 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: true (Empresa ID: 2)
2026-01-22 18:23:29 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-21 cerrado correctamente
2026-01-22 18:23:29 [http-nio-8080-exec-3] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-22 18:23:29 [http-nio-8080-exec-3] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-22 18:23:29 [http-nio-8080-exec-3] INFO  j.s.s.c.UsuarioControlador - üìã GET /admin/usuarios - Listando usuarios
2026-01-22 18:23:29 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Listando usuarios para empresa ID: 2
2026-01-22 18:23:29 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-22 18:23:29 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:23:29 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:23:29 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:23:29 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 43, Tenant anterior: 2
2026-01-22 18:23:29 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /admin/usuarios, Empresa ID anterior: 2
2026-01-22 18:23:30 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios/nuevo
2026-01-22 18:23:30 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9A9A2AA31258C223B49729C3738AED8], Granted Authorities=[ROLE_ADMIN]]]
2026-01-22 18:23:30 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios/nuevo
2026-01-22 18:23:30 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios/nuevo, M√©todo: GET
2026-01-22 18:23:30 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:23:30 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:23:30 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:23:30 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:23:30 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 44
2026-01-22 18:23:30 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:23:30 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-22 18:23:30 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-22 18:23:30 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:23:30 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-22 18:23:30 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:23:30 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:23:30 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:23:30 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-22 18:23:30 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios/nuevo, Empresa ID: 2
2026-01-22 18:23:30 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:23:30 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:23:30 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:23:30 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:23:30 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:23:30 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:23:30 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:23:30 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:23:30 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:23:30 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:23:30 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: true (Empresa ID: 2)
2026-01-22 18:23:30 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-21 cerrado correctamente
2026-01-22 18:23:30 [http-nio-8080-exec-4] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.mostrarFormularioCrear(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-22 18:23:30 [http-nio-8080-exec-4] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.mostrarFormularioCrear(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-22 18:23:30 [http-nio-8080-exec-4] INFO  j.s.s.c.UsuarioControlador - üìù GET /admin/usuarios/nuevo - Mostrando formulario crear usuario
2026-01-22 18:23:30 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 44, Tenant anterior: 2
2026-01-22 18:23:30 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 44, Request: /admin/usuarios/nuevo, Empresa ID anterior: 2
2026-01-22 18:23:44 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing POST /admin/usuarios/guardar
2026-01-22 18:23:44 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9A9A2AA31258C223B49729C3738AED8], Granted Authorities=[ROLE_ADMIN]]]
2026-01-22 18:23:44 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured POST /admin/usuarios/guardar
2026-01-22 18:23:44 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios/guardar, M√©todo: POST
2026-01-22 18:23:44 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:23:44 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:23:44 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:23:44 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:23:44 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 45
2026-01-22 18:23:44 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:23:44 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-22 18:23:44 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-22 18:23:44 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:23:44 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-22 18:23:44 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:23:44 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:23:44 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:23:44 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-22 18:23:44 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios/guardar, Empresa ID: 2
2026-01-22 18:23:44 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:23:44 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:23:44 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:23:44 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:23:44 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:23:44 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:23:44 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:23:44 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:23:44 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:23:44 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:23:44 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: true (Empresa ID: 2)
2026-01-22 18:23:44 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-21 cerrado correctamente
2026-01-22 18:23:44 [http-nio-8080-exec-5] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.guardarUsuario(jpd.sistemafacinv.sistemadefacturacioneinventario.modelos.Usuario,java.lang.String,org.springframework.web.servlet.mvc.support.RedirectAttributes); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-22 18:23:44 [http-nio-8080-exec-5] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.guardarUsuario(jpd.sistemafacinv.sistemadefacturacioneinventario.modelos.Usuario,java.lang.String,org.springframework.web.servlet.mvc.support.RedirectAttributes); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-22 18:23:44 [http-nio-8080-exec-5] INFO  j.s.s.c.UsuarioControlador - üíæ POST /admin/usuarios/guardar - Creando usuario: cajero1
2026-01-22 18:23:44 [http-nio-8080-exec-5] DEBUG j.s.s.c.UsuarioControlador - Datos usuario - Rol: CAJERO, Activo: false
2026-01-22 18:23:44 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Creando usuario: cajero1 para empresa ID: 2
2026-01-22 18:23:44 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        u1_0.nombre_usuario=? 
        and e1_0.id=? 
    limit
        ?
2026-01-22 18:23:44 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [cajero1]
2026-01-22 18:23:44 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:23:44 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:INTEGER) <- [1]
2026-01-22 18:23:44 [http-nio-8080-exec-5] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@222097258 wrapping com.mysql.cj.jdbc.ConnectionImpl@60428719] read-only
2026-01-22 18:23:44 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:23:44 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:23:44 [http-nio-8080-exec-5] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@222097258 wrapping com.mysql.cj.jdbc.ConnectionImpl@60428719]
2026-01-22 18:23:44 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        usuario
        (activo, contrasenna, empresa_id, nombre_usuario, rol, sucursal_id) 
    values
        (?, ?, ?, ?, ?, ?)
2026-01-22 18:23:44 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BOOLEAN) <- [true]
2026-01-22 18:23:44 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [$2a$10$tC3yEAnAJlKFCuZpfNZLoONXX8SUT2eEEIsHQBa5ZuFdawr3L76BK]
2026-01-22 18:23:44 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:23:44 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (4:VARCHAR) <- [cajero1]
2026-01-22 18:23:44 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (5:VARCHAR) <- [CAJERO]
2026-01-22 18:23:44 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (6:BIGINT) <- [null]
2026-01-22 18:23:44 [http-nio-8080-exec-5] INFO  j.s.s.servicios.UsuarioServicio - Usuario creado exitosamente: cajero1 con ID: 6
2026-01-22 18:23:44 [http-nio-8080-exec-5] INFO  j.s.s.c.UsuarioControlador - ‚úÖ Usuario creado exitosamente: cajero1 (ID: 6)
2026-01-22 18:23:44 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 45, Tenant anterior: 2
2026-01-22 18:23:44 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 45, Request: /admin/usuarios/guardar, Empresa ID anterior: 2
2026-01-22 18:23:44 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios
2026-01-22 18:23:44 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9A9A2AA31258C223B49729C3738AED8], Granted Authorities=[ROLE_ADMIN]]]
2026-01-22 18:23:44 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios
2026-01-22 18:23:44 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios, M√©todo: GET
2026-01-22 18:23:44 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:23:44 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:23:44 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:23:44 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:23:44 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 46
2026-01-22 18:23:44 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:23:44 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-22 18:23:44 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-22 18:23:44 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:23:44 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-22 18:23:44 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:23:44 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:23:44 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:23:44 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-22 18:23:44 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios, Empresa ID: 2
2026-01-22 18:23:44 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:23:44 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:23:44 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:23:44 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:23:44 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:23:44 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:23:44 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:23:44 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:23:44 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:23:44 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:23:44 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: true (Empresa ID: 2)
2026-01-22 18:23:44 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-21 cerrado correctamente
2026-01-22 18:23:44 [http-nio-8080-exec-6] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-22 18:23:44 [http-nio-8080-exec-6] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-22 18:23:44 [http-nio-8080-exec-6] INFO  j.s.s.c.UsuarioControlador - üìã GET /admin/usuarios - Listando usuarios
2026-01-22 18:23:44 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Listando usuarios para empresa ID: 2
2026-01-22 18:23:44 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-22 18:23:44 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:23:44 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:23:44 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:23:44 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 46, Tenant anterior: 2
2026-01-22 18:23:44 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 46, Request: /admin/usuarios, Empresa ID anterior: 2
2026-01-22 18:23:48 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios/editar/6
2026-01-22 18:23:48 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9A9A2AA31258C223B49729C3738AED8], Granted Authorities=[ROLE_ADMIN]]]
2026-01-22 18:23:48 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios/editar/6
2026-01-22 18:23:48 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios/editar/6, M√©todo: GET
2026-01-22 18:23:48 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:23:48 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:23:48 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:23:48 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:23:48 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 47
2026-01-22 18:23:48 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:23:48 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-22 18:23:48 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-22 18:23:48 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:23:48 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-22 18:23:48 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:23:48 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:23:48 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:23:48 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-22 18:23:48 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios/editar/6, Empresa ID: 2
2026-01-22 18:23:48 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:23:48 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:23:48 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:23:48 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:23:48 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:23:48 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:23:48 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:23:48 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:23:48 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:23:48 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:23:48 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: true (Empresa ID: 2)
2026-01-22 18:23:48 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-21 cerrado correctamente
2026-01-22 18:23:48 [http-nio-8080-exec-7] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.mostrarFormularioEditar(java.lang.Long,org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-22 18:23:48 [http-nio-8080-exec-7] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.mostrarFormularioEditar(java.lang.Long,org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-22 18:23:48 [http-nio-8080-exec-7] INFO  j.s.s.c.UsuarioControlador - ‚úèÔ∏è GET /admin/usuarios/editar/6 - Editando usuario
2026-01-22 18:23:48 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Obteniendo usuario ID: 6 para empresa ID: 2
2026-01-22 18:23:48 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        u1_0.id=? 
        and e1_0.id=?
2026-01-22 18:23:48 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [6]
2026-01-22 18:23:48 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:23:48 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:23:48 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:23:48 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 47, Tenant anterior: 2
2026-01-22 18:23:48 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 47, Request: /admin/usuarios/editar/6, Empresa ID anterior: 2
2026-01-22 18:23:50 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios
2026-01-22 18:23:50 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9A9A2AA31258C223B49729C3738AED8], Granted Authorities=[ROLE_ADMIN]]]
2026-01-22 18:23:50 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios
2026-01-22 18:23:50 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios, M√©todo: GET
2026-01-22 18:23:50 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:23:50 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:23:50 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:23:50 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:23:50 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 48
2026-01-22 18:23:50 [http-nio-8080-exec-8] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:23:50 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-22 18:23:50 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-22 18:23:50 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:23:50 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-22 18:23:50 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:23:50 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:23:50 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:23:50 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-22 18:23:50 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios, Empresa ID: 2
2026-01-22 18:23:50 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:23:50 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:23:50 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:23:50 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:23:50 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:23:50 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:23:50 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:23:50 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:23:50 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:23:50 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:23:50 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: true (Empresa ID: 2)
2026-01-22 18:23:50 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-21 cerrado correctamente
2026-01-22 18:23:50 [http-nio-8080-exec-8] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-22 18:23:50 [http-nio-8080-exec-8] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-22 18:23:50 [http-nio-8080-exec-8] INFO  j.s.s.c.UsuarioControlador - üìã GET /admin/usuarios - Listando usuarios
2026-01-22 18:23:50 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Listando usuarios para empresa ID: 2
2026-01-22 18:23:50 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-22 18:23:50 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:23:50 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:23:50 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:23:50 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 48, Tenant anterior: 2
2026-01-22 18:23:50 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 48, Request: /admin/usuarios, Empresa ID anterior: 2
2026-01-22 18:23:52 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-22 18:23:52 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9A9A2AA31258C223B49729C3738AED8], Granted Authorities=[ROLE_ADMIN]]]
2026-01-22 18:23:52 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-22 18:23:52 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-22 18:23:52 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:23:52 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:23:52 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:23:52 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:23:52 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 49
2026-01-22 18:23:52 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:23:52 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-22 18:23:52 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-22 18:23:52 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:23:52 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-22 18:23:52 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:23:52 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:23:52 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:23:52 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-22 18:23:52 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-22 18:23:52 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:23:52 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:23:52 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:23:52 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:23:52 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:23:52 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:23:52 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:23:52 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:23:52 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:23:52 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:23:52 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: true (Empresa ID: 2)
2026-01-22 18:23:52 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-21 cerrado correctamente
2026-01-22 18:23:52 [http-nio-8080-exec-9] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-22
2026-01-22 18:23:52 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-22 18:23:52 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:23:52 [http-nio-8080-exec-9] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-22
2026-01-22 18:23:52 [http-nio-8080-exec-9] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-22 18:23:52 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 49, Tenant anterior: 2
2026-01-22 18:23:52 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 49, Request: /principal, Empresa ID anterior: 2
2026-01-22 18:23:53 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing POST /logout
2026-01-22 18:23:53 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9A9A2AA31258C223B49729C3738AED8], Granted Authorities=[ROLE_ADMIN]]]
2026-01-22 18:23:53 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.logout.LogoutFilter - Logging out [UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=A9A9A2AA31258C223B49729C3738AED8], Granted Authorities=[ROLE_ADMIN]]]
2026-01-22 18:23:53 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.l.SecurityContextLogoutHandler - Invalidated session 03B8E8768384978028C1CD361245A895
2026-01-22 18:23:53 [http-nio-8080-exec-10] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /login?logout
2026-01-22 18:23:53 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login?logout
2026-01-22 18:23:53 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login?logout
2026-01-22 18:23:53 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-22 18:23:53 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:23:53 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:23:53 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:23:53 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:23:53 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 41
2026-01-22 18:23:53 [http-nio-8080-exec-1] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:23:53 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-22 18:23:53 [http-nio-8080-exec-1] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-22 18:23:53 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 41, Tenant anterior: 2
2026-01-22 18:23:53 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 41, Request: /login, Empresa ID anterior: 2
2026-01-22 18:23:57 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-22 18:23:57 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: cajer para la empresa ID: null
2026-01-22 18:23:57 [http-nio-8080-exec-2] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: cajer | Subdominio: jose
2026-01-22 18:23:57 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:23:57 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:23:57 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: cajer | Subdominio: jose | Empresa ID: 2 | Empresa Nombre: Empresa JOse
2026-01-22 18:23:57 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:23:57 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [cajer]
2026-01-22 18:23:57 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:23:57 [http-nio-8080-exec-2] WARN  j.s.s.servicios.UsuarioServicio - Credenciales no encontradas para usuario: cajer en empresa ID: 2
2026-01-22 18:23:57 [http-nio-8080-exec-2] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Failed to find user 'cajer'
2026-01-22 18:23:57 [http-nio-8080-exec-2] DEBUG o.s.s.authentication.ProviderManager - Authentication failed with provider DaoAuthenticationProvider since Bad credentials
2026-01-22 18:23:57 [http-nio-8080-exec-2] DEBUG o.s.s.authentication.ProviderManager - Denying authentication since all attempted providers failed
2026-01-22 18:23:57 [http-nio-8080-exec-2] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /login?error
2026-01-22 18:23:57 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login?error
2026-01-22 18:23:57 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login?error
2026-01-22 18:23:57 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-22 18:23:57 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:23:57 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:23:57 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:23:57 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:23:57 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 43
2026-01-22 18:23:57 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:23:57 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-22 18:23:57 [http-nio-8080-exec-3] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-22 18:23:57 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 43, Tenant anterior: 2
2026-01-22 18:23:57 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /login, Empresa ID anterior: 2
2026-01-22 18:24:02 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-22 18:24:02 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: cajero para la empresa ID: null
2026-01-22 18:24:02 [http-nio-8080-exec-4] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: cajero | Subdominio: jose
2026-01-22 18:24:02 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:24:02 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:24:02 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: cajero | Subdominio: jose | Empresa ID: 2 | Empresa Nombre: Empresa JOse
2026-01-22 18:24:02 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:24:02 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [cajero]
2026-01-22 18:24:02 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:24:02 [http-nio-8080-exec-4] WARN  j.s.s.servicios.UsuarioServicio - Credenciales no encontradas para usuario: cajero en empresa ID: 2
2026-01-22 18:24:02 [http-nio-8080-exec-4] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Failed to find user 'cajero'
2026-01-22 18:24:02 [http-nio-8080-exec-4] DEBUG o.s.s.authentication.ProviderManager - Authentication failed with provider DaoAuthenticationProvider since Bad credentials
2026-01-22 18:24:02 [http-nio-8080-exec-4] DEBUG o.s.s.authentication.ProviderManager - Denying authentication since all attempted providers failed
2026-01-22 18:24:02 [http-nio-8080-exec-4] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /login?error
2026-01-22 18:24:02 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login?error
2026-01-22 18:24:02 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login?error
2026-01-22 18:24:02 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-22 18:24:02 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:24:02 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:24:02 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:24:02 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:24:02 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 45
2026-01-22 18:24:02 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:24:02 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-22 18:24:02 [http-nio-8080-exec-5] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-22 18:24:02 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 45, Tenant anterior: 2
2026-01-22 18:24:02 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 45, Request: /login, Empresa ID anterior: 2
2026-01-22 18:24:06 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-22 18:24:06 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: admin para la empresa ID: null
2026-01-22 18:24:06 [http-nio-8080-exec-6] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: jose
2026-01-22 18:24:06 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:24:06 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:24:06 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: jose | Empresa ID: 2 | Empresa Nombre: Empresa JOse
2026-01-22 18:24:06 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:24:06 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-22 18:24:06 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:24:06 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:24:06 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:24:06 [http-nio-8080-exec-6] INFO  j.s.s.servicios.UsuarioServicio - üîê Encontrado usuario: admin
2026-01-22 18:24:06 [http-nio-8080-exec-6] INFO  j.s.s.servicios.UsuarioServicio - üîê Rol: ADMIN
2026-01-22 18:24:06 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - üîê Activo: true
2026-01-22 18:24:06 [http-nio-8080-exec-6] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Authenticated user
2026-01-22 18:24:06 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.s.ChangeSessionIdAuthenticationStrategy - Changed session id from 5338A7A41D057AB391A0F55D4A13E1E1
2026-01-22 18:24:06 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.CsrfAuthenticationStrategy - Replaced CSRF Token
2026-01-22 18:24:06 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Stored SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=5338A7A41D057AB391A0F55D4A13E1E1], Granted Authorities=[ROLE_ADMIN]]] to HttpSession [org.apache.catalina.session.StandardSessionFacade@3315a37f]
2026-01-22 18:24:06 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.UsernamePasswordAuthenticationFilter - Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=5338A7A41D057AB391A0F55D4A13E1E1], Granted Authorities=[ROLE_ADMIN]]
2026-01-22 18:24:06 [http-nio-8080-exec-6] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /principal
2026-01-22 18:24:06 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-22 18:24:06 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=5338A7A41D057AB391A0F55D4A13E1E1], Granted Authorities=[ROLE_ADMIN]]]
2026-01-22 18:24:06 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-22 18:24:06 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-22 18:24:06 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:24:06 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:24:06 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:24:06 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:24:06 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 47
2026-01-22 18:24:06 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:24:06 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-22 18:24:06 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-22 18:24:06 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:24:06 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-22 18:24:06 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:24:06 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:24:06 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:24:06 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-22 18:24:06 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-22 18:24:06 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:24:06 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:06 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:24:06 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:06 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:06 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:24:06 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:06 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:24:06 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:06 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:06 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: true (Empresa ID: 2)
2026-01-22 18:24:06 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-21 cerrado correctamente
2026-01-22 18:24:06 [http-nio-8080-exec-7] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-22
2026-01-22 18:24:06 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-22 18:24:06 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:24:06 [http-nio-8080-exec-7] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-22
2026-01-22 18:24:06 [http-nio-8080-exec-7] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-22 18:24:06 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 47, Tenant anterior: 2
2026-01-22 18:24:06 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 47, Request: /principal, Empresa ID anterior: 2
2026-01-22 18:24:08 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios
2026-01-22 18:24:08 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=5338A7A41D057AB391A0F55D4A13E1E1], Granted Authorities=[ROLE_ADMIN]]]
2026-01-22 18:24:08 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios
2026-01-22 18:24:08 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios, M√©todo: GET
2026-01-22 18:24:08 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:24:08 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:24:08 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:24:08 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:24:08 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 48
2026-01-22 18:24:08 [http-nio-8080-exec-8] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:24:08 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-22 18:24:08 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-22 18:24:08 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:24:08 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-22 18:24:08 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:24:08 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:24:08 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:24:08 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-22 18:24:08 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios, Empresa ID: 2
2026-01-22 18:24:08 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:24:08 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:08 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:24:08 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:08 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:08 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:24:08 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:08 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:24:08 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:08 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:08 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: true (Empresa ID: 2)
2026-01-22 18:24:08 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-21 cerrado correctamente
2026-01-22 18:24:08 [http-nio-8080-exec-8] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-22 18:24:08 [http-nio-8080-exec-8] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-22 18:24:08 [http-nio-8080-exec-8] INFO  j.s.s.c.UsuarioControlador - üìã GET /admin/usuarios - Listando usuarios
2026-01-22 18:24:08 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Listando usuarios para empresa ID: 2
2026-01-22 18:24:08 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-22 18:24:08 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:24:08 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:24:08 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:24:08 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 48, Tenant anterior: 2
2026-01-22 18:24:08 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 48, Request: /admin/usuarios, Empresa ID anterior: 2
2026-01-22 18:24:12 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-22 18:24:12 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=5338A7A41D057AB391A0F55D4A13E1E1], Granted Authorities=[ROLE_ADMIN]]]
2026-01-22 18:24:12 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-22 18:24:12 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-22 18:24:12 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:24:12 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:24:12 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:24:12 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:24:12 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 49
2026-01-22 18:24:12 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:24:12 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-22 18:24:12 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-22 18:24:12 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:24:12 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-22 18:24:12 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:24:12 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:24:12 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:24:12 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-22 18:24:12 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-22 18:24:12 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:24:12 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:12 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:24:12 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:12 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:12 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:24:12 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:12 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:24:12 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:12 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:12 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: true (Empresa ID: 2)
2026-01-22 18:24:12 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-21 cerrado correctamente
2026-01-22 18:24:12 [http-nio-8080-exec-9] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-22
2026-01-22 18:24:12 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-22 18:24:12 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:24:12 [http-nio-8080-exec-9] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-22
2026-01-22 18:24:12 [http-nio-8080-exec-9] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-22 18:24:12 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 49, Tenant anterior: 2
2026-01-22 18:24:12 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 49, Request: /principal, Empresa ID anterior: 2
2026-01-22 18:24:13 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing POST /logout
2026-01-22 18:24:13 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=5338A7A41D057AB391A0F55D4A13E1E1], Granted Authorities=[ROLE_ADMIN]]]
2026-01-22 18:24:13 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.logout.LogoutFilter - Logging out [UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=5338A7A41D057AB391A0F55D4A13E1E1], Granted Authorities=[ROLE_ADMIN]]]
2026-01-22 18:24:13 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.l.SecurityContextLogoutHandler - Invalidated session 2ECDA648A0D672FFEE9146D049C4EA8A
2026-01-22 18:24:13 [http-nio-8080-exec-10] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /login?logout
2026-01-22 18:24:13 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login?logout
2026-01-22 18:24:13 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login?logout
2026-01-22 18:24:13 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-22 18:24:13 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:24:13 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:24:13 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:24:13 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:24:13 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 41
2026-01-22 18:24:13 [http-nio-8080-exec-1] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:24:13 [http-nio-8080-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-22 18:24:13 [http-nio-8080-exec-1] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-22 18:24:13 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 41, Tenant anterior: 2
2026-01-22 18:24:13 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 41, Request: /login, Empresa ID anterior: 2
2026-01-22 18:24:18 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-22 18:24:18 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: cajero1 para la empresa ID: null
2026-01-22 18:24:18 [http-nio-8080-exec-3] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: cajero1 | Subdominio: jose
2026-01-22 18:24:18 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:24:18 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:24:18 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: cajero1 | Subdominio: jose | Empresa ID: 2 | Empresa Nombre: Empresa JOse
2026-01-22 18:24:18 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:24:18 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [cajero1]
2026-01-22 18:24:18 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:24:18 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:24:18 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:24:18 [http-nio-8080-exec-3] INFO  j.s.s.servicios.UsuarioServicio - üîê Encontrado usuario: cajero1
2026-01-22 18:24:18 [http-nio-8080-exec-3] INFO  j.s.s.servicios.UsuarioServicio - üîê Rol: CAJERO
2026-01-22 18:24:18 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - üîê Activo: true
2026-01-22 18:24:18 [http-nio-8080-exec-3] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Authenticated user
2026-01-22 18:24:18 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.s.ChangeSessionIdAuthenticationStrategy - Changed session id from D48F0B594868166C07DBD895151725CD
2026-01-22 18:24:18 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.CsrfAuthenticationStrategy - Replaced CSRF Token
2026-01-22 18:24:18 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Stored SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=cajero1, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D48F0B594868166C07DBD895151725CD], Granted Authorities=[ROLE_CAJERO]]] to HttpSession [org.apache.catalina.session.StandardSessionFacade@1a1ef747]
2026-01-22 18:24:18 [http-nio-8080-exec-3] DEBUG o.s.s.w.a.UsernamePasswordAuthenticationFilter - Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=cajero1, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D48F0B594868166C07DBD895151725CD], Granted Authorities=[ROLE_CAJERO]]
2026-01-22 18:24:18 [http-nio-8080-exec-3] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /principal
2026-01-22 18:24:18 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-22 18:24:18 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=cajero1, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D48F0B594868166C07DBD895151725CD], Granted Authorities=[ROLE_CAJERO]]]
2026-01-22 18:24:18 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-22 18:24:18 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-22 18:24:18 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:24:18 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:24:18 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:24:18 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:24:18 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 44
2026-01-22 18:24:18 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:24:18 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: cajero1
2026-01-22 18:24:18 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: cajero1 en empresa ID: 2
2026-01-22 18:24:18 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:24:18 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [cajero1]
2026-01-22 18:24:18 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:24:18 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:24:18 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:24:18 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario cajero1 validado para empresa 2
2026-01-22 18:24:18 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-22 18:24:18 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:24:18 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:18 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:24:18 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:18 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:18 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:24:18 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:18 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:24:18 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:18 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:18 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: true (Empresa ID: 2)
2026-01-22 18:24:18 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-21 cerrado correctamente
2026-01-22 18:24:18 [http-nio-8080-exec-4] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-22
2026-01-22 18:24:18 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-22 18:24:18 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:24:18 [http-nio-8080-exec-4] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-22
2026-01-22 18:24:18 [http-nio-8080-exec-4] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-22 18:24:18 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 44, Tenant anterior: 2
2026-01-22 18:24:18 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 44, Request: /principal, Empresa ID anterior: 2
2026-01-22 18:24:21 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-22 18:24:21 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=cajero1, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D48F0B594868166C07DBD895151725CD], Granted Authorities=[ROLE_CAJERO]]]
2026-01-22 18:24:21 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-22 18:24:21 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-22 18:24:21 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:24:21 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:24:21 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:24:21 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:24:21 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 45
2026-01-22 18:24:21 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:24:21 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: cajero1
2026-01-22 18:24:21 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: cajero1 en empresa ID: 2
2026-01-22 18:24:21 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:24:21 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [cajero1]
2026-01-22 18:24:21 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:24:21 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:24:21 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:24:21 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario cajero1 validado para empresa 2
2026-01-22 18:24:21 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-22 18:24:21 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:24:21 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:21 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:24:21 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:21 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:21 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:24:21 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:21 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:24:21 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:21 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:21 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: true (Empresa ID: 2)
2026-01-22 18:24:21 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-21 cerrado correctamente
2026-01-22 18:24:21 [http-nio-8080-exec-5] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-22
2026-01-22 18:24:21 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-22 18:24:21 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:24:21 [http-nio-8080-exec-5] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-22
2026-01-22 18:24:21 [http-nio-8080-exec-5] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-22 18:24:21 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 45, Tenant anterior: 2
2026-01-22 18:24:21 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 45, Request: /principal, Empresa ID anterior: 2
2026-01-22 18:24:22 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /productos
2026-01-22 18:24:22 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=cajero1, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D48F0B594868166C07DBD895151725CD], Granted Authorities=[ROLE_CAJERO]]]
2026-01-22 18:24:22 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.AccessDeniedHandlerImpl - Forwarding to /acceso-denegado with status code 403
2026-01-22 18:24:22 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /acceso-denegado
2026-01-22 18:24:22 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /acceso-denegado
2026-01-22 18:24:22 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /acceso-denegado, Empresa ID: null
2026-01-22 18:24:22 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì Interceptando acceso-denegado - EMPRESA: null
2026-01-22 18:24:22 [http-nio-8080-exec-6] WARN  j.s.s.controladores.InicioController - ‚õî GET /acceso-denigado - Mostrando p√°gina de acceso denegado
2026-01-22 18:24:23 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-22 18:24:23 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=cajero1, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D48F0B594868166C07DBD895151725CD], Granted Authorities=[ROLE_CAJERO]]]
2026-01-22 18:24:23 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-22 18:24:23 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-22 18:24:23 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:24:23 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:24:23 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:24:23 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:24:23 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 47
2026-01-22 18:24:23 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:24:23 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: cajero1
2026-01-22 18:24:23 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: cajero1 en empresa ID: 2
2026-01-22 18:24:23 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:24:23 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [cajero1]
2026-01-22 18:24:23 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:24:23 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:24:23 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:24:23 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario cajero1 validado para empresa 2
2026-01-22 18:24:23 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-22 18:24:23 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:24:23 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:23 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:24:23 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:23 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:23 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:24:23 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:23 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:24:23 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:23 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:23 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: true (Empresa ID: 2)
2026-01-22 18:24:23 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-21 cerrado correctamente
2026-01-22 18:24:23 [http-nio-8080-exec-7] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-22
2026-01-22 18:24:23 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-22 18:24:23 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:24:23 [http-nio-8080-exec-7] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-22
2026-01-22 18:24:23 [http-nio-8080-exec-7] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-22 18:24:23 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 47, Tenant anterior: 2
2026-01-22 18:24:23 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 47, Request: /principal, Empresa ID anterior: 2
2026-01-22 18:24:24 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /recetas
2026-01-22 18:24:24 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=cajero1, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D48F0B594868166C07DBD895151725CD], Granted Authorities=[ROLE_CAJERO]]]
2026-01-22 18:24:24 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AccessDeniedHandlerImpl - Forwarding to /acceso-denegado with status code 403
2026-01-22 18:24:24 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /acceso-denegado
2026-01-22 18:24:24 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /acceso-denegado
2026-01-22 18:24:24 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /acceso-denegado, Empresa ID: null
2026-01-22 18:24:24 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì Interceptando acceso-denegado - EMPRESA: null
2026-01-22 18:24:24 [http-nio-8080-exec-8] WARN  j.s.s.controladores.InicioController - ‚õî GET /acceso-denigado - Mostrando p√°gina de acceso denegado
2026-01-22 18:24:25 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-22 18:24:25 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=cajero1, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D48F0B594868166C07DBD895151725CD], Granted Authorities=[ROLE_CAJERO]]]
2026-01-22 18:24:25 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-22 18:24:25 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-22 18:24:25 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:24:25 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:24:25 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:24:25 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:24:25 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 49
2026-01-22 18:24:25 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:24:25 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: cajero1
2026-01-22 18:24:25 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: cajero1 en empresa ID: 2
2026-01-22 18:24:25 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:24:25 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [cajero1]
2026-01-22 18:24:25 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:24:25 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:24:25 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:24:25 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario cajero1 validado para empresa 2
2026-01-22 18:24:25 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-22 18:24:25 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:24:25 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:25 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:24:25 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:25 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:25 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:24:25 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:25 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:24:25 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:25 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:25 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: true (Empresa ID: 2)
2026-01-22 18:24:25 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-21 cerrado correctamente
2026-01-22 18:24:25 [http-nio-8080-exec-9] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-22
2026-01-22 18:24:25 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-22 18:24:25 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:24:25 [http-nio-8080-exec-9] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-22
2026-01-22 18:24:25 [http-nio-8080-exec-9] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-22 18:24:25 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 49, Tenant anterior: 2
2026-01-22 18:24:25 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 49, Request: /principal, Empresa ID anterior: 2
2026-01-22 18:24:25 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /cierres
2026-01-22 18:24:25 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=cajero1, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D48F0B594868166C07DBD895151725CD], Granted Authorities=[ROLE_CAJERO]]]
2026-01-22 18:24:25 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AccessDeniedHandlerImpl - Forwarding to /acceso-denegado with status code 403
2026-01-22 18:24:25 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /acceso-denegado
2026-01-22 18:24:25 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /acceso-denegado
2026-01-22 18:24:25 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /acceso-denegado, Empresa ID: null
2026-01-22 18:24:25 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì Interceptando acceso-denegado - EMPRESA: null
2026-01-22 18:24:25 [http-nio-8080-exec-10] WARN  j.s.s.controladores.InicioController - ‚õî GET /acceso-denigado - Mostrando p√°gina de acceso denegado
2026-01-22 18:24:26 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-22 18:24:26 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=cajero1, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D48F0B594868166C07DBD895151725CD], Granted Authorities=[ROLE_CAJERO]]]
2026-01-22 18:24:26 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-22 18:24:26 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-22 18:24:26 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:24:26 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:24:26 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:24:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:24:26 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 41
2026-01-22 18:24:26 [http-nio-8080-exec-1] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:24:26 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: cajero1
2026-01-22 18:24:26 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: cajero1 en empresa ID: 2
2026-01-22 18:24:26 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:24:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [cajero1]
2026-01-22 18:24:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:24:26 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:24:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:24:26 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario cajero1 validado para empresa 2
2026-01-22 18:24:26 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-22 18:24:26 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:24:26 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:24:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:26 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:24:26 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:24:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:26 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: true (Empresa ID: 2)
2026-01-22 18:24:26 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-21 cerrado correctamente
2026-01-22 18:24:26 [http-nio-8080-exec-1] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-22
2026-01-22 18:24:26 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-22 18:24:26 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:24:26 [http-nio-8080-exec-1] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-22
2026-01-22 18:24:26 [http-nio-8080-exec-1] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-22 18:24:26 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 41, Tenant anterior: 2
2026-01-22 18:24:26 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 41, Request: /principal, Empresa ID anterior: 2
2026-01-22 18:24:26 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /compras/nueva
2026-01-22 18:24:26 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=cajero1, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D48F0B594868166C07DBD895151725CD], Granted Authorities=[ROLE_CAJERO]]]
2026-01-22 18:24:26 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AccessDeniedHandlerImpl - Forwarding to /acceso-denegado with status code 403
2026-01-22 18:24:26 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /acceso-denegado
2026-01-22 18:24:26 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured GET /acceso-denegado
2026-01-22 18:24:26 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /acceso-denegado, Empresa ID: null
2026-01-22 18:24:26 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì Interceptando acceso-denegado - EMPRESA: null
2026-01-22 18:24:26 [http-nio-8080-exec-2] WARN  j.s.s.controladores.InicioController - ‚õî GET /acceso-denigado - Mostrando p√°gina de acceso denegado
2026-01-22 18:24:27 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-22 18:24:27 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=cajero1, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D48F0B594868166C07DBD895151725CD], Granted Authorities=[ROLE_CAJERO]]]
2026-01-22 18:24:27 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-22 18:24:27 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-22 18:24:27 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:24:27 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:24:27 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:24:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:24:27 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 43
2026-01-22 18:24:27 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:24:27 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: cajero1
2026-01-22 18:24:27 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: cajero1 en empresa ID: 2
2026-01-22 18:24:27 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:24:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [cajero1]
2026-01-22 18:24:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:24:27 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:24:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:24:27 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario cajero1 validado para empresa 2
2026-01-22 18:24:27 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-22 18:24:27 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:24:27 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:24:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:27 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:24:27 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:24:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:27 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: true (Empresa ID: 2)
2026-01-22 18:24:27 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-21 cerrado correctamente
2026-01-22 18:24:27 [http-nio-8080-exec-3] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-22
2026-01-22 18:24:27 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-22 18:24:27 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:24:27 [http-nio-8080-exec-3] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-22
2026-01-22 18:24:27 [http-nio-8080-exec-3] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-22 18:24:27 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 43, Tenant anterior: 2
2026-01-22 18:24:27 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /principal, Empresa ID anterior: 2
2026-01-22 18:24:28 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /compras
2026-01-22 18:24:28 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=cajero1, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D48F0B594868166C07DBD895151725CD], Granted Authorities=[ROLE_CAJERO]]]
2026-01-22 18:24:28 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AccessDeniedHandlerImpl - Forwarding to /acceso-denegado with status code 403
2026-01-22 18:24:28 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /acceso-denegado
2026-01-22 18:24:28 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /acceso-denegado
2026-01-22 18:24:28 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /acceso-denegado, Empresa ID: null
2026-01-22 18:24:28 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì Interceptando acceso-denegado - EMPRESA: null
2026-01-22 18:24:28 [http-nio-8080-exec-4] WARN  j.s.s.controladores.InicioController - ‚õî GET /acceso-denigado - Mostrando p√°gina de acceso denegado
2026-01-22 18:24:29 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-22 18:24:29 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=cajero1, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D48F0B594868166C07DBD895151725CD], Granted Authorities=[ROLE_CAJERO]]]
2026-01-22 18:24:29 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-22 18:24:29 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-22 18:24:29 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:24:29 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:24:29 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:24:29 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:24:29 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 45
2026-01-22 18:24:29 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:24:29 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: cajero1
2026-01-22 18:24:29 [http-nio-8080-exec-5] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: cajero1 en empresa ID: 2
2026-01-22 18:24:29 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:24:29 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [cajero1]
2026-01-22 18:24:29 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:24:29 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:24:29 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:24:29 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario cajero1 validado para empresa 2
2026-01-22 18:24:29 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-22 18:24:29 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:24:29 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:29 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:24:29 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:29 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:29 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:24:29 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:29 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:24:29 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:29 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:29 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: true (Empresa ID: 2)
2026-01-22 18:24:29 [http-nio-8080-exec-5] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-21 cerrado correctamente
2026-01-22 18:24:29 [http-nio-8080-exec-5] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-22
2026-01-22 18:24:29 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-22 18:24:29 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:24:29 [http-nio-8080-exec-5] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-22
2026-01-22 18:24:29 [http-nio-8080-exec-5] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-22 18:24:29 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 45, Tenant anterior: 2
2026-01-22 18:24:29 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 45, Request: /principal, Empresa ID anterior: 2
2026-01-22 18:24:30 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /reportes/consumo
2026-01-22 18:24:30 [http-nio-8080-exec-6] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=cajero1, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D48F0B594868166C07DBD895151725CD], Granted Authorities=[ROLE_CAJERO]]]
2026-01-22 18:24:30 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.AccessDeniedHandlerImpl - Forwarding to /acceso-denegado with status code 403
2026-01-22 18:24:30 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /acceso-denegado
2026-01-22 18:24:30 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /acceso-denegado
2026-01-22 18:24:30 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /acceso-denegado, Empresa ID: null
2026-01-22 18:24:30 [http-nio-8080-exec-6] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì Interceptando acceso-denegado - EMPRESA: null
2026-01-22 18:24:30 [http-nio-8080-exec-6] WARN  j.s.s.controladores.InicioController - ‚õî GET /acceso-denigado - Mostrando p√°gina de acceso denegado
2026-01-22 18:24:31 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-22 18:24:31 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=cajero1, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D48F0B594868166C07DBD895151725CD], Granted Authorities=[ROLE_CAJERO]]]
2026-01-22 18:24:31 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-22 18:24:31 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-22 18:24:31 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:24:31 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:24:31 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:24:31 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:24:31 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 47
2026-01-22 18:24:31 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:24:31 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: cajero1
2026-01-22 18:24:31 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: cajero1 en empresa ID: 2
2026-01-22 18:24:31 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:24:31 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [cajero1]
2026-01-22 18:24:31 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:24:31 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:24:31 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:24:31 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario cajero1 validado para empresa 2
2026-01-22 18:24:31 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-22 18:24:31 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:24:31 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:31 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:24:31 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:31 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:31 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:24:31 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:31 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:24:31 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:31 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:31 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: true (Empresa ID: 2)
2026-01-22 18:24:31 [http-nio-8080-exec-7] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-21 cerrado correctamente
2026-01-22 18:24:31 [http-nio-8080-exec-7] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-22
2026-01-22 18:24:31 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-22 18:24:31 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:24:31 [http-nio-8080-exec-7] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-22
2026-01-22 18:24:31 [http-nio-8080-exec-7] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-22 18:24:31 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 47, Tenant anterior: 2
2026-01-22 18:24:31 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 47, Request: /principal, Empresa ID anterior: 2
2026-01-22 18:24:32 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios
2026-01-22 18:24:32 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=cajero1, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D48F0B594868166C07DBD895151725CD], Granted Authorities=[ROLE_CAJERO]]]
2026-01-22 18:24:32 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios
2026-01-22 18:24:32 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios, M√©todo: GET
2026-01-22 18:24:32 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:24:32 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:24:32 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:24:32 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:24:32 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 48
2026-01-22 18:24:32 [http-nio-8080-exec-8] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:24:32 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: cajero1
2026-01-22 18:24:32 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: cajero1 en empresa ID: 2
2026-01-22 18:24:32 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:24:32 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [cajero1]
2026-01-22 18:24:32 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:24:32 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:24:32 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:24:32 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario cajero1 validado para empresa 2
2026-01-22 18:24:32 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios, Empresa ID: 2
2026-01-22 18:24:32 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:24:32 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:32 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:24:32 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:32 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:32 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:24:32 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:32 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:24:32 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:32 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:32 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: true (Empresa ID: 2)
2026-01-22 18:24:32 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-21 cerrado correctamente
2026-01-22 18:24:32 [http-nio-8080-exec-8] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-22 18:24:32 [http-nio-8080-exec-8] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Failed to authorize ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador] with authorization manager org.springframework.security.authorization.method.PreAuthorizeAuthorizationManager@5664a5c and result ExpressionAuthorizationDecision [granted=false, expressionAttribute=hasAnyRole('ADMIN', 'DEV')]
2026-01-22 18:24:32 [http-nio-8080-exec-8] ERROR j.s.s.context.TenantFilter - ‚ùå Error en TenantFilter: Request processing failed: org.springframework.security.authorization.AuthorizationDeniedException: Access Denied
jakarta.servlet.ServletException: Request processing failed: org.springframework.security.authorization.AuthorizationDeniedException: Access Denied
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1022)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at jpd.sistemafacinv.sistemadefacturacioneinventario.context.TenantFilter.doFilter(TenantFilter.java:123)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at jpd.sistemafacinv.sistemadefacturacioneinventario.context.TenantContextCleanupFilter.doFilter(TenantContextCleanupFilter.java:45)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:365)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:101)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:125)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:119)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:235)
	at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:229)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.csrf.CsrfFilter.doFilterInternal(CsrfFilter.java:117)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.ServletRequestPathFilter.doFilter(ServletRequestPathFilter.java:52)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebSecurityConfiguration.java:319)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$4(HandlerMappingIntrospector.java:267)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:240)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:362)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:278)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:88)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:113)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:83)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:72)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:399)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1774)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:973)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:491)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:840)
Caused by: org.springframework.security.authorization.AuthorizationDeniedException: Access Denied
	at org.springframework.security.authorization.method.ThrowingMethodAuthorizationDeniedHandler.handleDeniedInvocation(ThrowingMethodAuthorizationDeniedHandler.java:38)
	at org.springframework.security.authorization.method.PreAuthorizeAuthorizationManager.handleDeniedInvocation(PreAuthorizeAuthorizationManager.java:108)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.handle(AuthorizationManagerBeforeMethodInterceptor.java:287)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.attemptAuthorization(AuthorizationManagerBeforeMethodInterceptor.java:260)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.invoke(AuthorizationManagerBeforeMethodInterceptor.java:196)
	at org.springframework.security.config.annotation.method.configuration.DeferringMethodInterceptor.invoke(DeferringMethodInterceptor.java:44)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728)
	at jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador$$SpringCGLIB$$0.listarUsuarios(<generated>)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	... 99 common frames omitted
2026-01-22 18:24:32 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 48, Tenant anterior: 2
2026-01-22 18:24:32 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 48, Request: /admin/usuarios, Empresa ID anterior: 2
2026-01-22 18:24:32 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.AccessDeniedHandlerImpl - Forwarding to /acceso-denegado with status code 403
2026-01-22 18:24:32 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /acceso-denegado
2026-01-22 18:24:32 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /acceso-denegado
2026-01-22 18:24:32 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /acceso-denegado, Empresa ID: null
2026-01-22 18:24:32 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì Interceptando acceso-denegado - EMPRESA: null
2026-01-22 18:24:32 [http-nio-8080-exec-8] WARN  j.s.s.controladores.InicioController - ‚õî GET /acceso-denigado - Mostrando p√°gina de acceso denegado
2026-01-22 18:24:32 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-22 18:24:32 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=cajero1, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D48F0B594868166C07DBD895151725CD], Granted Authorities=[ROLE_CAJERO]]]
2026-01-22 18:24:32 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-22 18:24:32 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-22 18:24:32 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:24:32 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:24:32 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:24:32 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:24:32 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 49
2026-01-22 18:24:32 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:24:32 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: cajero1
2026-01-22 18:24:32 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: cajero1 en empresa ID: 2
2026-01-22 18:24:32 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:24:32 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [cajero1]
2026-01-22 18:24:32 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:24:32 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:24:32 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:24:32 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario cajero1 validado para empresa 2
2026-01-22 18:24:32 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-22 18:24:32 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:24:32 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:32 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:24:32 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:32 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:32 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:24:32 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:32 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:24:32 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:32 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:32 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: true (Empresa ID: 2)
2026-01-22 18:24:32 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-21 cerrado correctamente
2026-01-22 18:24:32 [http-nio-8080-exec-9] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-22
2026-01-22 18:24:32 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-22 18:24:32 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:24:32 [http-nio-8080-exec-9] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-22
2026-01-22 18:24:32 [http-nio-8080-exec-9] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-22 18:24:32 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 49, Tenant anterior: 2
2026-01-22 18:24:32 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 49, Request: /principal, Empresa ID anterior: 2
2026-01-22 18:24:34 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /productos
2026-01-22 18:24:34 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=cajero1, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D48F0B594868166C07DBD895151725CD], Granted Authorities=[ROLE_CAJERO]]]
2026-01-22 18:24:34 [http-nio-8080-exec-10] DEBUG o.s.s.w.a.AccessDeniedHandlerImpl - Forwarding to /acceso-denegado with status code 403
2026-01-22 18:24:34 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /acceso-denegado
2026-01-22 18:24:34 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /acceso-denegado
2026-01-22 18:24:34 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /acceso-denegado, Empresa ID: null
2026-01-22 18:24:34 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì Interceptando acceso-denegado - EMPRESA: null
2026-01-22 18:24:34 [http-nio-8080-exec-10] WARN  j.s.s.controladores.InicioController - ‚õî GET /acceso-denigado - Mostrando p√°gina de acceso denegado
2026-01-22 18:24:34 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-22 18:24:34 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=cajero1, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D48F0B594868166C07DBD895151725CD], Granted Authorities=[ROLE_CAJERO]]]
2026-01-22 18:24:34 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-22 18:24:34 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-22 18:24:34 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:24:34 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:24:34 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:24:34 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:24:34 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 41
2026-01-22 18:24:34 [http-nio-8080-exec-1] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:24:34 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: cajero1
2026-01-22 18:24:34 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: cajero1 en empresa ID: 2
2026-01-22 18:24:34 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:24:34 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [cajero1]
2026-01-22 18:24:34 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:24:34 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:24:34 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:24:34 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario cajero1 validado para empresa 2
2026-01-22 18:24:34 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-22 18:24:34 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:24:34 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:34 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:24:34 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:34 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:34 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:24:34 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:34 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:24:34 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:34 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:34 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: true (Empresa ID: 2)
2026-01-22 18:24:34 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-21 cerrado correctamente
2026-01-22 18:24:34 [http-nio-8080-exec-1] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-22
2026-01-22 18:24:34 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-22 18:24:34 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:24:34 [http-nio-8080-exec-1] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-22
2026-01-22 18:24:34 [http-nio-8080-exec-1] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-22 18:24:34 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 41, Tenant anterior: 2
2026-01-22 18:24:34 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 41, Request: /principal, Empresa ID anterior: 2
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /facturas/facturar
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=cajero1, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D48F0B594868166C07DBD895151725CD], Granted Authorities=[ROLE_CAJERO]]]
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured GET /facturas/facturar
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /facturas/facturar, M√©todo: GET
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:24:35 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 42
2026-01-22 18:24:35 [http-nio-8080-exec-2] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: cajero1
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: cajero1 en empresa ID: 2
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:24:35 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [cajero1]
2026-01-22 18:24:35 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:24:35 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario cajero1 validado para empresa 2
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /facturas/facturar, Empresa ID: 2
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:35 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:24:35 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:35 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:35 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:24:35 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:35 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: true (Empresa ID: 2)
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-21 cerrado correctamente
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador.mostrarPuntoVenta(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador]
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador.mostrarPuntoVenta(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.FacturaControlador]
2026-01-22 18:24:35 [http-nio-8080-exec-2] INFO  j.s.s.c.FacturaControlador - üí∞ GET /facturas/facturar - Mostrando punto de venta (CAJERO)
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-22 18:24:35 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.ClienteServicio - Listando clientes para empresa ID: 2
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        c1_0.id,
        c1_0.activo,
        c1_0.correo,
        c1_0.empresa_id,
        c1_0.identificacion,
        c1_0.nombre,
        c1_0.telefono 
    from
        cliente c1_0 
    left join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    where
        e1_0.id=?
2026-01-22 18:24:35 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:24:35 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.ClienteServicio - Encontrados 1 clientes para empresa ID: 2
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.ProductoServicio - Listando productos para empresa ID: 2
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        p1_0.receta_id,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta 
    from
        producto p1_0 
    left join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        e1_0.id=?
2026-01-22 18:24:35 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.ProductoServicio - Encontrados 0 productos para empresa ID: 2
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.ClienteServicio - Listando clientes para empresa ID: 2
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        c1_0.id,
        c1_0.activo,
        c1_0.correo,
        c1_0.empresa_id,
        c1_0.identificacion,
        c1_0.nombre,
        c1_0.telefono 
    from
        cliente c1_0 
    left join
        empresa e1_0 
            on e1_0.id=c1_0.empresa_id 
    where
        e1_0.id=?
2026-01-22 18:24:35 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:24:35 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.ClienteServicio - Encontrados 1 clientes para empresa ID: 2
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.ProductoServicio - Listando productos para empresa ID: 2
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        p1_0.id,
        p1_0.activo,
        p1_0.empresa_id,
        p1_0.nombre,
        p1_0.precio_compra,
        p1_0.precio_venta,
        p1_0.receta_id,
        p1_0.stock,
        p1_0.tiene_receta,
        p1_0.unidad_medida_venta 
    from
        producto p1_0 
    left join
        empresa e1_0 
            on e1_0.id=p1_0.empresa_id 
    where
        e1_0.id=?
2026-01-22 18:24:35 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.ProductoServicio - Encontrados 0 productos para empresa ID: 2
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG j.s.s.c.FacturaControlador - Punto de venta cargado - Clientes: 1, Productos: 0
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 42, Tenant anterior: 2
2026-01-22 18:24:35 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 42, Request: /facturas/facturar, Empresa ID anterior: 2
2026-01-22 18:24:41 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-22 18:24:41 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=cajero1, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D48F0B594868166C07DBD895151725CD], Granted Authorities=[ROLE_CAJERO]]]
2026-01-22 18:24:41 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-22 18:24:41 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-22 18:24:41 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:24:41 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:24:41 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:24:41 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:24:41 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 43
2026-01-22 18:24:41 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:24:41 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: cajero1
2026-01-22 18:24:41 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: cajero1 en empresa ID: 2
2026-01-22 18:24:41 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:24:41 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [cajero1]
2026-01-22 18:24:41 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:24:41 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:24:41 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:24:41 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario cajero1 validado para empresa 2
2026-01-22 18:24:41 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-22 18:24:41 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:24:41 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:41 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:24:41 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:41 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:41 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:24:41 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:41 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:24:41 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:41 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:41 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: true (Empresa ID: 2)
2026-01-22 18:24:41 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-21 cerrado correctamente
2026-01-22 18:24:41 [http-nio-8080-exec-3] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-22
2026-01-22 18:24:41 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-22 18:24:41 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:24:41 [http-nio-8080-exec-3] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-22
2026-01-22 18:24:41 [http-nio-8080-exec-3] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-22 18:24:41 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 43, Tenant anterior: 2
2026-01-22 18:24:41 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /principal, Empresa ID anterior: 2
2026-01-22 18:24:47 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios
2026-01-22 18:24:47 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=cajero1, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D48F0B594868166C07DBD895151725CD], Granted Authorities=[ROLE_CAJERO]]]
2026-01-22 18:24:47 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios
2026-01-22 18:24:47 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios, M√©todo: GET
2026-01-22 18:24:47 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:24:47 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:24:47 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:24:47 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:24:47 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 44
2026-01-22 18:24:47 [http-nio-8080-exec-4] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:24:47 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: cajero1
2026-01-22 18:24:47 [http-nio-8080-exec-4] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: cajero1 en empresa ID: 2
2026-01-22 18:24:47 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:24:47 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [cajero1]
2026-01-22 18:24:47 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:24:47 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:24:47 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:24:47 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario cajero1 validado para empresa 2
2026-01-22 18:24:47 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios, Empresa ID: 2
2026-01-22 18:24:47 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:24:47 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:47 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:24:47 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:47 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:47 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:24:47 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:47 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:24:47 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:47 [http-nio-8080-exec-4] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:47 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: true (Empresa ID: 2)
2026-01-22 18:24:47 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-21 cerrado correctamente
2026-01-22 18:24:47 [http-nio-8080-exec-4] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-22 18:24:47 [http-nio-8080-exec-4] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Failed to authorize ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador] with authorization manager org.springframework.security.authorization.method.PreAuthorizeAuthorizationManager@5664a5c and result ExpressionAuthorizationDecision [granted=false, expressionAttribute=hasAnyRole('ADMIN', 'DEV')]
2026-01-22 18:24:47 [http-nio-8080-exec-4] ERROR j.s.s.context.TenantFilter - ‚ùå Error en TenantFilter: Request processing failed: org.springframework.security.authorization.AuthorizationDeniedException: Access Denied
jakarta.servlet.ServletException: Request processing failed: org.springframework.security.authorization.AuthorizationDeniedException: Access Denied
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1022)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at jpd.sistemafacinv.sistemadefacturacioneinventario.context.TenantFilter.doFilter(TenantFilter.java:123)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at jpd.sistemafacinv.sistemadefacturacioneinventario.context.TenantContextCleanupFilter.doFilter(TenantContextCleanupFilter.java:45)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:365)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:101)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:125)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:119)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:235)
	at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:229)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.csrf.CsrfFilter.doFilterInternal(CsrfFilter.java:117)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.ServletRequestPathFilter.doFilter(ServletRequestPathFilter.java:52)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebSecurityConfiguration.java:319)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$4(HandlerMappingIntrospector.java:267)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:240)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:362)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:278)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:162)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:88)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:113)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:83)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:72)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:399)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1774)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:973)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:491)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:840)
Caused by: org.springframework.security.authorization.AuthorizationDeniedException: Access Denied
	at org.springframework.security.authorization.method.ThrowingMethodAuthorizationDeniedHandler.handleDeniedInvocation(ThrowingMethodAuthorizationDeniedHandler.java:38)
	at org.springframework.security.authorization.method.PreAuthorizeAuthorizationManager.handleDeniedInvocation(PreAuthorizeAuthorizationManager.java:108)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.handle(AuthorizationManagerBeforeMethodInterceptor.java:287)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.attemptAuthorization(AuthorizationManagerBeforeMethodInterceptor.java:260)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.invoke(AuthorizationManagerBeforeMethodInterceptor.java:196)
	at org.springframework.security.config.annotation.method.configuration.DeferringMethodInterceptor.invoke(DeferringMethodInterceptor.java:44)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728)
	at jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador$$SpringCGLIB$$0.listarUsuarios(<generated>)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	... 99 common frames omitted
2026-01-22 18:24:47 [http-nio-8080-exec-4] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 44, Tenant anterior: 2
2026-01-22 18:24:47 [http-nio-8080-exec-4] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 44, Request: /admin/usuarios, Empresa ID anterior: 2
2026-01-22 18:24:47 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.AccessDeniedHandlerImpl - Forwarding to /acceso-denegado with status code 403
2026-01-22 18:24:47 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /acceso-denegado
2026-01-22 18:24:47 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /acceso-denegado
2026-01-22 18:24:47 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /acceso-denegado, Empresa ID: null
2026-01-22 18:24:47 [http-nio-8080-exec-4] DEBUG j.s.s.config.CierreDiarioInterceptor - üîì Interceptando acceso-denegado - EMPRESA: null
2026-01-22 18:24:47 [http-nio-8080-exec-4] WARN  j.s.s.controladores.InicioController - ‚õî GET /acceso-denigado - Mostrando p√°gina de acceso denegado
2026-01-22 18:24:48 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /logout
2026-01-22 18:24:48 [http-nio-8080-exec-5] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=cajero1, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D48F0B594868166C07DBD895151725CD], Granted Authorities=[ROLE_CAJERO]]]
2026-01-22 18:24:48 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.logout.LogoutFilter - Logging out [UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=cajero1, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=D48F0B594868166C07DBD895151725CD], Granted Authorities=[ROLE_CAJERO]]]
2026-01-22 18:24:48 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.l.SecurityContextLogoutHandler - Invalidated session 8824EF4ACE6EAAC6547951FD414E0858
2026-01-22 18:24:48 [http-nio-8080-exec-5] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /login?logout
2026-01-22 18:24:48 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login?logout
2026-01-22 18:24:48 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login?logout
2026-01-22 18:24:48 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-22 18:24:48 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:24:48 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:24:48 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:24:48 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:24:48 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 46
2026-01-22 18:24:48 [http-nio-8080-exec-6] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:24:48 [http-nio-8080-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-22 18:24:48 [http-nio-8080-exec-6] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-22 18:24:48 [http-nio-8080-exec-6] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 46, Tenant anterior: 2
2026-01-22 18:24:48 [http-nio-8080-exec-6] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 46, Request: /login, Empresa ID anterior: 2
2026-01-22 18:24:52 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-22 18:24:52 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: admin para la empresa ID: null
2026-01-22 18:24:52 [http-nio-8080-exec-7] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: jose
2026-01-22 18:24:52 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:24:52 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:24:52 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: admin | Subdominio: jose | Empresa ID: 2 | Empresa Nombre: Empresa JOse
2026-01-22 18:24:52 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:24:52 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-22 18:24:52 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:24:52 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:24:52 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:24:52 [http-nio-8080-exec-7] INFO  j.s.s.servicios.UsuarioServicio - üîê Encontrado usuario: admin
2026-01-22 18:24:52 [http-nio-8080-exec-7] INFO  j.s.s.servicios.UsuarioServicio - üîê Rol: ADMIN
2026-01-22 18:24:52 [http-nio-8080-exec-7] DEBUG j.s.s.servicios.UsuarioServicio - üîê Activo: true
2026-01-22 18:24:53 [http-nio-8080-exec-7] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Authenticated user
2026-01-22 18:24:53 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.s.ChangeSessionIdAuthenticationStrategy - Changed session id from F21F931A8791A95E43E5897900E6E815
2026-01-22 18:24:53 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.CsrfAuthenticationStrategy - Replaced CSRF Token
2026-01-22 18:24:53 [http-nio-8080-exec-7] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Stored SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=F21F931A8791A95E43E5897900E6E815], Granted Authorities=[ROLE_ADMIN]]] to HttpSession [org.apache.catalina.session.StandardSessionFacade@1c8af50d]
2026-01-22 18:24:53 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.UsernamePasswordAuthenticationFilter - Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=F21F931A8791A95E43E5897900E6E815], Granted Authorities=[ROLE_ADMIN]]
2026-01-22 18:24:53 [http-nio-8080-exec-7] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /principal
2026-01-22 18:24:53 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-22 18:24:53 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=F21F931A8791A95E43E5897900E6E815], Granted Authorities=[ROLE_ADMIN]]]
2026-01-22 18:24:53 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-22 18:24:53 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-22 18:24:53 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:24:53 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:24:53 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:24:53 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:24:53 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 48
2026-01-22 18:24:53 [http-nio-8080-exec-8] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:24:53 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-22 18:24:53 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-22 18:24:53 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:24:53 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-22 18:24:53 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:24:53 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:24:53 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:24:53 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-22 18:24:53 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-22 18:24:53 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:24:53 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:53 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:24:53 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:53 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:53 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:24:53 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:53 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:24:53 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:53 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:53 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: true (Empresa ID: 2)
2026-01-22 18:24:53 [http-nio-8080-exec-8] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-21 cerrado correctamente
2026-01-22 18:24:53 [http-nio-8080-exec-8] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-22
2026-01-22 18:24:53 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-22 18:24:53 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:24:53 [http-nio-8080-exec-8] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-22
2026-01-22 18:24:53 [http-nio-8080-exec-8] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-22 18:24:53 [http-nio-8080-exec-8] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 48, Tenant anterior: 2
2026-01-22 18:24:53 [http-nio-8080-exec-8] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 48, Request: /principal, Empresa ID anterior: 2
2026-01-22 18:24:55 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios
2026-01-22 18:24:55 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=F21F931A8791A95E43E5897900E6E815], Granted Authorities=[ROLE_ADMIN]]]
2026-01-22 18:24:55 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios
2026-01-22 18:24:55 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios, M√©todo: GET
2026-01-22 18:24:55 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:24:55 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:24:55 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:24:55 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:24:55 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 49
2026-01-22 18:24:55 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:24:55 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-22 18:24:55 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-22 18:24:55 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:24:55 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-22 18:24:55 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:24:55 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:24:55 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:24:55 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-22 18:24:55 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios, Empresa ID: 2
2026-01-22 18:24:55 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:24:55 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:55 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:24:55 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:55 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:55 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:24:55 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:55 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:24:55 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:55 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:55 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: true (Empresa ID: 2)
2026-01-22 18:24:55 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-21 cerrado correctamente
2026-01-22 18:24:55 [http-nio-8080-exec-9] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-22 18:24:55 [http-nio-8080-exec-9] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-22 18:24:55 [http-nio-8080-exec-9] INFO  j.s.s.c.UsuarioControlador - üìã GET /admin/usuarios - Listando usuarios
2026-01-22 18:24:55 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Listando usuarios para empresa ID: 2
2026-01-22 18:24:55 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-22 18:24:55 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:24:55 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:24:55 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:24:55 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 49, Tenant anterior: 2
2026-01-22 18:24:55 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 49, Request: /admin/usuarios, Empresa ID anterior: 2
2026-01-22 18:24:57 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios/editar/6
2026-01-22 18:24:57 [http-nio-8080-exec-10] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=F21F931A8791A95E43E5897900E6E815], Granted Authorities=[ROLE_ADMIN]]]
2026-01-22 18:24:57 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios/editar/6
2026-01-22 18:24:57 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios/editar/6, M√©todo: GET
2026-01-22 18:24:57 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:24:57 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:24:57 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:24:57 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:24:57 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 50
2026-01-22 18:24:57 [http-nio-8080-exec-10] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:24:57 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-22 18:24:57 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-22 18:24:57 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:24:57 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-22 18:24:57 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:24:57 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:24:57 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:24:57 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-22 18:24:57 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios/editar/6, Empresa ID: 2
2026-01-22 18:24:57 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:24:57 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:57 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:24:57 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:57 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:57 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:24:57 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:24:57 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:24:57 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:24:57 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:24:57 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: true (Empresa ID: 2)
2026-01-22 18:24:57 [http-nio-8080-exec-10] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-21 cerrado correctamente
2026-01-22 18:24:57 [http-nio-8080-exec-10] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.mostrarFormularioEditar(java.lang.Long,org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-22 18:24:57 [http-nio-8080-exec-10] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.mostrarFormularioEditar(java.lang.Long,org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-22 18:24:57 [http-nio-8080-exec-10] INFO  j.s.s.c.UsuarioControlador - ‚úèÔ∏è GET /admin/usuarios/editar/6 - Editando usuario
2026-01-22 18:24:57 [http-nio-8080-exec-10] DEBUG j.s.s.servicios.UsuarioServicio - Obteniendo usuario ID: 6 para empresa ID: 2
2026-01-22 18:24:57 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        u1_0.id=? 
        and e1_0.id=?
2026-01-22 18:24:57 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [6]
2026-01-22 18:24:57 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:24:57 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:24:57 [http-nio-8080-exec-10] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:24:57 [http-nio-8080-exec-10] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 50, Tenant anterior: 2
2026-01-22 18:24:57 [http-nio-8080-exec-10] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 50, Request: /admin/usuarios/editar/6, Empresa ID anterior: 2
2026-01-22 18:25:01 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing POST /admin/usuarios/actualizar/6
2026-01-22 18:25:01 [http-nio-8080-exec-1] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=F21F931A8791A95E43E5897900E6E815], Granted Authorities=[ROLE_ADMIN]]]
2026-01-22 18:25:01 [http-nio-8080-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured POST /admin/usuarios/actualizar/6
2026-01-22 18:25:01 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios/actualizar/6, M√©todo: POST
2026-01-22 18:25:01 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:25:01 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:25:01 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:25:01 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:25:01 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 41
2026-01-22 18:25:01 [http-nio-8080-exec-1] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:25:01 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-22 18:25:01 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-22 18:25:01 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:25:01 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-22 18:25:01 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:25:01 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:25:01 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:25:01 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-22 18:25:01 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios/actualizar/6, Empresa ID: 2
2026-01-22 18:25:01 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:25:01 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:25:01 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:25:01 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:25:01 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:25:01 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:25:01 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:25:01 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:25:01 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:25:01 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:25:01 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: true (Empresa ID: 2)
2026-01-22 18:25:01 [http-nio-8080-exec-1] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-21 cerrado correctamente
2026-01-22 18:25:01 [http-nio-8080-exec-1] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.actualizarUsuario(java.lang.Long,jpd.sistemafacinv.sistemadefacturacioneinventario.modelos.Usuario,java.lang.String,java.lang.String,org.springframework.web.servlet.mvc.support.RedirectAttributes); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-22 18:25:01 [http-nio-8080-exec-1] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.actualizarUsuario(java.lang.Long,jpd.sistemafacinv.sistemadefacturacioneinventario.modelos.Usuario,java.lang.String,java.lang.String,org.springframework.web.servlet.mvc.support.RedirectAttributes); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-22 18:25:01 [http-nio-8080-exec-1] INFO  j.s.s.c.UsuarioControlador - üîÑ POST /admin/usuarios/actualizar/6 - Actualizando usuario
2026-01-22 18:25:01 [http-nio-8080-exec-1] DEBUG j.s.s.c.UsuarioControlador - Usuario autenticado: admin, Roles: [ROLE_ADMIN]
2026-01-22 18:25:01 [http-nio-8080-exec-1] DEBUG j.s.s.c.UsuarioControlador - Contrase√±a no cambiada para usuario ID: 6
2026-01-22 18:25:01 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Obteniendo usuario ID: 6 para empresa ID: 2
2026-01-22 18:25:01 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        u1_0.id=? 
        and e1_0.id=?
2026-01-22 18:25:01 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [6]
2026-01-22 18:25:01 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:25:01 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:25:01 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:25:01 [http-nio-8080-exec-1] DEBUG j.s.s.servicios.UsuarioServicio - Actualizando usuario ID: 6 en empresa ID: 2
2026-01-22 18:25:01 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        u1_0.id=? 
        and e1_0.id=?
2026-01-22 18:25:01 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [6]
2026-01-22 18:25:01 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:25:01 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:25:01 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:25:01 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono,
        u1_0.nombre_usuario,
        u1_0.rol,
        s1_0.id,
        s1_0.direccion,
        s1_0.email,
        s1_0.empresa_id,
        e2_0.id,
        e2_0.email_contacto,
        e2_0.estado,
        e2_0.fecha_creacion,
        e2_0.nombre,
        e2_0.plan,
        e2_0.subdominio,
        e2_0.telefono,
        s1_0.nombre,
        s1_0.telefono 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    left join
        sucursal s1_0 
            on s1_0.id=u1_0.sucursal_id 
    left join
        empresa e2_0 
            on e2_0.id=s1_0.empresa_id 
    where
        u1_0.id=?
2026-01-22 18:25:01 [http-nio-8080-exec-1] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [6]
2026-01-22 18:25:01 [http-nio-8080-exec-1] INFO  j.s.s.servicios.UsuarioServicio - Usuario actualizado exitosamente: cajero1 (ID: 6)
2026-01-22 18:25:01 [http-nio-8080-exec-1] INFO  j.s.s.c.UsuarioControlador - ‚úÖ Usuario actualizado exitosamente ID: 6 - Nuevo rol: CAJERO
2026-01-22 18:25:01 [http-nio-8080-exec-1] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 41, Tenant anterior: 2
2026-01-22 18:25:01 [http-nio-8080-exec-1] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 41, Request: /admin/usuarios/actualizar/6, Empresa ID anterior: 2
2026-01-22 18:25:01 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /admin/usuarios
2026-01-22 18:25:01 [http-nio-8080-exec-2] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=F21F931A8791A95E43E5897900E6E815], Granted Authorities=[ROLE_ADMIN]]]
2026-01-22 18:25:01 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured GET /admin/usuarios
2026-01-22 18:25:01 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /admin/usuarios, M√©todo: GET
2026-01-22 18:25:01 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:25:01 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:25:01 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:25:01 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:25:01 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 42
2026-01-22 18:25:01 [http-nio-8080-exec-2] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:25:01 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-22 18:25:01 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-22 18:25:01 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:25:01 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-22 18:25:01 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:25:01 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:25:01 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:25:01 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-22 18:25:01 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /admin/usuarios, Empresa ID: 2
2026-01-22 18:25:01 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:25:01 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:25:01 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:25:01 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:25:01 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:25:01 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:25:01 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:25:01 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:25:01 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:25:01 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:25:01 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: true (Empresa ID: 2)
2026-01-22 18:25:01 [http-nio-8080-exec-2] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-21 cerrado correctamente
2026-01-22 18:25:01 [http-nio-8080-exec-2] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-22 18:25:01 [http-nio-8080-exec-2] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public java.lang.String jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador.listarUsuarios(org.springframework.ui.Model); target is of class [jpd.sistemafacinv.sistemadefacturacioneinventario.controladores.UsuarioControlador]
2026-01-22 18:25:01 [http-nio-8080-exec-2] INFO  j.s.s.c.UsuarioControlador - üìã GET /admin/usuarios - Listando usuarios
2026-01-22 18:25:01 [http-nio-8080-exec-2] DEBUG j.s.s.servicios.UsuarioServicio - Listando usuarios para empresa ID: 2
2026-01-22 18:25:01 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    left join
        empresa e1_0 
            on e1_0.id=u1_0.empresa_id 
    where
        e1_0.id=?
2026-01-22 18:25:01 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:25:01 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:25:01 [http-nio-8080-exec-2] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:25:01 [http-nio-8080-exec-2] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 42, Tenant anterior: 2
2026-01-22 18:25:01 [http-nio-8080-exec-2] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 42, Request: /admin/usuarios, Empresa ID anterior: 2
2026-01-22 18:25:04 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-22 18:25:04 [http-nio-8080-exec-3] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=F21F931A8791A95E43E5897900E6E815], Granted Authorities=[ROLE_ADMIN]]]
2026-01-22 18:25:04 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-22 18:25:04 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-22 18:25:04 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:25:04 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:25:04 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:25:04 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:25:04 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 43
2026-01-22 18:25:04 [http-nio-8080-exec-3] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:25:04 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: admin
2026-01-22 18:25:04 [http-nio-8080-exec-3] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: admin en empresa ID: 2
2026-01-22 18:25:04 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:25:04 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [admin]
2026-01-22 18:25:04 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:25:04 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:25:04 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:25:04 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario admin validado para empresa 2
2026-01-22 18:25:04 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-22 18:25:04 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:25:04 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:25:04 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:25:04 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:25:04 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:25:04 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:25:04 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:25:04 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:25:04 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:25:04 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:25:04 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: true (Empresa ID: 2)
2026-01-22 18:25:04 [http-nio-8080-exec-3] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-21 cerrado correctamente
2026-01-22 18:25:04 [http-nio-8080-exec-3] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-22
2026-01-22 18:25:04 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-22 18:25:04 [http-nio-8080-exec-3] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:25:04 [http-nio-8080-exec-3] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-22
2026-01-22 18:25:04 [http-nio-8080-exec-3] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-22 18:25:04 [http-nio-8080-exec-3] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 43, Tenant anterior: 2
2026-01-22 18:25:04 [http-nio-8080-exec-3] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 43, Request: /principal, Empresa ID anterior: 2
2026-01-22 18:25:05 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing POST /logout
2026-01-22 18:25:05 [http-nio-8080-exec-4] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=F21F931A8791A95E43E5897900E6E815], Granted Authorities=[ROLE_ADMIN]]]
2026-01-22 18:25:05 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.logout.LogoutFilter - Logging out [UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=F21F931A8791A95E43E5897900E6E815], Granted Authorities=[ROLE_ADMIN]]]
2026-01-22 18:25:05 [http-nio-8080-exec-4] DEBUG o.s.s.w.a.l.SecurityContextLogoutHandler - Invalidated session BF5F214FB547E8B6B05C417CED8F9084
2026-01-22 18:25:05 [http-nio-8080-exec-4] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /login?logout
2026-01-22 18:25:05 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login?logout
2026-01-22 18:25:05 [http-nio-8080-exec-5] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login?logout
2026-01-22 18:25:05 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-22 18:25:05 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:25:05 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:25:05 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:25:05 [http-nio-8080-exec-5] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:25:05 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 45
2026-01-22 18:25:05 [http-nio-8080-exec-5] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:25:05 [http-nio-8080-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-22 18:25:05 [http-nio-8080-exec-5] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-22 18:25:05 [http-nio-8080-exec-5] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 45, Tenant anterior: 2
2026-01-22 18:25:05 [http-nio-8080-exec-5] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 45, Request: /login, Empresa ID anterior: 2
2026-01-22 18:25:10 [http-nio-8080-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-22 18:25:10 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: cajero1 para la empresa ID: null
2026-01-22 18:25:10 [http-nio-8080-exec-6] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: cajero1 | Subdominio: jose
2026-01-22 18:25:10 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:25:10 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:25:10 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: cajero1 | Subdominio: jose | Empresa ID: 2 | Empresa Nombre: Empresa JOse
2026-01-22 18:25:10 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:25:10 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [cajero1]
2026-01-22 18:25:10 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:25:10 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:25:10 [http-nio-8080-exec-6] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:25:10 [http-nio-8080-exec-6] INFO  j.s.s.servicios.UsuarioServicio - üîê Encontrado usuario: cajero1
2026-01-22 18:25:10 [http-nio-8080-exec-6] INFO  j.s.s.servicios.UsuarioServicio - üîê Rol: CAJERO
2026-01-22 18:25:10 [http-nio-8080-exec-6] DEBUG j.s.s.servicios.UsuarioServicio - üîê Activo: true
2026-01-22 18:25:10 [http-nio-8080-exec-6] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Failed to authenticate since password does not match stored value
2026-01-22 18:25:10 [http-nio-8080-exec-6] DEBUG o.s.s.authentication.ProviderManager - Authentication failed with provider DaoAuthenticationProvider since Bad credentials
2026-01-22 18:25:10 [http-nio-8080-exec-6] DEBUG o.s.s.authentication.ProviderManager - Denying authentication since all attempted providers failed
2026-01-22 18:25:10 [http-nio-8080-exec-6] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /login?error
2026-01-22 18:25:10 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing GET /login?error
2026-01-22 18:25:10 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured GET /login?error
2026-01-22 18:25:10 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /login, M√©todo: GET
2026-01-22 18:25:10 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:25:10 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:25:10 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:25:10 [http-nio-8080-exec-7] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:25:10 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 47
2026-01-22 18:25:10 [http-nio-8080-exec-7] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:25:10 [http-nio-8080-exec-7] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2026-01-22 18:25:10 [http-nio-8080-exec-7] INFO  j.s.s.controladores.InicioController - üîê GET /login - Mostrando p√°gina de login
2026-01-22 18:25:10 [http-nio-8080-exec-7] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 47, Tenant anterior: 2
2026-01-22 18:25:10 [http-nio-8080-exec-7] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 47, Request: /login, Empresa ID anterior: 2
2026-01-22 18:25:17 [http-nio-8080-exec-8] DEBUG o.s.security.web.FilterChainProxy - Securing POST /login
2026-01-22 18:25:17 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - Autenticando usuario: cajero1 para la empresa ID: null
2026-01-22 18:25:17 [http-nio-8080-exec-8] INFO  j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: cajero1 | Subdominio: jose
2026-01-22 18:25:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:25:17 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:25:17 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - üîê Login - Usuario: cajero1 | Subdominio: jose | Empresa ID: 2 | Empresa Nombre: Empresa JOse
2026-01-22 18:25:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:25:17 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [cajero1]
2026-01-22 18:25:17 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:25:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:25:17 [http-nio-8080-exec-8] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:25:17 [http-nio-8080-exec-8] INFO  j.s.s.servicios.UsuarioServicio - üîê Encontrado usuario: cajero1
2026-01-22 18:25:17 [http-nio-8080-exec-8] INFO  j.s.s.servicios.UsuarioServicio - üîê Rol: CAJERO
2026-01-22 18:25:17 [http-nio-8080-exec-8] DEBUG j.s.s.servicios.UsuarioServicio - üîê Activo: true
2026-01-22 18:25:17 [http-nio-8080-exec-8] DEBUG o.s.s.a.d.DaoAuthenticationProvider - Authenticated user
2026-01-22 18:25:17 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.s.ChangeSessionIdAuthenticationStrategy - Changed session id from 582188B48EF0C9D4EAB600ADAD57920C
2026-01-22 18:25:17 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.CsrfAuthenticationStrategy - Replaced CSRF Token
2026-01-22 18:25:17 [http-nio-8080-exec-8] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Stored SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=cajero1, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=582188B48EF0C9D4EAB600ADAD57920C], Granted Authorities=[ROLE_CAJERO]]] to HttpSession [org.apache.catalina.session.StandardSessionFacade@3b8f3fc2]
2026-01-22 18:25:17 [http-nio-8080-exec-8] DEBUG o.s.s.w.a.UsernamePasswordAuthenticationFilter - Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=cajero1, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=582188B48EF0C9D4EAB600ADAD57920C], Granted Authorities=[ROLE_CAJERO]]
2026-01-22 18:25:17 [http-nio-8080-exec-8] DEBUG o.s.s.web.DefaultRedirectStrategy - Redirecting to /principal
2026-01-22 18:25:17 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Securing GET /principal
2026-01-22 18:25:17 [http-nio-8080-exec-9] DEBUG o.s.s.w.c.HttpSessionSecurityContextRepository - Retrieved SecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=cajero1, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_CAJERO]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=582188B48EF0C9D4EAB600ADAD57920C], Granted Authorities=[ROLE_CAJERO]]]
2026-01-22 18:25:17 [http-nio-8080-exec-9] DEBUG o.s.security.web.FilterChainProxy - Secured GET /principal
2026-01-22 18:25:17 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üìå TenantFilter - RUTA: /principal, M√©todo: GET
2026-01-22 18:25:17 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üåê Server Name: jose.localhost
2026-01-22 18:25:17 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üîç Subdominio extra√≠do: jose
2026-01-22 18:25:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.subdominio=?
2026-01-22 18:25:17 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [jose]
2026-01-22 18:25:17 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üîß TenantContext.setCurrentTenant(2) - Hilo: 49
2026-01-22 18:25:17 [http-nio-8080-exec-9] INFO  j.s.s.context.TenantFilter - ‚úÖ Empresa establecida desde subdominio: 2 (Subdominio: jose)
2026-01-22 18:25:17 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - üë§ Usuario autenticado en TenantFilter: cajero1
2026-01-22 18:25:17 [http-nio-8080-exec-9] DEBUG j.s.s.servicios.UsuarioServicio - Buscando usuario: cajero1 en empresa ID: 2
2026-01-22 18:25:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.activo,
        u1_0.contrasenna,
        u1_0.empresa_id,
        u1_0.nombre_usuario,
        u1_0.rol,
        u1_0.sucursal_id 
    from
        usuario u1_0 
    where
        u1_0.nombre_usuario=? 
        and u1_0.empresa_id=?
2026-01-22 18:25:17 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:VARCHAR) <- [cajero1]
2026-01-22 18:25:17 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:BIGINT) <- [2]
2026-01-22 18:25:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        e1_0.id,
        e1_0.email_contacto,
        e1_0.estado,
        e1_0.fecha_creacion,
        e1_0.nombre,
        e1_0.plan,
        e1_0.subdominio,
        e1_0.telefono 
    from
        empresa e1_0 
    where
        e1_0.id=?
2026-01-22 18:25:17 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:BIGINT) <- [2]
2026-01-22 18:25:17 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantFilter - ‚úÖ Usuario cajero1 validado para empresa 2
2026-01-22 18:25:17 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üõ°Ô∏è Interceptor ejecutando - Ruta: /principal, Empresa ID: 2
2026-01-22 18:25:17 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - üìÖ Validaci√≥n de cierre - Fecha: 2026-01-22, Hora: 18:00
2026-01-22 18:25:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:25:17 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:25:17 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:25:17 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:25:17 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Despu√©s de las 5:00 AM ‚Üí Validar AYER: 2026-01-21
2026-01-22 18:25:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        case 
            when count(cid1_0.id)>0 
                then 1 
            else 0 
    end 
from
    cierre_inventario_diario cid1_0 
where
    cid1_0.fecha=? 
    and cid1_0.estado=? 
    and cid1_0.empresa_id=?
2026-01-22 18:25:17 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-21]
2026-01-22 18:25:17 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (2:VARCHAR) <- [COMPLETADO]
2026-01-22 18:25:17 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (3:BIGINT) <- [2]
2026-01-22 18:25:17 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ¬øD√≠a 2026-01-21 cerrado?: true (Empresa ID: 2)
2026-01-22 18:25:17 [http-nio-8080-exec-9] DEBUG j.s.s.config.CierreDiarioInterceptor - ‚úÖ Acceso permitido - D√≠a 2026-01-21 cerrado correctamente
2026-01-22 18:25:17 [http-nio-8080-exec-9] DEBUG j.s.s.c.DashboardControlador - üìÖ Agregando estado del d√≠a: 2026-01-22
2026-01-22 18:25:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        cid1_0.id,
        cid1_0.cantidad_facturas,
        cid1_0.empresa_id,
        cid1_0.estado,
        cid1_0.fecha,
        cid1_0.observaciones,
        cid1_0.total_ventas,
        cid1_0.usuario_id 
    from
        cierre_inventario_diario cid1_0 
    where
        cid1_0.fecha=? 
        and cid1_0.estado='COMPLETADO'
2026-01-22 18:25:17 [http-nio-8080-exec-9] TRACE org.hibernate.orm.jdbc.bind - binding parameter (1:DATE) <- [2026-01-22]
2026-01-22 18:25:17 [http-nio-8080-exec-9] DEBUG j.s.s.c.DashboardControlador - No hay cierre completado para hoy: 2026-01-22
2026-01-22 18:25:17 [http-nio-8080-exec-9] INFO  j.s.s.c.DashboardControlador - üè† GET /principal - Accediendo al dashboard principal
2026-01-22 18:25:17 [http-nio-8080-exec-9] DEBUG j.s.s.context.TenantContext - üßπ TenantContext.clear() - Hilo: 49, Tenant anterior: 2
2026-01-22 18:25:17 [http-nio-8080-exec-9] DEBUG j.s.s.c.TenantContextCleanupFilter - ‚úÖ TenantContext limpiado - Hilo: 49, Request: /principal, Empresa ID anterior: 2
2026-01-22 18:47:46 [SpringApplicationShutdownHook] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2026-01-22 18:47:46 [tomcat-shutdown] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2026-01-22 18:47:46 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2026-01-22 18:47:46 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2026-01-22 18:47:46 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
